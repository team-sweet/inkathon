!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).DigitalInk={})}(this,function(exports){"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function asyncGeneratorStep(t,e,i,n,r,o,a){try{var s=t[o](a),l=s.value}catch(t){return void i(t)}s.done?e(l):Promise.resolve(l).then(n,r)}function _asyncToGenerator(t){return function(){var e=this,i=arguments;return new Promise(function(n,r){var o=t.apply(e,i);function a(t){asyncGeneratorStep(o,n,r,a,s,"next",t)}function s(t){asyncGeneratorStep(o,n,r,a,s,"throw",t)}a(void 0)})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _get(t,e,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=_superPropBase(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(i):r.value}})(t,e,i||t)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}String.prototype.contains||(String.prototype.contains=function(t){return-1!=this.indexOf(t)}),String.prototype.startsWith||(String.prototype.startsWith=function(t){return this.length>=t.length&&this.substring(0,t.length)==t}),String.prototype.endsWith||(String.prototype.endsWith=function(t){return this.length>=t.length&&this.substring(this.length-t.length,this.length)==t}),String.prototype.charsCode=function(){return this.split("").reduce(function(t,e){return t+e.charCodeAt(0)},0)},String.prototype.containsIgnoreCase=function(t){return-1!=this.toUpperCase().indexOf(t.toUpperCase())},String.prototype.toCharArray=function(t){var e=t?new Uint8Array(this.length):new Array(this.length);e.bytes=!0;for(var i=0;i<this.length;i++){var n=this.charCodeAt(i);n>255&&(e.bytes=!1),e[i]=n}return e},String.fromCharArray=function(t){var e="";try{e=String.fromCharCode.apply(null,t)}catch(t){for(var i=0;i<bytes.length;i++)e+=String.fromCharCode(bytes[i])}return e},String.prototype.pad=function(t,e){return this.length<t?new Array(t-this.length+1).join(e||"-")+this:this.toString()},Number.prototype.pad=function(t){return String(this).length<t?new Array(t-String(this).length+1).join(0)+String(this):this.toString()},Number.prototype.toFloat32=function(){var t=new Float32Array(1);return t[0]=this,t[0]},Object.defineProperty(Array.prototype,"first",{get:function(){return this[0]},configurable:!0}),Object.defineProperty(Array.prototype,"last",{get:function(){return this[this.length-1]},configurable:!0}),Array.prototype.contains=function(t){return this.indexOf(t)>-1},Array.prototype.clone=function(){var t=new Array;return this.forEach(function(e){t.push(Object.clone(e))}),t},Array.prototype.pushArray=function(){this.push.apply(this,this.concat.apply([],arguments))},Array.prototype.add=function(t){if(!this.contains(t))return this.push(t)},Array.prototype.remove=function(t){return this.removeAt(this.indexOf(t))},Array.prototype.removeAt=function(t){return t>-1&&this.splice(t,1),this},Array.prototype.replace=function(t,e,i){var n=this.indexOf(t);if(n>-1)if(!i&&e instanceof Array){for(var r=[n,1],o=0;o<e.length;o++)r.push(e[o]);this.splice.apply(this,r)}else this.splice(n,1,e);return this},Array.protoTypedArrays=function(){["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].forEach(function(type){var TypedArray;try{TypedArray=eval(type+"Array")}catch(t){return void console.warn(type+"Array not found")}TypedArray.from?Array.prototype["to"+type+"Array"]=function(){return TypedArray.from(this)}:Array.prototype["to"+type+"Array"]=function(){return new TypedArray(this)},Array.from?TypedArray.prototype.toArray=function(){return Array.from(this)}:TypedArray.prototype.toArray=function(){return Array.prototype.slice.call(this)},TypedArray.prototype.clone=function(){return new TypedArray(this,this.byteOffset,this.length)}})},Array.protoTypedArrays(),delete Array.protoTypedArrays,ArrayBuffer.isTypedArray=function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},Function.name||(Function.name="Function"),Array.prototype.constructor.name||(Array.prototype.constructor.name="Array"),Function.create=function(t,e){e||(e=function(){});var i=e.getArguments(),n=new Function("body","return function "+t+"("+i+") {return body.apply(this, arguments);};")(e);return n.toString=function(){return e.toString()},n.toSource=function(){return e.toSource()},n},"name"in Function.prototype||Object.defineProperty(Function.prototype,"name",{configurable:!0,get:function(){var t=this.toString().match(/^function\s([\w$]+)/);return t?t[1]:""}}),Function.prototype.getArguments=function(){var t=this.toString().match(/\((.*?)\)/)[1].replace(/\s*/g,"");return 0==t.length?[]:t.split(",")},Function.prototype.getBody=function(){return this.toString().match(/\{([\s\S]*)\}/m)[1].replace(/^\s*\/\/.*$/gm,"")},Function.prototype.construct=function(t){var e=arguments.callee.caller.arguments;this.getArguments().forEach(function(t,i){this[t]=e[i]},t)},Function.prototype.createEnum=function(t,e){if(this[t])throw new Error("Already exists key: "+t);this[t]=new Object;for(var i=0;i<e.length;i++){var n=t+"_"+e[i],r=this[t];r[e[i]]=function(){var o=Object.create(Object.prototype,{constructor:{value:Function.create(n)},type:{value:t},name:{value:e[i]},value:{value:i}});return Object.defineProperty(r,i,{get:function(){return o}}),o}()}},Function.prototype.argsToJSON=function(t){var e={};t||(t={});var i=arguments.callee.caller.arguments;return this.getArguments().forEach(function(n,r){e[n]=i[r],void 0===e[n]&&n in t&&(e[n]=t[n])}),e},Function.prototype.getInheritanceChain=function(){var t=new Array,e=this.constructor;for(t.push(this.prototype.constructor);"Function"!=e.name;)t.push(e),e=e.constructor;return e!=this.prototype.constructor&&t.push(e),t},Function.prototype.isClassMethod=function(t){var e=!1;if(t.name)e=this.prototype[t.name]==t;else for(var i in this.prototype)if(this.prototype[i]==t){e=!0;break}return e},Function.prototype.extends=function(t){for(var e in this.prototype=Object.create(t.prototype),Object.defineProperty(this.prototype,"constructor",{value:this,enumerable:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"constructor",{value:t.prototype.constructor,enumerable:!1,writable:!0,configurable:!0}),t)t.hasOwnProperty(e)&&(this[e]=t[e]);this.prototype.$parent||Object.defineProperty(this.prototype,"super",{get:function(){var t,e=this,i=this.constructor.getInheritanceChain(),n=arguments.callee.caller;if(!n)return null;if(i.contains(n)){for(var r=this.constructor.constructor,o=i.indexOf(n);o>0;)r=r.constructor,o--;(t=function(){r.apply(e,arguments)}).bind=function(t){var i=r.prototype[t];if(!i)throw new Error("super function with name '"+t+"' not found");return function(){return i.apply(e,arguments)}}}else{for(var a,s=0;s<i.length;s++){var l=i[s];if(l.isClassMethod(n)){a=l;break}}if(!a)throw new Error("super call is outside of inheritance chain");var u=function(t){for(var i=a.prototype[t],n=a.constructor;n&&n.prototype[t]==i;)"Function"==(n=n.constructor).name&&(n=null);if(!n)throw new Error("super not found");var r=n.prototype[t];if(!r)throw new Error("super function with name '"+t+"' not found");return function(){return r.apply(e,arguments)}};(t=function(t){if(!t||"string"!=typeof t)throw new Error("super function 'name' is required");return u(t).apply(e,Array.prototype.splice.call(arguments,1))}).bind=u}return t}})},Object.extend=function(t,e,i){var n=!1,r=i?t.$parent:null;for(var o in r||i||((r=new Object).$$=new Object),e)i||"function"!=typeof t[o]?"object"==_typeof(t[o])?Object.extend(t[o],e[o],i):t[o]=e[o]:(r.$$[o]=t[o],function(t){r[t]=function(){var e=this.$$.context;if(!e)throw new Error('Context not found in "'+arguments.callee.caller.name+'".');return this.$$[t].apply(e,arguments)}}(o),t[o]=e[o],n=!0);if(n&&!i){if(t.hasOwnProperty("super")||Object.defineProperty(t,"super",{get:function(){var t=arguments.callee.caller;if(!t)throw'"super" not applicable for root';var e=t.lvl;if(e>0)for(var i=this.$parent;i.$$.lvl>e-1;)i=i.$parent;else i=this.$parent;return i.$$.context=this,i}}),t.$parent)for(o in r.$parent=t.$parent,r.$$.lvl=t.$parent.$$.lvl+1,r.$parent)"function"==typeof r.$parent[o]&&void 0===r[o]&&function(t){r[t]=function(){return this.$parent.$$.context||(this.$parent.$$.context=this.$$.context),this.$parent[t].apply(this.$parent,arguments)}}(o);else r.$$.lvl=1;for(o in r.$$)"function"==typeof r.$$[o]&&(r.$$[o].lvl=r.$$.lvl);t.$parent=r}},Object.equals=function(t,e){if(t===e)return!0;if(!(t instanceof Object&&e instanceof Object))return!1;if(t.constructor!==e.constructor)return!1;for(var i in t)if(t.hasOwnProperty(i)){if(!e.hasOwnProperty(i))return!1;if(t[i]!==e[i]){if("object"!==_typeof(t[i]))return!1;if(!Object.equals(t[i],e[i]))return!1}}for(i in e)if(e.hasOwnProperty(i)&&!t.hasOwnProperty(i))return!1;return!0},Object.clone=function(t,e){var i=new Array;return function t(n){if(null===n)return null;if("object"!==_typeof(n)||n.mutable)return n;if("function"==typeof n.clone)return n.clone();for(var r=0;r<i.length;r++)if(i[r][0]===n)return i[r][1];var o=Object.create(Object.getPrototypeOf(n));for(sPropertyName in i.push([n,o]),n)e&&"function"==typeof n[sPropertyName]||n.hasOwnProperty(sPropertyName)&&(o[sPropertyName]=t(n[sPropertyName]));return o}(t)},Object.nameAnonymousFunctions=function(t,e){for(var i in t)"function"!=typeof t[i]||t[i].name||("constructor"==i&&e?Object.defineProperty(t[i],"name",{value:e}):Object.defineProperty(t[i],"name",{value:i}))},JSON.toBase64=function(t){return btoa(JSON.stringify(t))},JSON.fromBase64=function(t){return JSON.parse(atob(t))},JSON.encode=function(t){return JSON.toBase64(t).toCharArray(!0)},JSON.decode=function(t){var e=String.fromCharArray(t);return JSON.fromBase64(e)},Math.toDegrees=function(t){return t*(180/this.PI)},Math.toRadians=function(t){return t*(this.PI/180)},Math.randomInt=function(t,e){return Math.floor(this.random()*(e-t+1))+t};var _ENVIRONMENT=function(){if("undefined"!=typeof ENVIRONMENT)return ENVIRONMENT;var t,e="object"===("undefined"==typeof window?"undefined":_typeof(window)),i="function"==typeof importScripts,n="object"===("undefined"==typeof process?"undefined":_typeof(process))&&"function"==typeof require&&!e&&!i;return t=e?window:i?self:global,Function.prototype.createEnum.call(t,"EnvironmentType",["WEB","WORKER","NODE","SHELL"]),t.ENVIRONMENT=e?EnvironmentType.WEB:i?EnvironmentType.WORKER:n?EnvironmentType.NODE:EnvironmentType.SHELL,t.ENVIRONMENT}(),Kotlin;if(_ENVIRONMENT==EnvironmentType.WEB&&(HTMLElement.prototype.getInlineStyle=function(t){return this.style[t]||this.style["-webkit-"+t]||this.style["-khtml-"+t]||this.style["-moz-"+t]||this.style["-ms-"+t]||this.style["-o-"+t]||""},HTMLElement.prototype.setStyle=function(t,e){["-webkit","-khtml","-moz","-ms","-o"].forEach(function(i){this.style[i+"-"+t]=e},this),this.style[t]=e},HTMLElement.prototype.getStyle=function(t){var e=t,i=t.startsWith("-");i&&(e=t.substring(1));for(var n=e.split("-"),r=n.length-1;r>0;r--)n[r]=n[r].substring(0,1).toUpperCase()+n[r].substring(1);e=n.join("");var o=window.getComputedStyle?document.defaultView.getComputedStyle(this,null)[e]:this.currentStyle[e];if(!i&&void 0===o){var a=["-webkit","-khtml","-moz","-ms","-o"];for(r=0;r<a.length&&"undefined"==(o=this.getStyle(a[r]+"-"+t));r++);}return o},HTMLElement.prototype.getMathStyle=function(t,e){var i=e?this.getInlineStyle(t):this.getStyle(t);return"auto"==i&&(i=0),parseFloat(i)},HTMLElement.prototype.getTransformStyle=function(){var t={translate:{x:0,y:0},scale:{x:1,y:1},rotate:{angle:0},skew:{angleX:0,angleY:0},matrix:{a:1,b:0,c:0,d:1,tx:0,ty:0}},e=this.getStyle("transform");if("none"!=e){var i=e.substring(e.indexOf("(")+1,e.indexOf(")")).split(/,\s*/g),n=parseFloat(i[0]),r=parseFloat(i[1]),o=parseFloat(i[2]),a=parseFloat(i[3]),s=parseFloat(i[4]),l=parseFloat(i[5]);t.scale={x:Math.sqrt(n*n+o*o),y:Math.sqrt(a*a+r*r)},t.skew={angleX:Math.tan(o),angleY:Math.tan(r)},t.rotate={angle:Math.atan2(r,n)},t.translate={x:s,y:l},t.matrix={a:n,b:r,c:o,d:a,tx:s,ty:l}}return t},HTMLElement.prototype.toRect=function(t){var e=new Object,i=(this.getTransformStyle().rotate.angle,this.getBoundingClientRect());return e.width=this.offsetWidth,e.height=this.offsetHeight,e.left=this.offsetLeft,e.top=this.offsetTop,e.right=e.left+e.width,e.bottom=e.top+e.height,e.scaleFactor=Math.max(e.width,e.height)/Math.min(e.width,e.height),e.offsetWidth=this.offsetWidth,e.offsetHeight=this.offsetHeight,e.fullWidth=this.offsetWidth+this.getMathStyle("margin-left")+this.getMathStyle("margin-right"),e.fullHeight=this.offsetHeight+this.getMathStyle("margin-top")+this.getMathStyle("margin-bottom"),e.center={x:e.width/2,y:e.height/2},e.rotationFrameWidth=i.width,e.rotationFrameHeight=i.height,e.rotationCenter={x:i.width/2,y:i.height/2},Object.defineProperty(e,"x",{get:function(){return this.left}}),Object.defineProperty(e,"y",{get:function(){return this.top}}),e.centerOnParent={x:e.left+e.rotationCenter.x,y:e.top+e.rotationCenter.y},e.centerOnScreen={x:i.left+e.rotationCenter.x,y:i.top+e.rotationCenter.y},e},HTMLImageElement.prototype.toDataURL=function(t){var e=document.createElement("canvas");return e.width=this.width,e.height=this.height,e.getContext("2d").drawImage(this,0,0),e.toDataURL(t||"image/png")},HTMLImageElement.prototype.toBlob=function(t){return new Blob([this.getBytes(t).buffer],{type:t||"image/png"})},HTMLImageElement.prototype.getBytes=function(t){var e=this.toDataURL(t).split(",")[1];return atob(e).toCharArray(!0)},Image.fromBytes=function(t,e,i){var n=new Image;return n.onload=function(){URL.revokeObjectURL(this.src),e&&e.call(this)},n.src=URL.createObjectURL(new Blob([t.buffer],{type:"image/"+(i||"png")})),n},CanvasRenderingContext2D.prototype.clearCanvas=function(t){this.clearRect(0,0,this.canvas.width,this.canvas.height),t&&(this.fillStyle=t,this.fillRect(0,0,this.canvas.width,this.canvas.height))},"undefined"==typeof OffscreenCanvas?(window.OffscreenCanvas=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i},window.OffscreenCanvasRenderingContext2D=CanvasRenderingContext2D):"undefined"!=typeof OffscreenCanvasRenderingContext2D&&(OffscreenCanvasRenderingContext2D.prototype.clearCanvas=CanvasRenderingContext2D.prototype.clearCanvas),Object.defineProperty(Screen.prototype,"deviceWidth",{get:function(){if(90==window.orientation||-90==window.orientation){if(!this.orientation)return this.orientation=!0,this.deviceHeight;delete this.orientation}var t=this.width;return window.matchMedia("(-webkit-device-pixel-ratio)").matches||(t=Math.ceil(t*window.devicePixelRatio))%10!=0&&(t%10>5?t+=10-t%10:t-=t%10),t},configurable:!0}),Object.defineProperty(Screen.prototype,"deviceHeight",{get:function(){if(90==window.orientation||-90==window.orientation){if(!this.orientation)return this.orientation=!0,this.deviceWidth;delete this.orientation}var t=this.height;return window.matchMedia("(-webkit-device-pixel-ratio)").matches||(t=Math.ceil(t*window.devicePixelRatio))%10!=0&&(t%10>5?t+=10-t%10:t-=t%10),t},configurable:!0}),function(){try{"x"in document.createElement("div").getBoundingClientRect()||Object.extend(HTMLElement.prototype,{getBoundingClientRect:function(){var t=this.super.getBoundingClientRect();return t.x=t.left,t.y=t.top,t}})}catch(t){}}(),"undefined"==typeof createImageBitmap&&(window.createImageBitmap=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,i){var n=new Image;n.crossOrigin="anonymous",e instanceof Blob?n.src=URL.createObjectURL(e):n.src=e,n.onload=function(){return t(n)},n.onerror=i}));case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())),"undefined"==typeof kotlin)throw new Error("Error loading module 'DigitalInk'. Its dependency 'kotlin' was not found. Please, check whether 'kotlin' is loaded prior to 'DigitalInk'.");Kotlin=kotlin;var DigitalInk={};!function(t){var e,i,n,r,o=t.$$importsForInline$$||(t.$$importsForInline$$={}),a=Kotlin.Kind.CLASS,s=Kotlin.kotlin.collections.indexOf_mjy6jw$,l=Kotlin.kotlin.collections.ArrayList_init_287e2$,u=Kotlin.kotlin.Enum,h=Kotlin.throwISE,c=Kotlin.kotlin.Unit,v=Kotlin.numberToDouble,p=Kotlin.Kind.OBJECT,f=Kotlin.kotlin.io.println_s8jyv4$,d=Kotlin.equals,_=Kotlin.hashCode,x=Kotlin.ensureNotNull,b=Kotlin.kotlin.collections.ArrayList_init_ww73n8$,$=Kotlin.kotlin.NullPointerException,y=Kotlin.kotlin.collections.contains_mjy6jw$,g=Kotlin.kotlin.IllegalArgumentException_init_pdl1vj$,m=Kotlin.throwCCE,E=Kotlin.kotlin.Triple,P=Kotlin.kotlin.math,w=Kotlin.Long.ZERO,I=Kotlin.numberToInt,S=Kotlin.kotlin.collections.listOf_i5x0yv$,A=Kotlin.kotlin.collections.plus_mydzjv$,k=Kotlin.kotlin.collections.ArrayList_init_mqih57$,T=Kotlin.kotlin.ranges.until_dqglrj$,C=Kotlin.kotlin.collections.slice_6bjbi1$,L=Kotlin.kotlin.collections.arrayListOf_i5x0yv$,O=Kotlin.kotlin.js.internal.FloatCompanionObject,R=Kotlin.kotlin.collections.flatten_u0ad8z$,D=Kotlin.arrayEquals,N=Kotlin.arrayHashCode,z=Kotlin.kotlin.IllegalStateException_init_pdl1vj$,M=Kotlin.kotlin.Pair,F=Kotlin.kotlin.collections.ArrayList,B=Kotlin.kotlin.isNaN_81szk$,X=Kotlin.kotlin.collections.last_2p1efm$,Y=Kotlin.toString,j=Kotlin.kotlin.collections.addAll_ye1y7v$,U=Kotlin.defineInlineFunction,G=Kotlin.wrapFunction,K=Kotlin.kotlin.math.abs_za3lpa$,q=Kotlin.kotlin.collections.mutableListOf_i5x0yv$,H=Kotlin.kotlin.collections.firstOrNull_2p1efm$,W=Kotlin.kotlin.collections.MutableList,V=Kotlin.throwUPAE,Z=Kotlin.kotlin.Comparator,J=Kotlin.getPropertyCallableRef,Q=Kotlin.kotlin.ranges.downTo_dqglrj$,tt=Kotlin.kotlin.Exception,et=Kotlin.kotlin.collections.sortWith_nqfjgj$,it=Kotlin.kotlin.ranges.IntRange,nt=Kotlin.kotlin.Exception_init_pdl1vj$,rt=Kotlin.kotlin.collections.toFloatArray_zwy31$,ot=Kotlin.kotlin.js.json_pyyo18$,at=Kotlin.kotlin.collections.toList_rjqryz$,st=Kotlin.numberToLong;function lt(t,e,i,n){this.x=t,this.y=e,this.z=i,this.w=n}function ut(t){return t=t||Object.create(lt.prototype),lt.call(t,0,0,0,0),t}function ht(t,e,i){var n=t.get_za3lpa$(s(i,ee())),r=t.get_za3lpa$(s(i,ie())),o=n-e.get_za3lpa$(s(i,ee())),a=r-e.get_za3lpa$(s(i,ie()));return o*o+a*a}function ct(t,e){var i,n=l();for(i=t.iterator();i.hasNext();){var r=i.next();n.add_11rb$(Xe().simplifyPolygonDouglasPeucker_sre3up$(r,e))}return n}function vt(t,e){u.call(this),this.name$=t,this.ordinal$=e}function pt(){pt=function(){},i=new vt("DEBUG",0),n=new vt("WARN",1),r=new vt("ERROR",2)}function ft(){return pt(),i}function dt(){return pt(),n}function _t(){return pt(),r}function xt(t,e,i,n,r,o,a,s,l,u,h,c,v,p,f,d){Vt(),this.v00=t,this.v01=e,this.v02=i,this.v03=n,this.v10=r,this.v11=o,this.v12=a,this.v13=s,this.v20=l,this.v21=u,this.v22=h,this.v23=c,this.v30=v,this.v31=p,this.v32=f,this.v33=d}vt.prototype=Object.create(u.prototype),vt.prototype.constructor=vt,Qt.prototype=Object.create(u.prototype),Qt.prototype.constructor=Qt,ge.prototype=Object.create(u.prototype),ge.prototype.constructor=ge,Se.prototype=Object.create(u.prototype),Se.prototype.constructor=Se,Ge.prototype=Object.create(Ue.prototype),Ge.prototype.constructor=Ge,Ke.prototype=Object.create(Ue.prototype),Ke.prototype.constructor=Ke,We.prototype=Object.create(je.prototype),We.prototype.constructor=We,ei.prototype=Object.create(Ue.prototype),ei.prototype.constructor=ei,ii.prototype=Object.create(Ue.prototype),ii.prototype.constructor=ii,ni.prototype=Object.create(Ue.prototype),ni.prototype.constructor=ni,oi.prototype=Object.create(Ue.prototype),oi.prototype.constructor=oi,ui.prototype=Object.create(Ue.prototype),ui.prototype.constructor=ui,Hi.prototype=Object.create(u.prototype),Hi.prototype.constructor=Hi,Ji.prototype=Object.create(u.prototype),Ji.prototype.constructor=Ji,nn.prototype=Object.create(u.prototype),nn.prototype.constructor=nn,ln.prototype=Object.create(u.prototype),ln.prototype.constructor=ln,fn.prototype=Object.create(u.prototype),fn.prototype.constructor=fn,bn.prototype=Object.create(u.prototype),bn.prototype.constructor=bn,Pn.prototype=Object.create(u.prototype),Pn.prototype.constructor=Pn,kn.prototype=Object.create(u.prototype),kn.prototype.constructor=kn,$r.prototype=Object.create(br.prototype),$r.prototype.constructor=$r,kr.prototype=Object.create(Ar.prototype),kr.prototype.constructor=kr,Gr.prototype=Object.create(tt.prototype),Gr.prototype.constructor=Gr,Kr.prototype=Object.create(u.prototype),Kr.prototype.constructor=Kr,lt.prototype.times_7ojuuq$=function(t){var e=new lt(0,0,0,0);return e.x=this.x*t.v00+this.y*t.v10+this.z*t.v20+this.w*t.v30,e.y=this.x*t.v01+this.y*t.v11+this.z*t.v21+this.w*t.v31,e.z=this.x*t.v02+this.y*t.v12+this.z*t.v22+this.w*t.v32,e.w=this.x*t.v03+this.y*t.v13+this.z*t.v23+this.w*t.v33,e},lt.prototype.dot_2u1m6d$=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lt.$metadata$={kind:a,simpleName:"DIPoint4",interfaces:[]},lt.prototype.component1=function(){return this.x},lt.prototype.component2=function(){return this.y},lt.prototype.component3=function(){return this.z},lt.prototype.component4=function(){return this.w},lt.prototype.copy_7b5o5w$=function(t,e,i,n){return new lt(void 0===t?this.x:t,void 0===e?this.y:e,void 0===i?this.z:i,void 0===n?this.w:n)},lt.prototype.toString=function(){return"DIPoint4(x="+Kotlin.toString(this.x)+", y="+Kotlin.toString(this.y)+", z="+Kotlin.toString(this.z)+", w="+Kotlin.toString(this.w)+")"},lt.prototype.hashCode=function(){var t=0;return t=31*(t=31*(t=31*(t=31*t+Kotlin.hashCode(this.x)|0)+Kotlin.hashCode(this.y)|0)+Kotlin.hashCode(this.z)|0)+Kotlin.hashCode(this.w)|0},lt.prototype.equals=function(t){return this===t||null!==t&&"object"===_typeof(t)&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&Kotlin.equals(this.x,t.x)&&Kotlin.equals(this.y,t.y)&&Kotlin.equals(this.z,t.z)&&Kotlin.equals(this.w,t.w)},vt.$metadata$={kind:a,simpleName:"LogLevel",interfaces:[u]},vt.values=function(){return[ft(),dt(),_t()]},vt.valueOf_61zpoe$=function(t){switch(t){case"DEBUG":return ft();case"WARN":return dt();case"ERROR":return _t();default:h("No enum constant com.wacom.digitalink.LogLevel."+t)}},Object.defineProperty(xt.prototype,"transposed",{get:function(){return this.clone().transpose()}}),xt.prototype.transpose=function(){return this.setColumns_8odxlg$(this.v00,this.v01,this.v02,this.v03,this.v10,this.v11,this.v12,this.v13,this.v20,this.v21,this.v22,this.v23,this.v30,this.v31,this.v32,this.v33)},xt.prototype.setRows_8odxlg$=function(t,e,i,n,r,o,a,s,l,u,h,c,v,p,f,d){return this.v00=t,this.v01=e,this.v02=i,this.v03=n,this.v10=r,this.v11=o,this.v12=a,this.v13=s,this.v20=l,this.v21=u,this.v22=h,this.v23=c,this.v30=v,this.v31=p,this.v32=f,this.v33=d,this},xt.prototype.setColumns_8odxlg$=function(t,e,i,n,r,o,a,s,l,u,h,c,v,p,f,d){return this.v00=t,this.v01=r,this.v02=l,this.v03=v,this.v10=e,this.v11=o,this.v12=u,this.v13=p,this.v20=i,this.v21=a,this.v22=h,this.v23=f,this.v30=n,this.v31=s,this.v32=c,this.v33=d,this},Object.defineProperty(xt.prototype,"determinant",{get:function(){return 0+this.v30*this.v21*this.v12*this.v03-this.v20*this.v31*this.v12*this.v03-this.v30*this.v11*this.v22*this.v03+this.v10*this.v31*this.v22*this.v03+this.v20*this.v11*this.v32*this.v03-this.v10*this.v21*this.v32*this.v03-this.v30*this.v21*this.v02*this.v13+this.v20*this.v31*this.v02*this.v13+this.v30*this.v01*this.v22*this.v13-this.v00*this.v31*this.v22*this.v13-this.v20*this.v01*this.v32*this.v13+this.v00*this.v21*this.v32*this.v13+this.v30*this.v11*this.v02*this.v23-this.v10*this.v31*this.v02*this.v23-this.v30*this.v01*this.v12*this.v23+this.v00*this.v31*this.v12*this.v23+this.v10*this.v01*this.v32*this.v23-this.v00*this.v11*this.v32*this.v23-this.v20*this.v11*this.v02*this.v33+this.v10*this.v21*this.v02*this.v33+this.v20*this.v01*this.v12*this.v33-this.v00*this.v21*this.v12*this.v33-this.v10*this.v01*this.v22*this.v33+this.v00*this.v11*this.v22*this.v33}}),xt.prototype.identity=function(){return this.setColumns_8odxlg$(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},xt.prototype.setToTranslation_1ugm5o$=function(t,e,i,n){return void 0===n&&(n=1),this.setToTranslation_7b5o5w$(v(t),v(e),v(i),v(n))},xt.prototype.setToTranslation_7b5o5w$=function(t,e,i,n){return void 0===n&&(n=1),this.setRows_kl5sxh$(this,1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,n)},xt.prototype.setToScale_1ugm5o$=function(t,e,i,n){return void 0===n&&(n=1),this.setToScale_7b5o5w$(v(t),v(e),v(i),v(n))},xt.prototype.setToScale_7b5o5w$=function(t,e,i,n){return void 0===n&&(n=1),this.setRows_kl5sxh$(this,t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,n)};var bt=Math;function $t(){Wt=this,this.tempMat3D_0=Zt()}xt.prototype.setToRotationX_mx4ult$=function(t){var e=bt.cos(t),i=bt.sin(t);return this.setRows_kl5sxh$(this,1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1)},xt.prototype.setToRotationY_mx4ult$=function(t){var e=bt.cos(t),i=bt.sin(t);return this.setRows_kl5sxh$(this,e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1)},xt.prototype.setToRotationZ_mx4ult$=function(t){var e=bt.cos(t),i=bt.sin(t);return this.setRows_kl5sxh$(this,e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1)},xt.prototype.setToRotation_7nqgd$=function(t,e,i,n){return this.setToRotation_7b5o5w$(t,v(e),v(i),v(n))},xt.prototype.setToRotation_7b5o5w$=function(t,e,i,n){var r=e*e+i*i+n*n,o=1/bt.sqrt(r),a=e*o,s=i*o,l=n*o,u=bt.cos(t),h=bt.sin(t),c=1-u,v=c*a,p=c*s;return this.setRows_kl5sxh$(this,v*a+u,v*s-h*l,v*l+h*s,0,v*s+h*l,p*s+u,p*l-h*a,0,v*l-h*s,p*l+h*a,c*l*l+u,0,0,0,0,1)},xt.prototype.multiply_1djhs$=function(t,e){return this.setRows_8odxlg$(t.v00*e.v00+t.v01*e.v10+t.v02*e.v20+t.v03*e.v30,t.v00*e.v01+t.v01*e.v11+t.v02*e.v21+t.v03*e.v31,t.v00*e.v02+t.v01*e.v12+t.v02*e.v22+t.v03*e.v32,t.v00*e.v03+t.v01*e.v13+t.v02*e.v23+t.v03*e.v33,t.v10*e.v00+t.v11*e.v10+t.v12*e.v20+t.v13*e.v30,t.v10*e.v01+t.v11*e.v11+t.v12*e.v21+t.v13*e.v31,t.v10*e.v02+t.v11*e.v12+t.v12*e.v22+t.v13*e.v32,t.v10*e.v03+t.v11*e.v13+t.v12*e.v23+t.v13*e.v33,t.v20*e.v00+t.v21*e.v10+t.v22*e.v20+t.v23*e.v30,t.v20*e.v01+t.v21*e.v11+t.v22*e.v21+t.v23*e.v31,t.v20*e.v02+t.v21*e.v12+t.v22*e.v22+t.v23*e.v32,t.v20*e.v03+t.v21*e.v13+t.v22*e.v23+t.v23*e.v33,t.v30*e.v00+t.v31*e.v10+t.v32*e.v20+t.v33*e.v30,t.v30*e.v01+t.v31*e.v11+t.v32*e.v21+t.v33*e.v31,t.v30*e.v02+t.v31*e.v12+t.v32*e.v22+t.v33*e.v32,t.v30*e.v03+t.v31*e.v13+t.v32*e.v23+t.v33*e.v33)},xt.prototype.multiply_mx4ult$=function(t){return this.v00=this.v00*t,this.v01=this.v01*t,this.v02=this.v02*t,this.v03=this.v03*t,this.v10=this.v10*t,this.v11=this.v11*t,this.v12=this.v12*t,this.v13=this.v13*t,this.v20=this.v20*t,this.v21=this.v21*t,this.v22=this.v22*t,this.v23=this.v23*t,this.v30=this.v30*t,this.v31=this.v31*t,this.v32=this.v32*t,this.v33=this.v33*t,this},xt.prototype.copyFrom_7ojuuq$=function(t){return this.v00=t.v00,this.v01=t.v01,this.v02=t.v02,this.v03=t.v03,this.v10=t.v10,this.v11=t.v11,this.v12=t.v12,this.v13=t.v13,this.v20=t.v20,this.v21=t.v21,this.v22=t.v22,this.v23=t.v23,this.v30=t.v30,this.v31=t.v31,this.v32=t.v32,this.v33=t.v33,this},xt.prototype.transform_f5rm4b$=function(t,e,i,n,r){return void 0===n&&(n=1),void 0===r&&(r=new lt(0,0,0,0)),new lt(this.v00*t+this.v01*e+this.v02*i+this.v03*n,this.v10*t+this.v11*e+this.v12*i+this.v13*n,this.v20*t+this.v21*e+this.v22*i+this.v23*n,this.v30*t+this.v31*e+this.v32*i+this.v33*n)},xt.prototype.transform_m4mu76$=function(t,e){return void 0===e&&(e=ut()),this.transform_f5rm4b$(t.x,t.y,t.z,t.w,e)},xt.prototype.setRows_kl5sxh$=function(t,e,i,n,r,o,a,s,l,u,h,c,p,f,d,_,x){return t.setRows_8odxlg$(v(e),v(i),v(n),v(r),v(o),v(a),v(s),v(l),v(u),v(h),v(c),v(p),v(f),v(d),v(_),v(x))},xt.prototype.times_ll68d$=function(t,e){return Zt().multiply_1djhs$(t,e)},xt.prototype.times_6ue379$=function(t,e){return t.clone().multiply_mx4ult$(v(e))},xt.prototype.div_6ue379$=function(t,e){return t.clone().multiply_mx4ult$(1/v(e))},xt.prototype.multiply_6ue379$=function(t,e){return t.multiply_mx4ult$(v(e))},$t.$metadata$={kind:p,simpleName:"Companion",interfaces:[]};var yt,gt,mt,Et,Pt,wt,It,St,At,kt,Tt,Ct,Lt,Ot,Rt,Dt,Nt,zt,Mt,Ft,Bt,Xt,Yt,jt,Ut,Gt,Kt,qt,Ht,Wt=null;function Vt(){return null===Wt&&new $t,Wt}function Zt(t){return t=t||Object.create(xt.prototype),xt.call(t,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),t}function Jt(t,e,i,n,r,o,a,s,l,u,h,c,v,p,f,d,_){void 0===i&&(i=null),void 0===n&&(n=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===c&&(c=null),void 0===v&&(v=null),void 0===p&&(p=null),void 0===f&&(f=null),void 0===d&&(d=null),void 0===_&&(_=null),this.x=t,this.y=e,this.z=i,this.size=n,this.red=r,this.green=o,this.blue=a,this.alpha=s,this.rotation=l,this.scaleX=u,this.scaleY=h,this.scaleZ=c,this.offsetX=v,this.offsetY=p,this.offsetZ=f,this.dX=d,this.dY=_}function Qt(t,e,i){u.call(this),this.value=i,this.name$=t,this.ordinal$=e}function te(){te=function(){},yt=new Qt("X",0,1),gt=new Qt("Y",1,2),mt=new Qt("Z",2,4),Et=new Qt("RED",3,8),Pt=new Qt("GREEN",4,16),wt=new Qt("BLUE",5,32),It=new Qt("ALPHA",6,64),St=new Qt("SIZE",7,128),At=new Qt("ROTATION",8,256),kt=new Qt("SCALE_X",9,512),Tt=new Qt("SCALE_Y",10,1024),Ct=new Qt("SCALE_Z",11,2048),Lt=new Qt("OFFSET_X",12,4096),Ot=new Qt("OFFSET_Y",13,8192),Rt=new Qt("OFFSET_Z",14,16384),Dt=new Qt("D_X",15,32768),Nt=new Qt("D_Y",16,65536)}function ee(){return te(),yt}function ie(){return te(),gt}function ne(){return te(),mt}function re(){return te(),Et}function oe(){return te(),Pt}function ae(){return te(),wt}function se(){return te(),It}function le(){return te(),St}function ue(){return te(),At}function he(){return te(),kt}function ce(){return te(),Tt}function ve(){return te(),Ct}function pe(){return te(),Lt}function fe(){return te(),Ot}function de(){return te(),Rt}function _e(){return te(),Dt}function xe(){return te(),Nt}function be(){return[ee(),ie(),ne(),re(),oe(),ae(),se(),le(),ue(),he(),ce(),ve(),pe(),fe(),de(),_e(),xe()]}function $e(t,e,i){return i=i||Object.create(Jt.prototype),Jt.call(i,t,e,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null),i}function ye(){this.isFirst_8v8lcg$_0=!1,this.isLast_e4dpge$_0=!1,this.accumulatedAddition_k4s9y0$_0=l(),this.lastPrediction_8gfzkp$_0=l()}function ge(t,e){u.call(this),this.name$=t,this.ordinal$=e}function me(){me=function(){},zt=new ge("BEGIN",0),Mt=new ge("UPDATE",1),Ft=new ge("END",2)}function Ee(){return me(),zt}function Pe(){return me(),Mt}function we(){return me(),Ft}function Ie(t,e,i,n,r,o,a,s,l){void 0===r&&(r=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),void 0===l&&(l=null),this.x=t,this.y=e,this.phase=i,this.timestamp=n,this.z=r,this.force=o,this.radius=a,this.altitudeAngle=s,this.azimuthAngle=l,this.computedAzimuthAngle=null}function Se(t,e,i){u.call(this),this.value=i,this.name$=t,this.ordinal$=e}function Ae(){Ae=function(){},Bt=new Se("X",0,1),Xt=new Se("Y",1,2),Yt=new Se("Z",2,4),jt=new Se("PHASE",3,8),Ut=new Se("TIMESTAMP",4,16),Gt=new Se("FORCE",5,32),Kt=new Se("RADIUS",6,64),qt=new Se("ALTITUDE_ANGLE",7,128),Ht=new Se("AZIMUTH_ANGLE",8,256)}function ke(){return Ae(),Bt}function Te(){return Ae(),Xt}function Ce(){return Ae(),Yt}function Le(){return Ae(),jt}function Oe(){return Ae(),Ut}function Re(){return Ae(),Gt}function De(){return Ae(),Kt}function Ne(){return Ae(),qt}function ze(){return Ae(),Ht}function Me(){Xe()}function Fe(){Be=this,this.allPaths=pr([]),this.CLIPPER_RANGE_MIN=-32767,this.CLIPPER_RANGE_MAX=32767,this.CLIPPER_RANGE_SIZE=65534;var t=new kr;t.strictlySimple=!0,this.clipper=t}xt.prototype.translate_1ugm5o$=function(t,e,i,n){return void 0===n&&(n=1),Vt().tempMat3D_0.setToTranslation_1ugm5o$(t,e,i,n),this.multiply_1djhs$(this,Vt().tempMat3D_0),this},xt.prototype.rotate_7nqgd$=function(t,e,i,n){return Vt().tempMat3D_0.setToRotation_7nqgd$(t,e,i,n),this.multiply_1djhs$(this,Vt().tempMat3D_0),this},xt.prototype.scale_1ugm5o$=function(t,e,i,n){return void 0===n&&(n=1),Vt().tempMat3D_0.setToScale_1ugm5o$(t,e,i,n),this.multiply_1djhs$(this,Vt().tempMat3D_0),this},xt.prototype.rotate_y2kzbl$=function(t,e,i){return this.rotate_7nqgd$(t,1,0,0),this.rotate_7nqgd$(e,0,1,0),this.rotate_7nqgd$(i,0,0,1),this},xt.prototype.invert_ll68d$=function(t,i){void 0===i&&(i=t);var n=t,r=i.v12*i.v23*i.v31-i.v13*i.v22*i.v31+i.v13*i.v21*i.v32-i.v11*i.v23*i.v32-i.v12*i.v21*i.v33+i.v11*i.v22*i.v33,o=i.v03*i.v22*i.v31-i.v02*i.v23*i.v31-i.v03*i.v21*i.v32+i.v01*i.v23*i.v32+i.v02*i.v21*i.v33-i.v01*i.v22*i.v33,a=i.v02*i.v13*i.v31-i.v03*i.v12*i.v31+i.v03*i.v11*i.v32-i.v01*i.v13*i.v32-i.v02*i.v11*i.v33+i.v01*i.v12*i.v33,s=i.v03*i.v12*i.v21-i.v02*i.v13*i.v21-i.v03*i.v11*i.v22+i.v01*i.v13*i.v22+i.v02*i.v11*i.v23-i.v01*i.v12*i.v23,l=i.v00*r+i.v10*o+i.v20*a+i.v30*s;if(0===l)return e&&f("Matrix doesn't have inverse"),i.identity();var u=1/l;return n.setRows_8odxlg$(r*u,o*u,a*u,s*u,(i.v13*i.v22*i.v30-i.v12*i.v23*i.v30-i.v13*i.v20*i.v32+i.v10*i.v23*i.v32+i.v12*i.v20*i.v33-i.v10*i.v22*i.v33)*u,(i.v02*i.v23*i.v30-i.v03*i.v22*i.v30+i.v03*i.v20*i.v32-i.v00*i.v23*i.v32-i.v02*i.v20*i.v33+i.v00*i.v22*i.v33)*u,(i.v03*i.v12*i.v30-i.v02*i.v13*i.v30-i.v03*i.v10*i.v32+i.v00*i.v13*i.v32+i.v02*i.v10*i.v33-i.v00*i.v12*i.v33)*u,(i.v02*i.v13*i.v20-i.v03*i.v12*i.v20+i.v03*i.v10*i.v22-i.v00*i.v13*i.v22-i.v02*i.v10*i.v23+i.v00*i.v12*i.v23)*u,(i.v11*i.v23*i.v30-i.v13*i.v21*i.v30+i.v13*i.v20*i.v31-i.v10*i.v23*i.v31-i.v11*i.v20*i.v33+i.v10*i.v21*i.v33)*u,(i.v03*i.v21*i.v30-i.v01*i.v23*i.v30-i.v03*i.v20*i.v31+i.v00*i.v23*i.v31+i.v01*i.v20*i.v33-i.v00*i.v21*i.v33)*u,(i.v01*i.v13*i.v30-i.v03*i.v11*i.v30+i.v03*i.v10*i.v31-i.v00*i.v13*i.v31-i.v01*i.v10*i.v33+i.v00*i.v11*i.v33)*u,(i.v03*i.v11*i.v20-i.v01*i.v13*i.v20-i.v03*i.v10*i.v21+i.v00*i.v13*i.v21+i.v01*i.v10*i.v23-i.v00*i.v11*i.v23)*u,(i.v12*i.v21*i.v30-i.v11*i.v22*i.v30-i.v12*i.v20*i.v31+i.v10*i.v22*i.v31+i.v11*i.v20*i.v32-i.v10*i.v21*i.v32)*u,(i.v01*i.v22*i.v30-i.v02*i.v21*i.v30+i.v02*i.v20*i.v31-i.v00*i.v22*i.v31-i.v01*i.v20*i.v32+i.v00*i.v21*i.v32)*u,(i.v02*i.v11*i.v30-i.v01*i.v12*i.v30-i.v02*i.v10*i.v31+i.v00*i.v12*i.v31+i.v01*i.v10*i.v32-i.v00*i.v11*i.v32)*u,(i.v01*i.v12*i.v20-i.v02*i.v11*i.v20+i.v02*i.v10*i.v21-i.v00*i.v12*i.v21-i.v01*i.v10*i.v22+i.v00*i.v11*i.v22)*u)},xt.prototype.equals=function(t){return Kotlin.isType(t,xt)&&d(this.v00,t.v00)&&d(this.v01,t.v01)&&d(this.v02,t.v02)&&d(this.v03,t.v03)&&d(this.v10,t.v10)&&d(this.v11,t.v11)&&d(this.v12,t.v12)&&d(this.v13,t.v13)&&d(this.v20,t.v20)&&d(this.v21,t.v21)&&d(this.v22,t.v22)&&d(this.v23,t.v23)&&d(this.v30,t.v30)&&d(this.v31,t.v31)&&d(this.v32,t.v32)&&d(this.v33,t.v33)},xt.prototype.hashCode=function(){var t=_(this.v00);return t=(31*(t=(31*(t=(31*(t=(31*(t=(31*(t=(31*(t=(31*(t=(31*(t=(31*(t=(31*(t=(31*(t=(31*(t=(31*(t=(31*(t=(31*(t=(31*t|0)+_(this.v01)|0)|0)+_(this.v02)|0)|0)+_(this.v03)|0)|0)+_(this.v10)|0)|0)+_(this.v11)|0)|0)+_(this.v12)|0)|0)+_(this.v13)|0)|0)+_(this.v20)|0)|0)+_(this.v21)|0)|0)+_(this.v22)|0)|0)+_(this.v23)|0)|0)+_(this.v30)|0)|0)+_(this.v31)|0)|0)+_(this.v32)|0)|0)+_(this.v33)|0)|0)+Vt().tempMat3D_0.hashCode()|0},xt.prototype.toString=function(){var t="[\n";return t+="["+this.v00+", "+this.v01+", "+this.v02+", "+this.v03+"]\n",t+="["+this.v10+", "+this.v11+", "+this.v12+", "+this.v13+"]\n",t+="["+this.v20+", "+this.v21+", "+this.v22+", "+this.v23+"]\n",t+="["+this.v30+", "+this.v31+", "+this.v32+", "+this.v33+"]\n",t+="]"},xt.prototype.clone=function(){return Zt().copyFrom_7ojuuq$(this)},xt.$metadata$={kind:a,simpleName:"Matrix3D",interfaces:[]},Object.defineProperty(Qt.prototype,"isCoordinate",{get:function(){return this===ee()||this===ie()||this===ne()}}),Qt.$metadata$={kind:a,simpleName:"Property",interfaces:[u]},Qt.values=be,Qt.valueOf_61zpoe$=function(t){switch(t){case"X":return ee();case"Y":return ie();case"Z":return ne();case"RED":return re();case"GREEN":return oe();case"BLUE":return ae();case"ALPHA":return se();case"SIZE":return le();case"ROTATION":return ue();case"SCALE_X":return he();case"SCALE_Y":return ce();case"SCALE_Z":return ve();case"OFFSET_X":return pe();case"OFFSET_Y":return fe();case"OFFSET_Z":return de();case"D_X":return _e();case"D_Y":return xe();default:h("No enum constant com.wacom.digitalink.PathPoint.Property."+t)}},Jt.prototype.setProperty_2w0t5k$=function(t,e){switch(t.name){case"X":this.x=x(e);break;case"Y":this.y=x(e);break;case"Z":this.z=e;break;case"RED":this.red=e;break;case"GREEN":this.green=e;break;case"BLUE":this.blue=e;break;case"ALPHA":this.alpha=e;break;case"SIZE":this.size=e;break;case"ROTATION":this.rotation=e;break;case"SCALE_X":this.scaleX=e;break;case"SCALE_Y":this.scaleY=e;break;case"SCALE_Z":this.scaleZ=e;break;case"OFFSET_X":this.offsetX=e;break;case"OFFSET_Y":this.offsetY=e;break;case"OFFSET_Z":this.offsetZ=e;break;case"D_X":this.dX=e;break;case"D_Y":this.dY=e}},Jt.prototype.getProperty_qe0o24$=function(t){switch(t.name){case"X":return this.x;case"Y":return this.y;case"Z":return this.z;case"RED":return this.red;case"GREEN":return this.green;case"BLUE":return this.blue;case"ALPHA":return this.alpha;case"SIZE":return this.size;case"ROTATION":return this.rotation;case"SCALE_X":return this.scaleX;case"SCALE_Y":return this.scaleY;case"SCALE_Z":return this.scaleZ;case"OFFSET_X":return this.offsetX;case"OFFSET_Y":return this.offsetY;case"OFFSET_Z":return this.offsetZ;case"D_X":return this.dX;case"D_Y":return this.dY;default:return Kotlin.noWhenBranchMatched()}},Jt.prototype.asArray_g85dc6$=function(t){for(var e=b(t.length),i=0;i<t.length;i++){if(null==this.getProperty_qe0o24$(t[i]))throw new $("Property "+t[i]+" cannot be null!");e.add_11rb$(x(this.getProperty_qe0o24$(t[i])))}return e},Jt.prototype.hasAll_akwwuj$=function(t){var e;for(e=t.iterator();e.hasNext();){var i=e.next();if(null==this.getProperty_qe0o24$(i))return!1}return!0},Jt.prototype.hasOthers_akwwuj$=function(t){var e,i,n=be(),r=l();for(i=0;i!==n.length;++i){var o=n[i];t.contains_11rb$(o)||r.add_11rb$(o)}for(e=r.iterator();e.hasNext();){var a=e.next();if(null!=this.getProperty_qe0o24$(a))return!0}return!1},Jt.$metadata$={kind:a,simpleName:"PathPoint",interfaces:[]},Jt.prototype.component1=function(){return this.x},Jt.prototype.component2=function(){return this.y},Jt.prototype.component3=function(){return this.z},Jt.prototype.component4=function(){return this.size},Jt.prototype.component5=function(){return this.red},Jt.prototype.component6=function(){return this.green},Jt.prototype.component7=function(){return this.blue},Jt.prototype.component8=function(){return this.alpha},Jt.prototype.component9=function(){return this.rotation},Jt.prototype.component10=function(){return this.scaleX},Jt.prototype.component11=function(){return this.scaleY},Jt.prototype.component12=function(){return this.scaleZ},Jt.prototype.component13=function(){return this.offsetX},Jt.prototype.component14=function(){return this.offsetY},Jt.prototype.component15=function(){return this.offsetZ},Jt.prototype.component16=function(){return this.dX},Jt.prototype.component17=function(){return this.dY},Jt.prototype.copy_usd2u0$=function(t,e,i,n,r,o,a,s,l,u,h,c,v,p,f,d,_){return new Jt(void 0===t?this.x:t,void 0===e?this.y:e,void 0===i?this.z:i,void 0===n?this.size:n,void 0===r?this.red:r,void 0===o?this.green:o,void 0===a?this.blue:a,void 0===s?this.alpha:s,void 0===l?this.rotation:l,void 0===u?this.scaleX:u,void 0===h?this.scaleY:h,void 0===c?this.scaleZ:c,void 0===v?this.offsetX:v,void 0===p?this.offsetY:p,void 0===f?this.offsetZ:f,void 0===d?this.dX:d,void 0===_?this.dY:_)},Jt.prototype.toString=function(){return"PathPoint(x="+Kotlin.toString(this.x)+", y="+Kotlin.toString(this.y)+", z="+Kotlin.toString(this.z)+", size="+Kotlin.toString(this.size)+", red="+Kotlin.toString(this.red)+", green="+Kotlin.toString(this.green)+", blue="+Kotlin.toString(this.blue)+", alpha="+Kotlin.toString(this.alpha)+", rotation="+Kotlin.toString(this.rotation)+", scaleX="+Kotlin.toString(this.scaleX)+", scaleY="+Kotlin.toString(this.scaleY)+", scaleZ="+Kotlin.toString(this.scaleZ)+", offsetX="+Kotlin.toString(this.offsetX)+", offsetY="+Kotlin.toString(this.offsetY)+", offsetZ="+Kotlin.toString(this.offsetZ)+", dX="+Kotlin.toString(this.dX)+", dY="+Kotlin.toString(this.dY)+")"},Jt.prototype.hashCode=function(){var t=0;return t=31*(t=31*(t=31*(t=31*(t=31*(t=31*(t=31*(t=31*(t=31*(t=31*(t=31*(t=31*(t=31*(t=31*(t=31*(t=31*(t=31*t+Kotlin.hashCode(this.x)|0)+Kotlin.hashCode(this.y)|0)+Kotlin.hashCode(this.z)|0)+Kotlin.hashCode(this.size)|0)+Kotlin.hashCode(this.red)|0)+Kotlin.hashCode(this.green)|0)+Kotlin.hashCode(this.blue)|0)+Kotlin.hashCode(this.alpha)|0)+Kotlin.hashCode(this.rotation)|0)+Kotlin.hashCode(this.scaleX)|0)+Kotlin.hashCode(this.scaleY)|0)+Kotlin.hashCode(this.scaleZ)|0)+Kotlin.hashCode(this.offsetX)|0)+Kotlin.hashCode(this.offsetY)|0)+Kotlin.hashCode(this.offsetZ)|0)+Kotlin.hashCode(this.dX)|0)+Kotlin.hashCode(this.dY)|0},Jt.prototype.equals=function(t){return this===t||null!==t&&"object"===_typeof(t)&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&Kotlin.equals(this.x,t.x)&&Kotlin.equals(this.y,t.y)&&Kotlin.equals(this.z,t.z)&&Kotlin.equals(this.size,t.size)&&Kotlin.equals(this.red,t.red)&&Kotlin.equals(this.green,t.green)&&Kotlin.equals(this.blue,t.blue)&&Kotlin.equals(this.alpha,t.alpha)&&Kotlin.equals(this.rotation,t.rotation)&&Kotlin.equals(this.scaleX,t.scaleX)&&Kotlin.equals(this.scaleY,t.scaleY)&&Kotlin.equals(this.scaleZ,t.scaleZ)&&Kotlin.equals(this.offsetX,t.offsetX)&&Kotlin.equals(this.offsetY,t.offsetY)&&Kotlin.equals(this.offsetZ,t.offsetZ)&&Kotlin.equals(this.dX,t.dX)&&Kotlin.equals(this.dY,t.dY)},Object.defineProperty(ye.prototype,"isFirst",{get:function(){return this.isFirst_8v8lcg$_0},set:function(t){this.isFirst_8v8lcg$_0=t}}),Object.defineProperty(ye.prototype,"isLast",{get:function(){return this.isLast_e4dpge$_0},set:function(t){this.isLast_e4dpge$_0=t}}),Object.defineProperty(ye.prototype,"accumulatedAddition",{get:function(){return this.accumulatedAddition_k4s9y0$_0},set:function(t){this.accumulatedAddition_k4s9y0$_0=t}}),Object.defineProperty(ye.prototype,"lastPrediction",{get:function(){return this.lastPrediction_8gfzkp$_0},set:function(t){this.lastPrediction_8gfzkp$_0=t}}),ye.prototype.add_nynv2b$=function(t,e,i){switch(t.name){case"BEGIN":this.accumulatedAddition=l(),this.lastPrediction=l(),this.isFirst=!0,this.isLast=!1;break;case"END":this.isLast=!0}null!=e&&this.accumulatedAddition.addAll_brywnq$(e),null!=i&&(this.lastPrediction=i)},ye.prototype.reset=function(){this.accumulatedAddition.clear(),this.lastPrediction.clear(),this.isFirst=!1,this.isLast=!1},ye.$metadata$={kind:a,simpleName:"PathSegment",interfaces:[]},ge.$metadata$={kind:a,simpleName:"Phase",interfaces:[u]},ge.values=function(){return[Ee(),Pe(),we()]},ge.valueOf_61zpoe$=function(t){switch(t){case"BEGIN":return Ee();case"UPDATE":return Pe();case"END":return we();default:h("No enum constant com.wacom.digitalink.Phase."+t)}},Object.defineProperty(Ie.prototype,"magnitude",{get:function(){return this.getMagnitude_0(this.x,this.y)}}),Se.$metadata$={kind:a,simpleName:"Property",interfaces:[u]},Se.values=function(){return[ke(),Te(),Ce(),Le(),Oe(),Re(),De(),Ne(),ze()]},Se.valueOf_61zpoe$=function(t){switch(t){case"X":return ke();case"Y":return Te();case"Z":return Ce();case"PHASE":return Le();case"TIMESTAMP":return Oe();case"FORCE":return Re();case"RADIUS":return De();case"ALTITUDE_ANGLE":return Ne();case"AZIMUTH_ANGLE":return ze();default:h("No enum constant com.wacom.digitalink.PointerData.Property."+t)}},Ie.prototype.equals=function(t){var e;return!(null==t||null==(e=Kotlin.getKClassFromExpression(t))||!e.equals(Kotlin.getKClassFromExpression(this)))&&(Kotlin.isType(t,Ie)||m(),this.x===t.x&&this.y===t.y&&this.z==t.z&&this.phase===t.phase&&d(this.timestamp,t.timestamp)&&this.force==t.force&&this.radius==t.radius&&this.altitudeAngle==t.altitudeAngle&&this.azimuthAngle==t.azimuthAngle)},Ie.prototype.minus_0=function(t){return new E(this.x-t.x,this.y-t.y,this.timestamp.subtract(t.timestamp))},Ie.prototype.speed_lkqypw$=function(t,i){var n;if(null!=t&&null==i)n=this.minus_0(t);else if(null!=i&&null==t)n=i.minus_0(this);else{if(null==t||null==i)return null;n=i.minus_0(t)}var r=n,o=r.component1(),a=r.component2(),s=r.component3();return e&&this.check_0(s),this.getMagnitude_0(o,a)/(s.toNumber()/1e3)},Ie.prototype.computeNearestAzimuthAngle_pyqb7w$=function(t){var e,i;if(null==this.azimuthAngle)return null;if(null!=t){if(null==t.azimuthAngle)return null;var n=null!=(e=t.computedAzimuthAngle)?e:x(t.azimuthAngle),r=x(this.azimuthAngle);if(r>n){var o=r-n,a=r-2*P.PI;i=o<n-a?r:a}else{var s=r+2*P.PI;i=s-n<n-r?s:r}}else i=x(this.azimuthAngle);return this.computedAzimuthAngle=i,i},Ie.prototype.check_0=function(t){t.compareTo_11rb$(w)<0?lo("com.wacom.digitalink.PointerData.speed: Timestamp difference is negative and will result in a negative speed!",dt()):d(t,w)&&lo("com.wacom.digitalink.PointerData.speed: Timestamp difference is zero and will result in an infinite speed!",dt())},Ie.prototype.getMagnitude_0=function(t,e){var i=t*t+e*e;return bt.sqrt(i)},Ie.prototype.hashCode=function(){var t=_(this.x);return t=Kotlin.imul(17,t)+_(this.y)|0,t=Kotlin.imul(17,t)+this.phase.hashCode()|0,t=Kotlin.imul(17,t)+_(this.timestamp)|0},Ie.$metadata$={kind:a,simpleName:"PointerData",interfaces:[]},Ie.prototype.component1=function(){return this.x},Ie.prototype.component2=function(){return this.y},Ie.prototype.component3=function(){return this.phase},Ie.prototype.component4=function(){return this.timestamp},Ie.prototype.component5=function(){return this.z},Ie.prototype.component6=function(){return this.force},Ie.prototype.component7=function(){return this.radius},Ie.prototype.component8=function(){return this.altitudeAngle},Ie.prototype.component9=function(){return this.azimuthAngle},Ie.prototype.copy_n2kez4$=function(t,e,i,n,r,o,a,s,l){return new Ie(void 0===t?this.x:t,void 0===e?this.y:e,void 0===i?this.phase:i,void 0===n?this.timestamp:n,void 0===r?this.z:r,void 0===o?this.force:o,void 0===a?this.radius:a,void 0===s?this.altitudeAngle:s,void 0===l?this.azimuthAngle:l)},Ie.prototype.toString=function(){return"PointerData(x="+Kotlin.toString(this.x)+", y="+Kotlin.toString(this.y)+", phase="+Kotlin.toString(this.phase)+", timestamp="+Kotlin.toString(this.timestamp)+", z="+Kotlin.toString(this.z)+", force="+Kotlin.toString(this.force)+", radius="+Kotlin.toString(this.radius)+", altitudeAngle="+Kotlin.toString(this.altitudeAngle)+", azimuthAngle="+Kotlin.toString(this.azimuthAngle)+")"},Fe.prototype.mergePolygons_7nvot6$=function(t,e){var i,n,r,o;void 0===e&&(e=null);var a=null!=e?e:this.comuptePolygonBounds_0(t),s=65534/(a.right-a.left+1e-16),u=65534/(a.bottom-a.top+1e-16),h=bt.min(s,u),c=bt.floor(h),v=a.left+32767/c,p=a.top+32767/c;for(this.allPaths.clear(),i=t.iterator();i.hasNext();){var f=i.next(),d=sr(f.size);n=f.size;for(var _=0;_<n;_+=2){var x=I((f.get_za3lpa$(_)-v)*c),b=I((f.get_za3lpa$(_+1|0)-p)*c);d.add_11rb$(x),d.add_11rb$(b)}this.allPaths.add_11rb$(d)}this.clipper.clear(),this.clipper.addPaths_4w9siq$(this.allPaths,_n(),!0),this.clipper.execute_70u5c3$(cn(),this.allPaths,gn());var $=l();for(r=this.allPaths.iterator();r.hasNext();){var y=r.next(),g=l();o=y.size;for(var m=0;m<o;m+=2)g.add_11rb$(y.get_za3lpa$(m)/c+v),g.add_11rb$(y.get_za3lpa$(m+1|0)/c+p);$.add_11rb$(g)}return $},Fe.prototype.simplifyPolygonDouglasPeucker_sre3up$=function(t,e){if(t.size<6)return t;var i=this.simplifyPolylineDouglasPeucker_sre3up$(k(A(t,S([t.get_za3lpa$(0),t.get_za3lpa$(1)]))),e);return i.size<8?t:C(i,T(0,i.size-2|0))},Fe.prototype.simplifyPolylineDouglasPeucker_sre3up$=function(t,e){var i;if(e<=0)return l();if(t.size<4)return t;var n,r=0,o=0;i=t.size-2|0;for(var a=2;a<i;a+=2){var s=this.perpendicularDistance_w8lrqs$(t.get_za3lpa$(a),t.get_za3lpa$(a+1|0),t.get_za3lpa$(0),t.get_za3lpa$(1),t.get_za3lpa$(t.size-2|0),t.get_za3lpa$(t.size-1|0));s>r&&(o=a,r=s)}if(r>e){var u=this.simplifyPolylineDouglasPeucker_sre3up$(C(t,T(0,o+2|0)),e),h=this.simplifyPolylineDouglasPeucker_sre3up$(C(t,T(o,t.size)),e);n=k(A(u,C(h,T(2,h.size))))}else n=L([t.get_za3lpa$(0),t.get_za3lpa$(1),t.get_za3lpa$(t.size-2|0),t.get_za3lpa$(t.size-1|0)]);return n},Fe.prototype.perpendicularDistance_w8lrqs$=function(t,e,i,n,r,o){var a,s=t-i,l=r-i,u=s*(o-n)-l*(e-n);u*=u;var h=(s=r-i)*s+(l=o-n)*l;if(h>0){var c=u/h;a=bt.sqrt(c)}else{var v=(i-t)*(i-t)+(n-e)*(n-e);a=bt.sqrt(v)}return a},Fe.prototype.comuptePolygonBounds_0=function(t){var e,i=new hi(O.MAX_VALUE,O.MAX_VALUE,O.MIN_VALUE,O.MIN_VALUE),n=R(t);e=n.size;for(var r=0;r<e;r+=2)n.get_za3lpa$(r)<i.left&&(i.left=n.get_za3lpa$(r)),n.get_za3lpa$(r+1|0)<i.top&&(i.top=n.get_za3lpa$(r+1|0)),n.get_za3lpa$(r)>i.right&&(i.right=n.get_za3lpa$(r)),n.get_za3lpa$(r+1|0)>i.bottom&&(i.bottom=n.get_za3lpa$(r+1|0));return i},Fe.$metadata$={kind:p,simpleName:"Companion",interfaces:[]};var Be=null;function Xe(){return null===Be&&new Fe,Be}function Ye(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=1),this.path=t,this.layout=e,this.ts=i,this.tf=n}function je(t,e){void 0===t&&(t=null),void 0===e&&(e=we()),this.allData_15m8ty$_0=t,this.phase_5dody2$_0=e}function Ue(t){void 0===t&&(t=null),this.allData_c4vwev$_0=t,this.isFirstSegment=!1,this.isLastSegment=!0}function Ge(t,e){Ue.call(this),this.layout=t,this.prototype_8scsud$_0=e,this.defaultSize=O.NaN,this.allData=l()}function Ke(){Ue.call(this),this.lastPolygon_grily9$_0=null,this.allData=l()}Me.$metadata$={kind:a,simpleName:"PolygonUtils",interfaces:[]},Ye.prototype.equals=function(t){var e;return this===t||!(null==t||null==(e=Kotlin.getKClassFromExpression(this))||!e.equals(Kotlin.getKClassFromExpression(t)))&&(Kotlin.isType(t,Ye)||m(),!!d(this.path,t.path)&&(!!D(this.layout,t.layout)&&(this.ts===t.ts&&this.tf===t.tf)))},Ye.prototype.hashCode=function(){var t=_(this.path);return t=(31*(t=(31*(t=(31*t|0)+N(this.layout)|0)|0)+_(this.ts)|0)|0)+_(this.tf)|0},Ye.$metadata$={kind:a,simpleName:"Spline",interfaces:[]},Ye.prototype.component1=function(){return this.path},Ye.prototype.component2=function(){return this.layout},Ye.prototype.component3=function(){return this.ts},Ye.prototype.component4=function(){return this.tf},Ye.prototype.copy_8qav66$=function(t,e,i,n){return new Ye(void 0===t?this.path:t,void 0===e?this.layout:e,void 0===i?this.ts:i,void 0===n?this.tf:n)},Ye.prototype.toString=function(){return"Spline(path="+Kotlin.toString(this.path)+", layout="+Kotlin.toString(this.layout)+", ts="+Kotlin.toString(this.ts)+", tf="+Kotlin.toString(this.tf)+")"},Object.defineProperty(je.prototype,"allData",{get:function(){return this.allData_15m8ty$_0},set:function(t){this.allData_15m8ty$_0=t}}),Object.defineProperty(je.prototype,"phase",{get:function(){return this.phase_5dody2$_0},set:function(t){this.phase_5dody2$_0=t}}),je.prototype.add_hr8sph$=function(t,e,i){if(!this.movePhase_ld1mfe$_0(t))throw z("Cannot move from phase "+this.phase+" to phase "+t);return this.add_xwzc9q$(e,i)},je.prototype.movePhase_ld1mfe$_0=function(t){return(this.phase!==we()||t===Ee())&&((this.phase!==Ee()||t===we()||t===Pe())&&((this.phase!==Pe()||t===Pe()||t===we())&&(t===Ee()&&this.reset(),this.phase=t,!0)))},je.$metadata$={kind:a,simpleName:"DataProcessor",interfaces:[]},Object.defineProperty(Ue.prototype,"allData",{get:function(){return this.allData_c4vwev$_0},set:function(t){this.allData_c4vwev$_0=t}}),Ue.prototype.add_cy7266$=function(t,e,i,n){return t&&!this.isLastSegment&&z("Cannot start new segment before the previous is ended"),this.isFirstSegment=t,this.isLastSegment=e,t&&this.reset(),this.add_xwzc9q$(i,n)},Ue.$metadata$={kind:a,simpleName:"DataSequenceProcessor",interfaces:[]},Object.defineProperty(Ge.prototype,"prototype",{get:function(){return this.prototype_8scsud$_0},set:function(t){this.prototype_8scsud$_0=t}}),Ge.prototype.add_xwzc9q$=function(t,e){var i,n=l();return null!=t?(x(n).addAll_brywnq$(this.impl_0(t)),x(this.allData).addAll_brywnq$(n)):n=null,i=null!=e?this.impl_0(e):null,new M(n,i)},Ge.prototype.reset=function(){var t;null!=(t=this.allData)&&t.clear(),this.isFirstSegment=!1,this.isLastSegment=!0},Ge.prototype.impl_0=function(t){var e,i=this.generatePolygons_0(this.prototype,t.path,this.layout);return Kotlin.isType(e=i,F)?e:m()},Ge.prototype.generatePolygons_0=function(t,e,i){var n,r=l();n=e.size/i.length|0;for(var o=0;o<n;o++){var a=k(e.subList_vux9f0$(Kotlin.imul(o,i.length),Kotlin.imul(o+1|0,i.length))),s=this.createTransform_0(a,i),u=this.transformPoly_0(t,s);r.add_11rb$(u)}return r},Ge.prototype.transformPoly_0=function(t,e){var i,n=k(t);i=t.size;for(var r=0;r<i;r+=2){var o=e.v00*t.get_za3lpa$(r)+e.v01*t.get_za3lpa$(r+1|0)+0*e.v02+1*e.v03,a=e.v10*t.get_za3lpa$(r)+e.v11*t.get_za3lpa$(r+1|0)+0*e.v12+1*e.v13,s=e.v30*t.get_za3lpa$(r)+e.v31*t.get_za3lpa$(r+1|0)+0*e.v32+1*e.v33;n.set_wxm5ur$(r,o/s),n.set_wxm5ur$(r+1|0,a/s)}return n},Ge.prototype.createTransform_0=function(t,e){for(var i=0,n=0,r=0,o=0,a=1,s=1,l=1,u=this.defaultSize,h=0,c=0,v=0,p=0;p<e.length;p++){switch(e[p].name){case"X":i=t.get_za3lpa$(p);break;case"Y":n=t.get_za3lpa$(p);break;case"Z":r=t.get_za3lpa$(p);break;case"ROTATION":o=t.get_za3lpa$(p);break;case"SCALE_X":a=t.get_za3lpa$(p);break;case"SCALE_Y":s=t.get_za3lpa$(p);break;case"SCALE_Z":l=t.get_za3lpa$(p);break;case"SIZE":u=t.get_za3lpa$(p);break;case"OFFSET_X":h=t.get_za3lpa$(p);break;case"OFFSET_Y":c=t.get_za3lpa$(p);break;case"OFFSET_Z":v=t.get_za3lpa$(p)}}if(B(u))throw z("Size information is required. Please provide via layout or via default configuration".toString());var f=Zt();return f.setToTranslation_7b5o5w$(i,n,r),f.rotate_y2kzbl$(0,0,o),f.translate_1ugm5o$(h,c,v),f.scale_1ugm5o$(u*a,u*s,u*l),f},Ge.$metadata$={kind:a,simpleName:"BrushApplier",interfaces:[Ue]},Object.defineProperty(Ke.prototype,"lastPolygon",{get:function(){return this.lastPolygon_grily9$_0},set:function(t){this.lastPolygon_grily9$_0=t}}),Ke.prototype.add_xwzc9q$=function(t,e){var i,n;return null!=t?(i=this.impl_0(t),t.size>0&&(this.lastPolygon=X(t))):i=null,null!=i&&x(this.allData).addAll_brywnq$(i),n=null!=e?this.impl_0(e):null,new M(i,n)},Ke.prototype.reset=function(){var t;null!=(t=this.allData)&&t.clear(),this.lastPolygon=null,this.isFirstSegment=!1,this.isLastSegment=!0},Ke.prototype.impl_0=function(t){var e,i=l();null!=this.lastPolygon&&(i=k(x(this.lastPolygon)));var n=l();for(e=t.iterator();e.hasNext();){var r=e.next();i.addAll_brywnq$(r);var o=this.convexHullMonotoneChain_xntww4$(i);n.add_11rb$(o),i=r}return n};var qe=Kotlin.kotlin.collections.emptyList_287e2$;function He(t,e,i,n){return t>i||t===i&&e>n}function We(t){ti(),je.call(this),this.config_gygryp$_0=t,this.inputBuffer_8be2vx$=l(),this.allData=l()}function Ve(t){void 0===t&&(t=[ee(),ie(),le()]),this.layout=t,this.pathPointCalculator=Ze}function Ze(t,e,i){var n=ti().calculateBasedOnSpeed(t,e,i,1,2);return null!=n?new Jt(e.x,e.y,void 0,n):null}function Je(){Qe=this}Ke.prototype.convexHullGrahamScan_0=function(t){var e,i;if(t.size<=1)return qe();var n=t.get_za3lpa$(0),r=t.get_za3lpa$(1);e=t.size;for(var o=0;o<e;o+=2)t.get_za3lpa$(o+1|0)<r&&(n=t.get_za3lpa$(o),r=t.get_za3lpa$(o+1|0));var a,s,u=n,h=r,c=qi().sort_f7hl2y$(t,(a=u,s=h,function(t,e,i,n){return-(t-a)/(e-s)>-(i-a)/(n-s)})),v=l();v.add_11rb$(n),v.add_11rb$(r),i=c.size;for(var p=0;p<i;p+=2)if(c.get_za3lpa$(p)!==n||c.get_za3lpa$(p+1|0)!==r)if(2!==v.size){for(var f=-1;f<0;){var d=v.size,_=v.get_za3lpa$(d-4|0),x=v.get_za3lpa$(d-3|0),b=v.get_za3lpa$(d-2|0),$=v.get_za3lpa$(d-1|0);(f=this.cross_0(_,x,b,$,c.get_za3lpa$(p),c.get_za3lpa$(p+1|0)))<0&&(v.removeAt_za3lpa$(v.size-1|0),v.removeAt_za3lpa$(v.size-1|0))}v.add_11rb$(c.get_za3lpa$(p)),v.add_11rb$(c.get_za3lpa$(p+1|0))}else v.add_11rb$(c.get_za3lpa$(p)),v.add_11rb$(c.get_za3lpa$(p+1|0));return v},Ke.prototype.convexHullMonotoneChain_xntww4$=function(t){var e,i,n;if(t.size<=0)return qe();for(var r=qi().sort_f7hl2y$(t,He),o=r.size,a=b(o),s=0;s<o;s++)a.add_11rb$(0);var l=a,u=0;e=r.size;for(var h=0;h<e;h+=2){for(;u>=4&&this.cross_0(l.get_za3lpa$(u-4|0),l.get_za3lpa$(u-3|0),l.get_za3lpa$(u-2|0),l.get_za3lpa$(u-1|0),r.get_za3lpa$(h),r.get_za3lpa$(h+1|0))<=0;)u=u-2|0;l.set_wxm5ur$(u,r.get_za3lpa$(h)),l.set_wxm5ur$(u+1|0,r.get_za3lpa$(h+1|0)),u=u+2|0}i=l.size-u|0;for(var c=0;c<i;c+=2)l.removeAt_za3lpa$(l.size-1|0),l.removeAt_za3lpa$(l.size-1|0);for(var v=r.size,p=b(v),f=0;f<v;f++)p.add_11rb$(0);var d=p;u=0;for(var _=r.size-2|0;_>=0;_-=2){for(;u>=4&&this.cross_0(d.get_za3lpa$(u-4|0),d.get_za3lpa$(u-3|0),d.get_za3lpa$(u-2|0),d.get_za3lpa$(u-1|0),r.get_za3lpa$(_),r.get_za3lpa$(_+1|0))<=0;)u=u-2|0;d.set_wxm5ur$(u,r.get_za3lpa$(_)),d.set_wxm5ur$(u+1|0,r.get_za3lpa$(_+1|0)),u=u+2|0}n=d.size-u+2|0;for(var x=0;x<n;x+=2)d.removeAt_za3lpa$(d.size-1|0),d.removeAt_za3lpa$(d.size-1|0);return A(d,l)},Ke.prototype.cross_0=function(t,e,i,n,r,o){return(i-t)*(o-e)-(n-e)*(r-t)},Ke.prototype.isLeft_0=function(t,e,i,n,r,o){return(t-i)*(o-n)-(r-i)*(e-n)},Ke.$metadata$={kind:a,simpleName:"ConvexHullChainProducer",interfaces:[Ue]},Ve.$metadata$={kind:a,simpleName:"Config",interfaces:[]},Object.defineProperty(We.prototype,"config",{get:function(){return this.config_gygryp$_0},set:function(t){this.config_gygryp$_0=t}}),We.prototype.add_xwzc9q$=function(t,e){if(!d(null!=t?t.phase:null,this.phase))throw z("The phase of the addition ("+Y(null!=t?t.phase:null)+") doesn't match the phase of the PathProducer ("+this.phase+").");var i=this.calculateGeometry_0(t,e),n=i.component1(),r=i.component2();return x(this.allData).addAll_brywnq$(n),new M(n,r)},We.prototype.reset=function(){var t;this.inputBuffer_8be2vx$.clear(),null!=(t=this.allData)&&t.clear(),this.phase=we()},We.prototype.calculate_0=function(t,e,i){var n=null;return null!=e&&(n=this.config.pathPointCalculator(t,e,i)),n},We.prototype.calculateGeometry_0=function(t,e){var i,n;null!=t&&this.inputBuffer_8be2vx$.add_11rb$(t);var r,o=l(),a=l(),s=this.inputBuffer_8be2vx$.size>=3?this.inputBuffer_8be2vx$.get_za3lpa$(this.inputBuffer_8be2vx$.size-3|0):null,u=this.inputBuffer_8be2vx$.size>=2?this.inputBuffer_8be2vx$.get_za3lpa$(this.inputBuffer_8be2vx$.size-2|0):null,h=this.inputBuffer_8be2vx$.size>=1?this.inputBuffer_8be2vx$.get_za3lpa$(this.inputBuffer_8be2vx$.size-1|0):null,c=this.calculate_0(s,u,h);(null!=t&&null!=c&&o.addAll_brywnq$(c.asArray_g85dc6$(this.config.layout)),this.phase===we())?null!=(i=this.calculate_0(u,h,null))&&o.addAll_brywnq$(i.asArray_g85dc6$(this.config.layout)):null!=(n=this.calculate_0(u,h,e))&&(a.addAll_brywnq$(n.asArray_g85dc6$(this.config.layout)),null!=(r=this.calculate_0(h,e,null))&&a.addAll_brywnq$(r.asArray_g85dc6$(this.config.layout)));return new M(o,a)},Je.prototype.calculateBasedOnSpeed=function(t,e,i,n,r,o,a,s,l,u){if(void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=100),void 0===l&&(l=4e3),void 0===u&&(u=null),null!=o&&null==t)return o;if(null!=a&&null==i)return a;var h=e.speed_lkqypw$(t,i);if(null!=h){var c=bt.max(h,s),v=(bt.min(c,l)-s)/(l-s);return n+(v=null!=u?u(v):1-v)*(r-n)}return null},Je.$metadata$={kind:p,simpleName:"Companion",interfaces:[]};var Qe=null;function ti(){return null===Qe&&new Je,Qe}function ei(){Ue.call(this),this.polygonBounds=null,this.allData=l(),this.polygonBounds=null}function ii(t){Ue.call(this),this.epsilon=t,this.allData=l()}function ni(t,e){void 0===e&&(e=15),Ue.call(this),this.buffer_0=null,this.windowSize_0=null,this.dimsCount=t,this.movingAverageWindowSize_u1wa3h$_0=e,this.pointsCount_83oyhd$_0=0,this.filter_0=L([-6e-6,-139e-6,-185e-6,414e-6,.002357,.003357,-.003135,-.023928,-.042909,-.017858,.096525,.254692,.347072,.26881,.114933]),this.predictionPointsCount_0=4,this.predictionPointsCount_0=Kotlin.imul(this.predictionPointsCount_0,e)/this.filter_0.size|0,this.filter_0=this.resample_0(this.filter_0,e),this.windowSize_0=this.filter_0.size,this.pointsCount=0,this.buffer_0=l(),this.allData=l()}We.$metadata$={kind:a,simpleName:"PathProducer",interfaces:[je]},ei.prototype.impl_0=function(t){return Xe().mergePolygons_7nvot6$(t,this.polygonBounds)},ei.prototype.add_xwzc9q$=function(t,e){var i;return null!=(i=null!=t?this.impl_0(t):null)&&x(this.allData).addAll_brywnq$(i),new M(i,null==e?e:Xe().mergePolygons_7nvot6$(e))},ei.prototype.reset=function(){var t;null!=(t=this.allData)&&t.clear(),this.isFirstSegment=!1,this.isLastSegment=!0},ei.$metadata$={kind:a,simpleName:"PolygonMerger",interfaces:[Ue]},ii.prototype.impl_0=function(t){return ct(t,this.epsilon)},ii.prototype.add_xwzc9q$=function(t,e){var i;return null!=(i=null!=t?this.impl_0(t):null)&&x(this.allData).addAll_brywnq$(i),new M(i,e)},ii.prototype.reset=function(){var t;null!=(t=this.allData)&&t.clear(),this.isFirstSegment=!1,this.isLastSegment=!0},ii.$metadata$={kind:a,simpleName:"PolygonSimplifier",interfaces:[Ue]},Object.defineProperty(ni.prototype,"movingAverageWindowSize",{get:function(){return this.movingAverageWindowSize_u1wa3h$_0},set:function(t){this.movingAverageWindowSize_u1wa3h$_0=t}}),Object.defineProperty(ni.prototype,"pointsCount",{get:function(){return this.pointsCount_83oyhd$_0},set:function(t){this.pointsCount_83oyhd$_0=t}}),ni.prototype.add_xwzc9q$=function(t,e){var i=null;null!=t&&(i=this.isLastSegment?this.project_xntww4$(t):this.add_xntww4$(t),x(this.allData).addAll_brywnq$(i));var n=null;return null!=e&&(n=this.project_xntww4$(e)),new M(i,n)},ni.prototype.reset=function(){var t;this.buffer_0.clear(),null!=(t=this.allData)&&t.clear(),this.pointsCount=0,this.isFirstSegment=!1,this.isLastSegment=!0},ni.prototype.add_xntww4$=function(t){var e;if(t.size%this.dimsCount!=0)throw g("Points size ('"+t.size+"') must be multiple of the dimensions count ('"+this.dimsCount+"').");this.pointsCount=this.pointsCount+(t.size/this.dimsCount|0)|0;var i=l();e=t.size/this.dimsCount|0;for(var n=0;n<e;n++)i.addAll_brywnq$(this.addImpl_0(k(C(t,T(Kotlin.imul(n,this.dimsCount),Kotlin.imul(n+1|0,this.dimsCount))))));return i},ni.prototype.calculateFilteredBuffer_0=function(t){var e,i,n=b(this.dimsCount);e=x(this.windowSize_0);for(var r=0;r<e;r++){i=this.dimsCount;for(var o=0;o<i;o++)n.size<=o&&n.add_11rb$(0),n.set_wxm5ur$(o,n.get_za3lpa$(o)+this.buffer_0.get_za3lpa$(Kotlin.imul(r,this.dimsCount)+o|0)*t.get_za3lpa$(r))}return n},ni.prototype.addImpl_0=function(t){var i;if(e&&t.size!==this.dimsCount)throw z("Error".toString());for(this.buffer_0.addAll_brywnq$(t);this.buffer_0.size<Kotlin.imul(x(this.windowSize_0),this.dimsCount);)this.buffer_0.addAll_u57x28$(0,C(this.buffer_0,T(0,this.dimsCount)));for(;this.buffer_0.size>Kotlin.imul(x(this.windowSize_0),this.dimsCount);){i=this.dimsCount;for(var n=0;n<i;n++)this.buffer_0.removeAt_za3lpa$(0)}return this.calculateFilteredBuffer_0(this.filter_0)},ni.prototype.project_xntww4$=function(t){if(t.size%this.dimsCount!=0)throw g("Points size ('"+t.size+"') must be multiple of the dimensions count ('"+this.dimsCount+"').");if(t.isEmpty())return l();var e=k(this.buffer_0),i=l(),n=k(C(t,T(0,t.size-this.dimsCount|0)));i.addAll_brywnq$(this.add_xntww4$(n));for(var r=k(C(t,T(t.size-this.dimsCount|0,t.size))),o=this.predictionPointsCount_0,a=0;a<o;a++){var s=this.addImpl_0(r);(o-a|0)<=this.pointsCount&&i.addAll_brywnq$(s)}return this.buffer_0=e,i},ni.prototype.resample_0=function(t,e){for(var i=l(),n=0;n<e;n++){var r=Kotlin.imul(t.size-1|0,n)/(e-1|0),o=I(bt.floor(r)),a=I(bt.ceil(r)),s=r-bt.floor(r),u=t.get_za3lpa$(o)*(1-s)+t.get_za3lpa$(a)*s;i.add_11rb$(u)}return i},ni.$metadata$={kind:a,simpleName:"Smoother",interfaces:[Ue]};var ri=Kotlin.kotlin.collections.copyToArray;function oi(t,e,i,n,r){if(li(),void 0===n&&(n=!1),void 0===r&&(r=!1),Ue.call(this),this.inputLayout=t,this.spacing_0=e,this.splitCount_0=i,this.calculateDerivates_0=n,this.interpolateByLength_0=r,this.lastPoint_0=null,this.polynomials_0=null,this.inputStride_0=0,this.layout=null,this.defaultSize=O.NaN,this.sizeScaleFactor=1,this.distanceScaleFactor=1,this.c_0=new lt(0,0,0,0),this.coefficientsVector_0=new lt(0,0,0,0),this.coefficientDerivatesVector_0=new lt(0,0,0,0),this.calculateDerivates_0){var o=l();j(o,this.inputLayout),o.add_11rb$(_e()),o.add_11rb$(xe()),this.layout=ri(o)}else this.layout=this.inputLayout;this.inputStride_0=this.inputLayout.length,this.polynomials_0=Kotlin.newArray(this.inputStride_0,null),this.allData=new Ye(l(),this.layout)}function ai(){si=this,this.catmullRomPolynomialCoefficentsMatrix_0=new xt(0,-.5,1,-.5,1,0,-2.5,1.5,0,.5,2,-1.5,0,0,-.5,.5)}oi.prototype.add_xwzc9q$=function(t,e){var i,n;return null!=(i=null!=t?this.addImpl_0(t,!0):null)&&x(this.allData).path.addAll_brywnq$(i.path),n=null!=e?this.addImpl_0(e,!1):null,new M(i,n)},oi.prototype.reset=function(){var t,e;this.lastPoint_0=null,null!=(e=null!=(t=this.allData)?t.path:null)&&e.clear(),this.isFirstSegment=!1,this.isLastSegment=!0},oi.prototype.addImpl_0=function(t,e){var i=this.discretizeSpline_0(t);return e&&i.path.size>0&&(this.lastPoint_0=k(C(i.path,T(i.path.size-this.layout.length|0,i.path.size)))),i},oi.prototype.discretizeSpline_0=function(t){var i,n,r=this.lastPoint_0,o=s(this.inputLayout,le()),a=t.path.size/this.inputStride_0|0;if(-1===o&&B(this.defaultSize))throw z("Size information is required. Please provide via layout or via default configuration".toString());if(!y(this.inputLayout,ee())||!y(this.inputLayout,ie()))return e&&lo("Layout doesn't contain X and Y",dt()),new Ye(l(),this.inputLayout);if(t.path.size%this.inputStride_0!=0)return e&&lo("Path size doesn't match the stride provided via the layout",dt()),new Ye(l(),this.inputLayout);if(a<4)return e&&lo("Control points are less than 4",dt()),new Ye(l(),this.inputLayout);if(null!=r&&r.size!==this.layout.length)return e&&lo("Incorrect or missing last point",dt()),new Ye(l(),this.inputLayout);for(var u=a-3|0,h=l(),c=this.splitCount_0,v=0;v<u;v++){i=this.inputStride_0;for(var p=0;p<i;p++)this.polynomials_0[p]=this.catmullRomPolynomial_0(t.path,p,v);if(this.interpolateByLength_0){var f=Kotlin.imul(this.inputStride_0,v+1|0),d=t.path.get_za3lpa$(f),_=t.path.get_za3lpa$(f+1|0),x=t.path.get_za3lpa$(f+this.inputStride_0|0),b=t.path.get_za3lpa$(f+this.inputStride_0+1|0),$=(x-d)*(x-d)+(b-_)*(b-_),g=this.distanceScaleFactor*bt.sqrt($)*this.splitCount_0;c=I(bt.floor(g)+1)}var m=c;n=c;for(var E=0;E<=n;E++){var P=E/m;if(!(0===v&&P<t.ts)&&!(v===(u-1|0)&&P>t.tf||v>0&&0===P)){var w=this.samplePoint_0(P),S=!0;if(null!=r){var A=ht(r,w,this.inputLayout),k=(-1===o?this.defaultSize:(r.get_za3lpa$(o)+w.get_za3lpa$(o))/2)*this.spacing_0;S=A>=k*k}S&&(h.addAll_brywnq$(w),r=w)}}}return new Ye(h,this.layout,t.ts,t.tf)},oi.prototype.catmullRomPolynomial_0=function(t,e,i){var n=Kotlin.imul(this.inputStride_0,i+0|0),r=Kotlin.imul(this.inputStride_0,i+1|0),o=Kotlin.imul(this.inputStride_0,i+2|0),a=Kotlin.imul(this.inputStride_0,i+3|0);return this.c_0.x=t.get_za3lpa$(n+e|0),this.c_0.y=t.get_za3lpa$(r+e|0),this.c_0.z=t.get_za3lpa$(o+e|0),this.c_0.w=t.get_za3lpa$(a+e|0),this.c_0.times_7ojuuq$(li().catmullRomPolynomialCoefficentsMatrix_0)},oi.prototype.samplePoint_0=function(t){var e;this.coefficientsVector_0.x=1,this.coefficientsVector_0.y=t,this.coefficientsVector_0.z=t*t,this.coefficientsVector_0.w=t*t*t;var i=b(this.layout.length),n=s(this.layout,le());e=this.polynomials_0.length;for(var r=0;r<e;r++){var o=this.polynomials_0[r],a=x(o).dot_2u1m6d$(this.coefficientsVector_0);r===n&&(a*=this.sizeScaleFactor),i.add_11rb$(a)}if(this.calculateDerivates_0){var l=s(this.layout,ee()),u=s(this.layout,ie());i.add_11rb$(this.getDerivativeOf_0(x(this.polynomials_0[l]))),i.add_11rb$(this.getDerivativeOf_0(x(this.polynomials_0[u])))}return i},oi.prototype.getDerivativeOf_0=function(t){return this.coefficientDerivatesVector_0.x=t.y,this.coefficientDerivatesVector_0.y=2*t.z,this.coefficientDerivatesVector_0.z=3*t.w,this.coefficientDerivatesVector_0.w=0,this.coefficientDerivatesVector_0.dot_2u1m6d$(this.coefficientsVector_0)},ai.$metadata$={kind:p,simpleName:"Companion",interfaces:[]};var si=null;function li(){return null===si&&new ai,si}function ui(t){Ue.call(this),this.layout=t,this.dimsCount_0=this.layout.length,this.allData=new Ye(l(),this.layout)}function hi(t,e,i,n){this.top=t,this.left=e,this.bottom=i,this.right=n}function ci(){qi()}function vi(){Ki=this,this.stride_0=2}oi.$metadata$={kind:a,simpleName:"SplineInterpolator",interfaces:[Ue]},ui.prototype.add_xwzc9q$=function(t,e){var i,n=null!=(i=null!=t?t.size:null)?i:0;0===x(this.allData).path.size&&null!=t&&t.size>0&&(x(this.allData).path.addAll_u57x28$(0,C(t,T(0,this.dimsCount_0))),n=n+this.dimsCount_0|0),null!=t&&x(this.allData).path.addAll_brywnq$(t),this.isLastSegment&&x(this.allData).path.size>0&&(x(this.allData).path.addAll_brywnq$(C(x(this.allData).path,T(x(this.allData).path.size-this.dimsCount_0|0,x(this.allData).path.size))),n=n+this.dimsCount_0|0);var r=new Ye(l(),this.layout),o=new Ye(l(),this.layout);return n>0&&(r.path=this.getAddedSpline_0(n)),null!=e&&(o.path=this.getPredictedSpline_0(e)),new M(r,o)},ui.prototype.reset=function(){var t,e;null!=(e=null!=(t=this.allData)?t.path:null)&&e.clear(),this.isFirstSegment=!1,this.isLastSegment=!0},ui.prototype.getAddedSpline_0=function(t){var e=l();if(t>0){var i=x(this.allData).path,n=x(this.allData).path.size-t-(3*this.dimsCount_0|0)|0,r=C(i,T(bt.max(0,n),x(this.allData).path.size));e.addAll_brywnq$(r)}return e.size<(4*this.dimsCount_0|0)&&e.clear(),e},ui.prototype.getPredictedSpline_0=function(t){var e=l();if(t.size>0){var i=x(this.allData).path,n=x(this.allData).path.size-(3*this.dimsCount_0|0)|0,r=C(i,T(bt.max(0,n),x(this.allData).path.size));for(e.addAll_brywnq$(r),e.addAll_brywnq$(t),e.addAll_brywnq$(C(e,T(e.size-this.dimsCount_0|0,e.size)));e.size<(4*this.dimsCount_0|0);)e.addAll_u57x28$(0,C(e,T(0,this.dimsCount_0)))}return e},ui.$metadata$={kind:a,simpleName:"SplineProducer",interfaces:[Ue]},hi.$metadata$={kind:a,simpleName:"Bounds",interfaces:[]},hi.prototype.component1=function(){return this.top},hi.prototype.component2=function(){return this.left},hi.prototype.component3=function(){return this.bottom},hi.prototype.component4=function(){return this.right},hi.prototype.copy_7b5o5w$=function(t,e,i,n){return new hi(void 0===t?this.top:t,void 0===e?this.left:e,void 0===i?this.bottom:i,void 0===n?this.right:n)},hi.prototype.toString=function(){return"Bounds(top="+Kotlin.toString(this.top)+", left="+Kotlin.toString(this.left)+", bottom="+Kotlin.toString(this.bottom)+", right="+Kotlin.toString(this.right)+")"},hi.prototype.hashCode=function(){var t=0;return t=31*(t=31*(t=31*(t=31*t+Kotlin.hashCode(this.top)|0)+Kotlin.hashCode(this.left)|0)+Kotlin.hashCode(this.bottom)|0)+Kotlin.hashCode(this.right)|0},hi.prototype.equals=function(t){return this===t||null!==t&&"object"===_typeof(t)&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&Kotlin.equals(this.top,t.top)&&Kotlin.equals(this.left,t.left)&&Kotlin.equals(this.bottom,t.bottom)&&Kotlin.equals(this.right,t.right)},vi.prototype.sort_f7hl2y$=function(t,e){return this.sortArrayPart_0(t,0,t.size-this.stride_0|0,e),t},vi.prototype.partition_0=function(t,e,i,n){var r,o=t.get_za3lpa$(i),a=t.get_za3lpa$(i+1|0),s=e-this.stride_0|0;r=i-this.stride_0|0;for(var l=e;l<=r;l+=2)n(o,a,t.get_za3lpa$(l),t.get_za3lpa$(l+1|0))&&(s=s+this.stride_0|0,this.swap_0(t,s,l));return this.swap_0(t,s+this.stride_0|0,i),s+this.stride_0|0},vi.prototype.swap_0=function(t,e,i){var n=t.get_za3lpa$(e),r=t.get_za3lpa$(e+1|0);return t.set_wxm5ur$(e,t.get_za3lpa$(i)),t.set_wxm5ur$(e+1|0,t.get_za3lpa$(i+1|0)),t.set_wxm5ur$(i,n),t.set_wxm5ur$(i+1|0,r),t},vi.prototype.sortArrayPart_0=function(t,e,i,n){if(e<i){var r=this.partition_0(t,e,i,n);this.sortArrayPart_0(t,e,r-this.stride_0|0,n),this.sortArrayPart_0(t,r+this.stride_0|0,i,n)}},vi.$metadata$={kind:p,simpleName:"Companion",interfaces:[]};var pi,fi,di,_i,xi,bi,$i,yi,gi,mi,Ei,Pi,wi,Ii,Si,Ai,ki,Ti,Ci,Li,Oi,Ri,Di,Ni,zi,Mi,Fi,Bi,Xi,Yi,ji,Ui,Gi,Ki=null;function qi(){return null===Ki&&new vi,Ki}function Hi(t,e){u.call(this),this.name$=t,this.ordinal$=e}function Wi(){Wi=function(){},gi=new Hi("Left",0),mi=new Hi("Right",1)}function Vi(){return Wi(),gi}function Zi(){return Wi(),mi}function Ji(t,e){u.call(this),this.name$=t,this.ordinal$=e}function Qi(){Qi=function(){},Ei=new Ji("RightToLeft",0),Pi=new Ji("LeftToRight",1)}function tn(){return Qi(),Ei}function en(){return Qi(),Pi}function nn(t,e){u.call(this),this.name$=t,this.ordinal$=e}function rn(){rn=function(){},wi=new nn("Any",0),Ii=new nn("Open",1),Si=new nn("Closed",2)}function on(){return rn(),wi}function an(){return rn(),Ii}function sn(){return rn(),Si}function ln(t,e){u.call(this),this.name$=t,this.ordinal$=e}function un(){un=function(){},Ai=new ln("Intersection",0),ki=new ln("Union",1),Ti=new ln("Difference",2),Ci=new ln("Xor",3)}function hn(){return un(),Ai}function cn(){return un(),ki}function vn(){return un(),Ti}function pn(){return un(),Ci}function fn(t,e){u.call(this),this.name$=t,this.ordinal$=e}function dn(){dn=function(){},Li=new fn("Subject",0),Oi=new fn("Clip",1)}function _n(){return dn(),Li}function xn(){return dn(),Oi}function bn(t,e){u.call(this),this.name$=t,this.ordinal$=e}function $n(){$n=function(){},Ri=new bn("EvenOdd",0),Di=new bn("NonZero",1),Ni=new bn("Positive",2),zi=new bn("Negative",3)}function yn(){return $n(),Ri}function gn(){return $n(),Di}function mn(){return $n(),Ni}function En(){return $n(),zi}function Pn(t,e){u.call(this),this.name$=t,this.ordinal$=e}function wn(){wn=function(){},Mi=new Pn("Square",0),Fi=new Pn("Round",1),Bi=new Pn("Miter",2)}function In(){return wn(),Mi}function Sn(){return wn(),Fi}function An(){return wn(),Bi}function kn(t,e){u.call(this),this.name$=t,this.ordinal$=e}function Tn(){Tn=function(){},Xi=new kn("ClosedPolygon",0),Yi=new kn("ClosedLine",1),ji=new kn("OpenButt",2),Ui=new kn("OpenSquare",3),Gi=new kn("OpenRound",4)}function Cn(){return Tn(),Xi}function Ln(){return Tn(),Yi}function On(){return Tn(),ji}function Rn(){return Tn(),Ui}function Dn(){return Tn(),Gi}function Nn(t,e,i,n){this.left=t,this.top=e,this.right=i,this.bottom=n}function zn(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=null),this.y=t,this.leftBound=e,this.rightBound=i,this.next=n}function Mn(t,e){void 0===t&&(t=0),void 0===e&&(e=null),this.y=t,this.next=e}function Fn(t,e,i){void 0===t&&(t=0),void 0===e&&(e=null),void 0===i&&(i=null),this.x=t,this.next=e,this.prev=i}function Bn(t,e,i,n){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=0),void 0===n&&(n=0),this.outPt1=t,this.outPt2=e,this.offPtX=i,this.offPtY=n}function Xn(t,e,i){this.left=t,this.right=e,this.direction=i}function Yn(t,e,i,n,r,o,a){return a?t===i&&e===n||t===r&&e===o||t>i==t<r&&e>n==e<o&&d(c,c):t===i&&e===n||t===r&&e===o||t>i==t<r&&e>n==e<o&&Kotlin.imul(t-i|0,o-n|0)===Kotlin.imul(r-i|0,e-n|0)}ci.$metadata$={kind:a,simpleName:"QuickSort",interfaces:[]},Hi.$metadata$={kind:a,simpleName:"EdgeSide",interfaces:[u]},Hi.values=function(){return[Vi(),Zi()]},Hi.valueOf_61zpoe$=function(t){switch(t){case"Left":return Vi();case"Right":return Zi();default:h("No enum constant klipper.EdgeSide."+t)}},Ji.$metadata$={kind:a,simpleName:"Direction",interfaces:[u]},Ji.values=function(){return[tn(),en()]},Ji.valueOf_61zpoe$=function(t){switch(t){case"RightToLeft":return tn();case"LeftToRight":return en();default:h("No enum constant klipper.Direction."+t)}},nn.$metadata$={kind:a,simpleName:"NodeType",interfaces:[u]},nn.values=function(){return[on(),an(),sn()]},nn.valueOf_61zpoe$=function(t){switch(t){case"Any":return on();case"Open":return an();case"Closed":return sn();default:h("No enum constant klipper.NodeType."+t)}},ln.$metadata$={kind:a,simpleName:"ClipType",interfaces:[u]},ln.values=function(){return[hn(),cn(),vn(),pn()]},ln.valueOf_61zpoe$=function(t){switch(t){case"Intersection":return hn();case"Union":return cn();case"Difference":return vn();case"Xor":return pn();default:h("No enum constant klipper.ClipType."+t)}},fn.$metadata$={kind:a,simpleName:"PolyType",interfaces:[u]},fn.values=function(){return[_n(),xn()]},fn.valueOf_61zpoe$=function(t){switch(t){case"Subject":return _n();case"Clip":return xn();default:h("No enum constant klipper.PolyType."+t)}},bn.$metadata$={kind:a,simpleName:"PolyFillType",interfaces:[u]},bn.values=function(){return[yn(),gn(),mn(),En()]},bn.valueOf_61zpoe$=function(t){switch(t){case"EvenOdd":return yn();case"NonZero":return gn();case"Positive":return mn();case"Negative":return En();default:h("No enum constant klipper.PolyFillType."+t)}},Pn.$metadata$={kind:a,simpleName:"JoinType",interfaces:[u]},Pn.values=function(){return[In(),Sn(),An()]},Pn.valueOf_61zpoe$=function(t){switch(t){case"Square":return In();case"Round":return Sn();case"Miter":return An();default:h("No enum constant klipper.JoinType."+t)}},kn.$metadata$={kind:a,simpleName:"EndType",interfaces:[u]},kn.values=function(){return[Cn(),Ln(),On(),Rn(),Dn()]},kn.valueOf_61zpoe$=function(t){switch(t){case"ClosedPolygon":return Cn();case"ClosedLine":return Ln();case"OpenButt":return On();case"OpenSquare":return Rn();case"OpenRound":return Dn();default:h("No enum constant klipper.EndType."+t)}},Nn.$metadata$={kind:a,simpleName:"IntRect",interfaces:[]},Nn.prototype.component1=function(){return this.left},Nn.prototype.component2=function(){return this.top},Nn.prototype.component3=function(){return this.right},Nn.prototype.component4=function(){return this.bottom},Nn.prototype.copy_tjonv8$=function(t,e,i,n){return new Nn(void 0===t?this.left:t,void 0===e?this.top:e,void 0===i?this.right:i,void 0===n?this.bottom:n)},Nn.prototype.toString=function(){return"IntRect(left="+Kotlin.toString(this.left)+", top="+Kotlin.toString(this.top)+", right="+Kotlin.toString(this.right)+", bottom="+Kotlin.toString(this.bottom)+")"},Nn.prototype.hashCode=function(){var t=0;return t=31*(t=31*(t=31*(t=31*t+Kotlin.hashCode(this.left)|0)+Kotlin.hashCode(this.top)|0)+Kotlin.hashCode(this.right)|0)+Kotlin.hashCode(this.bottom)|0},Nn.prototype.equals=function(t){return this===t||null!==t&&"object"===_typeof(t)&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&Kotlin.equals(this.left,t.left)&&Kotlin.equals(this.top,t.top)&&Kotlin.equals(this.right,t.right)&&Kotlin.equals(this.bottom,t.bottom)},zn.$metadata$={kind:a,simpleName:"LocalMinima",interfaces:[]},zn.prototype.component1=function(){return this.y},zn.prototype.component2=function(){return this.leftBound},zn.prototype.component3=function(){return this.rightBound},zn.prototype.component4=function(){return this.next},zn.prototype.copy_7dcbn8$=function(t,e,i,n){return new zn(void 0===t?this.y:t,void 0===e?this.leftBound:e,void 0===i?this.rightBound:i,void 0===n?this.next:n)},zn.prototype.toString=function(){return"LocalMinima(y="+Kotlin.toString(this.y)+", leftBound="+Kotlin.toString(this.leftBound)+", rightBound="+Kotlin.toString(this.rightBound)+", next="+Kotlin.toString(this.next)+")"},zn.prototype.hashCode=function(){var t=0;return t=31*(t=31*(t=31*(t=31*t+Kotlin.hashCode(this.y)|0)+Kotlin.hashCode(this.leftBound)|0)+Kotlin.hashCode(this.rightBound)|0)+Kotlin.hashCode(this.next)|0},zn.prototype.equals=function(t){return this===t||null!==t&&"object"===_typeof(t)&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&Kotlin.equals(this.y,t.y)&&Kotlin.equals(this.leftBound,t.leftBound)&&Kotlin.equals(this.rightBound,t.rightBound)&&Kotlin.equals(this.next,t.next)},Mn.$metadata$={kind:a,simpleName:"Scanbeam",interfaces:[]},Mn.prototype.component1=function(){return this.y},Mn.prototype.component2=function(){return this.next},Mn.prototype.copy_e9jvsg$=function(t,e){return new Mn(void 0===t?this.y:t,void 0===e?this.next:e)},Mn.prototype.toString=function(){return"Scanbeam(y="+Kotlin.toString(this.y)+", next="+Kotlin.toString(this.next)+")"},Mn.prototype.hashCode=function(){var t=0;return t=31*(t=31*t+Kotlin.hashCode(this.y)|0)+Kotlin.hashCode(this.next)|0},Mn.prototype.equals=function(t){return this===t||null!==t&&"object"===_typeof(t)&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&Kotlin.equals(this.y,t.y)&&Kotlin.equals(this.next,t.next)},Fn.$metadata$={kind:a,simpleName:"Maxima",interfaces:[]},Fn.prototype.component1=function(){return this.x},Fn.prototype.component2=function(){return this.next},Fn.prototype.component3=function(){return this.prev},Fn.prototype.copy_sz1ra4$=function(t,e,i){return new Fn(void 0===t?this.x:t,void 0===e?this.next:e,void 0===i?this.prev:i)},Fn.prototype.toString=function(){return"Maxima(x="+Kotlin.toString(this.x)+", next="+Kotlin.toString(this.next)+", prev="+Kotlin.toString(this.prev)+")"},Fn.prototype.hashCode=function(){var t=0;return t=31*(t=31*(t=31*t+Kotlin.hashCode(this.x)|0)+Kotlin.hashCode(this.next)|0)+Kotlin.hashCode(this.prev)|0},Fn.prototype.equals=function(t){return this===t||null!==t&&"object"===_typeof(t)&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&Kotlin.equals(this.x,t.x)&&Kotlin.equals(this.next,t.next)&&Kotlin.equals(this.prev,t.prev)},Bn.$metadata$={kind:a,simpleName:"Join",interfaces:[]},Bn.prototype.component1=function(){return this.outPt1},Bn.prototype.component2=function(){return this.outPt2},Bn.prototype.component3=function(){return this.offPtX},Bn.prototype.component4=function(){return this.offPtY},Bn.prototype.copy_wiqyj8$=function(t,e,i,n){return new Bn(void 0===t?this.outPt1:t,void 0===e?this.outPt2:e,void 0===i?this.offPtX:i,void 0===n?this.offPtY:n)},Bn.prototype.toString=function(){return"Join(outPt1="+Kotlin.toString(this.outPt1)+", outPt2="+Kotlin.toString(this.outPt2)+", offPtX="+Kotlin.toString(this.offPtX)+", offPtY="+Kotlin.toString(this.offPtY)+")"},Bn.prototype.hashCode=function(){var t=0;return t=31*(t=31*(t=31*(t=31*t+Kotlin.hashCode(this.outPt1)|0)+Kotlin.hashCode(this.outPt2)|0)+Kotlin.hashCode(this.offPtX)|0)+Kotlin.hashCode(this.offPtY)|0},Bn.prototype.equals=function(t){return this===t||null!==t&&"object"===_typeof(t)&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&Kotlin.equals(this.outPt1,t.outPt1)&&Kotlin.equals(this.outPt2,t.outPt2)&&Kotlin.equals(this.offPtX,t.offPtX)&&Kotlin.equals(this.offPtY,t.offPtY)},Xn.$metadata$={kind:a,simpleName:"HorzDirection",interfaces:[]},Xn.prototype.component1=function(){return this.left},Xn.prototype.component2=function(){return this.right},Xn.prototype.component3=function(){return this.direction},Xn.prototype.copy_vli5dy$=function(t,e,i){return new Xn(void 0===t?this.left:t,void 0===e?this.right:e,void 0===i?this.direction:i)},Xn.prototype.toString=function(){return"HorzDirection(left="+Kotlin.toString(this.left)+", right="+Kotlin.toString(this.right)+", direction="+Kotlin.toString(this.direction)+")"},Xn.prototype.hashCode=function(){var t=0;return t=31*(t=31*(t=31*t+Kotlin.hashCode(this.left)|0)+Kotlin.hashCode(this.right)|0)+Kotlin.hashCode(this.direction)|0},Xn.prototype.equals=function(t){return this===t||null!==t&&"object"===_typeof(t)&&Object.getPrototypeOf(this)===Object.getPrototypeOf(t)&&Kotlin.equals(this.left,t.left)&&Kotlin.equals(this.right,t.right)&&Kotlin.equals(this.direction,t.direction)};var jn=U("DigitalInk.klipper.get_isNearZero_1zw1ma$",G(function(){var e=t.klipper;return function(t){return t>-e.TOLERANCE_8be2vx$&&t<e.TOLERANCE_8be2vx$}}));function Un(t){return I(t<0?t-.5:t+.5)}function Gn(t,e){}function Kn(t,e,i){return i?d((t.deltaY_8be2vx$,e.deltaX_8be2vx$,c),(t.deltaX_8be2vx$,e.deltaY_8be2vx$,c)):Kotlin.imul(t.deltaY_8be2vx$,e.deltaX_8be2vx$)===Kotlin.imul(t.deltaX_8be2vx$,e.deltaY_8be2vx$)}function qn(t,e,i,n,r,o,a){return a?d(c,c):Kotlin.imul(e-n|0,i-r|0)===Kotlin.imul(t-i|0,n-o|0)}function Hn(t,e,i,n,r,o,a,s,l){return l?d(c,c):Kotlin.imul(e-n|0,r-a|0)===Kotlin.imul(t-i|0,o-s|0)}function Wn(t,e,i,n,r,o){return!(t===r&&e===o||t===i&&e===n||r===i&&o===n)&&(t!==r?i>t==i<r:n>e==n<o)}function Vn(t,e,i,n){return e===n?xi:(i-t|0)/(n-e|0)}function Zn(t,e){var i=t.side_8be2vx$;t.side_8be2vx$=e.side_8be2vx$,e.side_8be2vx$=i}function Jn(t,e){var i=t.outIdx_8be2vx$;t.outIdx_8be2vx$=e.outIdx_8be2vx$,e.outIdx_8be2vx$=i}function Qn(t,e){return e===t.topY_8be2vx$?t.topX_8be2vx$:t.botX_8be2vx$+Un(t.dx_8be2vx$*(e-t.botY_8be2vx$|0))|0}function tr(t){for(var e=t;null!=e&&null==e.pts_8be2vx$;)e=e.firstLeft_8be2vx$;return e}function er(t,e,i,n,r,o){var a=n-o|0,s=r-i|0,l=a*i+s*n;return(l=a*t+s*e-l)*l/(a*a+s*s)}function ir(t,e,i,n,r,o,a){return(K(t-i|0)>K(e-n|0)?t>i==t<r?er(t,e,i,n,r,o):i>t==i<r?er(i,n,t,e,r,o):er(r,o,t,e,i,n):e>n==e<o?er(t,e,i,n,r,o):n>e==n<o?er(i,n,t,e,r,o):er(r,o,t,e,i,n))<a}function nr(t,e,i,n,r){var o=t-i,a=e-n;return o*o+a*a<=r}function rr(t,e,i,n){var r,o,a,s,l,u=n?2:0,h=t.size,c=e.size,v=fr(c);if(i){r=e.size;for(var p=0;p<r;p+=2){var f=sr(h);o=t.size;for(var d=0;d<o;d+=2)f.add_11rb$(e.get_za3lpa$(p)+t.get_za3lpa$(d)|0),f.add_11rb$(e.get_za3lpa$(p+1|0)+t.get_za3lpa$(d+1|0)|0);v.add_11rb$(f)}}else{a=e.size;for(var _=0;_<a;_+=2){var x=sr(h);s=t.size;for(var b=0;b<s;b+=2)x.add_11rb$(e.get_za3lpa$(_)-t.get_za3lpa$(b)|0),x.add_11rb$(e.get_za3lpa$(_+1|0)-t.get_za3lpa$(b+1|0)|0);v.add_11rb$(x)}}var $=fr(Kotlin.imul(c+u|0,h+2|0));l=c-2+u|0;for(var y=0;y<l;y+=2)for(var g=0;g<h;g+=2){var m=ar(new Int32Array([v.get_za3lpa$(y%c).get_za3lpa$(g%h),v.get_za3lpa$((y+1|0)%c).get_za3lpa$((g+1|0)%h),v.get_za3lpa$((y+2|0)%c).get_za3lpa$(g%h),v.get_za3lpa$((y+3|0)%c).get_za3lpa$((g+1|0)%h),v.get_za3lpa$((y+2|0)%c).get_za3lpa$((g+2|0)%h),v.get_za3lpa$((y+3|0)%c).get_za3lpa$((g+3|0)%h),v.get_za3lpa$(y%c).get_za3lpa$((g+2|0)%h),v.get_za3lpa$((y+1|0)%c).get_za3lpa$((g+3|0)%h)]));cr(m)||lr(m),$.add_11rb$(m)}return $}function or(t,e,i,n){var r=i-t|0,o=n-e|0;if(0===r&&0===o)return new M(0,0);var a=r*r+o*o,s=1/bt.sqrt(a);return new M(o*s,(0|-r)*s)}function ar(t){for(var e=b(t.length),i=0;i<t.length;i++)e.add_11rb$(t[i]);return e}function sr(t){return b(t)}function lr(t){for(var e,i,n=0,r=t.size;n<(r/2|0);)e=t.get_za3lpa$(n),i=t.get_za3lpa$(n+1|0),t.set_wxm5ur$(n,t.get_za3lpa$(r-n-2|0)),t.set_wxm5ur$(n+1|0,t.get_za3lpa$(r-n-1|0)),t.set_wxm5ur$(r-n-2|0,e),t.set_wxm5ur$(r-n-1|0,i),n=n+2|0}function ur(t){var e=t.size;if(e<6)return 0;for(var i=0,n=0,r=e-2|0;n<e;){var o=t.get_za3lpa$(n),a=t.get_za3lpa$(n+1|0);i+=(t.get_za3lpa$(r)+o)*(t.get_za3lpa$(r+1|0)-a),r=n,n=n+2|0}return.5*-i}function hr(t,e,i){for(var n,r=t.size,o=b(r),a=0;a<r;a++)o.add_11rb$(0);var s=o;n=t.size;for(var l=0;l<n;l+=2)s.set_wxm5ur$(l,t.get_za3lpa$(l)+e|0),s.set_wxm5ur$(l+1|0,t.get_za3lpa$(l+1|0)+i|0);return s}function cr(t){return ur(t)>=0}var vr=Array;function pr(t){return q(t.slice())}function fr(t){return b(t)}var dr=U("DigitalInk.klipper.Paths_9nlmmg$",G(function(){var t=Kotlin.kotlin.collections.ArrayList_init_ww73n8$;return function(e,i){for(var n=t(e),r=0;r<e;r++)n.add_11rb$(i(r));return n}}));function _r(t){for(var e={v:0},i=t.size;e.v<i&&0===t.get_za3lpa$(e.v).size;)e.v=e.v+1|0;if(e.v===i)return new Nn(0,0,0,0);var n={v:0},r={v:0};n.v=t.get_za3lpa$(e.v).get_za3lpa$(0),r.v=t.get_za3lpa$(e.v).get_za3lpa$(1);var o,a=new Nn(n.v,r.v,n.v,r.v);for(o=T(e.v,i).iterator();o.hasNext();){var s,l=o.next(),u=t.get_za3lpa$(l);s=u.size;for(var h=0;h<s;h+=2)u.get_za3lpa$(e.v)<a.left?a.left=u.get_za3lpa$(e.v):u.get_za3lpa$(e.v)>a.right&&(a.right=u.get_za3lpa$(e.v)),u.get_za3lpa$(e.v+1|0)<a.top?a.top=u.get_za3lpa$(e.v+1|0):u.get_za3lpa$(e.v+1|0)>a.bottom&&(a.bottom=u.get_za3lpa$(e.v+1|0))}return a}function xr(t,e,i){var n;switch(i.name){case"Open":return;case"Closed":n=!e.isOpen;break;default:n=!0}var r,o=n;if(!e.contour.isEmpty()&&o){var a=e.contour;t.add_11rb$(a)}for(r=e.children.iterator();r.hasNext();){xr(t,r.next(),i)}}function br(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.jointype_8be2vx$=t,this.endtype_8be2vx$=e,this.parent=null,this.contour=ar(new Int32Array([])),this.index_40vyxd$_0=0,this.children=l(),this.isOpen=!1}function $r(){br.call(this),this.allPolys_8be2vx$=l()}function yr(){this.botX_8be2vx$=0,this.botY_8be2vx$=0,this.currX_8be2vx$=0,this.currY_8be2vx$=0,this.topX_8be2vx$=0,this.topY_8be2vx$=0,this.deltaX_8be2vx$=0,this.deltaY_8be2vx$=0,this.dx_8be2vx$=0,this.polyTyp_8be2vx$=null,this.side_8be2vx$=null,this.windDelta_8be2vx$=0,this.windCnt_8be2vx$=0,this.windCnt2_8be2vx$=0,this.outIdx_8be2vx$=0,this.next_8be2vx$_ucipwl$_0=this.next_8be2vx$_ucipwl$_0,this.prev_8be2vx$_wqgucb$_0=this.prev_8be2vx$_wqgucb$_0,this.nextInLML_8be2vx$=null,this.nextInAEL_8be2vx$=null,this.prevInAEL_8be2vx$=null,this.nextInSEL_8be2vx$=null,this.prevInSEL_8be2vx$=null}function gr(t,e,i,n){this.edge1_8be2vx$=t,this.edge2_8be2vx$=e,this.ptX_8be2vx$=i,this.ptY_8be2vx$=n}function mr(t){return d(t.edge1_8be2vx$.nextInSEL_8be2vx$,t.edge2_8be2vx$)||d(t.edge1_8be2vx$.prevInSEL_8be2vx$,t.edge2_8be2vx$)}function Er(){Pr=this}Object.defineProperty(br.prototype,"childCount",{get:function(){return this.children.size}}),br.prototype.addChild_n1bxgk$=function(t){var e=this.children.size;this.children.add_11rb$(t),t.parent=this,t.index_40vyxd$_0=e},br.prototype.getNext=function(){return this.children.isEmpty()?this.getNextSiblingUp_8be2vx$():this.children.get_za3lpa$(0)},br.prototype.getNextSiblingUp_8be2vx$=function(){var t=this.parent;return null==t?null:this.index_40vyxd$_0===(t.children.size-1|0)?t.getNextSiblingUp_8be2vx$():t.children.get_za3lpa$(this.index_40vyxd$_0+1|0)},Object.defineProperty(br.prototype,"isHole",{get:function(){for(var t=!0,e=this.parent;null!=e;)t=!t,e=e.parent;return t}}),br.$metadata$={kind:a,simpleName:"PolyNode",interfaces:[]},Object.defineProperty($r.prototype,"first",{get:function(){return H(this.children)}}),Object.defineProperty($r.prototype,"total",{get:function(){var t=this.allPolys_8be2vx$.size;return t>0&&!d(this.children.get_za3lpa$(0),this.allPolys_8be2vx$.get_za3lpa$(0))&&(t=t-1|0),t}}),Object.defineProperty($r.prototype,"openPaths",{get:function(){var t,e=fr(this.childCount);for(t=this.children.iterator();t.hasNext();){var i=t.next();if(i.isOpen){var n=i.contour;e.add_11rb$(n)}}return e}}),Object.defineProperty($r.prototype,"closedPaths",{get:function(){var t=fr(this.total);return xr(t,this,sn()),t}}),Object.defineProperty($r.prototype,"paths",{get:function(){var t=fr(this.total);return xr(t,this,on()),t}}),$r.prototype.clear=function(){var t;this.allPolys_8be2vx$.clear(),(Kotlin.isType(t=this.children,W)?t:m()).clear()},$r.$metadata$={kind:a,simpleName:"PolyTree",interfaces:[br]},Object.defineProperty(yr.prototype,"next_8be2vx$",{get:function(){return null==this.next_8be2vx$_ucipwl$_0?V("next"):this.next_8be2vx$_ucipwl$_0},set:function(t){this.next_8be2vx$_ucipwl$_0=t}}),Object.defineProperty(yr.prototype,"prev_8be2vx$",{get:function(){return null==this.prev_8be2vx$_wqgucb$_0?V("prev"):this.prev_8be2vx$_wqgucb$_0},set:function(t){this.prev_8be2vx$_wqgucb$_0=t}}),yr.prototype.init_n1fz30$=function(t){this.currY_8be2vx$>=this.next_8be2vx$.currY_8be2vx$?(this.botX_8be2vx$=this.currX_8be2vx$,this.botY_8be2vx$=this.currY_8be2vx$,this.topX_8be2vx$=this.next_8be2vx$.currX_8be2vx$,this.topY_8be2vx$=this.next_8be2vx$.currY_8be2vx$):(this.topX_8be2vx$=this.currX_8be2vx$,this.topY_8be2vx$=this.currY_8be2vx$,this.botX_8be2vx$=this.next_8be2vx$.currX_8be2vx$,this.botY_8be2vx$=this.next_8be2vx$.currY_8be2vx$),this.setDx_8be2vx$(),this.polyTyp_8be2vx$=t},yr.prototype.init_y2ij7r$=function(t,e,i,n){this.next_8be2vx$=t,this.prev_8be2vx$=e,this.currX_8be2vx$=i,this.currY_8be2vx$=n,this.outIdx_8be2vx$=-1},Object.defineProperty(yr.prototype,"isHorizontal_8be2vx$",{get:function(){return 0===this.deltaY_8be2vx$}}),yr.prototype.setDx_8be2vx$=function(){this.deltaX_8be2vx$=this.topX_8be2vx$-this.botX_8be2vx$|0,this.deltaY_8be2vx$=this.topY_8be2vx$-this.botY_8be2vx$|0,this.dx_8be2vx$=0===this.deltaY_8be2vx$?xi:this.deltaX_8be2vx$/this.deltaY_8be2vx$},yr.prototype.reverseHorizontal_8be2vx$=function(){var t=this.topX_8be2vx$;this.topX_8be2vx$=this.botX_8be2vx$,this.botX_8be2vx$=t},yr.$metadata$={kind:a,simpleName:"TEdge",interfaces:[]},gr.$metadata$={kind:a,simpleName:"IntersectNode",interfaces:[]},Er.prototype.compare=function(t,e){var i=e.ptY_8be2vx$-t.ptY_8be2vx$|0;return i>0?1:i<0?-1:0},Er.$metadata$={kind:p,simpleName:"IntersectNodeComparator",interfaces:[Z]};var Pr=null;function wr(){return null===Pr&&new Er,Pr}function Ir(){this.idx_8be2vx$=-1,this.isHole_8be2vx$=!1,this.isOpen_8be2vx$=!1,this.firstLeft_8be2vx$=null,this.pts_8be2vx$=null,this.bottomPt_8be2vx$=null,this.polyNode_8be2vx$=null}function Sr(t,e,i){this.idx_8be2vx$=t,this.ptX_8be2vx$=0,this.ptY_8be2vx$=0,this.next_8be2vx$_lusozq$_0=this.next_8be2vx$_lusozq$_0,this.prev_8be2vx$_tsx6py$_0=this.prev_8be2vx$_tsx6py$_0,this.ptX_8be2vx$=e,this.ptY_8be2vx$=i}function Ar(){this.minimaList_8be2vx$=null,this.currentLM_8be2vx$=null,this.edges_8be2vx$=l(),this.scanbeam_8be2vx$=null,this.polyOuts_8be2vx$=l(),this.activeEdges_8be2vx$=null,this.useFullRange_8be2vx$=!1,this.hasOpenPaths_8be2vx$=!1,this.preserveCollinear=!1}function kr(t){Lr(),void 0===t&&(t=0),Ar.call(this),this.clipType_0=null,this.maxima_0=null,this.sortedEdges_0=null,this.intersectList_0=l(),this.intersectNodeComparator_8be2vx$=wr(),this.executeLocked_0=!1,this.clipFillType_0=null,this.subjFillType_0=null,this.joins_0=l(),this.ghostJoins_0=l(),this.usingPolyTree_0=!1,this.reverseSolution=0!=(1&t),this.strictlySimple=0!=(2&t),this.preserveCollinear=0!=(4&t)}function Tr(){Cr=this,this.REVERSE_SOLUTION=1,this.STRICTLY_SIMPLE=2,this.PRESERVE_COLLINEAR=4}Ir.prototype.isRightOf_xn8tnc$=function(t){var e=this;do{if(e=x(e).firstLeft_8be2vx$,d(e,t))return!0}while(null!=e);return!1},Ir.prototype.updateOutPtIdxs_8be2vx$=function(){var t=x(this.pts_8be2vx$);do{t.idx_8be2vx$=this.idx_8be2vx$,t=t.prev_8be2vx$}while(!d(t,this.pts_8be2vx$))},Ir.prototype.calcArea_8be2vx$=function(){var t,e;return null!=(e=null!=(t=this.pts_8be2vx$)?t.calcArea_8be2vx$():null)?e:0},Ir.$metadata$={kind:a,simpleName:"OutRec",interfaces:[]},Object.defineProperty(Sr.prototype,"next_8be2vx$",{get:function(){return null==this.next_8be2vx$_lusozq$_0?V("next"):this.next_8be2vx$_lusozq$_0},set:function(t){this.next_8be2vx$_lusozq$_0=t}}),Object.defineProperty(Sr.prototype,"prev_8be2vx$",{get:function(){return null==this.prev_8be2vx$_tsx6py$_0?V("prev"):this.prev_8be2vx$_tsx6py$_0},set:function(t){this.prev_8be2vx$_tsx6py$_0=t}}),Sr.prototype.reversePolyPtLinks_8be2vx$=function(){var t,e;t=this;do{e=t.next_8be2vx$,t.next_8be2vx$=t.prev_8be2vx$,t.prev_8be2vx$=e,t=e}while(!d(t,this))},Sr.prototype.calcArea_8be2vx$=function(){var t=this,e=0;do{e+=(t.prev_8be2vx$.ptX_8be2vx$+t.ptX_8be2vx$|0)*(t.prev_8be2vx$.ptY_8be2vx$-t.ptY_8be2vx$|0),t=t.next_8be2vx$}while(!d(t,this));return.5*e},Sr.prototype.containsPoint_6xvm5r$=function(t,e){var i=this,n=0,r=i,o=i.ptX_8be2vx$,a=i.ptY_8be2vx$;do{var s=(i=i.next_8be2vx$).ptX_8be2vx$,l=i.ptY_8be2vx$;if(l===e&&(s===t||a===e&&s>t==o<t))return-1;if(a<e!=l<e)if(o>=t)if(s>t)n=1-n|0;else{var u=(o-t|0)*(l-e|0)-(s-t|0)*(a-e|0);if(0===u)return-1;u>0==l>a&&(n=1-n|0)}else if(s>t){var h=(o-t|0)*(l-e|0)-(s-t|0)*(a-e|0);if(0===h)return-1;h>0==l>a&&(n=1-n|0)}o=s,a=l}while(!d(r,i));return n},Sr.prototype.containsPoint_3dk5mk$=function(t){var e=t;do{var i=this.containsPoint_6xvm5r$(e.ptX_8be2vx$,e.ptY_8be2vx$);if(i>=0)return i>0;e=e.next_8be2vx$}while(!d(e,t));return!0},Sr.prototype.exclude_8be2vx$=function(){var t=this.prev_8be2vx$;return t.next_8be2vx$=this.next_8be2vx$,this.next_8be2vx$.prev_8be2vx$=t,t.idx_8be2vx$=0,t},Sr.prototype.hasVertex_6xvm5r$=function(t,e){var i=this;do{if(i.ptX_8be2vx$===t&&i.ptY_8be2vx$===e)return!0;i=i.next_8be2vx$}while(!d(i,this));return!1},Sr.$metadata$={kind:a,simpleName:"OutPt",interfaces:[]},Ar.prototype.rangeTest_b8r1gm$=function(t,e,i){if(i.get()){if(t>32767||e>32767||(0|-t)>32767||(0|-e)>32767)throw new Gr("Coordinate (["+t+", "+e+"]) outside allowed range.")}else(t>32767||e>32767||(0|-t)>32767||(0|-e)>32767)&&(i.set(!0),this.rangeTest_b8r1gm$(t,e,i))},Ar.prototype.findNextLocMin_xdr81x$_0=function(t){for(var e,i=t;;){for(;i.botX_8be2vx$!==i.prev_8be2vx$.botX_8be2vx$&&i.botY_8be2vx$!==i.prev_8be2vx$.botY_8be2vx$||i.currX_8be2vx$===i.topX_8be2vx$&&i.currY_8be2vx$===i.topY_8be2vx$;)i=i.next_8be2vx$;if(i.dx_8be2vx$!==xi&&i.prev_8be2vx$.dx_8be2vx$!==xi)break;for(;i.prev_8be2vx$.dx_8be2vx$===xi;)i=i.prev_8be2vx$;for(e=i;i.dx_8be2vx$===xi;)i=i.next_8be2vx$;if(i.topY_8be2vx$!==i.prev_8be2vx$.botY_8be2vx$){e.prev_8be2vx$.botX_8be2vx$<i.botX_8be2vx$&&(i=e);break}}return i},Ar.prototype.processBound_ce1kep$_0=function(t,e){var i,n,r=t,o=r;if(-2===o.outIdx_8be2vx$){if(r=o,e){for(;r.topY_8be2vx$===r.next_8be2vx$.botY_8be2vx$;)r=r.next_8be2vx$;for(;!d(r,o)&&r.dx_8be2vx$===xi;)r=r.prev_8be2vx$}else{for(;r.topY_8be2vx$===r.next_8be2vx$.botY_8be2vx$;)r=r.prev_8be2vx$;for(;!d(r,o)&&r.dx_8be2vx$===xi;)r=r.next_8be2vx$}if(d(r,o))o=e?r.next_8be2vx$:r.prev_8be2vx$;else{r=e?o.next_8be2vx$:o.prev_8be2vx$;var a=new zn;a.next=null,a.y=r.botY_8be2vx$,a.leftBound=null,a.rightBound=r,r.windDelta_8be2vx$=0,o=this.processBound_ce1kep$_0(r,e),this.insertLocalMinima_nl7vmx$_0(a)}return o}if(r.dx_8be2vx$===xi&&((i=e?r.prev_8be2vx$:r.next_8be2vx$).dx_8be2vx$===xi?i.botX_8be2vx$!==r.botX_8be2vx$&&i.topX_8be2vx$!==r.botX_8be2vx$&&r.reverseHorizontal_8be2vx$():i.botX_8be2vx$!==r.botX_8be2vx$&&r.reverseHorizontal_8be2vx$()),i=r,e){for(;o.topY_8be2vx$===o.next_8be2vx$.botY_8be2vx$&&-2!==o.next_8be2vx$.outIdx_8be2vx$;)o=o.next_8be2vx$;if(o.dx_8be2vx$===xi&&-2!==o.next_8be2vx$.outIdx_8be2vx$){for(n=o;n.prev_8be2vx$.dx_8be2vx$===xi;)n=n.prev_8be2vx$;n.prev_8be2vx$.topX_8be2vx$>o.next_8be2vx$.topX_8be2vx$&&(o=n.prev_8be2vx$)}for(;!d(r,o);)r.nextInLML_8be2vx$=r.next_8be2vx$,r.dx_8be2vx$!==xi||d(r,i)||r.botX_8be2vx$===r.prev_8be2vx$.topX_8be2vx$||r.reverseHorizontal_8be2vx$(),r=r.next_8be2vx$;r.dx_8be2vx$!==xi||d(r,i)||r.botX_8be2vx$===r.prev_8be2vx$.topX_8be2vx$||r.reverseHorizontal_8be2vx$(),o=o.next_8be2vx$}else{for(;o.topY_8be2vx$===o.prev_8be2vx$.botY_8be2vx$&&-2!==o.prev_8be2vx$.outIdx_8be2vx$;)o=o.prev_8be2vx$;if(o.dx_8be2vx$===xi&&-2!==o.prev_8be2vx$.outIdx_8be2vx$){for(n=o;n.next_8be2vx$.dx_8be2vx$===xi;)n=n.next_8be2vx$;(n.next_8be2vx$.topX_8be2vx$===o.prev_8be2vx$.topX_8be2vx$||n.next_8be2vx$.topX_8be2vx$>o.prev_8be2vx$.topX_8be2vx$)&&(o=n.next_8be2vx$)}for(;!d(r,o);)r.nextInLML_8be2vx$=r.prev_8be2vx$,r.dx_8be2vx$!==xi||d(r,i)||r.botX_8be2vx$===r.next_8be2vx$.topX_8be2vx$||r.reverseHorizontal_8be2vx$(),r=r.prev_8be2vx$;r.dx_8be2vx$!==xi||d(r,i)||r.botX_8be2vx$===r.next_8be2vx$.topX_8be2vx$||r.reverseHorizontal_8be2vx$(),o=o.prev_8be2vx$}return o},Ar.prototype.addPath_uwq97q$=function(t,e,i){if(!pi)throw new Gr("AddPath: Open paths have been disabled.");if(!i&&e===xn())throw new Gr("AddPath: Open paths must be subject.");var n=t.size-2|0;if(i)for(;n>0&&t.get_za3lpa$(n)===t.get_za3lpa$(0)&&t.get_za3lpa$(n+1|0)===t.get_za3lpa$(1);)n=n-2|0;for(;n>0&&t.get_za3lpa$(n)===t.get_za3lpa$(n-2|0)&&t.get_za3lpa$(n+1|0)===t.get_za3lpa$(n-1|0);)n=n-2|0;if(i&&n<4||!i&&n<2)return!1;for(var r=1+(n/2|0)|0,o=b(r),a=0;a<r;a++)o.add_11rb$(new yr);var s,l=o,u=!0;for(l.get_za3lpa$(1).currX_8be2vx$=t.get_za3lpa$(2),l.get_za3lpa$(1).currY_8be2vx$=t.get_za3lpa$(3),this.rangeTest_b8r1gm$(t.get_za3lpa$(0),t.get_za3lpa$(1),J("useFullRange",0,function(t){return t.useFullRange_8be2vx$}.bind(null,this),function(t,e){t.useFullRange_8be2vx$=e}.bind(null,this))),this.rangeTest_b8r1gm$(t.get_za3lpa$(n),t.get_za3lpa$(n+1|0),J("useFullRange",0,function(t){return t.useFullRange_8be2vx$}.bind(null,this),function(t,e){t.useFullRange_8be2vx$=e}.bind(null,this))),l.get_za3lpa$(0).init_y2ij7r$(l.get_za3lpa$(1),l.get_za3lpa$(n/2|0),t.get_za3lpa$(0),t.get_za3lpa$(1)),l.get_za3lpa$(n/2|0).init_y2ij7r$(l.get_za3lpa$(0),l.get_za3lpa$((n/2|0)-1|0),t.get_za3lpa$(n),t.get_za3lpa$(n+1|0)),s=Q((n/2|0)-1|0,1).iterator();s.hasNext();){var h=s.next();this.rangeTest_b8r1gm$(t.get_za3lpa$(2*h|0),t.get_za3lpa$(1+(2*h|0)|0),J("useFullRange",0,function(t){return t.useFullRange_8be2vx$}.bind(null,this),function(t,e){t.useFullRange_8be2vx$=e}.bind(null,this))),l.get_za3lpa$(h).init_y2ij7r$(l.get_za3lpa$(h+1|0),l.get_za3lpa$(h-1|0),t.get_za3lpa$(2*h|0),t.get_za3lpa$(1+(2*h|0)|0))}for(var c=l.get_za3lpa$(0),v={v:c},p=c;;)if(v.v.currX_8be2vx$!==v.v.next_8be2vx$.currX_8be2vx$||v.v.currY_8be2vx$!==v.v.next_8be2vx$.currY_8be2vx$||!i&&d(v.v.next_8be2vx$,c)){if(d(v.v.prev_8be2vx$,v.v.next_8be2vx$))break;if(!i||!qn(v.v.prev_8be2vx$.currX_8be2vx$,v.v.prev_8be2vx$.currY_8be2vx$,v.v.currX_8be2vx$,v.v.currY_8be2vx$,v.v.next_8be2vx$.currX_8be2vx$,v.v.next_8be2vx$.currY_8be2vx$,this.useFullRange_8be2vx$)||this.preserveCollinear&&Wn(v.v.prev_8be2vx$.currX_8be2vx$,v.v.prev_8be2vx$.currY_8be2vx$,v.v.currX_8be2vx$,v.v.currY_8be2vx$,v.v.next_8be2vx$.currX_8be2vx$,v.v.next_8be2vx$.currY_8be2vx$)){if(v.v=v.v.next_8be2vx$,d(v.v,p)||!i&&d(v.v.next_8be2vx$,c))break}else d(v.v,c)&&(c=v.v.next_8be2vx$),v.v=this.removeEdge_3fg5wb$(v.v),v.v=v.v.prev_8be2vx$,p=v.v}else{if(d(v.v,v.v.next_8be2vx$))break;d(v.v,c)&&(c=v.v.next_8be2vx$),v.v=this.removeEdge_3fg5wb$(v.v),p=v.v}if(!i&&d(v.v,v.v.next_8be2vx$)||i&&d(v.v.prev_8be2vx$,v.v.next_8be2vx$))return!1;i||(this.hasOpenPaths_8be2vx$=!0,c.prev_8be2vx$.outIdx_8be2vx$=-2),v.v=c;do{v.v.init_n1fz30$(e),v.v=v.v.next_8be2vx$,u&&v.v.currY_8be2vx$!==c.currY_8be2vx$&&(u=!1)}while(!d(v.v,c));if(u){if(i)return!1;v.v.prev_8be2vx$.outIdx_8be2vx$=-2;var f=new zn;f.next=null,f.y=v.v.botY_8be2vx$,f.leftBound=null;var _=v.v;_.side_8be2vx$=Zi(),_.windDelta_8be2vx$=0,f.rightBound=_;for(var $=f;v.v.botX_8be2vx$!==v.v.prev_8be2vx$.topX_8be2vx$&&v.v.reverseHorizontal_8be2vx$(),-2!==v.v.next_8be2vx$.outIdx_8be2vx$;)v.v.nextInLML_8be2vx$=v.v.next_8be2vx$,v.v=v.v.next_8be2vx$;return this.insertLocalMinima_nl7vmx$_0($),this.edges_8be2vx$.add_11rb$(l),!0}this.edges_8be2vx$.add_11rb$(l);var y={v:null},g=null;for(v.v.prev_8be2vx$.botX_8be2vx$===v.v.prev_8be2vx$.topX_8be2vx$&&v.v.prev_8be2vx$.botY_8be2vx$===v.v.prev_8be2vx$.topY_8be2vx$&&(v.v=v.v.next_8be2vx$);v.v=this.findNextLocMin_xdr81x$_0(v.v),!d(v.v,g);){null==g&&(g=v.v);var m=new zn;m.next=null,m.y=v.v.botY_8be2vx$,v.v.dx_8be2vx$<v.v.prev_8be2vx$.dx_8be2vx$?(m.leftBound=v.v.prev_8be2vx$,m.rightBound=v.v,y.v=!1):(m.leftBound=v.v,m.rightBound=v.v.prev_8be2vx$,y.v=!0),x(m.leftBound).side_8be2vx$=Vi(),x(m.rightBound).side_8be2vx$=Zi(),i?d(x(m.leftBound).next_8be2vx$,m.rightBound)?x(m.leftBound).windDelta_8be2vx$=-1:x(m.leftBound).windDelta_8be2vx$=1:x(m.leftBound).windDelta_8be2vx$=0,x(m.rightBound).windDelta_8be2vx$=0|-x(m.leftBound).windDelta_8be2vx$,v.v=this.processBound_ce1kep$_0(x(m.leftBound),y.v),-2===v.v.outIdx_8be2vx$&&(v.v=this.processBound_ce1kep$_0(v.v,y.v));var E=this.processBound_ce1kep$_0(x(m.rightBound),!y.v);-2===E.outIdx_8be2vx$&&(E=this.processBound_ce1kep$_0(E,!y.v)),-2===x(m.leftBound).outIdx_8be2vx$?m.leftBound=null:-2===x(m.rightBound).outIdx_8be2vx$&&(m.rightBound=null),y.v||(v.v=E);var P=m;this.insertLocalMinima_nl7vmx$_0(P)}return!0},Ar.prototype.addPaths_4w9siq$=function(t,e,i){var n,r={v:!1};for(n=t.iterator();n.hasNext();){var o=n.next();this.addPath_uwq97q$(o,e,i)&&(r.v=!0)}return r.v},Ar.prototype.removeEdge_3fg5wb$=function(t){return t.prev_8be2vx$.next_8be2vx$=t.next_8be2vx$,t.next_8be2vx$.prev_8be2vx$=t.prev_8be2vx$,t.next_8be2vx$},Ar.prototype.insertLocalMinima_nl7vmx$_0=function(t){if(null==this.minimaList_8be2vx$)this.minimaList_8be2vx$=t;else if(t.y>=x(this.minimaList_8be2vx$).y)t.next=this.minimaList_8be2vx$,this.minimaList_8be2vx$=t;else{for(var e=this.minimaList_8be2vx$;null!=x(e).next&&t.y<x(e.next).y;)e=e.next;t.next=e.next,e.next=t}},Ar.prototype.popLocalMinima_kcn2v3$=function(t){var e=this.currentLM_8be2vx$;return null!=this.currentLM_8be2vx$&&x(this.currentLM_8be2vx$).y===t?(this.currentLM_8be2vx$=x(this.currentLM_8be2vx$).next,e):null},Ar.prototype.reset=function(){var t,e;if(this.currentLM_8be2vx$=this.minimaList_8be2vx$,null!=this.currentLM_8be2vx$){this.scanbeam_8be2vx$=null;for(var i=this.minimaList_8be2vx$;null!=i;)this.insertScanbeam_kcn2v3$(i.y),null!=(t=i.leftBound)&&(t.currX_8be2vx$=t.botX_8be2vx$,t.currY_8be2vx$=t.botY_8be2vx$,t.outIdx_8be2vx$=-1),null!=(e=i.rightBound)&&(e.currX_8be2vx$=e.botX_8be2vx$,e.currY_8be2vx$=e.botY_8be2vx$,e.outIdx_8be2vx$=-1),i=i.next;this.activeEdges_8be2vx$=null}},Ar.prototype.insertScanbeam_kcn2v3$=function(t){if(null==this.scanbeam_8be2vx$)this.scanbeam_8be2vx$=new Mn(t,null);else if(t>x(this.scanbeam_8be2vx$).y)this.scanbeam_8be2vx$=new Mn(t,this.scanbeam_8be2vx$);else{for(var e=x(this.scanbeam_8be2vx$);null!=e.next&&t<=x(e.next).y;)e=x(e.next);t!==e.y&&(e.next=new Mn(t,e.next))}},Ar.prototype.popScanbeam_8be2vx$=function(){if(null==this.scanbeam_8be2vx$)return null;var t=x(this.scanbeam_8be2vx$).y;return this.scanbeam_8be2vx$=x(this.scanbeam_8be2vx$).next,t},Ar.prototype.localMinimaPending_8be2vx$=function(){return null!=this.currentLM_8be2vx$},Ar.prototype.createOutRec_8be2vx$=function(){var t=new Ir;return this.polyOuts_8be2vx$.add_11rb$(t),t.idx_8be2vx$=this.polyOuts_8be2vx$.size-1|0,t},Ar.prototype.updateEdgeIntoAEL_3fg5wb$=function(t){var e;if(null==(e=t.nextInLML_8be2vx$))throw new Gr("UpdateEdgeIntoAEL: invalid call");var i=e,n=t.prevInAEL_8be2vx$,r=t.nextInAEL_8be2vx$;return i.outIdx_8be2vx$=t.outIdx_8be2vx$,null!=n?n.nextInAEL_8be2vx$=i:this.activeEdges_8be2vx$=i,null!=r&&(r.prevInAEL_8be2vx$=i),i.side_8be2vx$=t.side_8be2vx$,i.windDelta_8be2vx$=t.windDelta_8be2vx$,i.windCnt_8be2vx$=t.windCnt_8be2vx$,i.windCnt2_8be2vx$=t.windCnt2_8be2vx$,i.currX_8be2vx$=i.botX_8be2vx$,i.currY_8be2vx$=i.botY_8be2vx$,i.prevInAEL_8be2vx$=n,i.nextInAEL_8be2vx$=r,i.isHorizontal_8be2vx$||this.insertScanbeam_kcn2v3$(i.topY_8be2vx$),i},Ar.prototype.swapPositionsInAEL_mmqypl$=function(t,e){var i,n,r,o,a,s;if(!d(t.nextInAEL_8be2vx$,t.prevInAEL_8be2vx$)&&!d(e.nextInAEL_8be2vx$,e.prevInAEL_8be2vx$)){if(d(t.nextInAEL_8be2vx$,e)){var l;null!=(i=e.nextInAEL_8be2vx$)?(i.prevInAEL_8be2vx$=t,l=i):l=null;var u,h=l;null!=(n=t.prevInAEL_8be2vx$)?(n.nextInAEL_8be2vx$=e,u=n):u=null;var c=u;e.prevInAEL_8be2vx$=c,e.nextInAEL_8be2vx$=t,t.prevInAEL_8be2vx$=e,t.nextInAEL_8be2vx$=h}else if(d(e.nextInAEL_8be2vx$,t)){var v;null!=(r=t.nextInAEL_8be2vx$)?(r.prevInAEL_8be2vx$=e,v=r):v=null;var p,f=v;null!=(o=e.prevInAEL_8be2vx$)?(o.nextInAEL_8be2vx$=t,p=o):p=null;var _=p;t.prevInAEL_8be2vx$=_,t.nextInAEL_8be2vx$=e,e.prevInAEL_8be2vx$=t,e.nextInAEL_8be2vx$=f}else{var x,b,$,y,g=t.nextInAEL_8be2vx$,m=t.prevInAEL_8be2vx$;null!=(a=e.nextInAEL_8be2vx$)?(a.prevInAEL_8be2vx$=t,x=a):x=null,t.nextInAEL_8be2vx$=x,null!=(s=e.prevInAEL_8be2vx$)?(s.nextInAEL_8be2vx$=t,b=s):b=null,t.prevInAEL_8be2vx$=b,null!=g?(g.prevInAEL_8be2vx$=e,$=g):$=null,e.nextInAEL_8be2vx$=$,null!=m?(m.nextInAEL_8be2vx$=e,y=m):y=null,e.prevInAEL_8be2vx$=y}null==t.prevInAEL_8be2vx$?this.activeEdges_8be2vx$=t:null==e.prevInAEL_8be2vx$&&(this.activeEdges_8be2vx$=e)}},Ar.prototype.deleteFromAEL_3fg5wb$=function(t){var e=t.prevInAEL_8be2vx$,i=t.nextInAEL_8be2vx$;(null!=e||null!=i||d(t,this.activeEdges_8be2vx$))&&(null!=e?e.nextInAEL_8be2vx$=i:this.activeEdges_8be2vx$=i,null!=i&&(i.prevInAEL_8be2vx$=e),t.nextInAEL_8be2vx$=null,t.prevInAEL_8be2vx$=null)},Ar.prototype.clear=function(){var t;for(this.disposeLocalMinimaList_n4lyzg$_0(),t=this.edges_8be2vx$.iterator();t.hasNext();){t.next().clear()}},Ar.prototype.disposeLocalMinimaList_n4lyzg$_0=function(){for(;null!=this.minimaList_8be2vx$;){var t=x(this.minimaList_8be2vx$).next;this.minimaList_8be2vx$=null,this.minimaList_8be2vx$=t}this.currentLM_8be2vx$=null},Ar.$metadata$={kind:a,simpleName:"ClipperBase",interfaces:[]},Tr.$metadata$={kind:p,simpleName:"Companion",interfaces:[]};var Cr=null;function Lr(){return null===Cr&&new Tr,Cr}function Or(t,e){Ur(),void 0===t&&(t=2),void 0===e&&(e=Ur().DEF_ARC_TOLERANCE),this.miterLimit=t,this.arcTolerance=e,this.destPolys_63nkfw$_0=this.destPolys_63nkfw$_0,this.srcPoly_2tnktt$_0=this.srcPoly_2tnktt$_0,this.destPoly_dju7wb$_0=this.destPoly_dju7wb$_0,this.normals_0=l(),this.delta_0=0,this.sinA_0=0,this.sin_0=0,this.cos_0=0,this.miterLim_0=0,this.stepsPerRad_0=0,this.lowestX_0=-1,this.lowestY_0=0,this.polyNodes_0=new br}function Rr(){jr=this,this.TWO_PI=2*P.PI,this.DEF_ARC_TOLERANCE=.25}kr.prototype.insertMaxima_0=function(t){var e,i=new Fn;i.x=t;var n=this.maxima_0;if(null==n)this.maxima_0=i;else if(t<n.x)i.next=n,this.maxima_0=i;else{for(var r=n;null!=x(r).next&&t>=x(r.next).x;)r=r.next;if(t===r.x)return;i.next=r.next,i.prev=r,null!=(e=r.next)&&(e.prev=i),r.next=i}},kr.prototype.execute_70u5c3$=function(t,e,i){return void 0===i&&(i=yn()),this.execute_vmznv9$(t,e,i,i)},kr.prototype.execute_egl5ia$=function(t,e,i){return void 0===i&&(i=yn()),this.execute_gfiyp8$(t,e,i,i)},kr.prototype.execute_vmznv9$=function(t,e,i,n){if(this.executeLocked_0)return!1;if(this.hasOpenPaths_8be2vx$)throw new Gr("Error: PolyTree struct is needed for open path clipping.");var r;this.executeLocked_0=!0,e.clear(),this.subjFillType_0=i,this.clipFillType_0=n,this.clipType_0=t,this.usingPolyTree_0=!1;try{(r=this.executeInternal_0())&&this.buildResult_0(e)}finally{this.disposeAllPolyPts_0(),this.executeLocked_0=!1}return r},kr.prototype.execute_gfiyp8$=function(t,e,i,n){if(this.executeLocked_0)return!1;var r;this.executeLocked_0=!0,this.subjFillType_0=i,this.clipFillType_0=n,this.clipType_0=t,this.usingPolyTree_0=!0;try{(r=this.executeInternal_0())&&this.buildResult2_0(e)}finally{this.disposeAllPolyPts_0(),this.executeLocked_0=!1}return r},kr.prototype.fixHoleLinkage_xn8tnc$=function(t){var e=t.firstLeft_8be2vx$;if(null!=e&&(t.isHole_8be2vx$===e.isHole_8be2vx$||null==e.pts_8be2vx$)){for(var i=e;null!=i&&(i.isHole_8be2vx$===t.isHole_8be2vx$||null==i.pts_8be2vx$);)i=i.firstLeft_8be2vx$;t.firstLeft_8be2vx$=i}},kr.prototype.executeInternal_0=function(){var t,e,i,n;try{this.reset(),this.sortedEdges_0=null,this.maxima_0=null;var r={v:0},o={v:0},a=this.popScanbeam_8be2vx$();if(null==a)return!1;for(r.v=a,this.insertLocalMinimaIntoAEL_0(r.v);;){var s;if(null!=(t=this.popScanbeam_8be2vx$())?(o.v=t,s=c):s=null,null==s&&!this.localMinimaPending_8be2vx$())break;if(this.processHorizontals_0(),this.ghostJoins_0.clear(),!this.processIntersections_0(o.v))return!1;this.processEdgesAtTopOfScanbeam_0(o.v),r.v=o.v,this.insertLocalMinimaIntoAEL_0(r.v)}for(e=this.polyOuts_8be2vx$.iterator();e.hasNext();){var l=e.next();null==l.pts_8be2vx$||l.isOpen_8be2vx$||(l.isHole_8be2vx$^this.reverseSolution)===l.calcArea_8be2vx$()>0&&null!=(i=l.pts_8be2vx$)&&i.reversePolyPtLinks_8be2vx$()}for(this.joinCommonEdges_0(),n=this.polyOuts_8be2vx$.iterator();n.hasNext();){var u=n.next();null!=u.pts_8be2vx$&&(u.isOpen_8be2vx$?this.fixupOutPolyline_0(u):this.fixupOutPolygon_0(u))}return this.strictlySimple&&this.doSimplePolygons_0(),!0}finally{this.joins_0.clear(),this.ghostJoins_0.clear()}},kr.prototype.disposeAllPolyPts_0=function(){this.polyOuts_8be2vx$.clear()},kr.prototype.addJoin_0=function(t,e,i,n){var r=this.joins_0,o=new Bn(t,e,i,n);r.add_11rb$(o)},kr.prototype.addGhostJoin_0=function(t,e,i){var n=this.ghostJoins_0,r=new Bn(t,void 0,e,i);n.add_11rb$(r)},kr.prototype.insertLocalMinimaIntoAEL_0=function(t){for(var e,i={v:null};;){var n=this.popLocalMinima_kcn2v3$(t);if(i.v=n,null==n)break;var r=x(i.v).leftBound,o=x(i.v).rightBound,a={v:null};if(null==r?(this.insertEdgeIntoAEL_0(x(o),null),this.setWindingCount_0(o),this.isContributing_0(o)&&(a.v=this.addOutPt_0(o,o.botX_8be2vx$,o.botY_8be2vx$))):null==o?(this.insertEdgeIntoAEL_0(r,null),this.setWindingCount_0(r),this.isContributing_0(r)&&(a.v=this.addOutPt_0(r,r.botX_8be2vx$,r.botY_8be2vx$)),this.insertScanbeam_kcn2v3$(r.topY_8be2vx$)):(this.insertEdgeIntoAEL_0(r,null),this.insertEdgeIntoAEL_0(o,r),this.setWindingCount_0(r),o.windCnt_8be2vx$=r.windCnt_8be2vx$,o.windCnt2_8be2vx$=r.windCnt2_8be2vx$,this.isContributing_0(r)&&(a.v=this.addLocalMinPoly_0(r,o,r.botX_8be2vx$,r.botY_8be2vx$)),this.insertScanbeam_kcn2v3$(r.topY_8be2vx$)),null!=o&&(o.isHorizontal_8be2vx$?(null!=(e=o.nextInLML_8be2vx$)&&this.insertScanbeam_kcn2v3$(e.topY_8be2vx$),this.addEdgeToSEL_0(o)):this.insertScanbeam_kcn2v3$(o.topY_8be2vx$)),null!=r&&null!=o){var s,l=null!=a.v&&o.isHorizontal_8be2vx$;if(l&&(l=!this.ghostJoins_0.isEmpty()),l&&0!==o.windDelta_8be2vx$)for(s=this.ghostJoins_0.iterator();s.hasNext();){var u=s.next();this.horzSegmentsOverlap_0(x(u.outPt1).ptX_8be2vx$,u.offPtX,o.botX_8be2vx$,o.topX_8be2vx$)&&this.addJoin_0(u.outPt1,a.v,u.offPtX,u.offPtY)}var h=r.prevInAEL_8be2vx$;if(r.outIdx_8be2vx$>=0&&null!=h&&h.currX_8be2vx$===r.botX_8be2vx$&&h.outIdx_8be2vx$>=0&&Hn(h.currX_8be2vx$,h.currY_8be2vx$,h.topX_8be2vx$,h.topY_8be2vx$,r.currX_8be2vx$,r.currY_8be2vx$,r.topX_8be2vx$,r.topY_8be2vx$,this.useFullRange_8be2vx$)&&0!==r.windDelta_8be2vx$&&0!==h.windDelta_8be2vx$){var c=this.addOutPt_0(h,r.botX_8be2vx$,r.botY_8be2vx$);this.addJoin_0(a.v,c,r.topX_8be2vx$,r.topY_8be2vx$)}if(!d(r.nextInAEL_8be2vx$,o)){var v=x(o.prevInAEL_8be2vx$);if(o.outIdx_8be2vx$>=0&&v.outIdx_8be2vx$>=0&&Hn(v.currX_8be2vx$,v.currY_8be2vx$,v.topX_8be2vx$,v.topY_8be2vx$,o.currX_8be2vx$,o.currY_8be2vx$,o.topX_8be2vx$,o.topY_8be2vx$,this.useFullRange_8be2vx$)&&0!==o.windDelta_8be2vx$&&0!==v.windDelta_8be2vx$){var p=this.addOutPt_0(v,o.botX_8be2vx$,o.botY_8be2vx$);this.addJoin_0(a.v,p,o.topX_8be2vx$,o.topY_8be2vx$)}var f=r.nextInAEL_8be2vx$;if(null!=f)for(;!d(f,o);)this.intersectEdges_0(o,x(f),r.currX_8be2vx$,r.currY_8be2vx$),f=f.nextInAEL_8be2vx$}}}},kr.prototype.insertEdgeIntoAEL_0=function(t,e){var i,n,r,o=e,a=this.activeEdges_8be2vx$;if(null==a)t.prevInAEL_8be2vx$=null,t.nextInAEL_8be2vx$=null,this.activeEdges_8be2vx$=t;else if(null==o&&this.e2InsertsBeforeE1_0(a,t))t.prevInAEL_8be2vx$=null,t.nextInAEL_8be2vx$=a,a.prevInAEL_8be2vx$=t,this.activeEdges_8be2vx$=t;else{for(null==o&&(o=a);null!=(n=null!=(i=x(o).nextInAEL_8be2vx$)?!this.e2InsertsBeforeE1_0(i,t):null)&&n;)o=o.nextInAEL_8be2vx$;t.nextInAEL_8be2vx$=o.nextInAEL_8be2vx$,null!=(r=o.nextInAEL_8be2vx$)&&(r.prevInAEL_8be2vx$=t),t.prevInAEL_8be2vx$=o,o.nextInAEL_8be2vx$=t}},kr.prototype.e2InsertsBeforeE1_0=function(t,e){return e.currX_8be2vx$===t.currX_8be2vx$?e.topY_8be2vx$>t.topY_8be2vx$?e.topX_8be2vx$<Qn(t,e.topY_8be2vx$):t.topX_8be2vx$>Qn(e,t.topY_8be2vx$):e.currX_8be2vx$<t.currX_8be2vx$},kr.prototype.isEvenOddFillType_0=function(t){return d(t.polyTyp_8be2vx$,_n())?d(this.subjFillType_0,yn()):d(this.clipFillType_0,yn())},kr.prototype.isEvenOddAltFillType_0=function(t){return d(t.polyTyp_8be2vx$,_n())?d(this.clipFillType_0,yn()):d(this.subjFillType_0,yn())},kr.prototype.isContributing_0=function(t){var e,i,n,r;switch(d(t.polyTyp_8be2vx$,_n())?(n=x(this.subjFillType_0),r=x(this.clipFillType_0)):(n=x(this.clipFillType_0),r=x(this.subjFillType_0)),n.name){case"EvenOdd":if(0===t.windDelta_8be2vx$&&1!==t.windCnt_8be2vx$)return!1;break;case"NonZero":if(1!==K(t.windCnt_8be2vx$))return!1;break;case"Positive":if(1!==t.windCnt_8be2vx$)return!1;break;default:if(-1!==t.windCnt_8be2vx$)return!1}if(e=this.clipType_0,d(e,hn()))switch(r.name){case"EvenOdd":case"NonZero":i=0!==t.windCnt2_8be2vx$;break;case"Positive":i=t.windCnt2_8be2vx$>0;break;default:i=t.windCnt2_8be2vx$<0}else if(d(e,cn()))switch(r.name){case"EvenOdd":case"NonZero":i=0===t.windCnt2_8be2vx$;break;case"Positive":i=t.windCnt2_8be2vx$<=0;break;default:i=t.windCnt2_8be2vx$>=0}else if(d(e,vn()))if(d(t.polyTyp_8be2vx$,_n()))switch(r.name){case"EvenOdd":case"NonZero":i=0===t.windCnt2_8be2vx$;break;case"Positive":i=t.windCnt2_8be2vx$<=0;break;default:i=t.windCnt2_8be2vx$>=0}else switch(r.name){case"EvenOdd":case"NonZero":i=0!==t.windCnt2_8be2vx$;break;case"Positive":i=t.windCnt2_8be2vx$>0;break;default:i=t.windCnt2_8be2vx$<0}else if(d(e,pn()))if(0===t.windDelta_8be2vx$)switch(r.name){case"EvenOdd":case"NonZero":i=0===t.windCnt2_8be2vx$;break;case"Positive":i=t.windCnt2_8be2vx$<=0;break;default:i=t.windCnt2_8be2vx$>=0}else i=!0;else i=!0;return i},kr.prototype.setWindingCount_0=function(t){for(var e,i,n,r=t.prevInAEL_8be2vx$;null!=r&&(!d(r.polyTyp_8be2vx$,t.polyTyp_8be2vx$)||0===r.windDelta_8be2vx$);)r=r.prevInAEL_8be2vx$;if(null==r){var o=d(t.polyTyp_8be2vx$,_n())?this.subjFillType_0:this.clipFillType_0;t.windCnt_8be2vx$=0===t.windDelta_8be2vx$?d(o,En())?-1:1:t.windDelta_8be2vx$,t.windCnt2_8be2vx$=0,n=this.activeEdges_8be2vx$}else if(0!==t.windDelta_8be2vx$||d(this.clipType_0,cn()))if(this.isEvenOddFillType_0(t)){if(0===t.windDelta_8be2vx$){for(var a=!0,s=r.prevInAEL_8be2vx$;null!=s;)d(s.polyTyp_8be2vx$,r.polyTyp_8be2vx$)&&0!==s.windDelta_8be2vx$&&(a=!a),s=s.prevInAEL_8be2vx$;e=a?0:1}else e=t.windDelta_8be2vx$;t.windCnt_8be2vx$=e,t.windCnt2_8be2vx$=r.windCnt2_8be2vx$,n=r.nextInAEL_8be2vx$}else i=Kotlin.imul(r.windCnt_8be2vx$,r.windDelta_8be2vx$)<0?K(r.windCnt_8be2vx$)>1?Kotlin.imul(r.windDelta_8be2vx$,t.windDelta_8be2vx$)<0?r.windCnt_8be2vx$:r.windCnt_8be2vx$+t.windDelta_8be2vx$|0:0===t.windDelta_8be2vx$?1:t.windDelta_8be2vx$:0===t.windDelta_8be2vx$?r.windCnt_8be2vx$<0?r.windCnt_8be2vx$-1|0:r.windCnt_8be2vx$+1|0:Kotlin.imul(r.windDelta_8be2vx$,t.windDelta_8be2vx$)<0?r.windCnt_8be2vx$:r.windCnt_8be2vx$+t.windDelta_8be2vx$|0,t.windCnt_8be2vx$=i,t.windCnt2_8be2vx$=r.windCnt2_8be2vx$,n=r.nextInAEL_8be2vx$;else t.windCnt_8be2vx$=1,t.windCnt2_8be2vx$=r.windCnt2_8be2vx$,n=r.nextInAEL_8be2vx$;if(r=n,this.isEvenOddAltFillType_0(t))for(;!d(r,t);)0!==x(r).windDelta_8be2vx$&&(t.windCnt2_8be2vx$=0===t.windCnt2_8be2vx$?1:0),r=r.nextInAEL_8be2vx$;else for(;!d(r,t);)t.windCnt2_8be2vx$=t.windCnt2_8be2vx$+x(r).windDelta_8be2vx$|0,r=r.nextInAEL_8be2vx$},kr.prototype.addEdgeToSEL_0=function(t){var e=this.sortedEdges_0;null==e?(t.prevInSEL_8be2vx$=null,t.nextInSEL_8be2vx$=null):(t.nextInSEL_8be2vx$=e,t.prevInSEL_8be2vx$=null,e.prevInSEL_8be2vx$=t),this.sortedEdges_0=t},kr.prototype.popEdgeFromSEL_8be2vx$=function(){var t,e=this.sortedEdges_0;if(null==e)return null;var i=e;return this.sortedEdges_0=e.nextInSEL_8be2vx$,null!=(t=this.sortedEdges_0)&&(t.prevInSEL_8be2vx$=null),i.nextInSEL_8be2vx$=null,i.prevInSEL_8be2vx$=null,e},kr.prototype.copyAELToSEL_0=function(){var t=this.activeEdges_8be2vx$;for(this.sortedEdges_0=t;null!=t;)t.prevInSEL_8be2vx$=t.prevInAEL_8be2vx$,t.nextInSEL_8be2vx$=t.nextInAEL_8be2vx$,t=t.nextInAEL_8be2vx$},kr.prototype.swapPositionsInSEL_0=function(t,e){var i,n,r,o;if(!(null==t.nextInSEL_8be2vx$&&null==t.prevInSEL_8be2vx$||null==e.nextInSEL_8be2vx$&&null==e.prevInSEL_8be2vx$)){if(d(t.nextInSEL_8be2vx$,e)){var a=e.nextInSEL_8be2vx$;null!=a&&(a.prevInSEL_8be2vx$=t);var s=t.prevInSEL_8be2vx$;null!=s&&(s.nextInSEL_8be2vx$=e),e.prevInSEL_8be2vx$=s,e.nextInSEL_8be2vx$=t,t.prevInSEL_8be2vx$=e,t.nextInSEL_8be2vx$=a}else if(d(e.nextInSEL_8be2vx$,t)){var l=t.nextInSEL_8be2vx$;null!=l&&(l.prevInSEL_8be2vx$=e);var u=e.prevInSEL_8be2vx$;null!=u&&(u.nextInSEL_8be2vx$=t),t.prevInSEL_8be2vx$=u,t.nextInSEL_8be2vx$=e,e.prevInSEL_8be2vx$=t,e.nextInSEL_8be2vx$=l}else{var h=t.nextInSEL_8be2vx$,c=t.prevInSEL_8be2vx$;t.nextInSEL_8be2vx$=e.nextInSEL_8be2vx$,null!=(i=t.nextInSEL_8be2vx$)&&(i.prevInSEL_8be2vx$=t),t.prevInSEL_8be2vx$=e.prevInSEL_8be2vx$,null!=(n=t.prevInSEL_8be2vx$)&&(n.nextInSEL_8be2vx$=t),e.nextInSEL_8be2vx$=h,null!=(r=e.nextInSEL_8be2vx$)&&(r.prevInSEL_8be2vx$=e),e.prevInSEL_8be2vx$=c,null!=(o=e.prevInSEL_8be2vx$)&&(o.nextInSEL_8be2vx$=e)}null==t.prevInSEL_8be2vx$?this.sortedEdges_0=t:null==e.prevInSEL_8be2vx$&&(this.sortedEdges_0=e)}},kr.prototype.addLocalMaxPoly_0=function(t,e,i,n){this.addOutPt_0(t,i,n),0===e.windDelta_8be2vx$&&this.addOutPt_0(e,i,n),t.outIdx_8be2vx$===e.outIdx_8be2vx$?(t.outIdx_8be2vx$=-1,e.outIdx_8be2vx$=-1):t.outIdx_8be2vx$<e.outIdx_8be2vx$?this.appendPolygon_0(t,e):this.appendPolygon_0(e,t)},kr.prototype.addLocalMinPoly_0=function(t,e,i,n){var r,o,a;if(e.isHorizontal_8be2vx$||t.dx_8be2vx$>e.dx_8be2vx$?(r=this.addOutPt_0(t,i,n),e.outIdx_8be2vx$=t.outIdx_8be2vx$,t.side_8be2vx$=Vi(),e.side_8be2vx$=Zi(),a=d((o=t).prevInAEL_8be2vx$,e)?e.prevInAEL_8be2vx$:o.prevInAEL_8be2vx$):(r=this.addOutPt_0(e,i,n),t.outIdx_8be2vx$=e.outIdx_8be2vx$,t.side_8be2vx$=Zi(),e.side_8be2vx$=Vi(),a=d((o=e).prevInAEL_8be2vx$,t)?t.prevInAEL_8be2vx$:o.prevInAEL_8be2vx$),null!=a&&a.outIdx_8be2vx$>=0&&a.topY_8be2vx$<n&&o.topY_8be2vx$<n){var s=Qn(a,n),l=Qn(o,n);if(s===l&&0!==o.windDelta_8be2vx$&&0!==a.windDelta_8be2vx$&&Hn(s,n,a.topX_8be2vx$,a.topY_8be2vx$,l,n,o.topX_8be2vx$,o.topY_8be2vx$,this.useFullRange_8be2vx$)){var u=this.addOutPt_0(a,i,n);this.addJoin_0(r,u,o.topX_8be2vx$,o.topY_8be2vx$)}}return r},kr.prototype.addOutPt_0=function(t,e,i){if(t.outIdx_8be2vx$<0){var n=this.createOutRec_8be2vx$();n.isOpen_8be2vx$=0===t.windDelta_8be2vx$;var r=new Sr(n.idx_8be2vx$,e,i);r.next_8be2vx$=r,r.prev_8be2vx$=r;var o=r;return n.pts_8be2vx$=o,n.isOpen_8be2vx$||this.setHoleState_0(t,n),t.outIdx_8be2vx$=n.idx_8be2vx$,o}var a=this.polyOuts_8be2vx$.get_za3lpa$(t.outIdx_8be2vx$),s=x(a.pts_8be2vx$),l=d(t.side_8be2vx$,Vi());if(l&&e===s.ptX_8be2vx$&&i===s.ptY_8be2vx$)return s;if(!l&&e===s.prev_8be2vx$.ptX_8be2vx$&&i===s.prev_8be2vx$.ptY_8be2vx$)return s.prev_8be2vx$;var u=new Sr(a.idx_8be2vx$,e,i);return u.next_8be2vx$=s,u.prev_8be2vx$=s.prev_8be2vx$,u.prev_8be2vx$.next_8be2vx$=u,s.prev_8be2vx$=u,l&&(a.pts_8be2vx$=u),u},kr.prototype.getLastOutPt_0=function(t){return d(t.side_8be2vx$,Vi())?x(this.polyOuts_8be2vx$.get_za3lpa$(t.outIdx_8be2vx$).pts_8be2vx$):x(this.polyOuts_8be2vx$.get_za3lpa$(t.outIdx_8be2vx$).pts_8be2vx$).prev_8be2vx$},kr.prototype.horzSegmentsOverlap_0=function(t,e,i,n){var r=t,o=e,a=i,s=n;if(r>o){var l=r;r=o,o=l}if(a>s){var u=a;a=s,s=u}return r<s&&a<o},kr.prototype.setHoleState_0=function(t,e){for(var i=t.prevInAEL_8be2vx$,n=null;null!=i;)i.outIdx_8be2vx$>=0&&0!==i.windDelta_8be2vx$&&(null==n?n=i:n.outIdx_8be2vx$===i.outIdx_8be2vx$&&(n=null)),i=i.prevInAEL_8be2vx$;if(null==n)e.firstLeft_8be2vx$=null,e.isHole_8be2vx$=!1;else{var r=this.polyOuts_8be2vx$.get_za3lpa$(n.outIdx_8be2vx$);e.firstLeft_8be2vx$=r,e.isHole_8be2vx$=!r.isHole_8be2vx$}},kr.prototype.firstIsBottomPt_0=function(t,e){for(var i=t.prev_8be2vx$;i.ptX_8be2vx$===t.ptX_8be2vx$&&i.ptY_8be2vx$===t.ptY_8be2vx$&&!d(i,t);)i=i.prev_8be2vx$;var n=Vn(t.ptX_8be2vx$,t.ptY_8be2vx$,i.ptX_8be2vx$,i.ptY_8be2vx$),r=bt.abs(n);for(i=t.next_8be2vx$;i.ptX_8be2vx$===t.ptX_8be2vx$&&i.ptY_8be2vx$===t.ptY_8be2vx$&&!d(i,t);)i=i.next_8be2vx$;var o=Vn(t.ptX_8be2vx$,t.ptY_8be2vx$,i.ptX_8be2vx$,i.ptY_8be2vx$),a=bt.abs(o);for(i=e.prev_8be2vx$;i.ptX_8be2vx$===e.ptX_8be2vx$&&i.ptY_8be2vx$===e.ptY_8be2vx$&&!d(i,e);)i=i.prev_8be2vx$;var s=Vn(e.ptX_8be2vx$,e.ptY_8be2vx$,i.ptX_8be2vx$,i.ptY_8be2vx$),l=bt.abs(s);for(i=e.next_8be2vx$;i.ptX_8be2vx$===e.ptX_8be2vx$&&i.ptY_8be2vx$===e.ptY_8be2vx$&&!d(i,e);)i=i.next_8be2vx$;var u=Vn(e.ptX_8be2vx$,e.ptY_8be2vx$,i.ptX_8be2vx$,i.ptY_8be2vx$),h=bt.abs(u),c=bt.max(r,a)===bt.max(l,h);return c&&(c=bt.min(r,a)===bt.min(l,h)),c?t.calcArea_8be2vx$()>0:r>=l&&r>=h||a>=l&&a>=h},kr.prototype.getBottomPt_0=function(t){for(var e=t,i=null,n=e.next_8be2vx$;!d(n,e);)n.ptY_8be2vx$>e.ptY_8be2vx$?(e=n,i=null):n.ptY_8be2vx$===e.ptY_8be2vx$&&n.ptX_8be2vx$<=e.ptX_8be2vx$&&(n.ptX_8be2vx$<e.ptX_8be2vx$?(i=null,e=n):d(n.next_8be2vx$,e)||d(n.prev_8be2vx$,e)||(i=n)),n=n.next_8be2vx$;if(null!=i)for(;!d(x(i),n);)for(this.firstIsBottomPt_0(n,i)||(e=i),i=i.next_8be2vx$;x(i).ptX_8be2vx$!==e.ptX_8be2vx$&&i.ptY_8be2vx$!==e.ptY_8be2vx$;)i=i.next_8be2vx$;return e},kr.prototype.getLowermostRec_0=function(t,e){null==t.bottomPt_8be2vx$&&(t.bottomPt_8be2vx$=this.getBottomPt_0(x(t.pts_8be2vx$))),null==e.bottomPt_8be2vx$&&(e.bottomPt_8be2vx$=this.getBottomPt_0(x(e.pts_8be2vx$)));var i=x(t.bottomPt_8be2vx$),n=x(e.bottomPt_8be2vx$);return i.ptY_8be2vx$>n.ptY_8be2vx$?t:i.ptY_8be2vx$<n.ptY_8be2vx$?e:i.ptX_8be2vx$<n.ptX_8be2vx$?t:i.ptX_8be2vx$>n.ptX_8be2vx$?e:d(i.next_8be2vx$,i)?e:d(n.next_8be2vx$,n)?t:this.firstIsBottomPt_0(i,n)?t:e},kr.prototype.getOutRec_0=function(t){for(var e=this.polyOuts_8be2vx$.get_za3lpa$(t);!d(e,this.polyOuts_8be2vx$.get_za3lpa$(e.idx_8be2vx$));)e=this.polyOuts_8be2vx$.get_za3lpa$(e.idx_8be2vx$);return e},kr.prototype.appendPolygon_0=function(t,e){var i,n=this.polyOuts_8be2vx$.get_za3lpa$(t.outIdx_8be2vx$),r=this.polyOuts_8be2vx$.get_za3lpa$(e.outIdx_8be2vx$);i=n.isRightOf_xn8tnc$(r)?r:r.isRightOf_xn8tnc$(n)?n:this.getLowermostRec_0(n,r);var o=x(n.pts_8be2vx$),a=o.prev_8be2vx$,s=x(r.pts_8be2vx$),l=s.prev_8be2vx$;if(d(t.side_8be2vx$,Vi())?d(e.side_8be2vx$,Vi())?(s.reversePolyPtLinks_8be2vx$(),s.next_8be2vx$=o,o.prev_8be2vx$=s,a.next_8be2vx$=l,l.prev_8be2vx$=a,n.pts_8be2vx$=l):(l.next_8be2vx$=o,o.prev_8be2vx$=l,s.prev_8be2vx$=a,a.next_8be2vx$=s,n.pts_8be2vx$=s):d(e.side_8be2vx$,Zi())?(s.reversePolyPtLinks_8be2vx$(),a.next_8be2vx$=l,l.prev_8be2vx$=a,s.next_8be2vx$=o,o.prev_8be2vx$=s):(a.next_8be2vx$=s,s.prev_8be2vx$=a,o.prev_8be2vx$=l,l.next_8be2vx$=o),n.bottomPt_8be2vx$=null,d(i,r)){var u=r.firstLeft_8be2vx$;d(u,n)||(n.firstLeft_8be2vx$=u),n.isHole_8be2vx$=r.isHole_8be2vx$}r.pts_8be2vx$=null,r.bottomPt_8be2vx$=null,r.firstLeft_8be2vx$=n;var h=t.outIdx_8be2vx$,c=e.outIdx_8be2vx$;t.outIdx_8be2vx$=-1,e.outIdx_8be2vx$=-1;for(var v=this.activeEdges_8be2vx$;null!=v;){if(v.outIdx_8be2vx$===c){v.outIdx_8be2vx$=h,v.side_8be2vx$=t.side_8be2vx$;break}v=v.nextInAEL_8be2vx$}r.idx_8be2vx$=n.idx_8be2vx$},kr.prototype.intersectEdges_0=function(t,e,i,n){var r,o,a,s,l,u=t.outIdx_8be2vx$>=0,h=e.outIdx_8be2vx$>=0;if(!pi||0!==t.windDelta_8be2vx$&&0!==e.windDelta_8be2vx$){if(d(t.polyTyp_8be2vx$,e.polyTyp_8be2vx$))if(this.isEvenOddFillType_0(t)){var c=t.windCnt_8be2vx$;t.windCnt_8be2vx$=e.windCnt_8be2vx$,e.windCnt_8be2vx$=c}else 0==(t.windCnt_8be2vx$+e.windDelta_8be2vx$|0)?t.windCnt_8be2vx$=0|-t.windCnt_8be2vx$:t.windCnt_8be2vx$=t.windCnt_8be2vx$+e.windDelta_8be2vx$|0,0==(e.windCnt_8be2vx$-t.windDelta_8be2vx$|0)?e.windCnt_8be2vx$=0|-e.windCnt_8be2vx$:e.windCnt_8be2vx$=e.windCnt_8be2vx$-t.windDelta_8be2vx$|0;else this.isEvenOddFillType_0(e)?t.windCnt2_8be2vx$=0===t.windCnt2_8be2vx$?1:0:t.windCnt2_8be2vx$=t.windCnt2_8be2vx$+e.windDelta_8be2vx$|0,this.isEvenOddFillType_0(t)?e.windCnt2_8be2vx$=0===e.windCnt2_8be2vx$?1:0:e.windCnt2_8be2vx$=e.windCnt2_8be2vx$-t.windDelta_8be2vx$|0;var v,p,f,_;d(t.polyTyp_8be2vx$,_n())?(v=this.subjFillType_0,f=this.clipFillType_0):(v=this.clipFillType_0,f=this.subjFillType_0),d(e.polyTyp_8be2vx$,_n())?(p=this.subjFillType_0,_=this.clipFillType_0):(p=this.clipFillType_0,_=this.subjFillType_0);var x=d(r=v,mn())?t.windCnt_8be2vx$:d(r,En())?0|-t.windCnt_8be2vx$:K(t.windCnt_8be2vx$),b=d(o=p,mn())?e.windCnt_8be2vx$:d(o,En())?0|-e.windCnt_8be2vx$:K(e.windCnt_8be2vx$);if(u&&h)0!==x&&1!==x||0!==b&&1!==b||!d(t.polyTyp_8be2vx$,e.polyTyp_8be2vx$)&&!d(this.clipType_0,pn())?this.addLocalMaxPoly_0(t,e,i,n):(this.addOutPt_0(t,i,n),this.addOutPt_0(e,i,n),Zn(t,e),Jn(t,e));else if(u)0!==b&&1!==b||(this.addOutPt_0(t,i,n),Zn(t,e),Jn(t,e));else if(h)0!==x&&1!==x||(this.addOutPt_0(e,i,n),Zn(t,e),Jn(t,e));else if(!(0!==x&&1!==x||0!==b&&1!==b)){var $=d(a=f,mn())?t.windCnt2_8be2vx$:d(a,En())?0|-t.windCnt2_8be2vx$:K(t.windCnt2_8be2vx$),y=d(s=_,mn())?e.windCnt2_8be2vx$:d(s,En())?0|-e.windCnt2_8be2vx$:K(e.windCnt2_8be2vx$);d(t.polyTyp_8be2vx$,e.polyTyp_8be2vx$)?1===x&&1===b?(l=this.clipType_0,d(l,hn())?$>0&&y>0&&this.addLocalMinPoly_0(t,e,i,n):d(l,cn())?$<=0&&y<=0&&this.addLocalMinPoly_0(t,e,i,n):d(l,vn())?(d(t.polyTyp_8be2vx$,xn())&&$>0&&y>0||d(t.polyTyp_8be2vx$,_n())&&$<=0&&y<=0)&&this.addLocalMinPoly_0(t,e,i,n):d(l,pn())&&this.addLocalMinPoly_0(t,e,i,n)):Zn(t,e):this.addLocalMinPoly_0(t,e,i,n)}}else{if(0===t.windDelta_8be2vx$&&0===e.windDelta_8be2vx$)return;d(t.polyTyp_8be2vx$,e.polyTyp_8be2vx$)&&t.windDelta_8be2vx$!==e.windDelta_8be2vx$&&d(this.clipType_0,cn())?0===t.windDelta_8be2vx$?h&&(this.addOutPt_0(t,i,n),u&&(t.outIdx_8be2vx$=-1)):u&&(this.addOutPt_0(e,i,n),h&&(e.outIdx_8be2vx$=-1)):d(t.polyTyp_8be2vx$,e.polyTyp_8be2vx$)||(0!==t.windDelta_8be2vx$||1!==K(e.windCnt_8be2vx$)||d(this.clipType_0,cn())&&0!==e.windCnt2_8be2vx$?0!==e.windDelta_8be2vx$||1!==K(t.windCnt_8be2vx$)||d(this.clipType_0,cn())&&0!==t.windCnt2_8be2vx$||(this.addOutPt_0(e,i,n),h&&(e.outIdx_8be2vx$=-1)):(this.addOutPt_0(t,i,n),u&&(t.outIdx_8be2vx$=-1)))}},kr.prototype.deleteFromSEL_0=function(t){var e=t.prevInSEL_8be2vx$,i=t.nextInSEL_8be2vx$;(null!=e||null!=i||d(t,this.sortedEdges_0))&&(null!=e?e.nextInSEL_8be2vx$=i:this.sortedEdges_0=i,null!=i&&(i.prevInSEL_8be2vx$=e),t.nextInSEL_8be2vx$=null,t.prevInSEL_8be2vx$=null)},kr.prototype.processHorizontals_0=function(){for(var t,e={v:null};;){var i;if(null!=(t=this.popEdgeFromSEL_8be2vx$())?(e.v=t,i=c):i=null,null==i)break;this.processHorizontal_0(x(e.v))}},kr.prototype.getHorzDirection_3fg5wb$=function(t){return t.botX_8be2vx$<t.topX_8be2vx$?new Xn(t.botX_8be2vx$,t.topX_8be2vx$,en()):new Xn(t.topX_8be2vx$,t.botX_8be2vx$,tn())},kr.prototype.processHorizontal_0=function(t){var e,i,n,r,o,a,s,l,u={v:t},h={v:null},c={v:0},v={v:0},p=0===u.v.windDelta_8be2vx$,f=this.getHorzDirection_3fg5wb$(u.v);h.v=f.direction,c.v=f.left,v.v=f.right;for(var _=u.v,b=null;null!=(i=null!=(e=_.nextInLML_8be2vx$)?e.isHorizontal_8be2vx$:null)&&i;)_=x(_.nextInLML_8be2vx$);null==_.nextInLML_8be2vx$&&(b=this.getMaximaPair_3fg5wb$(_));var $=this.maxima_0;if(null!=$)if(d(h.v,en())){for(;null!=$&&$.x<=u.v.botX_8be2vx$;)$=$.next;null!=$&&$.x>=_.topX_8be2vx$&&($=null)}else{for(;null!=(r=null!=(n=x($).next)?n.x<u.v.botX_8be2vx$:null)&&r;)$=$.next;$.x<=_.topX_8be2vx$&&($=null)}for(var y=null;;){for(var g=d(u.v,_),m={v:this.getNextInAEL_0(u.v,x(h.v))};null!=m.v;){if(null!=$)if(d(h.v,en()))for(;null!=$&&$.x<m.v.currX_8be2vx$;)u.v.outIdx_8be2vx$>=0&&!p&&this.addOutPt_0(u.v,$.x,u.v.botY_8be2vx$),$=$.next;else for(;null!=$&&$.x>m.v.currX_8be2vx$;)u.v.outIdx_8be2vx$>=0&&!p&&this.addOutPt_0(u.v,$.x,u.v.botY_8be2vx$),$=$.prev;if(d(h.v,en())&&m.v.currX_8be2vx$>v.v||d(h.v,tn())&&m.v.currX_8be2vx$<c.v)break;var E=m.v.currX_8be2vx$===u.v.topX_8be2vx$;if(E&&(E=null!=(a=null!=(o=u.v.nextInLML_8be2vx$)?x(m.v).dx_8be2vx$<o.dx_8be2vx$:null)&&a),E)break;if(u.v.outIdx_8be2vx$>=0&&!p){y=this.addOutPt_0(u.v,m.v.currX_8be2vx$,m.v.currY_8be2vx$);for(var P=this.sortedEdges_0;null!=P;){if(P.outIdx_8be2vx$>=0&&this.horzSegmentsOverlap_0(u.v.botX_8be2vx$,u.v.topX_8be2vx$,P.botX_8be2vx$,P.topX_8be2vx$)){var w=this.getLastOutPt_0(P);this.addJoin_0(w,y,P.topX_8be2vx$,P.topY_8be2vx$)}P=P.nextInSEL_8be2vx$}this.addGhostJoin_0(y,u.v.botX_8be2vx$,u.v.botY_8be2vx$)}if(d(m.v,b)&&g)return u.v.outIdx_8be2vx$>=0&&this.addLocalMaxPoly_0(u.v,b,u.v.topX_8be2vx$,u.v.topY_8be2vx$),this.deleteFromAEL_3fg5wb$(u.v),void this.deleteFromAEL_3fg5wb$(b);d(h.v,en())?this.intersectEdges_0(u.v,m.v,m.v.currX_8be2vx$,u.v.currY_8be2vx$):this.intersectEdges_0(m.v,u.v,m.v.currX_8be2vx$,u.v.currY_8be2vx$);var I=this.getNextInAEL_0(m.v,x(h.v));this.swapPositionsInAEL_mmqypl$(u.v,m.v),m.v=I}if(null==(l=null!=(s=u.v.nextInLML_8be2vx$)?s.isHorizontal_8be2vx$:null)||!l)break;u.v=this.updateEdgeIntoAEL_3fg5wb$(u.v),u.v.outIdx_8be2vx$>=0&&this.addOutPt_0(u.v,u.v.botX_8be2vx$,u.v.botY_8be2vx$);var S=this.getHorzDirection_3fg5wb$(u.v);h.v=S.direction,c.v=S.left,v.v=S.right}if(u.v.outIdx_8be2vx$>=0&&null==y){y=this.getLastOutPt_0(u.v);for(var A=this.sortedEdges_0;null!=A;){if(A.outIdx_8be2vx$>=0&&this.horzSegmentsOverlap_0(u.v.botX_8be2vx$,u.v.topX_8be2vx$,A.botX_8be2vx$,A.topX_8be2vx$)){var k=this.getLastOutPt_0(A);this.addJoin_0(k,y,A.topX_8be2vx$,A.topY_8be2vx$)}A=A.nextInSEL_8be2vx$}this.addGhostJoin_0(y,u.v.topX_8be2vx$,u.v.topY_8be2vx$)}if(null!=u.v.nextInLML_8be2vx$)if(u.v.outIdx_8be2vx$>=0){if(y=this.addOutPt_0(u.v,u.v.topX_8be2vx$,u.v.topY_8be2vx$),u.v=this.updateEdgeIntoAEL_3fg5wb$(u.v),0===u.v.windDelta_8be2vx$)return;var T=u.v.prevInAEL_8be2vx$,C=u.v.nextInAEL_8be2vx$;if(null!=T&&T.currX_8be2vx$===u.v.botX_8be2vx$&&T.currY_8be2vx$===u.v.botY_8be2vx$&&0!==T.windDelta_8be2vx$&&T.outIdx_8be2vx$>=0&&T.currY_8be2vx$>T.topY_8be2vx$&&Kn(u.v,T,this.useFullRange_8be2vx$)){var L=this.addOutPt_0(T,u.v.botX_8be2vx$,u.v.botY_8be2vx$);this.addJoin_0(y,L,u.v.topX_8be2vx$,u.v.topY_8be2vx$)}else if(null!=C&&C.currX_8be2vx$===u.v.botX_8be2vx$&&C.currY_8be2vx$===u.v.botY_8be2vx$&&0!==C.windDelta_8be2vx$&&C.outIdx_8be2vx$>=0&&C.currY_8be2vx$>C.topY_8be2vx$&&Kn(u.v,C,this.useFullRange_8be2vx$)){var O=this.addOutPt_0(C,u.v.botX_8be2vx$,u.v.botY_8be2vx$);this.addJoin_0(y,O,u.v.topX_8be2vx$,u.v.topY_8be2vx$)}}else u.v=this.updateEdgeIntoAEL_3fg5wb$(u.v);else u.v.outIdx_8be2vx$>=0&&this.addOutPt_0(u.v,u.v.topX_8be2vx$,u.v.topY_8be2vx$),this.deleteFromAEL_3fg5wb$(u.v)},kr.prototype.getNextInAEL_0=function(t,e){return e===en()?t.nextInAEL_8be2vx$:t.prevInAEL_8be2vx$},kr.prototype.isMinima_0=function(t){return null!=t&&!d(t.prev_8be2vx$.nextInLML_8be2vx$,t)&&!d(t.next_8be2vx$.nextInLML_8be2vx$,t)},kr.prototype.isMaxima_0=function(t,e){return null!=t&&t.topY_8be2vx$===e&&null==t.nextInLML_8be2vx$},kr.prototype.isIntermediate_0=function(t,e){return t.topY_8be2vx$===e&&null!=t.nextInLML_8be2vx$},kr.prototype.getMaximaPair_3fg5wb$=function(t){return t.next_8be2vx$.topX_8be2vx$===t.topX_8be2vx$&&t.next_8be2vx$.topY_8be2vx$===t.topY_8be2vx$&&null==t.next_8be2vx$.nextInLML_8be2vx$?t.next_8be2vx$:t.prev_8be2vx$.topX_8be2vx$===t.topX_8be2vx$&&t.prev_8be2vx$.topY_8be2vx$===t.topY_8be2vx$&&null==t.prev_8be2vx$.nextInLML_8be2vx$?t.prev_8be2vx$:null},kr.prototype.getMaximaPairEx_3fg5wb$=function(t){var e=this.getMaximaPair_3fg5wb$(t);return null==e||-2===e.outIdx_8be2vx$||d(e.nextInAEL_8be2vx$,e.prevInAEL_8be2vx$)&&!e.isHorizontal_8be2vx$?null:e},kr.prototype.processIntersections_0=function(t){if(null==this.activeEdges_8be2vx$)return!0;try{if(this.buildIntersectList_0(t),this.intersectList_0.isEmpty())return!0;if(1!==this.intersectList_0.size&&!this.fixupIntersectionOrder_0())return!1;this.processIntersectList_0()}catch(t){throw Kotlin.isType(t,tt)?(this.sortedEdges_0=null,this.intersectList_0.clear(),new Gr("ProcessIntersections error")):t}return this.sortedEdges_0=null,!0},kr.prototype.buildIntersectList_0=function(t){if(null!=this.activeEdges_8be2vx$){var e={v:this.activeEdges_8be2vx$};for(this.sortedEdges_0=e.v;null!=e.v;){var i=e.v;i.prevInSEL_8be2vx$=i.prevInAEL_8be2vx$,i.nextInSEL_8be2vx$=i.nextInAEL_8be2vx$,i.currX_8be2vx$=Qn(x(e.v),t),e.v=e.v.nextInAEL_8be2vx$}for(var n=!0;n&&null!=this.activeEdges_8be2vx$;){for(n=!1,e.v=this.activeEdges_8be2vx$;null!=x(e.v).nextInSEL_8be2vx$;){var r=x(e.v.nextInSEL_8be2vx$);if(e.v.currX_8be2vx$>r.currX_8be2vx$){var o=this.intersectPoint_0(e.v,r),a=o.component1(),s=o.component2();s<t&&(a=Qn(e.v,t),s=t);var l=new gr(e.v,r,a,s);this.intersectList_0.add_11rb$(l),this.swapPositionsInSEL_0(e.v,r),n=!0}else e.v=r}var u=e.v.prevInSEL_8be2vx$;if(null==u)break;u.nextInSEL_8be2vx$=null}this.sortedEdges_0=null}},kr.prototype.fixupIntersectionOrder_0=function(){et(this.intersectList_0,this.intersectNodeComparator_8be2vx$),this.copyAELToSEL_0();for(var t=this.intersectList_0.size,e=0;e<t;e++){if(!mr(this.intersectList_0.get_za3lpa$(e))){for(var i=e+1|0;i<t&&!mr(this.intersectList_0.get_za3lpa$(i));)i=i+1|0;if(i===t)return!1;var n=this.intersectList_0.get_za3lpa$(e);this.intersectList_0.set_wxm5ur$(e,this.intersectList_0.get_za3lpa$(i)),this.intersectList_0.set_wxm5ur$(i,n)}this.swapPositionsInSEL_0(this.intersectList_0.get_za3lpa$(e).edge1_8be2vx$,this.intersectList_0.get_za3lpa$(e).edge2_8be2vx$)}return!0},kr.prototype.processIntersectList_0=function(){var t;for(t=this.intersectList_0.iterator();t.hasNext();){var e=t.next();this.intersectEdges_0(e.edge1_8be2vx$,e.edge2_8be2vx$,e.ptX_8be2vx$,e.ptY_8be2vx$),this.swapPositionsInAEL_mmqypl$(e.edge1_8be2vx$,e.edge2_8be2vx$)}this.intersectList_0.clear()},kr.prototype.intersectPoint_0=function(t,e){var i,n,r,o,a=0,s=0;if(t.dx_8be2vx$===e.dx_8be2vx$)a=Qn(t,s=t.currY_8be2vx$);else{if(0===t.deltaX_8be2vx$)a=t.botX_8be2vx$,e.isHorizontal_8be2vx$?i=e.botY_8be2vx$:(o=e.botY_8be2vx$-e.botX_8be2vx$/e.dx_8be2vx$,i=Un(a/e.dx_8be2vx$+o)),s=i;else if(0===e.deltaX_8be2vx$)a=e.botX_8be2vx$,t.isHorizontal_8be2vx$?n=t.botY_8be2vx$:(r=t.botY_8be2vx$-t.botX_8be2vx$/t.dx_8be2vx$,n=Un(a/t.dx_8be2vx$+r)),s=n;else{r=t.botX_8be2vx$-t.botY_8be2vx$*t.dx_8be2vx$;var l=((o=e.botX_8be2vx$-e.botY_8be2vx$*e.dx_8be2vx$)-r)/(t.dx_8be2vx$-e.dx_8be2vx$);s=Un(l);var u=t.dx_8be2vx$,h=bt.abs(u),c=e.dx_8be2vx$;a=h<bt.abs(c)?Un(t.dx_8be2vx$*l+r):Un(e.dx_8be2vx$*l+o)}if(s<t.topY_8be2vx$||s<e.topY_8be2vx$){s=t.topY_8be2vx$>e.topY_8be2vx$?t.topY_8be2vx$:e.topY_8be2vx$;var v=t.dx_8be2vx$,p=bt.abs(v),f=e.dx_8be2vx$;a=p<bt.abs(f)?Qn(t,s):Qn(e,s)}if(s>t.currY_8be2vx$){s=t.currY_8be2vx$;var d=t.dx_8be2vx$,_=bt.abs(d),x=e.dx_8be2vx$;a=_>bt.abs(x)?Qn(e,s):Qn(t,s)}}return new M(a,s)},kr.prototype.processEdgesAtTopOfScanbeam_0=function(t){for(var e=this.activeEdges_8be2vx$;null!=e;){var i=this.isMaxima_0(e,t);if(i){var n=this.getMaximaPairEx_3fg5wb$(e);i=null==n||!n.isHorizontal_8be2vx$}if(i){this.strictlySimple&&this.insertMaxima_0(e.topX_8be2vx$);var r=e.prevInAEL_8be2vx$;this.doMaxima_0(e),e=null==r?this.activeEdges_8be2vx$:r.nextInAEL_8be2vx$}else{if(this.isIntermediate_0(e,t)&&x(e.nextInLML_8be2vx$).isHorizontal_8be2vx$?((e=this.updateEdgeIntoAEL_3fg5wb$(e)).outIdx_8be2vx$>=0&&this.addOutPt_0(e,e.botX_8be2vx$,e.botY_8be2vx$),this.addEdgeToSEL_0(e)):(e.currX_8be2vx$=Qn(e,t),e.currY_8be2vx$=t),this.strictlySimple){var o=e.prevInAEL_8be2vx$;if(e.outIdx_8be2vx$>=0&&0!==e.windDelta_8be2vx$&&null!=o&&o.outIdx_8be2vx$>=0&&o.currX_8be2vx$===e.currX_8be2vx$&&0!==o.windDelta_8be2vx$){var a=this.addOutPt_0(o,e.currX_8be2vx$,e.currY_8be2vx$),s=this.addOutPt_0(e,e.currX_8be2vx$,e.currY_8be2vx$);this.addJoin_0(a,s,e.currX_8be2vx$,e.currY_8be2vx$)}}e=e.nextInAEL_8be2vx$}}for(this.processHorizontals_0(),this.maxima_0=null,e=this.activeEdges_8be2vx$;null!=e;){if(this.isIntermediate_0(e,t)){var l=null;e.outIdx_8be2vx$>=0&&(l=this.addOutPt_0(e,e.topX_8be2vx$,e.topY_8be2vx$));var u=(e=this.updateEdgeIntoAEL_3fg5wb$(e)).prevInAEL_8be2vx$,h=e.nextInAEL_8be2vx$;if(null!=u&&u.currX_8be2vx$===e.botX_8be2vx$&&u.currY_8be2vx$===e.botY_8be2vx$&&null!=l&&u.outIdx_8be2vx$>=0&&u.currY_8be2vx$>u.topY_8be2vx$&&Hn(e.currX_8be2vx$,e.currY_8be2vx$,e.topX_8be2vx$,e.topY_8be2vx$,u.currX_8be2vx$,u.currY_8be2vx$,u.topX_8be2vx$,u.topY_8be2vx$,this.useFullRange_8be2vx$)&&0!==e.windDelta_8be2vx$&&0!==u.windDelta_8be2vx$){var c=this.addOutPt_0(u,e.botX_8be2vx$,e.botY_8be2vx$);this.addJoin_0(l,c,e.topX_8be2vx$,e.topY_8be2vx$)}else if(null!=h&&h.currX_8be2vx$===e.botX_8be2vx$&&h.currY_8be2vx$===e.botY_8be2vx$&&null!=l&&h.outIdx_8be2vx$>=0&&h.currY_8be2vx$>h.topY_8be2vx$&&Hn(e.currX_8be2vx$,e.currY_8be2vx$,e.topX_8be2vx$,e.topY_8be2vx$,h.currX_8be2vx$,h.currY_8be2vx$,h.topX_8be2vx$,h.topY_8be2vx$,this.useFullRange_8be2vx$)&&0!==e.windDelta_8be2vx$&&0!==h.windDelta_8be2vx$){var v=this.addOutPt_0(h,e.botX_8be2vx$,e.botY_8be2vx$);this.addJoin_0(l,v,e.topX_8be2vx$,e.topY_8be2vx$)}}e=e.nextInAEL_8be2vx$}},kr.prototype.doMaxima_0=function(t){var e=this.getMaximaPairEx_3fg5wb$(t);if(null==e)return t.outIdx_8be2vx$>=0&&this.addOutPt_0(t,t.topX_8be2vx$,t.topY_8be2vx$),void this.deleteFromAEL_3fg5wb$(t);for(var i=t.nextInAEL_8be2vx$;null!=i&&!d(i,e);)this.intersectEdges_0(t,i,t.topX_8be2vx$,t.topY_8be2vx$),this.swapPositionsInAEL_mmqypl$(t,i),i=t.nextInAEL_8be2vx$;if(-1===t.outIdx_8be2vx$&&-1===e.outIdx_8be2vx$)this.deleteFromAEL_3fg5wb$(t),this.deleteFromAEL_3fg5wb$(e);else if(t.outIdx_8be2vx$>=0&&e.outIdx_8be2vx$>=0)t.outIdx_8be2vx$>=0&&this.addLocalMaxPoly_0(t,e,t.topX_8be2vx$,t.topY_8be2vx$),this.deleteFromAEL_3fg5wb$(t),this.deleteFromAEL_3fg5wb$(e);else{if(!pi||0!==t.windDelta_8be2vx$)throw new Gr("DoMaxima error");t.outIdx_8be2vx$>=0&&(this.addOutPt_0(t,t.topX_8be2vx$,t.topY_8be2vx$),t.outIdx_8be2vx$=-1),this.deleteFromAEL_3fg5wb$(t),e.outIdx_8be2vx$>=0&&(this.addOutPt_0(e,t.topX_8be2vx$,t.topY_8be2vx$),e.outIdx_8be2vx$=-1),this.deleteFromAEL_3fg5wb$(e)}},kr.prototype.pointCount_0=function(t){if(null==t)return 0;var e=0,i=t;do{e=e+1|0,i=i.next_8be2vx$}while(!d(i,t));return e},kr.prototype.buildResult_0=function(t){var e,i,n,r;for(t.clear(),e=this.polyOuts_8be2vx$.iterator();e.hasNext();){if(null!=(n=null!=(i=e.next().pts_8be2vx$)?i.prev_8be2vx$:null)){var o=n,a=this.pointCount_0(o);if(!(a<2)){var s=sr(2*a|0);r=a-1|0;for(var l=0;l<=r;l++)s.add_11rb$(o.ptX_8be2vx$),s.add_11rb$(o.ptY_8be2vx$),o=o.prev_8be2vx$;t.add_11rb$(s)}}}},kr.prototype.buildResult2_0=function(t){var e,i,n,r,o;for(t.clear(),e=this.polyOuts_8be2vx$.iterator();e.hasNext();){var a=e.next(),s=this.pointCount_0(a.pts_8be2vx$);if(!(a.isOpen_8be2vx$&&s<2||!a.isOpen_8be2vx$&&s<3)){this.fixHoleLinkage_xn8tnc$(a);var l=new br(null,null);t.allPolys_8be2vx$.add_11rb$(l),a.polyNode_8be2vx$=l;for(var u=x(a.pts_8be2vx$).prev_8be2vx$,h=0;h<s;h++)l.contour.add_11rb$(u.ptX_8be2vx$),l.contour.add_11rb$(u.ptY_8be2vx$),u=u.prev_8be2vx$}}for(i=this.polyOuts_8be2vx$.iterator();i.hasNext();){var v=i.next();if(null!=(n=v.polyNode_8be2vx$)){var p=n;v.isOpen_8be2vx$?(p.isOpen=!0,t.addChild_n1bxgk$(p)):null!=(null!=(o=null!=(r=v.firstLeft_8be2vx$)?r.polyNode_8be2vx$:null)?(o.addChild_n1bxgk$(p),c):null)||t.addChild_n1bxgk$(p)}}},kr.prototype.fixupOutPolyline_0=function(t){for(var e=x(t.pts_8be2vx$),i=e.prev_8be2vx$;!d(e,i);)if((e=e.next_8be2vx$).ptX_8be2vx$===e.prev_8be2vx$.ptX_8be2vx$&&e.ptY_8be2vx$===e.prev_8be2vx$.ptY_8be2vx$){d(e,i)&&(i=e.prev_8be2vx$);var n=e.prev_8be2vx$;n.next_8be2vx$=e.next_8be2vx$,e.next_8be2vx$.prev_8be2vx$=n,e=n}d(e,e.prev_8be2vx$)&&(t.pts_8be2vx$=null)},kr.prototype.fixupOutPolygon_0=function(t){var e=null;t.bottomPt_8be2vx$=null;for(var i=x(t.pts_8be2vx$),n=this.preserveCollinear||this.strictlySimple;;){if(d(i.prev_8be2vx$,i)||d(i.prev_8be2vx$,i.next_8be2vx$))return void(t.pts_8be2vx$=null);if(i.ptX_8be2vx$===i.next_8be2vx$.ptX_8be2vx$&&i.ptY_8be2vx$===i.next_8be2vx$.ptY_8be2vx$||i.ptX_8be2vx$===i.prev_8be2vx$.ptX_8be2vx$&&i.ptY_8be2vx$===i.prev_8be2vx$.ptY_8be2vx$||qn(i.prev_8be2vx$.ptX_8be2vx$,i.prev_8be2vx$.ptY_8be2vx$,i.ptX_8be2vx$,i.ptY_8be2vx$,i.next_8be2vx$.ptX_8be2vx$,i.next_8be2vx$.ptY_8be2vx$,this.useFullRange_8be2vx$)&&(!n||!Wn(i.prev_8be2vx$.ptX_8be2vx$,i.prev_8be2vx$.ptY_8be2vx$,i.ptX_8be2vx$,i.ptY_8be2vx$,i.next_8be2vx$.ptX_8be2vx$,i.next_8be2vx$.ptY_8be2vx$)))e=null,i.prev_8be2vx$.next_8be2vx$=i.next_8be2vx$,i.next_8be2vx$.prev_8be2vx$=i.prev_8be2vx$,i=i.prev_8be2vx$;else{if(d(i,e))break;null==e&&(e=i),i=i.next_8be2vx$}}t.pts_8be2vx$=i},kr.prototype.dupOutPt_xwfzgr$=function(t,e){var i=new Sr(t.idx_8be2vx$,t.ptX_8be2vx$,t.ptY_8be2vx$);return e?(i.next_8be2vx$=t.next_8be2vx$,i.prev_8be2vx$=t,t.next_8be2vx$.prev_8be2vx$=i,t.next_8be2vx$=i):(i.prev_8be2vx$=t.prev_8be2vx$,i.next_8be2vx$=t,t.prev_8be2vx$.next_8be2vx$=i,t.prev_8be2vx$=i),i},kr.prototype.getOverlap_r9yya9$=function(t,e,i,n){var r,o;return t<e?i<n?(r=bt.max(t,i),o=bt.min(e,n)):(r=bt.max(t,n),o=bt.min(e,i)):i<n?(r=bt.max(e,i),o=bt.min(t,n)):(r=bt.max(e,n),o=bt.min(t,i)),new M(r,o)},kr.prototype.joinHorz_c0m538$=function(t,e,i,n,r,o,a){var s=t,l=e,u=i,h=n,c=s.ptX_8be2vx$>l.ptX_8be2vx$?tn():en(),v=u.ptX_8be2vx$>h.ptX_8be2vx$?tn():en();if(c===v)return!1;if(c===en()){for(;s.next_8be2vx$.ptX_8be2vx$<=r&&s.next_8be2vx$.ptX_8be2vx$>=s.ptX_8be2vx$&&s.next_8be2vx$.ptY_8be2vx$===o;)s=s.next_8be2vx$;a&&s.ptX_8be2vx$!==r&&(s=s.next_8be2vx$),(l=this.dupOutPt_xwfzgr$(s,!a)).ptX_8be2vx$!==r&&l.ptY_8be2vx$!==o&&((s=l).ptX_8be2vx$=r,s.ptY_8be2vx$=o,l=this.dupOutPt_xwfzgr$(s,!a))}else{for(;s.next_8be2vx$.ptX_8be2vx$>=r&&s.next_8be2vx$.ptX_8be2vx$<=s.ptX_8be2vx$&&s.next_8be2vx$.ptY_8be2vx$===o;)s=s.next_8be2vx$;a||s.ptX_8be2vx$===r||(s=s.next_8be2vx$),(l=this.dupOutPt_xwfzgr$(s,a)).ptX_8be2vx$!==r&&l.ptY_8be2vx$!==o&&((s=l).ptX_8be2vx$=r,s.ptY_8be2vx$=o,l=this.dupOutPt_xwfzgr$(s,a))}if(v===en()){for(;u.next_8be2vx$.ptX_8be2vx$<=r&&u.next_8be2vx$.ptX_8be2vx$>=u.ptX_8be2vx$&&u.next_8be2vx$.ptY_8be2vx$===o;)u=u.next_8be2vx$;a&&u.ptX_8be2vx$!==r&&(u=u.next_8be2vx$),(h=this.dupOutPt_xwfzgr$(u,!a)).ptX_8be2vx$!==r&&h.ptY_8be2vx$!==o&&((u=h).ptX_8be2vx$=r,u.ptY_8be2vx$=o,h=this.dupOutPt_xwfzgr$(u,!a))}else{for(;u.next_8be2vx$.ptX_8be2vx$>=r&&u.next_8be2vx$.ptX_8be2vx$<=u.ptX_8be2vx$&&u.next_8be2vx$.ptY_8be2vx$===o;)u=u.next_8be2vx$;a||u.ptX_8be2vx$===r||(u=u.next_8be2vx$),(h=this.dupOutPt_xwfzgr$(u,a)).ptX_8be2vx$!==r&&h.ptY_8be2vx$!==o&&((u=h).ptX_8be2vx$=r,u.ptY_8be2vx$=o,h=this.dupOutPt_xwfzgr$(u,a))}return c===en()===a?(s.prev_8be2vx$=u,u.next_8be2vx$=s,l.next_8be2vx$=h,h.prev_8be2vx$=l):(s.next_8be2vx$=u,u.prev_8be2vx$=s,l.prev_8be2vx$=h,h.next_8be2vx$=l),!0},kr.prototype.joinPoints_0=function(t,e,i){var n,r,o=x(t.outPt1),a=x(t.outPt2),s=o.ptY_8be2vx$===t.offPtY;if(s&&t.offPtX===o.ptX_8be2vx$&&t.offPtY===o.ptY_8be2vx$&&t.offPtX===a.ptX_8be2vx$&&t.offPtY===a.ptY_8be2vx$){if(!d(e,i))return!1;for(n=o.next_8be2vx$;!d(n,o)&&n.ptX_8be2vx$===t.offPtX&&n.ptY_8be2vx$===t.offPtY;)n=n.next_8be2vx$;var l=n.ptY_8be2vx$>t.offPtY;for(r=a.next_8be2vx$;!d(r,a)&&r.ptX_8be2vx$===t.offPtX&&r.ptY_8be2vx$===t.offPtY;)r=r.next_8be2vx$;return l!==r.ptY_8be2vx$>t.offPtY&&(l?(n=this.dupOutPt_xwfzgr$(o,!1),r=this.dupOutPt_xwfzgr$(a,!0),o.prev_8be2vx$=a,a.next_8be2vx$=o,n.next_8be2vx$=r,r.prev_8be2vx$=n,t.outPt1=o,t.outPt2=n,!0):(n=this.dupOutPt_xwfzgr$(o,!0),r=this.dupOutPt_xwfzgr$(a,!1),o.next_8be2vx$=a,a.prev_8be2vx$=o,n.prev_8be2vx$=r,r.next_8be2vx$=n,t.outPt1=o,t.outPt2=n,!0))}if(s){for(n=o;o.prev_8be2vx$.ptY_8be2vx$===o.ptY_8be2vx$&&!d(o.prev_8be2vx$,n)&&!d(o.prev_8be2vx$,a);)o=o.prev_8be2vx$;for(;n.next_8be2vx$.ptY_8be2vx$===n.ptY_8be2vx$&&!d(n.next_8be2vx$,o)&&!d(n.next_8be2vx$,a);)n=n.next_8be2vx$;if(d(n.next_8be2vx$,o)||d(n.next_8be2vx$,a))return!1;for(r=a;a.prev_8be2vx$.ptY_8be2vx$===a.ptY_8be2vx$&&!d(a.prev_8be2vx$,r)&&!d(a.prev_8be2vx$,n);)a=a.prev_8be2vx$;for(;r.next_8be2vx$.ptY_8be2vx$===r.ptY_8be2vx$&&!d(r.next_8be2vx$,a)&&!d(r.next_8be2vx$,o);)r=r.next_8be2vx$;if(d(r.next_8be2vx$,a)||d(r.next_8be2vx$,o))return!1;var u={v:0},h={v:0},c=this.getOverlap_r9yya9$(o.ptX_8be2vx$,n.ptX_8be2vx$,a.ptX_8be2vx$,r.ptX_8be2vx$);if(u.v=c.first,h.v=c.second,u.v>h.v)return!1;var v,p,f,_,b,$,y,g,m,E,P=0,w=0;if(p=u.v,f=h.v,p<=(_=o.ptX_8be2vx$)&&_<=f)P=o.ptX_8be2vx$,w=o.ptY_8be2vx$,v=o.ptX_8be2vx$>n.ptX_8be2vx$;else if(b=u.v,$=h.v,b<=(y=a.ptX_8be2vx$)&&y<=$)P=a.ptX_8be2vx$,w=a.ptY_8be2vx$,v=a.ptX_8be2vx$>r.ptX_8be2vx$;else g=u.v,m=h.v,g<=(E=n.ptX_8be2vx$)&&E<=m?(P=n.ptX_8be2vx$,w=n.ptY_8be2vx$,v=n.ptX_8be2vx$>o.ptX_8be2vx$):(P=r.ptX_8be2vx$,w=r.ptY_8be2vx$,v=r.ptX_8be2vx$>a.ptX_8be2vx$);return t.outPt1=o,t.outPt2=a,this.joinHorz_c0m538$(o,n,a,r,P,w,v)}for(n=o.next_8be2vx$;n.ptX_8be2vx$===o.ptX_8be2vx$&&n.ptY_8be2vx$===o.ptY_8be2vx$&&!d(n,o);)n=n.next_8be2vx$;var I=n.ptY_8be2vx$>o.ptY_8be2vx$||!qn(o.ptX_8be2vx$,o.ptY_8be2vx$,n.ptX_8be2vx$,n.ptY_8be2vx$,t.offPtX,t.offPtY,this.useFullRange_8be2vx$);if(I){for(n=o.prev_8be2vx$;n.ptX_8be2vx$===o.ptX_8be2vx$&&n.ptY_8be2vx$===o.ptY_8be2vx$&&!d(n,o);)n=n.prev_8be2vx$;if(n.ptY_8be2vx$>o.ptY_8be2vx$||!qn(o.ptX_8be2vx$,o.ptY_8be2vx$,n.ptX_8be2vx$,n.ptY_8be2vx$,t.offPtX,t.offPtY,this.useFullRange_8be2vx$))return!1}for(r=a.next_8be2vx$;r.ptX_8be2vx$===a.ptX_8be2vx$&&r.ptY_8be2vx$===a.ptY_8be2vx$&&!d(r,a);)r=r.next_8be2vx$;var S=r.ptY_8be2vx$>a.ptY_8be2vx$||!qn(a.ptX_8be2vx$,a.ptY_8be2vx$,r.ptX_8be2vx$,r.ptY_8be2vx$,t.offPtX,t.offPtY,this.useFullRange_8be2vx$);if(S){for(r=a.prev_8be2vx$;r.ptX_8be2vx$===a.ptX_8be2vx$&&r.ptY_8be2vx$===a.ptY_8be2vx$&&!d(r,a);)r=r.prev_8be2vx$;if(r.ptY_8be2vx$>a.ptY_8be2vx$||!qn(a.ptX_8be2vx$,a.ptY_8be2vx$,r.ptX_8be2vx$,r.ptY_8be2vx$,t.offPtX,t.offPtY,this.useFullRange_8be2vx$))return!1}return!(d(n,o)||d(r,a)||d(n,r)||d(e,i)&&I===S)&&(I?(n=this.dupOutPt_xwfzgr$(o,!1),r=this.dupOutPt_xwfzgr$(a,!0),o.prev_8be2vx$=a,a.next_8be2vx$=o,n.next_8be2vx$=r,r.prev_8be2vx$=n,t.outPt1=o,t.outPt2=n,!0):(n=this.dupOutPt_xwfzgr$(o,!0),r=this.dupOutPt_xwfzgr$(a,!1),o.next_8be2vx$=a,a.prev_8be2vx$=o,n.prev_8be2vx$=r,r.next_8be2vx$=n,t.outPt1=o,t.outPt2=n,!0))},kr.prototype.fixupFirstLefts1_0=function(t,e){var i;for(i=this.polyOuts_8be2vx$.iterator();i.hasNext();){var n=i.next(),r=tr(n.firstLeft_8be2vx$);null!=n.pts_8be2vx$&&d(r,t)&&x(e.pts_8be2vx$).containsPoint_3dk5mk$(x(n.pts_8be2vx$))&&(n.firstLeft_8be2vx$=e)}},kr.prototype.fixupFirstLefts2_0=function(t,e){var i,n=e.firstLeft_8be2vx$;for(i=this.polyOuts_8be2vx$.iterator();i.hasNext();){var r=i.next();if(null!=r.pts_8be2vx$&&!d(r,e)&&!d(r,t)){var o=tr(r.firstLeft_8be2vx$);(d(o,n)||d(o,t)||d(o,e))&&(x(t.pts_8be2vx$).containsPoint_3dk5mk$(x(r.pts_8be2vx$))?r.firstLeft_8be2vx$=t:x(e.pts_8be2vx$).containsPoint_3dk5mk$(x(r.pts_8be2vx$))?r.firstLeft_8be2vx$=e:(d(r.firstLeft_8be2vx$,t)||d(r.firstLeft_8be2vx$,e))&&(r.firstLeft_8be2vx$=n))}}},kr.prototype.fixupFirstLefts3_0=function(t,e){var i;for(i=this.polyOuts_8be2vx$.iterator();i.hasNext();){var n=i.next(),r=tr(n.firstLeft_8be2vx$);null!=n.pts_8be2vx$&&d(r,t)&&(n.firstLeft_8be2vx$=e)}},kr.prototype.joinCommonEdges_0=function(){var t,e,i;for(t=this.joins_0.iterator();t.hasNext();){var n=t.next(),r=this.getOutRec_0(x(n.outPt1).idx_8be2vx$),o=this.getOutRec_0(x(n.outPt2).idx_8be2vx$);if(null!=r.pts_8be2vx$&&null!=o.pts_8be2vx$&&(!r.isOpen_8be2vx$&&!o.isOpen_8be2vx$)){var a=d(r,o)?r:r.isRightOf_xn8tnc$(o)?o:o.isRightOf_xn8tnc$(r)?r:this.getLowermostRec_0(r,o);this.joinPoints_0(n,r,o)&&(d(r,o)?(r.pts_8be2vx$=n.outPt1,r.bottomPt_8be2vx$=null,(o=this.createOutRec_8be2vx$()).pts_8be2vx$=n.outPt2,o.updateOutPtIdxs_8be2vx$(),x(r.pts_8be2vx$).containsPoint_3dk5mk$(x(o.pts_8be2vx$))?(o.isHole_8be2vx$=!r.isHole_8be2vx$,o.firstLeft_8be2vx$=r,this.usingPolyTree_0&&this.fixupFirstLefts2_0(o,r),(o.isHole_8be2vx$^this.reverseSolution)===o.calcArea_8be2vx$()>0&&null!=(e=o.pts_8be2vx$)&&e.reversePolyPtLinks_8be2vx$()):x(o.pts_8be2vx$).containsPoint_3dk5mk$(x(r.pts_8be2vx$))?(o.isHole_8be2vx$=r.isHole_8be2vx$,r.isHole_8be2vx$=!o.isHole_8be2vx$,o.firstLeft_8be2vx$=r.firstLeft_8be2vx$,r.firstLeft_8be2vx$=o,this.usingPolyTree_0&&this.fixupFirstLefts2_0(r,o),(r.isHole_8be2vx$^this.reverseSolution)===r.calcArea_8be2vx$()>0&&null!=(i=r.pts_8be2vx$)&&i.reversePolyPtLinks_8be2vx$()):(o.isHole_8be2vx$=r.isHole_8be2vx$,o.firstLeft_8be2vx$=r.firstLeft_8be2vx$,this.usingPolyTree_0&&this.fixupFirstLefts1_0(r,o))):(o.pts_8be2vx$=null,o.bottomPt_8be2vx$=null,o.idx_8be2vx$=r.idx_8be2vx$,r.isHole_8be2vx$=a.isHole_8be2vx$,d(a,o)&&(r.firstLeft_8be2vx$=o.firstLeft_8be2vx$),o.firstLeft_8be2vx$=r,this.usingPolyTree_0&&this.fixupFirstLefts3_0(o,r)))}}},kr.prototype.doSimplePolygons_0=function(){for(var t=0;t<this.polyOuts_8be2vx$.size;){var e=this.polyOuts_8be2vx$.get_za3lpa$(t);t=t+1|0;var i=e.pts_8be2vx$;if(null!=i&&!e.isOpen_8be2vx$)do{for(var n=x(i).next_8be2vx$;!d(n,e.pts_8be2vx$);){if(i.ptX_8be2vx$===n.ptX_8be2vx$&&i.ptY_8be2vx$===n.ptY_8be2vx$&&!d(n.next_8be2vx$,i)&&!d(n.prev_8be2vx$,i)){var r=i.prev_8be2vx$,o=n.prev_8be2vx$;i.prev_8be2vx$=o,o.next_8be2vx$=i,n.prev_8be2vx$=r,r.next_8be2vx$=n,e.pts_8be2vx$=i;var a=this.createOutRec_8be2vx$();a.pts_8be2vx$=n,a.updateOutPtIdxs_8be2vx$(),x(e.pts_8be2vx$).containsPoint_3dk5mk$(x(a.pts_8be2vx$))?(a.isHole_8be2vx$=!e.isHole_8be2vx$,a.firstLeft_8be2vx$=e,this.usingPolyTree_0&&this.fixupFirstLefts2_0(a,e)):x(a.pts_8be2vx$).containsPoint_3dk5mk$(x(e.pts_8be2vx$))?(a.isHole_8be2vx$=e.isHole_8be2vx$,e.isHole_8be2vx$=!a.isHole_8be2vx$,a.firstLeft_8be2vx$=e.firstLeft_8be2vx$,e.firstLeft_8be2vx$=a,this.usingPolyTree_0&&this.fixupFirstLefts2_0(e,a)):(a.isHole_8be2vx$=e.isHole_8be2vx$,a.firstLeft_8be2vx$=e.firstLeft_8be2vx$,this.usingPolyTree_0&&this.fixupFirstLefts1_0(e,a)),n=i}n=n.next_8be2vx$}i=i.next_8be2vx$}while(!d(i,e.pts_8be2vx$))}},kr.$metadata$={kind:a,simpleName:"Clipper",interfaces:[Ar]},Rr.$metadata$={kind:p,simpleName:"Companion",interfaces:[]};var Dr,Nr,zr,Mr,Fr,Br,Xr,Yr,jr=null;function Ur(){return null===jr&&new Rr,jr}function Gr(t){nt(t,this),this.name="ClipperException"}function Kr(t,e){u.call(this),this.name$=t,this.ordinal$=e}function qr(){qr=function(){},Dr=new Kr("BEGIN",0),Nr=new Kr("SMOOTH",1),zr=new Kr("CREATE_SPLINE",2),Mr=new Kr("INTERPOLATE_SPLINE",3),Fr=new Kr("APPLY_BRUSH",4),Br=new Kr("CREATE_CONVEX_HULL_CHAIN",5),Xr=new Kr("MERGE_POLYGONS",6),Yr=new Kr("SIMPLIFY_POLYGONS",7)}function Hr(){return qr(),Dr}function Wr(){return qr(),Nr}function Vr(){return qr(),zr}function Zr(){return qr(),Mr}function Jr(){return qr(),Fr}function Qr(){return qr(),Br}function to(){return qr(),Xr}function eo(){return qr(),Yr}function io(t){var e;if(ao(),void 0===t&&(t=ot([])),this.particles_0=!1,this.brushPolygon_0=null,this.layout_0=null,this.defaultSize_0=O.NaN,this.pathSegment_0=null,this.pathProducer_0=null,this.smoother_0=null,this.splineProducer_0=null,this.splineInterpolator_0=null,this.brushApplier_0=null,this.convexHullChainProducer_0=null,this.polygonMerger_0=null,this.polygonSimplifier_0=null,null==t.layout)throw z("layout option is required".toString());if(this.particles_0=t.particles,this.layout_0=t.layout,-1===s(this.layout_0,le())){if(null==t.width)throw z("Stroke width information is required. Please provide via layout or through options".toString());this.defaultSize_0=t.width}var i=null==t.spacing?.1:t.spacing,n=null==t.movingAverageWindowSize?15:t.movingAverageWindowSize,r=null==t.splitCount?this.particles_0?1:6:t.splitCount,o=new Ve;if(o.layout=this.layout_0,null!=t.pathPointCalculator){var a=t.pathPointCalculator;o.pathPointCalculator=a}if(this.pathSegment_0=new ye,this.pathProducer_0=new We(o),this.smoother_0=new ni(this.layout_0.length,n),this.splineProducer_0=new ui(this.layout_0),this.splineInterpolator_0=new oi(this.layout_0,i,r,this.particles_0,this.particles_0),this.splineInterpolator_0.defaultSize=this.defaultSize_0,this.particles_0)this.brushApplier_0=null,this.convexHullChainProducer_0=null,this.polygonMerger_0=null,this.polygonSimplifier_0=null;else{if(null==t.brushPolygon)throw z("brushPolygon option is required".toString());if(-1!==s(this.layout_0,re()))throw z("RED layout channel is not supported for non particles strokes".toString());if(-1!==s(this.layout_0,oe()))throw z("GREEN layout channel is not supported for non particles strokes".toString());if(-1!==s(this.layout_0,ae()))throw z("BLUE layout channel is not supported for non particles strokes".toString());if(-1!==s(this.layout_0,se()))throw z("ALPHA layout channel is not supported for non particles strokes".toString());this.brushPolygon_0=t.brushPolygon;var l=null==t.epsilon?.1:t.epsilon;this.brushApplier_0=new Ge(this.layout_0,Kotlin.isType(e=at(x(this.brushPolygon_0)),F)?e:m()),this.brushApplier_0.defaultSize=this.defaultSize_0,this.convexHullChainProducer_0=new Ke,this.polygonMerger_0=new ei,this.polygonSimplifier_0=new ii(l)}}function no(){oo=this}Object.defineProperty(Or.prototype,"destPolys_0",{get:function(){return null==this.destPolys_63nkfw$_0?V("destPolys"):this.destPolys_63nkfw$_0},set:function(t){this.destPolys_63nkfw$_0=t}}),Object.defineProperty(Or.prototype,"srcPoly_0",{get:function(){return null==this.srcPoly_2tnktt$_0?V("srcPoly"):this.srcPoly_2tnktt$_0},set:function(t){this.srcPoly_2tnktt$_0=t}}),Object.defineProperty(Or.prototype,"destPoly_0",{get:function(){return null==this.destPoly_dju7wb$_0?V("destPoly"):this.destPoly_dju7wb$_0},set:function(t){this.destPoly_dju7wb$_0=t}}),Or.prototype.addPath_g03wud$=function(t,e,i){var n,r,o=t.size-2|0;if(!(o<0)){var a=new br(e,i),s=a.contour;if(i===Ln()||i===Cn())for(;o>0&&t.get_za3lpa$(0)===t.get_za3lpa$(o)&&t.get_za3lpa$(1)===t.get_za3lpa$(o+1|0);)o=o-2|0;(Kotlin.isType(n=s,F)?n:m()).ensureCapacity_za3lpa$(o+2|0);var l=t.get_za3lpa$(0);s.add_11rb$(l);var u=t.get_za3lpa$(1);s.add_11rb$(u);var h=0,c=0;r=t.size;for(var v=0;v<r;v+=2)if(s.get_za3lpa$(h)!==t.get_za3lpa$(v)&&s.get_za3lpa$(h+1|0)!==t.get_za3lpa$(v+1|0)){h=h+2|0;var p=t.get_za3lpa$(v);s.add_11rb$(p);var f=t.get_za3lpa$(v+1|0);s.add_11rb$(f),(t.get_za3lpa$(v+1|0)>s.get_za3lpa$(c+1|0)||t.get_za3lpa$(v+1|0)===s.get_za3lpa$(c+1|0)&&t.get_za3lpa$(v)<s.get_za3lpa$(c))&&(c=h)}if(!(i===Cn()&&h<4)&&(this.polyNodes_0.addChild_n1bxgk$(a),i===Cn()))if(this.lowestX_0<0)this.lowestX_0=this.polyNodes_0.childCount-1|0,this.lowestY_0=c;else{var d=this.polyNodes_0.children.get_za3lpa$(this.lowestX_0).contour.get_za3lpa$(this.lowestY_0),_=this.polyNodes_0.children.get_za3lpa$(this.lowestX_0).contour.get_za3lpa$(this.lowestY_0+1|0),x=s.get_za3lpa$(c),b=s.get_za3lpa$(c+1|0);(b>_||b===_&&x<d)&&(this.lowestX_0=this.polyNodes_0.childCount-1|0,this.lowestY_0=c)}}},Or.prototype.addPaths_91tuyf$=function(t,e,i){var n;for(n=t.iterator();n.hasNext();){var r=n.next();this.addPath_g03wud$(r,e,i)}},Or.prototype.fixOrientations_0=function(){var t,e;if(this.lowestX_0>=0&&!cr(this.polyNodes_0.children.get_za3lpa$(this.lowestX_0).contour))for(t=this.polyNodes_0.children.iterator();t.hasNext();){var i=t.next();(d(i.endtype_8be2vx$,Cn())||d(i.endtype_8be2vx$,Ln())&&cr(i.contour))&&lr(i.contour)}else for(e=this.polyNodes_0.children.iterator();e.hasNext();){var n=e.next();d(n.endtype_8be2vx$,Ln())&&!cr(n.contour)&&lr(n.contour)}},Or.prototype.doOffset_0=function(t){var e,i,n;if(this.delta_0=t,t>-yo.TOLERANCE_8be2vx$&&t<yo.TOLERANCE_8be2vx$){var r;for(this.destPolys_0=fr(this.polyNodes_0.childCount),r=this.polyNodes_0.children.iterator();r.hasNext();){var o=r.next();d(o.endtype_8be2vx$,Cn())&&this.destPolys_0.add_11rb$(o.contour)}}else{this.miterLim_0=this.miterLimit>2?2/(this.miterLimit*this.miterLimit):.5;var a=this.arcTolerance<=0?Ur().DEF_ARC_TOLERANCE:this.arcTolerance>bt.abs(t)*Ur().DEF_ARC_TOLERANCE?bt.abs(t)*Ur().DEF_ARC_TOLERANCE:this.arcTolerance,s=P.PI,l=1-a/bt.abs(t),u=s/bt.acos(l),h=Ur().TWO_PI/u;this.sin_0=bt.sin(h);var c=Ur().TWO_PI/u;for(this.cos_0=bt.cos(c),this.stepsPerRad_0=u/Ur().TWO_PI,t<0&&(this.sin_0=-this.sin_0),this.destPolys_0=fr(2*this.polyNodes_0.childCount|0),e=this.polyNodes_0.children.iterator();e.hasNext();){var v=e.next();this.srcPoly_0=v.contour;var p=this.srcPoly_0.size;if(!(0===p||t<=0&&(p<6||!d(v.endtype_8be2vx$,Cn()))))if(this.destPoly_0=ar(new Int32Array([])),2!==p){this.normals_0.clear(),this.normals_0.ensureCapacity_za3lpa$(p),i=p-2|0;for(var f=0;f<i;f+=2){var _=or(this.srcPoly_0.get_za3lpa$(f),this.srcPoly_0.get_za3lpa$(f+1|0),this.srcPoly_0.get_za3lpa$(f+2|0),this.srcPoly_0.get_za3lpa$(f+3|0)),b=_.component1(),$=_.component2();this.normals_0.add_11rb$(b),this.normals_0.add_11rb$($)}if(d(v.endtype_8be2vx$,Ln())||d(v.endtype_8be2vx$,Cn())){var y=or(this.srcPoly_0.get_za3lpa$(p-2|0),this.srcPoly_0.get_za3lpa$(p-1|0),this.srcPoly_0.get_za3lpa$(0),this.srcPoly_0.get_za3lpa$(1)),g=y.component1(),m=y.component2();this.normals_0.add_11rb$(g),this.normals_0.add_11rb$(m)}else this.normals_0.add_11rb$(this.normals_0.get_za3lpa$(p-4|0)),this.normals_0.add_11rb$(this.normals_0.get_za3lpa$(p-3|0));if(d(v.endtype_8be2vx$,Cn())){for(var E=p-2|0,w=0;w<p;w+=2)this.offsetPoint_xcbom5$(w,E,x(v.jointype_8be2vx$)),E=w;this.destPolys_0.add_11rb$(this.destPoly_0)}else if(d(v.endtype_8be2vx$,Ln())){for(var I=p-2|0,S=0;S<p;S+=2)this.offsetPoint_xcbom5$(S,I,x(v.jointype_8be2vx$)),I=S;this.destPolys_0.add_11rb$(this.destPoly_0),this.destPoly_0=ar(new Int32Array([]));for(var A=this.normals_0.get_za3lpa$(p-2|0),k=this.normals_0.get_za3lpa$(p-1|0),T=p-2|0;T>=2;T-=2)this.normals_0.set_wxm5ur$(T,-this.normals_0.get_za3lpa$(T-2|0)),this.normals_0.set_wxm5ur$(T+1|0,-this.normals_0.get_za3lpa$(T-1|0));this.normals_0.set_wxm5ur$(0,-A),this.normals_0.set_wxm5ur$(1,-k),I=0;for(var C=p-2|0;C>=0;C-=2)this.offsetPoint_xcbom5$(C,I,x(v.jointype_8be2vx$)),I=C;this.destPolys_0.add_11rb$(this.destPoly_0)}else{var L=0;n=p-2|0;for(var O=2;O<n;O+=2)this.offsetPoint_xcbom5$(O,L,x(v.jointype_8be2vx$)),L=O;if(d(v.endtype_8be2vx$,On())){var R=p-2|0,D=this.srcPoly_0.get_za3lpa$(R),N=this.srcPoly_0.get_za3lpa$(R+1|0),z=this.normals_0.get_za3lpa$(R),M=this.normals_0.get_za3lpa$(R+1|0);this.destPoly_0.add_11rb$(Un(D+z*t)),this.destPoly_0.add_11rb$(Un(N+M*t)),this.destPoly_0.add_11rb$(Un(D-z*t)),this.destPoly_0.add_11rb$(Un(D-M*t))}else{var F=p-2|0;L=p-4|0,this.sinA_0=0;var B=this.normals_0.get_za3lpa$(F),X=this.normals_0.get_za3lpa$(F+1|0);this.normals_0.set_wxm5ur$(F,-B),this.normals_0.set_wxm5ur$(F+1|0,-X),d(v.endtype_8be2vx$,Rn())?this.doSquare_6xvm5r$(F,L):this.doRound_6xvm5r$(F,L)}for(var Y=p-2|0;Y>=2;Y-=2)this.normals_0.set_wxm5ur$(Y,-this.normals_0.get_za3lpa$(Y-2|0)),this.normals_0.set_wxm5ur$(Y+1|0,-this.normals_0.get_za3lpa$(Y-1|0));this.normals_0.set_wxm5ur$(0,-this.normals_0.get_za3lpa$(2)),this.normals_0.set_wxm5ur$(1,-this.normals_0.get_za3lpa$(3));for(var j=(L=p-2|0)-2|0;j>=2;j-=2)this.offsetPoint_xcbom5$(j,L,x(v.jointype_8be2vx$)),L=j;if(d(v.endtype_8be2vx$,On())){var U=this.srcPoly_0.get_za3lpa$(0),G=this.srcPoly_0.get_za3lpa$(1),K=this.normals_0.get_za3lpa$(0),q=this.normals_0.get_za3lpa$(1);this.destPoly_0.add_11rb$(Un(U-K*t)),this.destPoly_0.add_11rb$(Un(G-q*t)),this.destPoly_0.add_11rb$(Un(U+K*t)),this.destPoly_0.add_11rb$(Un(G+q*t))}else L=2,this.sinA_0=0,d(v.endtype_8be2vx$,Rn())?this.doSquare_6xvm5r$(0,L):this.doRound_6xvm5r$(0,L);this.destPolys_0.add_11rb$(this.destPoly_0)}}else{var H=this.srcPoly_0.get_za3lpa$(0),W=this.srcPoly_0.get_za3lpa$(1);if(d(v.jointype_8be2vx$,Sn()))for(var V=1,Z=0,J=1;J<=u;){this.destPoly_0.add_11rb$(Un(H+V*t)),this.destPoly_0.add_11rb$(Un(W+Z*t));var Q=V;V=V*this.cos_0-this.sin_0*Z,Z=Q*this.sin_0+Z*this.cos_0,J=J+1|0}else{var tt,et={v:-1},nt={v:-1};for(tt=new it(1,4).iterator();tt.hasNext();){tt.next();this.destPoly_0.add_11rb$(Un(H+et.v*t)),this.destPoly_0.add_11rb$(Un(W+nt.v*t)),et.v<0?et.v=1:nt.v<0?nt.v=1:et.v=-1}}this.destPolys_0.add_11rb$(this.destPoly_0)}}}},Or.prototype.execute_j10y4s$=function(t,e){t.clear(),this.fixOrientations_0(),this.doOffset_0(e);var i=new kr;if(i.addPaths_4w9siq$(this.destPolys_0,_n(),!0),e>0)i.execute_vmznv9$(cn(),t,mn(),mn());else{var n=_r(this.destPolys_0),r=ar(new Int32Array([n.left-10|0,n.bottom+10|0,n.right+10|0,n.bottom+10|0,n.right+10|0,n.top-10|0,n.left-10|0,n.top-10|0]));i.addPath_uwq97q$(r,_n(),!0),i.reverseSolution=!0,i.execute_vmznv9$(cn(),t,En(),En()),t.isEmpty()||t.removeAt_za3lpa$(0)}},Or.prototype.execute_cbwto5$=function(t,e){t.clear(),this.fixOrientations_0(),this.doOffset_0(e);var i=new kr;if(i.addPaths_4w9siq$(this.destPolys_0,_n(),!0),e>0)i.execute_gfiyp8$(cn(),t,mn(),mn());else{var n=_r(this.destPolys_0),r=ar(new Int32Array([n.left-10|0,n.bottom+10|0,n.right+10|0,n.bottom+10|0,n.right+10|0,n.top-10|0,n.left-10|0,n.top-10|0]));if(i.addPath_uwq97q$(r,_n(),!0),i.reverseSolution=!0,i.execute_gfiyp8$(cn(),t,En(),En()),1===t.childCount){var o,a=t.children.get_za3lpa$(0);if(a.childCount>0){t.children.ensureCapacity_za3lpa$(a.childCount);var s=t.children,l=a.children.get_za3lpa$(0);l.parent=t,s.set_wxm5ur$(0,l),o=a.childCount;for(var u=1;u<o;u++)t.addChild_n1bxgk$(a.children.get_za3lpa$(u))}else t.clear()}else t.clear()}},Or.prototype.offsetPoint_xcbom5$=function(t,e,i){var n=this.normals_0.get_za3lpa$(e),r=this.normals_0.get_za3lpa$(e+1|0),o=this.normals_0.get_za3lpa$(t),a=this.normals_0.get_za3lpa$(t+1|0),s=this.srcPoly_0.get_za3lpa$(t),l=this.srcPoly_0.get_za3lpa$(t+1|0);this.sinA_0=n*a-o*r;var u=this.sinA_0*this.delta_0;if(bt.abs(u)<1){if(n*o+a*r>0)return this.destPoly_0.add_11rb$(Un(s+n*this.delta_0)),void this.destPoly_0.add_11rb$(Un(l+r*this.delta_0))}else this.sinA_0>1?this.sinA_0=1:this.sinA_0<-1&&(this.sinA_0=-1);if(this.sinA_0*this.delta_0<0)this.destPoly_0.add_11rb$(Un(s+n*this.delta_0)),this.destPoly_0.add_11rb$(Un(l+r*this.delta_0)),this.destPoly_0.add_11rb$(s),this.destPoly_0.add_11rb$(l),this.destPoly_0.add_11rb$(Un(s+o*this.delta_0)),this.destPoly_0.add_11rb$(Un(l+a*this.delta_0));else switch(i.name){case"Miter":var h=1+o*n+a*r;h>=this.miterLim_0?this.doMiter_wogov$(t,e,h):this.doSquare_6xvm5r$(t,e);break;case"Square":this.doSquare_6xvm5r$(t,e);break;case"Round":this.doRound_6xvm5r$(t,e)}},Or.prototype.doSquare_6xvm5r$=function(t,e){var i=this.normals_0.get_za3lpa$(e),n=this.normals_0.get_za3lpa$(e+1|0),r=this.normals_0.get_za3lpa$(t),o=this.normals_0.get_za3lpa$(t+1|0),a=this.srcPoly_0.get_za3lpa$(t),s=this.srcPoly_0.get_za3lpa$(t+1|0),l=this.sinA_0,u=i*r+i*r,h=bt.atan2(l,u)/4,c=bt.tan(h);this.destPoly_0.add_11rb$(Un(a+this.delta_0*(i-n*c))),this.destPoly_0.add_11rb$(Un(s+this.delta_0*(n+i*c))),this.destPoly_0.add_11rb$(Un(a+this.delta_0*(r+o*c))),this.destPoly_0.add_11rb$(Un(s+this.delta_0*(o-r*c)))},Or.prototype.doMiter_wogov$=function(t,e,i){var n=this.normals_0.get_za3lpa$(e),r=this.normals_0.get_za3lpa$(e+1|0),o=this.normals_0.get_za3lpa$(t),a=this.normals_0.get_za3lpa$(t+1|0),s=this.srcPoly_0.get_za3lpa$(t),l=this.srcPoly_0.get_za3lpa$(t+1|0),u=this.delta_0/i;this.destPoly_0.add_11rb$(Un(s+(n+o)*u)),this.destPoly_0.add_11rb$(Un(l+(r+a)*u))},Or.prototype.doRound_6xvm5r$=function(t,e){var i,n,r=this.normals_0.get_za3lpa$(e),o=this.normals_0.get_za3lpa$(e+1|0),a=this.normals_0.get_za3lpa$(t),s=this.normals_0.get_za3lpa$(t+1|0),l=this.srcPoly_0.get_za3lpa$(t),u=this.srcPoly_0.get_za3lpa$(t+1|0),h=this.sinA_0,c=r*a+o*s,v=bt.atan2(h,c),p=Un(this.stepsPerRad_0*bt.abs(v)),f=r,d=o;i=bt.max(p,1)-1|0;for(var _=0;_<=i;_++)this.destPoly_0.add_11rb$(Un(l+f*this.delta_0)),this.destPoly_0.add_11rb$(Un(u+d*this.delta_0)),n=f,f=f*this.cos_0-this.sin_0*d,d=n*this.sin_0+d*this.cos_0;this.destPoly_0.add_11rb$(Un(l+a*this.delta_0)),this.destPoly_0.add_11rb$(Un(u+s*this.delta_0))},Or.prototype.clear=function(){this.polyNodes_0.children.clear(),this.lowestX_0=-1},Or.$metadata$={kind:a,simpleName:"ClipperOffset",interfaces:[]},Gr.$metadata$={kind:a,simpleName:"ClipperException",interfaces:[tt]},Kr.$metadata$={kind:a,simpleName:"BuildPhase",interfaces:[u]},Kr.values=function(){return[Hr(),Wr(),Vr(),Zr(),Jr(),Qr(),to(),eo()]},Kr.valueOf_61zpoe$=function(t){switch(t){case"BEGIN":return Hr();case"SMOOTH":return Wr();case"CREATE_SPLINE":return Vr();case"INTERPOLATE_SPLINE":return Zr();case"APPLY_BRUSH":return Jr();case"CREATE_CONVEX_HULL_CHAIN":return Qr();case"MERGE_POLYGONS":return to();case"SIMPLIFY_POLYGONS":return eo();default:h("No enum constant com.wacom.digitalink.BuildPhase."+t)}},io.prototype.getPath=function(t){if(null==t&&(-1===s(this.layout_0,re())||-1===s(this.layout_0,oe())||-1===s(this.layout_0,ae())||-1===s(this.layout_0,se())))throw z("Stroke color information is required".toString());var e=this.particles_0?new so(x(this.splineInterpolator_0.allData),this.defaultSize_0,t):ao().convertToArray_0(x(x(this.polygonSimplifier_0).allData));return ot([new M("layout",this.layout_0),new M("points",rt(x(this.splineProducer_0.allData).path)),new M("spline",e),new M("width",this.defaultSize_0),new M("color",t),new M("ts",0),new M("tf",1)])},no.prototype.discretize=function(t,e){void 0===e&&(e=ot([]));var i=new io(e),n=new Ye(at(t),i.layout_0),r=i.discretize(!0,!0,n,null);return i.particles_0?new so(r.first,i.defaultSize_0,null):ao().convertToArray_0(r.first)},no.prototype.createPointerData_0=function(t,e){return new Ie(e.x,e.y,t,st(e.timestamp),null==e.z?null:e.z,null==e.force?null:e.force,null==e.radius?null:e.radius,null==e.altitude?null:e.altitude,null==e.azimuth?null:e.azimuth)};var ro=Kotlin.kotlin.collections.collectionSizeOrDefault_ba2ldo$;no.prototype.convertToArray_0=function(t){var e,i=b(ro(t,10));for(e=t.iterator();e.hasNext();){var n=e.next();i.add_11rb$(rt(n))}return ri(i)},no.prototype.convertToList_0=function(t){var e,i=b(t.length);for(e=0;e!==t.length;++e){var n=t[e];i.add_11rb$(at(n))}return k(i)},no.$metadata$={kind:p,simpleName:"Companion",interfaces:[]};var oo=null;function ao(){return null===oo&&new no,oo}function so(t,e,i){this.spline_0=t,this.defaultSize_0=e,this.color=i}function lo(t,e){if(void 0===e&&(e=ft()),vo().debug)switch(e.name){case"DEBUG":console.log(t);break;case"WARN":console.warn(t);break;case"ERROR":console.error(t)}}function uo(){vo()}function ho(){co=this,this.debug=!1}io.prototype.add=function(t,e,i){var n=ao().createPointerData_0(t,e),r=null==i?null:ao().createPointerData_0(t,i),o=this.pathProducer_0.add_hr8sph$(t,n,r),a=o.component1(),s=o.component2();this.pathSegment_0.add_nynv2b$(t,a,s)},io.prototype.getPathPart=function(){var t,e,i,n={v:null},r=this.pathSegment_0.isFirst,o=this.pathSegment_0.isLast;return n.v=this.smoother_0.add_cy7266$(r,o,this.pathSegment_0.accumulatedAddition,this.pathSegment_0.lastPrediction),null!=(t=this.intercept((e=n,i=this,function(t){return i.getStateValue_0(Wr(),e.v)})))&&(n.v=this.getStatePair_0(t)),this.pathSegment_0.reset(),n.v=this.splineProducer_0.add_cy7266$(r,o,n.v.first,n.v.second),null!=(t=this.intercept(function(t,e){return function(i){return e.getStateValue_0(Vr(),t.v)}}(n,this)))&&(n.v=this.getStatePair_0(t)),n.v=this.discretize(r,o,n.v.first,n.v.second),this.particles_0?ot([new M("added",new so(n.v.first,this.defaultSize_0,null)),new M("predicted",new so(n.v.second,this.defaultSize_0,null))]):ot([new M("added",ao().convertToArray_0(n.v.first)),new M("predicted",ao().convertToArray_0(n.v.second))])},io.prototype.discretize=function(t,e,i,n){var r,o,a,s={v:null};return s.v=this.splineInterpolator_0.add_cy7266$(t,e,i,n),null!=(r=this.intercept((o=s,a=this,function(t){return a.getStateValue_0(Zr(),o.v)})))&&(s.v=this.getStatePair_0(r)),this.particles_0||(s.v=x(this.brushApplier_0).add_cy7266$(t,e,s.v.first,s.v.second),null!=(r=this.intercept(function(t,e){return function(i){return e.getStateValue_0(Jr(),t.v)}}(s,this)))&&(s.v=this.getStatePair_0(r)),s.v=x(this.convexHullChainProducer_0).add_cy7266$(t,e,s.v.first,s.v.second),null!=(r=this.intercept(function(t,e){return function(i){return e.getStateValue_0(Qr(),t.v)}}(s,this)))&&(s.v=this.getStatePair_0(r)),s.v=x(this.polygonMerger_0).add_cy7266$(t,e,s.v.first,s.v.second),null!=(r=this.intercept(function(t,e){return function(i){return e.getStateValue_0(to(),t.v)}}(s,this)))&&(s.v=this.getStatePair_0(r)),s.v=x(this.polygonSimplifier_0).add_cy7266$(t,e,s.v.first,s.v.second),null!=(r=this.intercept(function(t,e){return function(i){return e.getStateValue_0(eo(),t.v)}}(s,this)))&&(s.v=this.getStatePair_0(r))),s.v},io.prototype.getStateValue_0=function(t,e){var i=ot([]);if(i.buildPhase=t,t===Hr()||t===Wr()){var n=e.first,r=e.second;i.added=rt(n),i.predicted=rt(r)}else if(t===Vr()||t===Zr()){var o=e.first,a=e.second;i.added=rt(o.path),i.predicted=rt(a.path)}else{var s=e.first,l=e.second;i.added=ao().convertToArray_0(s),i.predicted=ao().convertToArray_0(l)}return i},io.prototype.getStatePair_0=function(t){if(d(t.buildPhase,Hr())||d(t.buildPhase,Wr())){var e=t.added,i=t.predicted,n=l(),r=l();return 0!==e.length&&(n=at(e)),0!==i.length&&(r=at(i)),new M(n,r)}if(d(t.buildPhase,Vr())||d(t.buildPhase,Zr())){var o=t.added,a=t.predicted,s=new Ye(at(o),this.layout_0),u=new Ye(at(a),this.layout_0);return new M(s,u)}var h=t.added,c=t.predicted;return new M(ao().convertToList_0(h),ao().convertToList_0(c))},io.prototype.reset=function(){this.pathProducer_0.reset(),this.smoother_0.reset(),this.splineProducer_0.reset(),this.splineInterpolator_0.reset(),this.particles_0||(x(this.brushApplier_0).reset(),x(this.convexHullChainProducer_0).reset(),x(this.polygonMerger_0).reset(),x(this.polygonSimplifier_0).reset())},io.prototype.abort=function(){this.reset()},io.prototype.intercept=function(t){return null},io.$metadata$={kind:a,simpleName:"InkBuilder",interfaces:[]},Object.defineProperty(so.prototype,"layout",{get:function(){return this.spline_0.layout}}),Object.defineProperty(so.prototype,"length",{get:function(){return this.spline_0.path.size}}),Object.defineProperty(so.prototype,"ts",{get:function(){return this.spline_0.ts}}),Object.defineProperty(so.prototype,"tf",{get:function(){return this.spline_0.tf}}),Object.defineProperty(so.prototype,"width",{get:function(){return this.defaultSize_0}}),so.prototype.at=function(t){return this.spline_0.path.get_za3lpa$(t)},so.prototype.values=function(){return rt(this.spline_0.path)},so.$metadata$={kind:a,simpleName:"InterpolatedSpline",interfaces:[]},ho.$metadata$={kind:p,simpleName:"Companion",interfaces:[]};var co=null;function vo(){return null===co&&new ho,co}uo.$metadata$={kind:a,simpleName:"config",interfaces:[]};var po=t.com||(t.com={}),fo=po.wacom||(po.wacom={}),_o=fo.digitalink||(fo.digitalink={});_o.DIPoint4_init=ut,_o.DIPoint4=lt,Object.defineProperty(_o,"DEBUG_8be2vx$",{get:function(){return e}}),_o.distanceSq_lbuxx6$=ht,_o.simplified_pupstr$=ct,_o.merge_6wxdyh$=function(t,e){return void 0===e&&(e=null),Xe().mergePolygons_7nvot6$(t,e)},Object.defineProperty(vt,"DEBUG",{get:ft}),Object.defineProperty(vt,"WARN",{get:dt}),Object.defineProperty(vt,"ERROR",{get:_t}),_o.LogLevel=vt,Object.defineProperty(xt,"Companion",{get:Vt}),_o.Matrix3D_init=Zt,_o.Matrix3D=xt,Object.defineProperty(Qt,"X",{get:ee}),Object.defineProperty(Qt,"Y",{get:ie}),Object.defineProperty(Qt,"Z",{get:ne}),Object.defineProperty(Qt,"RED",{get:re}),Object.defineProperty(Qt,"GREEN",{get:oe}),Object.defineProperty(Qt,"BLUE",{get:ae}),Object.defineProperty(Qt,"ALPHA",{get:se}),Object.defineProperty(Qt,"SIZE",{get:le}),Object.defineProperty(Qt,"ROTATION",{get:ue}),Object.defineProperty(Qt,"SCALE_X",{get:he}),Object.defineProperty(Qt,"SCALE_Y",{get:ce}),Object.defineProperty(Qt,"SCALE_Z",{get:ve}),Object.defineProperty(Qt,"OFFSET_X",{get:pe}),Object.defineProperty(Qt,"OFFSET_Y",{get:fe}),Object.defineProperty(Qt,"OFFSET_Z",{get:de}),Object.defineProperty(Qt,"D_X",{get:_e}),Object.defineProperty(Qt,"D_Y",{get:xe}),Jt.Property=Qt,_o.PathPoint_init_dleff0$=$e,_o.PathPoint_init_1tcnn$=function(t,e,i){if($e(0,0,i=i||Object.create(Jt.prototype)),!y(e,ee())||!y(e,ie()))throw g("PathPoint must contain at least X and Y coordinates.");if(t.length!==e.length)throw g("The size of the values ("+t.length+") doesn't match the properties size ("+e.length+")");for(var n=0;n<e.length;n++)i.setProperty_2w0t5k$(e[n],t[n]);return i},_o.PathPoint_init_m7syj3$=function(t,e){return e=e||Object.create(Jt.prototype),Jt.call(e,t.x,t.y,t.z,t.size,t.red,t.green,t.blue,t.alpha,t.rotation,t.scaleX,t.scaleY,t.scaleZ,t.offsetX,t.offsetY,t.scaleZ,t.dX,t.dY),e},_o.PathPoint=Jt,_o.PathSegment=ye,Object.defineProperty(ge,"BEGIN",{get:Ee}),Object.defineProperty(ge,"UPDATE",{get:Pe}),Object.defineProperty(ge,"END",{get:we}),_o.Phase=ge,Object.defineProperty(Se,"X",{get:ke}),Object.defineProperty(Se,"Y",{get:Te}),Object.defineProperty(Se,"Z",{get:Ce}),Object.defineProperty(Se,"PHASE",{get:Le}),Object.defineProperty(Se,"TIMESTAMP",{get:Oe}),Object.defineProperty(Se,"FORCE",{get:Re}),Object.defineProperty(Se,"RADIUS",{get:De}),Object.defineProperty(Se,"ALTITUDE_ANGLE",{get:Ne}),Object.defineProperty(Se,"AZIMUTH_ANGLE",{get:ze}),Ie.Property=Se,_o.PointerData=Ie,Object.defineProperty(Me,"Companion",{get:Xe}),_o.PolygonUtils=Me,_o.Spline=Ye;var xo=_o.base||(_o.base={});xo.DataProcessor=je,xo.DataSequenceProcessor=Ue;var bo=_o.pipeline||(_o.pipeline={});bo.BrushApplier=Ge,_o.ConvexHullChainProducer=Ke,We.Config=Ve,Object.defineProperty(We,"Companion",{get:ti}),bo.PathProducer=We,bo.PolygonMerger=ei,bo.PolygonSimplifier=ii,bo.Smoother=ni,Object.defineProperty(oi,"Companion",{get:li}),bo.SplineInterpolator=oi,bo.SplineProducer=ui;var $o=_o.utils||(_o.utils={});$o.Bounds=hi,Object.defineProperty(ci,"Companion",{get:qi}),$o.QuickSort=ci;var yo=t.klipper||(t.klipper={});Object.defineProperty(yo,"USE_LINES_8be2vx$",{get:function(){return pi}}),Object.defineProperty(yo,"ZERO_8be2vx$",{get:function(){return fi}}),Object.defineProperty(yo,"LO_RANGE_8be2vx$",{get:function(){return di}}),Object.defineProperty(yo,"HI_RANGE_8be2vx$",{get:function(){return _i}}),Object.defineProperty(yo,"HORIZONTAL_8be2vx$",{get:function(){return xi}}),Object.defineProperty(yo,"SKIP_8be2vx$",{get:function(){return bi}}),Object.defineProperty(yo,"UNASSIGNED_8be2vx$",{get:function(){return $i}}),Object.defineProperty(yo,"TOLERANCE_8be2vx$",{get:function(){return yi}}),Object.defineProperty(Hi,"Left",{get:Vi}),Object.defineProperty(Hi,"Right",{get:Zi}),yo.EdgeSide=Hi,Object.defineProperty(Ji,"RightToLeft",{get:tn}),Object.defineProperty(Ji,"LeftToRight",{get:en}),yo.Direction=Ji,Object.defineProperty(nn,"Any",{get:on}),Object.defineProperty(nn,"Open",{get:an}),Object.defineProperty(nn,"Closed",{get:sn}),yo.NodeType=nn,Object.defineProperty(ln,"Intersection",{get:hn}),Object.defineProperty(ln,"Union",{get:cn}),Object.defineProperty(ln,"Difference",{get:vn}),Object.defineProperty(ln,"Xor",{get:pn}),yo.ClipType=ln,Object.defineProperty(fn,"Subject",{get:_n}),Object.defineProperty(fn,"Clip",{get:xn}),yo.PolyType=fn,Object.defineProperty(bn,"EvenOdd",{get:yn}),Object.defineProperty(bn,"NonZero",{get:gn}),Object.defineProperty(bn,"Positive",{get:mn}),Object.defineProperty(bn,"Negative",{get:En}),yo.PolyFillType=bn,Object.defineProperty(Pn,"Square",{get:In}),Object.defineProperty(Pn,"Round",{get:Sn}),Object.defineProperty(Pn,"Miter",{get:An}),yo.JoinType=Pn,Object.defineProperty(kn,"ClosedPolygon",{get:Cn}),Object.defineProperty(kn,"ClosedLine",{get:Ln}),Object.defineProperty(kn,"OpenButt",{get:On}),Object.defineProperty(kn,"OpenSquare",{get:Rn}),Object.defineProperty(kn,"OpenRound",{get:Dn}),yo.EndType=kn,yo.IntRect_init_6jpx6i$=function(t,e){return e=e||Object.create(Nn.prototype),Nn.call(e,t.left,t.top,t.right,t.bottom),e},yo.IntRect=Nn,yo.LocalMinima=zn,yo.Scanbeam=Mn,yo.Maxima=Fn,yo.Join=Bn,yo.HorzDirection=Xn,yo.isOnLineSegment_ulwha0$=Yn,yo.isOnPolygon_712fd7$=function(t,e,i,n){for(var r=i;;){if(Yn(t,e,r.ptX_8be2vx$,r.ptY_8be2vx$,r.next_8be2vx$.ptX_8be2vx$,r.next_8be2vx$.ptY_8be2vx$,n))return!0;if(r=r.next_8be2vx$,d(r,i))return!1}},yo.get_isNearZero_1zw1ma$=jn,yo.round_14dthe$=Un,yo.mul_b6l1hq$=Gn,yo.slopesEqual_ac3fxc$=Kn,yo.slopesEqual_ulwha0$=qn,yo.slopesEqual_426wzc$=Hn,yo.pt2IsBetweenPt1AndPt3_t4syr3$=Wn,yo.minkowski_lkygy7$=rr,yo.minkowskiSum_uo09lx$=function(t,e,i){var n=rr(t,e,!0,i),r=new kr;return r.addPaths_4w9siq$(n,_n(),!0),r.execute_vmznv9$(cn(),n,gn(),gn()),n},yo.minkowskiSum_tg3kgn$=function(t,e,i){var n,r=pr([]),o=new kr;for(n=e.iterator();n.hasNext();){var a=n.next(),s=rr(t,a,!0,i);if(o.addPaths_4w9siq$(s,_n(),!0),i){var l=hr(a,t.get_za3lpa$(0),t.get_za3lpa$(1));o.addPath_uwq97q$(l,xn(),!0)}}return o.execute_vmznv9$(cn(),r,gn(),gn()),r},yo.minkowskiDiff_q72cfg$=function(t,e){var i=rr(t,e,!1,!0),n=new kr;return n.addPaths_4w9siq$(i,_n(),!0),n.execute_vmznv9$(cn(),i,gn(),gn()),i},yo.getUnitNormal_tjonv8$=or,yo.Path_pmhfmb$=ar,yo.Path_za3lpa$=sr,yo.reverse_smf6gf$=lr,yo.calcArea_smf6gf$=ur,yo.simplify_9m0pot$=function(t,e){void 0===e&&(e=yn());var i=pr([]),n=new kr;return n.strictlySimple=!0,n.addPath_uwq97q$(t,_n(),!0),n.execute_vmznv9$(cn(),i,e,e),i},yo.get_orientation_smf6gf$=cr,yo.containsPoint_n00zd1$=function(t,e,i){var n=0,r=t.size;if(r<6)return 0;for(var o=t.get_za3lpa$(0),a=t.get_za3lpa$(1),s=2;s<=r;s+=2){var l=(s+1|0)===r?t.get_za3lpa$(0):t.get_za3lpa$(s),u=(s+1|0)===r?t.get_za3lpa$(1):t.get_za3lpa$(s+1|0);if(u===i&&(l===e||a===i&&l>e==o<e))return-1;if(a<i!=u<i)if(o>=e)if(l>e)n=1-n|0;else{var h=(o-e|0)*(u-i|0)-(l-e|0)*(a-i|0);if(0===h)return-1;h>0==u>a&&(n=1-n|0)}else if(l>e){var c=(o-e|0)*(u-i|0)-(l-e|0)*(a-i|0);if(0===c)return-1;c>0==u>a&&(n=1-n|0)}o=l,a=u}return n},yo.clean_p2u1l9$=function(t,e){var i,n;void 0===e&&(e=1.415);var r={v:t.size};if(0===r.v)return ar(new Int32Array([]));var o,a=vr(r.v);o=a.length-1|0;for(var s=0;s<=o;s++)a[s]=new Sr(0,t.get_za3lpa$(2*s|0),t.get_za3lpa$(1+(2*s|0)|0));var l,u,h=a,c=0;for(l=0;l!==h.length;++l){var v=h[l],p=h[(0|(u=c,c=u+1|0,u+1))%r.v];p.prev_8be2vx$=v,v.next_8be2vx$=p}for(var f=e*e,_=h[0];0===_.idx_8be2vx$&&!d(_.next_8be2vx$,_.prev_8be2vx$);)nr(_.ptX_8be2vx$,_.ptY_8be2vx$,_.prev_8be2vx$.ptX_8be2vx$,_.prev_8be2vx$.ptY_8be2vx$,f)?(r.v=r.v-1|0,i=_.exclude_8be2vx$()):nr(_.prev_8be2vx$.ptX_8be2vx$,_.prev_8be2vx$.ptY_8be2vx$,_.next_8be2vx$.ptX_8be2vx$,_.next_8be2vx$.ptY_8be2vx$,f)?(r.v=r.v-2|0,_.next_8be2vx$.exclude_8be2vx$(),i=_.exclude_8be2vx$()):ir(_.prev_8be2vx$.ptX_8be2vx$,_.prev_8be2vx$.ptY_8be2vx$,_.ptX_8be2vx$,_.ptY_8be2vx$,_.next_8be2vx$.ptX_8be2vx$,_.next_8be2vx$.ptY_8be2vx$,f)?(r.v=r.v-1|0,i=_.exclude_8be2vx$()):(_.idx_8be2vx$=1,i=_.next_8be2vx$),_=i;r.v<3&&(r.v=0);for(var x=2*r.v|0,$=b(x),y=0;y<x;y++)$.add_11rb$(0);var g=$;n=r.v;for(var m=0;m<n;m++)g.add_11rb$(_.ptX_8be2vx$),g.add_11rb$(_.ptY_8be2vx$),_=_.next_8be2vx$;return g},yo.Paths_zhfal7$=pr,yo.Paths_za3lpa$=fr,yo.Paths_9nlmmg$=dr,yo.get_bounds_gxe3rh$=_r,yo.reverse_gxe3rh$=function(t){var e;for(e=t.iterator();e.hasNext();)lr(e.next())},yo.simplify_d76y9b$=function(t,e){void 0===e&&(e=yn());var i=pr([]),n=new kr;return n.strictlySimple=!0,n.addPaths_4w9siq$(t,_n(),!0),n.execute_vmznv9$(cn(),i,e,e),i},yo.add_87gjsa$=xr,yo.PolyNode=br,yo.PolyTree=$r,yo.TEdge=yr,yo.IntersectNode=gr,Object.defineProperty(yo,"IntersectNodeComparator",{get:wr}),yo.OutRec=Ir,yo.OutPt=Sr,yo.ClipperBase=Ar,Object.defineProperty(kr,"Companion",{get:Lr}),yo.Clipper=kr,Object.defineProperty(Or,"Companion",{get:Ur}),o.DigitalInk=t,yo.ClipperOffset=Or,yo.ClipperException=Gr,Object.defineProperty(Kr,"BEGIN",{get:Hr}),Object.defineProperty(Kr,"SMOOTH",{get:Wr}),Object.defineProperty(Kr,"CREATE_SPLINE",{get:Vr}),Object.defineProperty(Kr,"INTERPOLATE_SPLINE",{get:Zr}),Object.defineProperty(Kr,"APPLY_BRUSH",{get:Jr}),Object.defineProperty(Kr,"CREATE_CONVEX_HULL_CHAIN",{get:Qr}),Object.defineProperty(Kr,"MERGE_POLYGONS",{get:to}),Object.defineProperty(Kr,"SIMPLIFY_POLYGONS",{get:eo}),_o.BuildPhase=Kr,Object.defineProperty(io,"Companion",{get:ao}),_o.InkBuilder=io,_o.InterpolatedSpline=so,_o.log_fb5ib3$=lo,Object.defineProperty(uo,"Companion",{get:vo}),_o.config=uo,e=!1,pi=!0,fi=0,di=32767,_i=32767,xi=-3.4e38,bi=-2,$i=-1,yi=1e-20,Kotlin.defineModule("DigitalInk",t)}(DigitalInk),kotlin.kotlin.collections.ArrayList.prototype.addAll_brywnq$=function(t){var e=this;return!t.isEmpty()&&(t.array_hd7ov6$_0?t.array_hd7ov6$_0.forEach(function(t){return e.array_hd7ov6$_0.push(t)}):this.array_hd7ov6$_0=this.array_hd7ov6$_0.concat(copyToArray(t)),this.modCount=this.modCount+1|0,!0)};var BuildPhase=DigitalInk.com.wacom.digitalink.BuildPhase,Phase=DigitalInk.com.wacom.digitalink.Phase,PathPoint=DigitalInk.com.wacom.digitalink.PathPoint,InterpolatedSpline=DigitalInk.com.wacom.digitalink.InterpolatedSpline,InkBuilder=DigitalInk.com.wacom.digitalink.InkBuilder;InkBuilder.discretize=DigitalInk.com.wacom.digitalink.InkBuilder.Companion.discretize,InkBuilder.calculateBasedOnSpeed=DigitalInk.com.wacom.digitalink.pipeline.PathProducer.Companion.calculateBasedOnSpeed,InkBuilder.BuildPhase=BuildPhase,InkBuilder.Phase=Phase,[BuildPhase,Phase,PathPoint.Property].forEach(function(t){t.values().forEach(function(e){e.type=t.name,e.value=e.ordinal,t[e.value]=e})});var config=DigitalInk.com.wacom.digitalink.config.Companion,WRect$1=function(){function t(e,i,n,r){_classCallCheck(this,t),Object.defineProperties(this,{left:{value:e,enumerable:!0},x:{value:e,enumerable:!0},bottom:{value:i,enumerable:!0},y:{value:i,enumerable:!0},right:{value:n,enumerable:!0},top:{value:r,enumerable:!0},width:{value:n-e,enumerable:!0},height:{value:r-i,enumerable:!0}})}return _createClass(t,[{key:"union",value:function(e){if(e&&!(e instanceof t))throw new TypeError("rect must be instance of WRect");return e?new t(Math.min(this.left,e.left),Math.min(this.bottom,e.bottom),Math.max(this.right,e.right),Math.max(this.top,e.top)):this}},{key:"intersection",value:function(e){if(e&&!(e instanceof t))throw new TypeError("rect must be instance of WRect");if(!e)return null;var i=new t(Math.max(this.left,e.left),Math.max(this.bottom,e.bottom),Math.min(this.right,e.right),Math.min(this.top,e.top));return i.width>0&&i.height>0?i:null}},{key:"ceil",value:function(){return new t(Math.floor(this.left),Math.floor(this.bottom),Math.ceil(this.right),Math.ceil(this.top))}},{key:"floor",value:function(){return new t(Math.ceil(this.left),Math.ceil(this.bottom),Math.floor(this.right),Math.floor(this.top))}},{key:"toQuad",value:function(){return new WQuad(this.left,this.bottom,this.right,this.bottom,this.left,this.top,this.right,this.top)}}],[{key:"makeWithSize",value:function(e,i,n,r){return new t(e,i,e+n,i+r)}},{key:"calculateParticleBrushSegmentBounds",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:WMat4.create(),r=Math.abs(i*e.size),o=n.transformPoint([e.x,e.y,0,1]),a=o[0],s=o[1],l=Math.max(e.scaleX,e.scaleY)*e.size,u=Math.cos(e.rotation),h=Math.sin(e.rotation),c=Number.MAX_SAFE_INTEGER,v=0,p=Number.MAX_SAFE_INTEGER,f=0;return[{x:-1,y:-1},{x:1,y:-1},{x:-1,y:1},{x:1,y:1}].forEach(function(t){t.x=t.x*l+e.offsetX,t.y=t.y*l+e.offsetY;var i=u*t.x-h*t.y+a,n=h*t.x+u*t.y+s,o=i-r;c=Math.min(c,o),v=Math.max(v,o),o=i+r,c=Math.min(c,o),v=Math.max(v,o);var d=n-r;p=Math.min(p,d),f=Math.max(f,d),d=n+r,p=Math.min(p,d),f=Math.max(f,d)}),t.makeWithSize(c,p,v-c,f-p)}}]),t}(),WQuad=function(){function t(e,i,n,r,o,a,s,l){_classCallCheck(this,t),Object.defineProperty(this,"data",{value:new Float32Array([e,i,n,r,o,a,s,l])}),Object.defineProperties(this,{x1:{value:this.data[0],enumerable:!0},y1:{value:this.data[1],enumerable:!0},x2:{value:this.data[2],enumerable:!0},y2:{value:this.data[3],enumerable:!0},x3:{value:this.data[4],enumerable:!0},y3:{value:this.data[5],enumerable:!0},x4:{value:this.data[6],enumerable:!0},y4:{value:this.data[7],enumerable:!0}})}return _createClass(t,[{key:"toFloat32Array",value:function(){return this.data}},{key:"transform",value:function(e){if(!(e&&e instanceof WMat4))throw new TypeError("matrix must be instance of WMat4");var i=e.transformPoint([this.x1,this.y1,0,1]),n=e.transformPoint([this.x2,this.y2,0,1]),r=e.transformPoint([this.x3,this.y3,0,1]),o=e.transformPoint([this.x4,this.y4,0,1]);return new t(i[0],i[1],n[0],n[1],r[0],r[1],o[0],o[1])}}]),t}(),WMat4=function(){function t(e){_classCallCheck(this,t),Object.defineProperty(this,"data",{value:new Float32Array(e)})}return _createClass(t,[{key:"toFloat32Array",value:function(){return this.data}},{key:"transpose",value:function(){return new t([this.data[0],this.data[4],this.data[8],this.data[12],this.data[1],this.data[5],this.data[9],this.data[13],this.data[2],this.data[6],this.data[10],this.data[14],this.data[3],this.data[7],this.data[11],this.data[15]])}},{key:"transformPoint",value:function(t){for(var e=new Float32Array(4),i=0;i<4;i++)for(var n=0;n<4;n++)e[i]+=t[n]*this.data[4*i+n];return e}}],[{key:"create",value:function(){return new t([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},{key:"makeOrtho",value:function(e,i,n,r,o,a){var s=[],l=i+e,u=i-e,h=r+n,c=r-n,v=a+o,p=a-o;return s[0]=2/u,s[4]=0,s[8]=0,s[12]=0,s[1]=0/u,s[5]=2/c,s[9]=0,s[13]=0,s[2]=0/u,s[6]=0,s[10]=-2/p,s[14]=0,s[3]=-l/u,s[7]=-h/c,s[11]=-v/p,s[15]=1,new t(new Float32Array(s))}}]),t}(),helper={makeRectFromFlippedRect:function(t){return WRect$1.makeWithSize(t.left,t.top,t.width,t.height)},makeQuadFromFlippedRect:function(t){return WRect$1.makeWithSize(t.left,t.top,t.width,t.height).toQuad()},makeMat4FromMatrix2D:function(t){return new WMat4([t.a,t.c,0,t.tx,t.b,t.d,0,t.ty,0,0,1,0,0,0,0,1])}},Rect=function(){function t(e,i,n,r){_classCallCheck(this,t),Object.defineProperties(this,{left:{value:e,enumerable:!0},top:{value:i,enumerable:!0},right:{value:n,enumerable:!0},bottom:{value:r,enumerable:!0},x:{value:e,enumerable:!0},y:{value:i,enumerable:!0},width:{value:n-e,enumerable:!0},height:{value:r-i,enumerable:!0}})}return _createClass(t,[{key:"union",value:function(e){if(e&&!(e instanceof t))throw new TypeError("rect must be instance of Rect");return e?new t(Math.min(this.left,e.left),Math.min(this.top,e.top),Math.max(this.right,e.right),Math.max(this.bottom,e.bottom)):this}},{key:"intersect",value:function(e){if(!e)return null;if(!(e instanceof t))throw new TypeError("rect must be instance of Rect");var i=new t(Math.max(this.left,e.left),Math.max(this.top,e.top),Math.min(this.right,e.right),Math.min(this.bottom,e.bottom));return i.width>0&&i.height>0?i:null}},{key:"ceil",value:function(){return new t(Math.floor(this.left),Math.floor(this.top),Math.ceil(this.right),Math.ceil(this.bottom))}},{key:"floor",value:function(){return new t(Math.ceil(this.left),Math.ceil(this.top),Math.floor(this.right),Math.floor(this.bottom))}},{key:"contains",value:function(t){return this.left<=t.x&&this.right>=t.x&&this.top<=t.y&&this.bottom>=t.y}},{key:"toPath",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,e=arguments.length>1?arguments[1]:void 0;return{layout:[PathPoint.Property.X,PathPoint.Property.Y],width:t,color:e,ts:0,tf:1,points:[this.left,this.top,this.left,this.top,this.right,this.top,this.right,this.bottom,this.left,this.bottom,this.left,this.top,this.left,this.top]}}},{key:"toWRect",value:function(){return WRect$1.makeWithSize(this.x,this.y,this.width,this.height)}}],[{key:"fromWRect",value:function(e){if(!e)return null;if(!(e instanceof WRect$1))throw new TypeError("rect must be instance of WRect");return new t.makeWithSize(e.left,e.bottom,e.width,e.height)}},{key:"fromPath",value:function(e){if(!e.length)return null;var i={x:e.first[0],y:e.first[1]},n=i.x,r=i.y,o=i.x,a=i.y;return e.forEach(function(t){for(var e=0;e<t.length;e+=2){var i={x:t[e],y:t[e+1]};n=Math.min(n,i.x),o=Math.max(o,i.x),r=Math.min(r,i.y),a=Math.max(a,i.y)}}),t.make(n,r,o,a).ceil()}},{key:"fromSpline",value:function(e,i,n){for(var r,o=e.layout.length,a=e.length/o,s=0;s<a;s++)r=WRect$1.calculateParticleBrushSegmentBounds(e.getPoint(s),i,n).union(r);return t.fromWRect(r).ceil()}},{key:"make",value:function(e,i,n,r){return new t(e,i,n,r)}},{key:"makeWithSize",value:function(e,i,n,r){return new t(e,i,e+n,i+r)}}]),t}(),RectTools={create:function(t,e,i,n){var r={left:t,top:e,width:i,height:n};return r.right=t+i,r.bottom=e+n,r.x=r.left,r.y=r.top,r},create2:function(t,e,i,n){var r={left:t,top:e,right:i,bottom:n};return r.width=i-t,r.height=n-e,r.x=r.left,r.y=r.top,r},fromPath:function(t){if(!t.length)return null;var e={x:t.first[0],y:t.first[1]},i=e.x,n=e.y,r=e.x,o=e.y;return t.forEach(function(t){for(var e=0;e<t.length;e+=2){var a={x:t[e],y:t[e+1]};i=Math.min(i,a.x),r=Math.max(r,a.x),n=Math.min(n,a.y),o=Math.max(o,a.y)}}),this.ceil(this.create2(i,n,r,o))},fromSpline:function(t,e,i){for(var n,r=t.layout.length,o=t.length/r,a=0;a<o;a++)n=WRect$1.calculateParticleBrushSegmentBounds(t.getPoint(a),e,i).union(n);return n=n.ceil(),RectTools.create(n.left,n.bottom,n.width,n.height)},ceil:function(t,e){if(!t)return null;var i=Math.floor(t.left),n=Math.floor(t.top),r=Math.ceil(t.right)-i,o=Math.ceil(t.bottom)-n;return e&&(r+=r%2,o+=o%2),this.create(i,n,r,o)},union:function(t,e){if(!t)return e;if(!e)return t;var i=Math.min(t.left,e.left),n=Math.min(t.top,e.top),r=Math.max(t.right,e.right),o=Math.max(t.bottom,e.bottom);return this.create(i,n,r-i,o-n)},intersect:function(t,e){if(!t||!e)return null;if(t.left<e.right&&t.right>e.left&&t.bottom>e.top&&t.top<e.bottom){var i=Math.max(t.left,e.left),n=Math.max(t.top,e.top),r=Math.min(t.right,e.right),o=Math.min(t.bottom,e.bottom);return this.create(i,n,r-i,o-n)}return null},containsPoint:function(t,e){return t.left<=e.x&&t.right>=e.x&&t.top<=e.y&&t.bottom>=e.y},getPath:function(t){return Module.PathBuilder.createPath([t.left,t.top,t.left,t.top,t.right,t.top,t.right,t.bottom,t.left,t.bottom,t.left,t.top,t.left,t.top],2)}},Color={TRANSPERENT:{red:0,green:0,blue:0,alpha:0},BLACK:{red:0,green:0,blue:0,alpha:1},WHITE:{red:255,green:255,blue:255,alpha:1},RED:{red:255,green:0,blue:0,alpha:1},GREEN:{red:0,green:255,blue:0,alpha:1},BLUE:{red:0,green:0,blue:255,alpha:1},init:function(t){t.ready||(Object.defineProperty(t,"ready",{value:!0}),Object.defineProperty(t,"asRGB",{get:function(){return Color.from(this.red,this.green,this.blue)}}),Object.defineProperty(t,"asHSLA",{get:function(){return Color.toHSLA(this)}}),Object.defineProperty(t,"asHex",{get:function(){return Color.toHex(this)}}),Object.defineProperty(t,"asArray",{get:function(){return Color.toArray(this)}}))},from:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=t;if(t instanceof Array){var o=t;r=o[0],e=o[1],i=o[2],n=o[3]}var a={red:r,green:e,blue:i,alpha:n};return this.init(a),a},is:function(t){return t&&"red"in t&&"green"in t&&"blue"in t},toArray:function(t){return[t.red,t.green,t.blue,t.alpha]},fromHSLA:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;t/=60,e/=100,i/=100;var r=(1-Math.abs(2*i-1))*e,o=r*(1-Math.abs(t%2-1)),a=0,s=0,l=0;t>=0&&t<1?(a=r,s=o):t>=1&&t<2?(a=o,s=r):t>=2&&t<3?(s=r,l=o):t>=3&&t<4?(s=o,l=r):t>=4&&t<5?(a=o,l=r):(a=r,l=o);var u=i-r/2;return a+=u,s+=u,l+=u,Color.from(Math.round(255*a),Math.round(255*s),Math.round(255*l),n)},toHSLA:function(t){var e=t.red/255,i=t.green/255,n=t.blue/255,r=Math.min(e,i,n),o=Math.max(e,i,n),a=0,s=0,l=(o+r)/2;if(o!=r){var u=o-r;switch(s=u/(1-Math.abs(2*l-1)),o){case e:a=(i-n)/u%6;break;case i:a=(n-e)/u+2;break;case n:a=(e-i)/u+4}}return(a*=60)<0&&(a+=360),{hue:parseFloat(a.toFixed(0)),saturation:parseFloat((100*s).toFixed(2)),lightness:parseFloat((100*l).toFixed(2)),alpha:t.alpha}},fromHex:function(t){return t=t.substring(1),Color.from(parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16))},toHex:function(t){return"#"+t.red.toString(16).pad(2,"0")+t.green.toString(16).pad(2,"0")+t.blue.toString(16).pad(2,"0")},random:function(t){return Color.from(Math.randomInt(0,255),Math.randomInt(0,255),Math.randomInt(0,255),t?Math.random():1)}};!function(){for(var t in Color)"object"==_typeof(Color[t])&&Color.init(Color[t])}();var Scalar$1={METER:{METER:1,CENTIMETER:100,MILLIMETER:1e3,MICROMETER:1e6,INCH:39.3700787402,POINT:2834.6456692913,PICA:236.2204724409,DIP:3779.5275590592},CENTIMETER:{METER:.01,CENTIMETER:1,MILLIMETER:10,MICROMETER:1e4,INCH:.3937007874,POINT:28.3464566929,PICA:2.3622047244,DIP:.3937007874*96},MILLIMETER:{METER:.001,CENTIMETER:.1,MILLIMETER:1,MICROMETER:1e3,INCH:.0393700787,POINT:2.8346456693,PICA:.2362204724,DIP:.0393700787*96},MICROMETER:{METER:1e-6,CENTIMETER:1e-4,MILLIMETER:.001,MICROMETER:1,INCH:393701e-10,POINT:.0028346457,PICA:.0002362205,DIP:393701e-10*96},INCH:{METER:.0254,CENTIMETER:2.54,MILLIMETER:25.4,MICROMETER:25400,INCH:1,POINT:72,PICA:6,DIP:96},POINT:{METER:.0003527778,CENTIMETER:.0352777778,MILLIMETER:.3527777778,MICROMETER:352.7777777778,INCH:.0138888889,POINT:1,PICA:.0833333333,DIP:1.3333333344},PICA:{METER:.0042333333,CENTIMETER:.4233333333,MILLIMETER:4.2333333333,MICROMETER:4233.3333333333,INCH:.1666666667,POINT:12,PICA:1,DIP:16.0000000032},DIP:{METER:.0254/96,CENTIMETER:2.54/96,MILLIMETER:25.4/96,MICROMETER:25400/96,INCH:1/96,POINT:.75,PICA:6/96,DIP:1},SECOND:{SECOND:1,MILLISECOND:1e3,NANOSECOND:1e9},MILLISECOND:{SECOND:.001,MILLISECOND:1,NANOSECOND:1e6},NANOSECOND:{SECOND:1e-9,MILLISECOND:1e-6,NANOSECOND:1},RADIAN:{RADIAN:1,DEGREE:57.2957795},DEGREE:{RADIAN:.0174532925,DEGREE:1},NEWTON:{NEWTON:1}};Function.createEnum.call(Scalar$1,"Unit",["DEVICE_POINT","METER","CENTIMETER","MILLIMETER","MICROMETER","INCH","POINT","PICA","DIP","SECOND","MILLISECOND","NANOSECOND","RADIAN","DEGREE","NEWTON","NORMALIZED","LOGICAL_VALUE"]),Function.createEnum.call(Scalar$1,"Metric",["LENGTH","TIME","FORCE","ANGLE","NORMALIZED","LOGICAL_VALUE"]);var SensorMetric=Object.freeze({LENGTH:Scalar$1.Unit.METER,TIME:Scalar$1.Unit.SECOND,FORCE:Scalar$1.Unit.NEWTON,ANGLE:Scalar$1.Unit.RADIAN,NORMALIZED:Scalar$1.Unit.NORMALIZED,LOGICAL_VALUE:Scalar$1.Unit.LOGICAL_VALUE});Scalar$1.getChannelResolution=function(t,e){var i=1;return t?t!=Scalar$1.Metric.NORMALIZED&&t!=Scalar$1.Metric.LOGICAL_VALUE&&(i=Scalar$1[SensorMetric[t.name].name][e.name]):console.warn("Ink sensor channel metric is not defined"),i},Scalar$1.convert=function(t,e,i,n){return e?i/e*Scalar$1[SensorMetric[t.name].name][n.name]:i},Scalar$1.convertAny=function(t,e,i,n){return t/n*Scalar$1[e.name][i.name]},Scalar$1.convertValue=function(t,e,i){return t/Scalar$1[e.name][i.name]},Object.freeze(Scalar$1),"undefined"!=typeof self?self.Scalar=Scalar$1:window.Scalar=Scalar$1;var InkSensorChannel=function(){function t(e,i,n,r,o,a){_classCallCheck(this,t),this.id=e,this.type=i,this.metric=n,this.min=r,this.max=o,this.resolution=a,this.type==t.Type.TIMESTAMP?this.dataType=t.DataType.UINT64:this.type!=t.Type.CUSTOM&&(this.dataType=t.DataType.FLOAT32)}return _createClass(t,null,[{key:"createDefaultInstance",value:function(e,i){var n,r,o,a,s=t.Type[i];switch(s){case t.Type.X:case t.Type.Y:case t.Type.Z:case t.Type.RADIUS_X:case t.Type.RADIUS_Y:n=t.Metric.LENGTH,r=Scalar$1.Unit.DIP;break;case t.Type.TIMESTAMP:n=t.Metric.TIME,r=Scalar$1.Unit.MILLISECOND;break;case t.Type.PRESSURE:n=t.Metric.NORMALIZED,r=Scalar$1.Unit.NORMALIZED,o=0,a=1;break;case t.Type.ALTITUDE:case t.Type.AZIMUTH:case t.Type.ROTATION:n=t.Metric.ANGLE,r=Scalar$1.Unit.RADIAN,o=0,a=2*Math.PI;break;default:console.error("createDefaultInstance fails with type:",i)}var l=new t(e,s,n,o,a,Scalar$1.getChannelResolution(n,r));return l.unit=r,l}}]),t}();InkSensorChannel.defaults={pen:["X","Y","TIMESTAMP","PRESSURE","ALTITUDE","AZIMUTH","ROTATION"],touch:["X","Y","TIMESTAMP","PRESSURE","RADIUS_X","RADIUS_Y","ROTATION"],mouse:["X","Y","TIMESTAMP"]},InkSensorChannel.createEnum("Type",["X","Y","Z","TIMESTAMP","PRESSURE","RADIUS_X","RADIUS_Y","ALTITUDE","AZIMUTH","ROTATION","CUSTOM"]),InkSensorChannel.createEnum("DataType",["FLOAT32","FLOAT64","INT32","INT64","UINT32","UINT64","BOOLEAN"]),InkSensorChannel.Metric=Scalar$1.Metric;var InkSensorChannelGroup=function(){function t(e,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];_classCallCheck(this,t),this.id=e,this.samplingRate=i,this.latency=n,this.channels=r,this.default=r.filter(function(t){return t.type==InkSensorChannel.Type.X||t.type==InkSensorChannel.Type.Y}).length>0}return _createClass(t,[{key:"add",value:function(t){t.type!=InkSensorChannel.Type.X&&t.type!=InkSensorChannel.Type.Y||(this.default=!0),this.channels.push(t)}},{key:"getChannel",value:function(t){return this.channels.filter(function(e){return e.id==t}).first}},{key:"getChannelByType",value:function(t,e){if(t==InkSensorChannel.Type.CUSTOM){if(!e)throw new Error("name argument is required for CUSTOM channels");return this.channels.filter(function(i){return i.type==t&&i.name==e}).first}return this.channels.filter(function(e){return e.type==t}).first}}]),t}(),utils={uuid:function(){var t=Date.now(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)});return e},longToByteArray:function(t){for(var e=[0,0,0,0,0,0,0,0],i=0;i<e.length;i++){var n=255&t;e[i]=n,t=(t-n)/256}return e},byteArrayToLong:function(t){for(var e=0,i=t.length-1;i>=0;i--)e=256*e+t[i];return e},getPropName:function(t){for(var e=t.split("_"),i=e.first.toLowerCase(),n=1;n<e.length;n++)i+=e[n].substring(0,1),i+=e[n].substring(1).toLowerCase();return i},getEnumValueName:function(t){for(var e="",i=0;i<t.length;i++)t[i]!=t[i].toLowerCase()&&(e+="_"),e+=t[i];return e.toUpperCase()}},InkDeviceContext=function(){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];_classCallCheck(this,t),this.deviceID=e,this.semantics=n,Object.defineProperty(this,"id",{get:function(){return i||(i=utils.uuid()),i},set:function(t){i=t},enumerable:!0})}return _createClass(t,[{key:"equals",value:function(t){return this.deviceID==t.deviceID}}]),t}(),InkDeviceContextProvider={contexts:{},feed:function(t){var e=this;t.forEach(function(t){return e.add(t)})},contains:function(t){return deviceContexts.filter(function(e){return t.equals(e)}).length>0},add:function(t){this.contexts[t.deviceID]||(this.contexts[t.deviceID]=[]);var e=this.contexts[t.deviceID],i=e.filter(function(e){return t.equals(e)});0==i.length?e.push(t):i=i.filter(function(e){return t.id==e.id})},get:function(t){this.contexts[t]||(this.contexts[t]=[]);var e=this.contexts[t],i=new InkDeviceContext(t),n=e.filter(function(t){return t.equals(i)}).first;return n||(n=new InkDeviceContext(t),e.push(n)),n},all:function(){var t;return(t=[]).concat.apply(t,_toConsumableArray(Object.values(this.contexts)))}},InkDevice=function(){function t(e,i,n,r,o){_classCallCheck(this,t),this.id=e,this.manufacturer=i,this.model=n,this.serialNumber=r,this.manufacturerID=o,this.channelGroups=[],this.context=InkDeviceContextProvider.get(e)}return _createClass(t,[{key:"addGroup",value:function(t){this.channelGroups.push(t)}},{key:"getDefaultGroup",value:function(){return this.channelGroups.filter(function(t){return t.default}).first}},{key:"getGroup",value:function(t){return this.channelGroups.filter(function(e){return e.id==t}).first}},{key:"getGroupByChannelID",value:function(t){return this.channelGroups.filter(function(e){return e.getChannel(t)}).first}}],[{key:"createDefaultInstance",value:function(e){var i=new t(e),n=InkSensorChannel.defaults[e].map(function(t){return InkSensorChannel.createDefaultInstance(t.toLowerCase(),t)}),r=new InkSensorChannelGroup("XY",void 0,void 0,n);i.default=!0,i.addGroup(r);var o=["TIMESTAMP","RADIUS_X"].map(function(t){var e=InkSensorChannel.createDefaultInstance(t.toLowerCase(),t);return e.id=utils.uuid(),e}),a=new InkSensorChannel("custom",InkSensorChannel.Type.CUSTOM,InkSensorChannel.Metric.LENGTH,void 0,void 0,Scalar.getChannelResolution(InkSensorChannel.Metric.LENGTH,Scalar.Unit.DIP));a.name="radiusCustom",a.dataType=InkSensorChannel.DataType.FLOAT32,o.push(a);var s=new InkSensorChannelGroup("G2",void 0,void 0,o);return i.addGroup(s),i}}]),t}();InkDevice.defaults={pen:InkDevice.createDefaultInstance("pen"),mouse:InkDevice.createDefaultInstance("mouse"),touch:InkDevice.createDefaultInstance("touch")};var SensorDataContext=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];_classCallCheck(this,t),this.id=utils.uuid(),this.inkState=t.InkState.PLANE,this.device=e,this.sensorDataByGroup=i}return _createClass(t,[{key:"add",value:function(t){this.sensorDataByGroup.push(t),t.default&&(this.default=t)}}]),t}();SensorDataContext.createEnum("InkState",["PLANE","HOVERING","IN_VOLUME","VOLUME_HOVERING","START_TRACKING","STOP_TRACKING"]);var SensorData=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];_classCallCheck(this,t),this.groupID=e,this.channels=i,this.path=n,this.layout=i.map(function(t){return t.type}),Object.defineProperty(this,"stride",{value:this.layout.length,enumerable:!0}),Object.defineProperty(this,"length",{get:function(){return this.path.length/this.stride},enumerable:!0})}return _createClass(t,[{key:"add",value:function(t){var e=this;this.channels.forEach(function(i){var n=i.type==InkSensorChannel.Type.CUSTOM?i.name:utils.getPropName(i.type.name),r=t[n];e.path.push(r)})}},{key:"getPoint",value:function(t){for(var e={x:1/0,y:1/0,z:NaN,timestamp:1/0,force:NaN,radiusX:NaN,radiusY:NaN,altitude:NaN,azimuth:NaN,rotation:NaN},i=0;i<this.stride;i++){var n=this.channels[i],r=n.type==InkSensorChannel.Type.CUSTOM?n.name:utils.getPropName(n.type.name),o=t*this.stride;e[r]=this.path[o+i]}return e}}],[{key:"createPoint",value:function(t,e,i){var n={x:e||t.offsetX||t.clientX,y:i||t.offsetY||t.clientY,z:void 0,timestamp:Date.now(),force:NaN,radius:void 0,radiusX:void 0,radiusY:void 0,tiltX:void 0,tiltY:void 0,altitude:void 0,azimuth:void 0,rotation:void 0},r={id:void 0,type:void 0,button:void 0,buttons:void 0};if(Object.defineProperty(n,"pointer",{value:r,enumerable:!0}),Object.defineProperty(n,"pressure",{get:function(){return this.force},enumerable:!0}),t instanceof PointerEvent)if(r.id=t.pointerId,r.type=t.pointerType,"pen"!=t.pointerType&&"mouse"!=t.pointerType||(r.button=t.button,r.buttons=t.buttons),"pen"!=t.pointerType&&"touch"!=t.pointerType||(n.rotation=Math.toRadians(t.twist)),"pen"==t.pointerType){n.force=t.pressure,n.tiltX=Math.toRadians(t.tiltX),n.tiltY=Math.toRadians(t.tiltY);var o=Math.tan(n.tiltX),a=Math.tan(n.tiltY),s=Math.sqrt(o*o+a*a);n.altitude=Math.atan2(1,s),n.azimuth=Math.atan2(a,o)}else"touch"==t.pointerType&&t.pressure>0&&(n.force=t.pressure);else if(t instanceof MouseEvent)r.id=1,r.type="mouse",r.button=t.button,r.buttons=t.buttons;else{if(!(t instanceof Touch))throw t instanceof TouchEvent?new Error("TouchEvent have multiple touches. Please provide touch."):new Error("Unexpected event detected: ".concat(t.constructor.name,". Expected event should instance of PointerEvent, MouseEvent or Touch."));r.id=t.identifier,r.type="touch",t.force>0&&(n.force=t.force),isNaN(t.radiusX)||isNaN(t.radiusY)||(n.radiusX=t.radiusX,n.radiusY=t.radiusY,n.radius=Math.max(t.radiusX,t.radiusY)),isNaN(t.rotationAngle)||(n.rotation=Math.toRadians(t.rotationAngle))}return n}}]),t}();function loadImage(t){return t instanceof Uint8Array?createImageBitmap(new Blob([t],{type:"image/png"})):t instanceof Blob?createImageBitmap(t):fetch(t,{mode:"no-cors"}).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t)})}SensorData.prototype.pointAt=SensorData.prototype.getPoint;var GLTools={createTexture:function(t,e,i){e||(e=t.CLAMP_TO_EDGE),i||(i=t.NEAREST);var n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i),t.bindTexture(t.TEXTURE_2D,null),n},fillTexture:function(t,e,i){return new Promise(function(n,r){if(Array.isArray(i)){var o=[],a=i,s=Promise.resolve();a.forEach(function(t){s=s.then(function(){return loadImage(t).then(function(t){return o.push(t)})})}),s.then(function(){return GLTools.completeMipMap(o)}).then(function(){e.mipmap=o,GLTools.initTexture(t,e),n(e)}).catch(r)}else{loadImage(i).then(function(i){e.image=i,GLTools.initTexture(t,e),n(e)}).catch(console.error)}})},completeMipMap:function(t){return t.sort(function(t,e){return e.width-t.width}),new Promise(function(e,i){if(1!=t.last.width){for(var n=Promise.resolve(),r=t.last.width;r>1;)r/=2,n=n.then(function(){var e=new OffscreenCanvas(t.last.width/2,t.last.height/2);return e.getContext("2d").drawImage(t.last,0,0,e.width,e.height),createImageBitmap(e)}).then(function(e){return t.push(e)});n.then(e)}else e()})},initTexture:function(t,e){if(t.bindTexture(t.TEXTURE_2D,e),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.mipmap){for(var i=0;i<e.mipmap.length;i++)t.texImage2D(t.TEXTURE_2D,i,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.mipmap[i]);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR)}else t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.image);t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.bindTexture(t.TEXTURE_2D,null),this.logGLError(t,e.name)},readTexturePixels:function(t,e,i){var n=new Uint8Array(i.width*i.height*4),r=t.createFramebuffer();return t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),t.readPixels(i.left,i.top,i.width,i.height,t.RGBA,t.UNSIGNED_BYTE,n),t.deleteFramebuffer(r),n},logGLError:function(t,e){var i=t.getError();i>0&&console.error("WebGL error - "+e+": "+i)}},InkGLContext=function(){function t(e){if(_classCallCheck(this,t),!e)throw new Error("GL context is not available in current environment");this.gl=e,this.currentProgram=null,this.programs=[]}return _createClass(t,[{key:"init",value:function(e,i){this.gl.disable(this.gl.DITHER),this.gl.disable(this.gl.BLEND),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.activeTexture(this.gl.TEXTURE0),this.bUseStencilBufferForBlending=!1,this.currentBlendMode=t.BlendMode.NONE,this.resize(e,i),this.scatterMethodRandomSeed=parseInt(Date.now()/1e3),this.blendMinMaxExt=this.gl.getExtension("EXT_blend_minmax"),this.genStaticVBOs(),this.onChange();for(var n=0;n<this.programs.length;n++)this.programs[n].init()}},{key:"random",value:function(){return this.scatterMethodRandomSeed=1103515245*this.scatterMethodRandomSeed+12345&2147483647,this.scatterMethodRandomSeed/2147483647}},{key:"setUniforms",value:function(t){var e=null;this._scaleVectorAbs=new Float32Array([this.bounds.width/this.graphicsBox.width,this.bounds.height/this.graphicsBox.height]),e=t?WMat4.makeOrtho(this.graphicsBox.left,this.graphicsBox.right,this.graphicsBox.top,this.graphicsBox.bottom,1,-1):WMat4.makeOrtho(this.graphicsBox.left,this.graphicsBox.right,this.graphicsBox.bottom,this.graphicsBox.top,1,-1),this._graphicsSpaceToFramebufferSpaceT=e.transpose(),this.onChange()}},{key:"resize",value:function(t,e){this.textureWidth=parseInt(Math.ceil(t.width)),this.textureHeight=parseInt(Math.ceil(t.height)),this.gl.viewport(t.x,t.y,t.width,t.height),this.bounds=t,this.graphicsBox=e,this._clipRect=this.graphicsBox}},{key:"genStaticVBOs",value:function(){this.fullScreenQuad2dBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.fullScreenQuad2dBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),this.gl.STATIC_DRAW);for(var t=[],e=0;e<=1024;e++)t.push(e,1,1),t.push(e,-1,1);for(var i=0;i<=1024;i++)t.push(i,1,1),t.push(i,1,0);for(var n=0;n<=1024;n++)t.push(n,-1,1),t.push(n,-1,0);this.strokeSegmentBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.strokeSegmentBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),t=[-1,1];for(var r=0;r<=1024;r++)t.push(r,1);for(var o=0;o<=1024;o++)t.push(o,1),t.push(o,0);this.circleBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.circleBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.destBuffer=this.gl.createBuffer(),this.srcBuffer=this.gl.createBuffer(),this.vertsBuffer=this.gl.createBuffer(),this.colorsBuffer=this.gl.createBuffer()}},{key:"blendMode",value:function(e){if(e!=this.currentBlendMode){switch(e){case t.BlendMode.NONE:this.gl.disable(this.gl.BLEND);break;case t.BlendMode.NORMAL:this.gl.enable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA);break;case t.BlendMode.NORMAL_REVERSE:this.gl.enable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.ONE_MINUS_DST_ALPHA,this.gl.ONE);break;case t.BlendMode.ERASE:this.gl.enable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.ZERO,this.gl.ONE_MINUS_SRC_ALPHA);break;case t.BlendMode.MAX:this.gl.enable(this.gl.BLEND),this.blendMinMaxExt?this.gl.blendEquation(this.blendMinMaxExt.MAX_EXT):(this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA));break;case t.BlendMode.MIN:this.gl.enable(this.gl.BLEND),this.blendMinMaxExt?this.gl.blendEquation(this.blendMinMaxExt.MIN_EXT):(this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA));break;case t.BlendMode.ADD:this.gl.enable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.ONE,this.gl.ONE);break;case t.BlendMode.SUBSTRACT:this.gl.enable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_SUBTRACT),this.gl.blendFunc(this.gl.ONE,this.gl.ONE);break;case t.BlendMode.SUBSTRACT_REVERSE:this.gl.enable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_REVERSE_SUBTRACT),this.gl.blendFunc(this.gl.ONE,this.gl.ONE);break;case t.BlendMode.MULTIPLY_NO_ALPHA:this.gl.enable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.ZERO,this.gl.SRC_COLOR);break;case t.BlendMode.MULTIPLY_NO_ALPHA_INVERT:this.gl.enable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.ZERO,this.gl.ONE_MINUS_SRC_COLOR)}this.currentBlendMode=e}}},{key:"clearColorbuffer",value:function(t){this.gl.clearColor(t.red*t.alpha/255,t.green*t.alpha/255,t.blue*t.alpha/255,t.alpha),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}},{key:"scissors",value:function(t){if(t&&!(t instanceof WRect$1))throw new TypeError("rect must be undefined or instanceof WRect");var e=this.gl.isEnabled(this.gl.SCISSOR_TEST);t?(e||this.gl.enable(this.gl.SCISSOR_TEST),this.gl.scissor(t.x,t.y,t.width,t.height)):e&&this.gl.disable(this.gl.SCISSOR_TEST)}},{key:"isProgramActive",value:function(t){return this.currentProgram==t}},{key:"activateProgram",value:function(t){this.isProgramActive(t)?t.contextChanged&&(t.onContextChange(),t.contextChanged=!1):(this.currentProgram&&this.currentProgram.onDeactivate(),this.gl.useProgram(t.program),this.currentProgram=t,t.onActivate(),t.onContextChange(),t.contextChanged=!1)}},{key:"generateBuffersExt",value:function(t,e,i,n){var r=this.gl,o=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,o);var a=r.createTexture();return r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,e,0,r.RGBA,n,null),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),{framebuffer:o,colorTexture:a}}},{key:"genFrameAndRenders",value:function(t,e,i){var n=this.gl.createFramebuffer(),r=this.gl.createRenderbuffer();return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,n),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,r),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,t,e,i),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.RENDERBUFFER,r),{framebuffer:n,renderbuffer:r}}},{key:"deleteBuffers",value:function(t,e){e&&this.gl.deleteTexture(e),t&&this.gl.deleteFramebuffer(t)}},{key:"deleteFrameAndRender",value:function(t,e){e&&this.gl.deleteRenderbuffer(e),t&&this.gl.deleteFramebuffer(t)}},{key:"onChange",value:function(){for(var t=0;t<this.programs.length;t++)this.programs[t].contextChanged=!0}},{key:"isStencilBufferAvailable",value:function(){return this.gl.getFramebufferAttachmentParameter(this.gl.FRAMEBUFFER,this.gl.STENCIL_ATTACHMENT,this.gl.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE)==this.gl.RENDERBUFFER}},{key:"enableStencilBufferForBlending",value:function(){this.bUseStencilBufferForBlending=!0,this.gl.enable(this.gl.STENCIL_TEST),this.gl.stencilMask(4294967295),this.gl.clearStencil(0),this.gl.clear(this.gl.STENCIL_BUFFER_BIT)}},{key:"disableStencilBufferForBlending",value:function(){this.bUseStencilBufferForBlending=!1}},{key:"shouldUseStencilBufferForBlending",value:function(){return this.bUseStencilBufferForBlending}},{key:"drawArrays",value:function(e,i,n){this.currentBlendMode!=t.BlendMode.MAX||this.blendMinMaxExt?this.gl.drawArrays(e,i,n):(this.shouldUseStencilBufferForBlending()&&(this.gl.enable(this.gl.STENCIL_TEST),this.gl.stencilFunc(this.gl.NOTEQUAL,1,1),this.gl.stencilOp(this.gl.REPLACE,this.gl.REPLACE,this.gl.REPLACE)),this.gl.blendFunc(this.gl.ONE,this.gl.ONE),this.gl.blendEquation(this.gl.FUNC_REVERSE_SUBTRACT),this.gl.drawArrays(e,i,n),this.shouldUseStencilBufferForBlending()&&(this.gl.stencilFunc(this.gl.NOTEQUAL,2,1),this.gl.stencilOp(this.gl.REPLACE,this.gl.REPLACE,this.gl.REPLACE)),this.gl.blendFunc(this.gl.ONE,this.gl.ONE),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.drawArrays(e,i,n),this.shouldUseStencilBufferForBlending()&&this.gl.disable(this.gl.STENCIL_TEST))}}],[{key:"random",value:function(t){return(1103515245*t+12345&2147483647)/2147483647}}]),t}();InkGLContext.createEnum("BlendMode",["NORMAL","NORMAL_REVERSE","ERASE","NONE","MAX","MIN","ADD","SUBSTRACT","SUBSTRACT_REVERSE","MULTIPLY_NO_ALPHA","MULTIPLY_NO_ALPHA_INVERT"]);var InkLayer=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(_classCallCheck(this,t),this.inkGLContext=e,this.gl=e.gl,this.scaleFactor=i.scaleFactor||1,this.flipY=!!i.flipY,this.ownGLResources=!(!(i.framebuffer||i.renderbuffer||i.texture)||!i.ownGLResources),this.useTextureStorage=!1,i.renderbuffer){if(!i.framebuffer)throw new Error("`framebuffer` is required when `renderbuffer` available");var r=this.initWithGLBuffers(i.framebuffer,i.renderbuffer);this.setDimensions(r.width,r.height),this.flipY=!0}else if(i.framebuffer){var o=this.initWithGLFramebuffer(i.framebuffer);this.setDimensions(o.width,o.height),this.flipY=!0}else if(i.texture){if(!(i.texture instanceof WebGLTexture))throw new Error("`texture` is not instance of WebGLTexture");var a;if(this.texture=i.texture,this.useTextureStorage=!0,i.width>0&&i.height>0)a={width:i.width,height:i.height};else{if(!this.texture.image)throw new Error("`width` and `height` are required when `texture` is available");a={width:this.texture.image.width,height:this.texture.image.height}}this.setDimensions(a.width,a.height)}else{var s=i.width||n.width,l=i.height||n.height;if(!s)throw new Error("width is required");if(!l)throw new Error("height is required");if(this.setDimensions(s,l),i.display)this.framebuffer=null,this.renderbuffer=null,this.colorTexture=null;else if(this.useTextureStorage=!i.useBuffersStorage,this.useTextureStorage){var u=this.inkGLContext.generateBuffersExt(this.storageWidth,this.storageHeight,this.gl.LINEAR,this.gl.UNSIGNED_BYTE);this.framebuffer=u.framebuffer,this.colorTexture=u.colorTexture}else{var h=this.inkGLContext.genFrameAndRenders(this.gl.RGBA8||this.gl.RGBA4,this.storageWidth,this.storageHeight);this.framebuffer=h.framebuffer,this.renderbuffer=h.renderbuffer}}this.releaseRenderbuffer=!1,this.deleted=!1}return _createClass(t,[{key:"initWithGLFramebuffer",value:function(t){if(!(t instanceof WebGLFramebuffer))throw new Error("`framebuffer` is not instance of WebGLFramebuffer");var e,i=this.gl.getParameter(this.gl.RENDERBUFFER_BINDING);if(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.gl.getError()==this.gl.INVALID_OPERATION)throw new Error("Invalid framebuffer");if(this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER)!=this.gl.FRAMEBUFFER_COMPLETE)throw new Error("Incomplete framebuffer");if(this.gl.getFramebufferAttachmentParameter(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE)!=this.gl.RENDERBUFFER)throw new Error("Renderbuffer attachment not found");return e=this.gl.getFramebufferAttachmentParameter(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,i),this.initWithGLBuffers(t,e)}},{key:"initWithGLBuffers",value:function(t,e){if(!(t instanceof WebGLFramebuffer))throw new Error("`framebuffer` is not instance of WebGLFramebuffer");if(!(e instanceof WebGLRenderbuffer))throw new Error("`renderbuffer` is not instance of WebGLRenderbuffer");var i=this.gl.getParameter(this.gl.RENDERBUFFER_BINDING);this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,e);var n=this.gl.getRenderbufferParameter(this.gl.RENDERBUFFER,this.gl.RENDERBUFFER_WIDTH),r=this.gl.getRenderbufferParameter(this.gl.RENDERBUFFER,this.gl.RENDERBUFFER_HEIGHT);return this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,i),this.framebuffer=options.framebuffer,this.renderbuffer=options.renderbuffer,{width:n,height:r}}},{key:"setDimensions",value:function(t,e){var i=Math.ceil(t*this.scaleFactor),n=Math.ceil(e*this.scaleFactor),r=WRect$1.makeWithSize(0,0,t,e),o=WRect$1.makeWithSize(0,0,i,n),a=r.toQuad();Object.defineProperties(this,{width:{value:t,enumerable:!0,configurable:!0},height:{value:e,enumerable:!0,configurable:!0},storageWidth:{value:i,enumerable:!0,configurable:!0},storageHeight:{value:n,enumerable:!0,configurable:!0},graphicsBounds:{value:r,enumerable:!0,configurable:!0},storageBounds:{value:o,enumerable:!0,configurable:!0},boundsQuad:{value:a,enumerable:!0,configurable:!0}})}},{key:"resize",value:function(t,e){t>0&&e>0&&(this.width!=t||this.height!=e)&&(this.setDimensions(t,e),this.useTextureStorage?(this.gl.bindTexture(this.gl.TEXTURE_2D,this.colorTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.storageWidth,this.storageHeight,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null)):this.renderbuffer&&(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.renderbuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.RGBA8||this.gl.RGBA4,this.storageWidth,this.storageHeight)))}},{key:"delete",value:function(){this.ownGLResources&&(this.useTextureStorage?this.inkGLContext.deleteBuffers(this.framebuffer,this.colorTexture):this.inkGLContext.deleteFrameAndRender(this.framebuffer,this.renderbuffer)),this.releaseRenderbuffer&&this.renderbuffer&&(this.gl.deleteRenderbuffer(this.renderbuffer),this.renderbuffer=null,this.releaseRenderbuffer=!1),this.deleted=!0}},{key:"deleteLater",value:function(){var t=this;setTimeout(function(){return t.delete()},0)}},{key:"isDeleted",value:function(){return this.deleted}}]),t}(),StrokeDrawContext=function(){function t(){_classCallCheck(this,t),this.randomSeed=Date.now()}return _createClass(t,[{key:"copyTo",value:function(t){t.randomSeed=this.randomSeed}}]),t}(),ParticleBrush=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.RotationMode.NONE,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{x:0,y:0};_classCallCheck(this,t),this.spacing=e,this.scattering=i,this.rotationMode=n,this.shape=r,this.fill=o,this.fillTextureSize={width:0,height:0},this.fillTextureOffset=s,this.randomizeFill=a}return _createClass(t,[{key:"configure",value:function(t){return t instanceof WebGLRenderingContext||t instanceof WebGL2RenderingContext?(this.ctx=t,Promise.all([this.configureShape(),this.configureFill()])):Promise.reject("ctx is not instance of WebGLRenderingContext or WebGL2RenderingContext")}},{key:"configureShape",value:function(){return this.shapeTexture?Promise.resolve():(this.shapeTexture=GLTools.createTexture(this.ctx,this.ctx.CLAMP_TO_EDGE,this.ctx.LINEAR),GLTools.fillTexture(this.ctx,this.shapeTexture,this.shape))}},{key:"configureFill",value:function(){var t=this;return this.fillTexture?Promise.resolve():(this.fillTexture=GLTools.createTexture(this.ctx,this.ctx.REPEAT,this.ctx.NEAREST),GLTools.fillTexture(this.ctx,this.fillTexture,this.fill).then(function(e){0==t.fillTextureSize.width&&(t.fillTextureSize.width=e.image.width),0==t.fillTextureSize.height&&(t.fillTextureSize.height=e.image.height)}))}}]),t}();ParticleBrush.createEnum("RotationMode",["NONE","RANDOM","TRAJECTORY"]);var PolygonBrush=function(){function t(e,i){_classCallCheck(this,t),this.id=i,this.polygon=e}return _createClass(t,null,[{key:"createCircle",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=0,i=[];e<360;){var n=0+.5*Math.cos(e),r=0+.5*Math.sin(e);i.push(n),i.push(r),e+=t}return i.toFloat32Array()}}]),t}(),StrokeBrush=function(){function t(e,i){_classCallCheck(this,t);var n=e.type;n||(n=i||e.randomSeed?t.Type.PARTICLE:t.Type.POLYGON),Object.defineProperty(this,"type",{value:n,enumerable:!0}),n!=t.Type.UNKNOWN&&(Object.defineProperty(this,"id",{value:e.id,enumerable:!0}),n==t.Type.PARTICLE?(Object.defineProperty(this,"randomSeed",{value:i||e.randomSeed,enumerable:!0}),Object.defineProperty(this,"scattering",{value:e.scattering,enumerable:!0}),Object.defineProperty(this,"spacing",{value:e.spacing,enumerable:!0})):Object.defineProperty(this,"polygon",{value:e.polygon,enumerable:!0}))}return _createClass(t,[{key:"toJSON",value:function(){var e={type:this.type.name};return this.type==t.Type.PARTICLE?e=Object.assign(e,{randomSeed:this.randomSeed,scattering:this.scattering,spacing:this.spacing}):this.type==t.Type.POLYGON&&(e=Object.assign(e,{polygon:data.polygon})),e}}],[{key:"from",value:function(e,i){if(e instanceof t)return e;if(e instanceof PolygonBrush)return new t({id:e.id,polygon:e.polygon.toArray().toFloat32Array()});if(e instanceof ParticleBrush){if(!i)throw new Error("randomSeed is required");return new t({id:e.id,randomSeed:i,spacing:e.spacing,scattering:e.scattering})}return e?new t(e,i):new t({type:t.Type.UNKNOWN})}}]),t}();StrokeBrush.createEnum("Type",["UNKNOWN","POLYGON","PARTICLE"]);var SensorDataCollector=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"add",value:function(t){this.sensorData.add(t)}},{key:"reset",value:function(t,e){var i=t.device.getDefaultGroup(),n=["pointer","force","tiltX","tiltY"],r=[];Object.keys(e).forEach(function(o){if(!n.includes(o)&&!isNaN(e[o])){var a=utils.getEnumValueName(o),s=InkSensorChannel.Type[a],l=s?i.getChannelByType(s):i.getChannelByType(InkSensorChannel.Type.CUSTOM,o);if(!l)throw s?new Error("Channel definition for "+s.name+" not found in device with id "+t.device.id+" under group with id "+i.id):new Error("Channel definition for custom channel with name "+o+" not found in device with id "+t.device.id+" under group with id "+i.id);r.push(l)}}),this.sensorData=new SensorData(i.id,r),this.sensorData.default=!0,t.add(this.sensorData)}}]),t}(),InkBuilder$1=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,e),t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,i)),i.collectSensorData&&(t.sensorDataCollector=new SensorDataCollector),t}return _inherits(e,t),_createClass(e,[{key:"add",value:function(t,i,n){if(this.sensorDataCollector){if(t==e.Phase.BEGIN){var r=this.device||InkDevice.defaults[i.pointer.type];this.sensorDataContext=new SensorDataContext(r),this.sensorDataCollector.reset(this.sensorDataContext,i)}this.sensorDataCollector.add(i)}_get(_getPrototypeOf(e.prototype),"add",this).call(this,t,i,n)}}],[{key:"createSensorPoint",value:function(t,e,i){return SensorData.createPoint(t,e,i)}}]),e}(InkBuilder),InterpolatedSplinerKT=DigitalInk.com.wacom.digitalink.InterpolatedSpline,PathPoint$1=DigitalInk.com.wacom.digitalink.PathPoint,InterpolatedSpline$1=function(){function t(e){_classCallCheck(this,t),this.spline=e,Object.defineProperty(this,"layout",{get:function(){return this.spline.layout}}),Object.defineProperty(this,"length",{get:function(){return this.spline.path.length}}),Object.defineProperty(this,"width",{get:function(){return this.spline.defaultWidth}}),Object.defineProperty(this,"color",{get:function(){return this.spline.defaultColor},set:function(t){this.spline.defaultColor=t}}),Object.defineProperty(this,"ts",{get:function(){return this.spline.ts}}),Object.defineProperty(this,"tf",{get:function(){return this.spline.tf}})}return _createClass(t,[{key:"getPoint",value:function(t){for(var e={x:1/0,y:1/0,z:NaN,size:NaN,red:NaN,green:NaN,blue:NaN,alpha:NaN,rotation:0,scaleX:1,scaleY:1,scaleZ:1,offsetX:0,offsetY:0,offsetZ:0},i=this.layout.length,n=0;n<i;n++){var r=t*i;e[utils.getPropName(this.layout[n].name)]=this.at(r+n)}return isNaN(e.size)&&(e.size=this.width),isNaN(e.red)&&(e.red=this.color.red),isNaN(e.green)&&(e.green=this.color.green),isNaN(e.blue)&&(e.blue=this.color.blue),isNaN(e.alpha)&&(e.alpha=this.color.alpha),e}},{key:"at",value:function(t){return this.spline.path[t]}},{key:"values",value:function(){return this.spline.path}}],[{key:"fromNative",value:function(e){return e?e.path&&e.path instanceof Float32Array?e:t.fromJSON(t.toJSON(e)):null}},{key:"toJSON",value:function(t){return{layout:t.layout.map(function(t){return t.name}),path:t.values(),width:t.width,color:t.color,ts:t.ts,tf:t.tf}}},{key:"fromJSON",value:function(e){return e.layout=e.layout.map(function(t){return PathPoint$1.Property[t]}),e.defaultWidth=e.width,Color.is(e.color)&&(e.defaultColor=Color.from(e.color.red,e.color.green,e.color.blue,e.color.alpha)),delete e.width,delete e.color,new t(e)}}]),t}();InterpolatedSplinerKT.prototype.getPoint=InterpolatedSpline$1.prototype.getPoint;var config$1={stroke:{generateID:void 0},setOwnBackbuffer:function(t){this.ownBackbuffer=t},setDefaultLayerSize:function(t,e){if(t>4e3)throw new Error("Max texture size width (4000) exceeded: ".concat(t));if(e>4e3)throw new Error("Max texture size height (4000) exceeded: ".concat(e));e||(e=t),this.DEFAULT_LAYER_SIZE={width:t,height:e}},setDefaultScaleFactor:function(t){if(!(t>0&&t<=1))throw new Error("Scale factor should be a number between 0 and 1: ".concat(t));this.DEFAULT_SCALE_FACTOR=t}},Stroke=function(){function t(e,i,n){var r=this;_classCallCheck(this,t);var o,a,s,l,u=i.id;if(!(e instanceof StrokeBrush))throw new Error("brush argument is not instance of StrokeBrush");if(!t.validatePath(i))throw new Error("Valid path is not found. Please check console for more information.");Object.defineProperty(this,"id",{get:function(){return u||(u=utils.uuid()),u},set:function(t){u=t},enumerable:!0}),Object.defineProperty(this,"getProcessedPath",{get:function(){return n},set:function(t){n=t,a=null},enumerable:!0}),o=Array.isArray(i.points)?i.points.toFloat32Array():i.points,this.brush=e,this.color=i.color,Object.defineProperty(this,"layout",{value:i.layout,enumerable:!0}),Object.defineProperty(this,"points",{value:o,enumerable:!0}),Object.defineProperty(this,"width",{value:i.width,enumerable:!0}),Object.defineProperty(this,"ts",{value:i.ts,enumerable:!0}),Object.defineProperty(this,"tf",{value:i.tf,enumerable:!0}),Object.defineProperty(this,"stride",{value:this.layout.length,enumerable:!0}),this.brush.type==StrokeBrush.Type.POLYGON?(a=i.spline,s=function(){if(!a)if("function"==typeof r.getProcessedPath)a=r.getProcessedPath();else{if(!(r.brush.polygon instanceof Float32Array))throw new Error("Path property polygon is required and should be instance of Float32Array");a=InkBuilder$1.discretize(o,{layout:r.layout,width:r.width,brushPolygon:r.brush.polygon})}},Object.defineProperty(this,"splineLength",{get:function(){return this.path.first.length/2},enumerable:!0}),this.getSplinePoint=function(t){var e=2*t;return{x:r.path.first[e],y:r.path.first[e+1]}}):this.brush.type==StrokeBrush.Type.PARTICLE&&(Object.defineProperty(this,"randomSeed",{value:e.randomSeed,enumerable:!0}),a=InterpolatedSpline$1.fromNative(i.spline),s=function(){if(!a)if("function"==typeof r.getProcessedPath)a=r.getProcessedPath();else{if("number"!=typeof r.brush.spacing)throw new Error("Brush property spacing is required when rendering is needed");(a=InkBuilder$1.discretize(o,{particles:!0,layout:r.layout,width:r.width,spacing:r.brush.spacing})).color=r.color}},Object.defineProperty(this,"splineLength",{get:function(){return this.path.length/this.path.layout.length},enumerable:!0}),this.getSplinePoint=function(t){return r.path.getPoint(t)}),this.at=function(t){return o[t]},this.getPoint=InterpolatedSpline$1.prototype.getPoint,this.reset=function(t){o=t,a=null,l=null},Object.defineProperty(this,"path",{get:function(){if(!a){if(this.brush.type==StrokeBrush.Type.UNKNOWN)throw new Error("Path cannot be calculated without proper brush");s()}return a},enumerable:!0}),Object.defineProperty(this,"bounds",{get:function(){if(!l)if(this.brush.type==StrokeBrush.Type.PARTICLE)l=RectTools.fromSpline(this.path,this.brush.scattering);else{if(this.brush.type!=StrokeBrush.Type.POLYGON)throw new Error("Bounds cannot be calculated without proper brush");l=RectTools.fromPath(this.path)}return l},enumerable:!0}),u||"function"!=typeof t.config.generateID||(u=t.config.generateID(this)),this.renderMode=void 0,this.sensorDataContext,this.sensorDataOffset=0,this.sensorDataMapping=void 0}return _createClass(t,[{key:"length",get:function(){return this.points.length/this.stride}}],[{key:"config",get:function(){return config$1.stroke}}]),_createClass(t,[{key:"pointAt",value:function(t){return this.getPoint(t)}},{key:"getAverageWidth",value:function(){var t=0;if(this.layout.includes(PathPoint.Property.SIZE)){for(var e=0,i=0;i<this.length;i++)e+=this.getPoint(i).size;t=e/this.length}else t=this.width;return t}},{key:"subStroke",value:function(e,i,n,r){if(0==e&&i==this.length-1&&n==this.ts&&r==this.tf)return this;var o=this.points.subarray(e*this.stride,(i+1)*this.stride);return t.createInstance(this.brush,o,this.layout,this.width,this.color,null,n,r,this.getProcessedPath)}},{key:"transform",value:function(t){var e=MatTools.transformPath(this.points,this.layout,t);this.reset(e)}},{key:"toJSON",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.Encoding.AUTO;e==t.Encoding.AUTO&&(e="undefined"==typeof Buffer?t.Encoding.ARRAY:t.Encoding.BUFFER);var i={encoding:e.name,brush:this.brush.toJSON(),id:this.id,points:t.fromFloat32Array(e,this.points),layout:this.layout.map(function(t){return t.name}),width:this.width,color:this.color,ts:this.ts,tf:this.tf};return this.brush.type==StrokeBrush.Type.POLYGON&&(i.brush.polygon=t.fromFloat32Array(e,this.brush.polygon)),i}}],[{key:"createInstance",value:function(e,i,n,r,o,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,u=arguments.length>8?arguments[8]:void 0;return new t(StrokeBrush.from(e,a),{points:i,layout:n,width:r,color:o,ts:s,tf:l},u)}},{key:"fromJSON",value:function(e,i){var n,r=t.toFloat32Array(t.Encoding[e.encoding],e.points),o=e.layout.map(function(t){return PathPoint.Property[t]});return e.brush.type=StrokeBrush.Type[e.brush.type],e.brush.type==StrokeBrush.Type.POLYGON&&(e.brush.polygon=t.toFloat32Array(t.Encoding[e.encoding],e.brush.polygon)),n=t.createInstance(e.brush,r,o,e.width,e.color,e.randomSeed,e.ts,e.tf,i),e.id&&(n.id=e.id),n}},{key:"fromFloat32Array",value:function(e,i){var n;if(e==t.Encoding.NONE)n=i;else if(e==t.Encoding.ARRAY)n=i.toArray();else{if("undefined"==typeof Buffer)throw new Error("Buffer not found, unable to serialize. Please provide Buffer in global scope.");var r=Buffer.from(i.buffer);switch(e){case t.Encoding.BUFFER:n=r.toJSON();break;case t.Encoding.BASE64:n=r.toString("base64");break;default:throw new Error("Invalid encoding provided: "+e)}}return n}},{key:"toFloat32Array",value:function(e,i){var n;if(e==t.Encoding.NONE)n=i;else if(e==t.Encoding.ARRAY)n=i.toFloat32Array();else{if("undefined"==typeof Buffer)throw new Error("Buffer not found, unable to deserialize. Please provide Buffer in global scope.");var r;switch(e){case t.Encoding.BUFFER:r=Buffer.from(i);break;case t.Encoding.BASE64:r=Buffer.from(i,"base64");break;default:throw new Error("Invalid encoding provided: "+e)}var o=new Uint8Array(r);n=new Float32Array(o.buffer)}return n}},{key:"validatePath",value:function(t){if(!t||0==t.length)return!1;if(Array.isArray(t))return!0;var e,i=!1;e=t.points?t.points.length:t.length;var n=PathPoint.Property,r=n.SIZE,o=n.RED,a=n.GREEN,s=n.BLUE,l=n.ALPHA;return e%t.layout.length!=0?console.error("The points array (length: ".concat(t.points.length,") does not refer to provided layout (").concat(t.layout,")")):!t.layout.includes(r)&&isNaN(t.width)?console.error("Either the width property must be set or the path layout must include a SIZE property"):t.layout.includes(o)&&t.layout.includes(a)&&t.layout.includes(s)&&t.layout.includes(l)||t.color?i=!0:console.error("Either the color property must be set or the path layout must include a RED, GREEN, BLUE, ALPHA properties"),i}},{key:"configure",value:function(t,e){config$1[t]=e}}]),t}();Stroke.createEnum("Encoding",["AUTO","NONE","ARRAY","BUFFER","BASE64"]);var OffscreenLayer=function(t){function e(t,i,n){var r;return _classCallCheck(this,e),r=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t.inkGLContext,i,n)),Object.defineProperty(_assertThisInitialized(r),"inkContext",{value:t}),r}return _inherits(e,InkLayer),_createClass(e,[{key:"bounds",get:function(){return RectTools.create(this.graphicsBounds.left,this.graphicsBounds.bottom,this.graphicsBounds.width,this.graphicsBounds.height)}}]),_createClass(e,[{key:"clear",value:function(t,e){if(e){if(Color.is(t))throw new Error("`clear` first argument should be DigitalInk.Rectangle")}else Color.is(t)?(e=t,t=null):e=Color.TRANSPERENT;var i=t?helper.makeRectFromFlippedRect(t):null;this.inkContext.setTarget(this,i),this.inkContext.clearColor(e),i&&this.inkContext.disableTargetClipRect()}},{key:"draw",value:function(t,e){var i=null;return t instanceof ParticleBrush&&!isNaN(e.randomSeed)&&((i=new StrokeDrawContext).randomSeed=e.randomSeed),this.drawStroke(t,e.path,!0,!0,i)}},{key:"drawStroke",value:function(t,e,i,n,r){return Stroke.validatePath(e)?(this.inkContext.setTarget(this),(o=this.inkContext.drawStroke(t,e,i,n,r,!0))&&(o=RectTools.create(o.left,o.bottom,o.width,o.height)),o):null;var o}},{key:"fillPath",value:function(t,e,i){Stroke.validatePath(t)&&Module.writeBytes(t.points,function(n){this.inkContext.setTarget(this),this.inkContext.fillPath(n,t.layout,e,!!i)},this)}},{key:"blend",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.mode||(e.mode=InkGLContext.BlendMode.NORMAL),e.rect&&!e.transform&&(e.sourceRect=e.rect,e.destinationRect=e.rect),e.transform&&e.destinationRect)throw new Error("`destinationRect` is not applicable with `transform`");if(e.sourceRect&&!e.destinationRect)throw new Error("With `sourceRect`, `destinationRect` is required");if(e.destinationRect&&!e.sourceRect)throw new Error("With `destinationRect`, `sourceRect`is required");if(this.inkContext.setTarget(this,e.clipRect?helper.makeRectFromFlippedRect(e.clipRect):void 0),"boolean"==typeof e.flipY&&(t.flipY=e.flipY),e.transform&&e.rect){var i=helper.makeQuadFromFlippedRect(e.rect),n=i.transform(helper.makeMat4FromMatrix2D(e.transform));this.inkContext.drawLayer(t,i,n,e.mode)}else e.transform?this.inkContext.drawLayerWithTransform(t,helper.makeMat4FromMatrix2D(e.transform),e.mode):e.sourceRect&&e.destinationRect?this.inkContext.drawLayer(t,helper.makeQuadFromFlippedRect(e.sourceRect),helper.makeQuadFromFlippedRect(e.destinationRect),e.mode):this.inkContext.drawLayerWithTransform(t,null,e.mode)}},{key:"readPixels",value:function(t){return this.inkContext.setTarget(this),this.inkContext.readPixels(t?helper.makeRectFromFlippedRect(t):null)}},{key:"writePixels",value:function(t,e){if(!t)throw new Error("OffscreenLayer$writePixels 'bytes' parameter is required");if(!(t instanceof Uint8Array))throw new Error("OffscreenLayer$writePixels 'bytes' parameter is not instance of Uint8Array");this.inkContext.setTarget(this),this.inkContext.writePixels(e?helper.makeRectFromFlippedRect(e):null,t)}}]),e}();OffscreenLayer.BlendMode=InkGLContext.BlendMode;var GLProgram=function(){function t(e){_classCallCheck(this,t),Object.defineProperties(this,{inkGLContext:{value:e},gl:{value:e.gl}}),this.program=this.createProgram(this.compileShader(this.constructor.getVertexShader(),this.gl.VERTEX_SHADER),this.compileShader(this.constructor.getFragmentShader(),this.gl.FRAGMENT_SHADER)),this.contextChanged=!0}return _createClass(t,[{key:"init",value:function(){}},{key:"compileShader",value:function(t,e){var i=this.inkGLContext.gl,n=i.createShader(e);if(i.shaderSource(n,t),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS))throw new Error("could not compile shader:"+i.getShaderInfoLog(n));return n}},{key:"createProgram",value:function(t,e){var i=this.inkGLContext.gl,n=i.createProgram();if(i.attachShader(n,t),i.attachShader(n,e),i.linkProgram(n),!i.getProgramParameter(n,i.LINK_STATUS))throw new Error("program filed to link:"+i.getProgramInfoLog(n));return n}},{key:"onActivate",value:function(){}},{key:"onDeactivate",value:function(){}},{key:"onContextChange",value:function(){}},{key:"activate",value:function(){this.inkGLContext.activateProgram(this)}}]),t}(),SimpleProgram=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,GLProgram),_createClass(e,[{key:"init",value:function(){this.a_position=this.gl.getAttribLocation(this.program,"a_position"),this.a_color=this.gl.getAttribLocation(this.program,"a_color"),this.u_projectionMatrix=this.gl.getUniformLocation(this.program,"u_projectionMatrix")}},{key:"onContextChange",value:function(){this.gl.uniformMatrix4fv(this.u_projectionMatrix,!1,this.inkGLContext._graphicsSpaceToFramebufferSpaceT.toFloat32Array())}},{key:"onDeactivate",value:function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}},{key:"drawVertices",value:function(t,e,i){this.activate(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.inkGLContext.vertsBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(this.a_position),this.gl.vertexAttribPointer(this.a_position,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.inkGLContext.colorsBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(this.a_color),this.gl.vertexAttribPointer(this.a_color,4,this.gl.FLOAT,!1,0,0),t.length&&this.inkGLContext.drawArrays(this.gl.TRIANGLES,0,t.length/2)}}],[{key:"getVertexShader",value:function(){return"\n\t\t\tprecision highp float;\n\n\t\t\tuniform mat4 u_projectionMatrix;\n\n\t\t\tattribute highp vec4 a_position;\n\t\t\tattribute lowp vec4 a_color;\n\n\t\t\tvarying lowp vec4 v_color;\n\n\t\t\tvoid main() {\n\t\t\t\tgl_Position = u_projectionMatrix * a_position;\n\t\t\t\tv_color = a_color;\n\t\t\t}\n\t\t"}},{key:"getFragmentShader",value:function(){return"\n\t\t\tvarying lowp vec4 v_color;\n\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = v_color;\n\t\t\t}\n\t\t"}}]),e}(),kWglAntiAliasingSize=1.25,CircleProgram=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,GLProgram),_createClass(e,[{key:"init",value:function(){var t=this.inkGLContext.gl;this.a_t=t.getAttribLocation(this.program,"a_t"),this.u_xyr=t.getUniformLocation(this.program,"u_xyr"),this.u_count=t.getUniformLocation(this.program,"u_count"),this.u_concatenated_matrix=t.getUniformLocation(this.program,"u_concatenated_matrix"),this.u_color=t.getUniformLocation(this.program,"u_color"),this.u_scale_vector_abs=t.getUniformLocation(this.program,"u_scale_vector_abs")}},{key:"setColor",value:function(t){this.color=t,this.colorChanged=!0}},{key:"onActivate",value:function(){var t=this.inkGLContext.gl;this.colorChanged=!0,t.enableVertexAttribArray(this.a_t),t.bindBuffer(t.ARRAY_BUFFER,this.inkGLContext.circleBuffer),t.vertexAttribPointer(this.a_t,2,t.FLOAT,!1,0,0)}},{key:"onDeactivate",value:function(){var t=this.inkGLContext.gl;t.bindBuffer(t.ARRAY_BUFFER,null),t.disableVertexAttribArray(this.a_t)}},{key:"onContextChange",value:function(){var t=this.inkGLContext,e=t.gl;e.uniformMatrix4fv(this.u_concatenated_matrix,!1,t._graphicsSpaceToFramebufferSpaceT.toFloat32Array()),e.uniform2fv(this.u_scale_vector_abs,t._scaleVectorAbs),this.scaleFactor=Math.max(t._scaleVectorAbs[0],t._scaleVectorAbs[1])}},{key:"drawCircle",value:function(t,e,i){this.activate();var n=this.inkGLContext.gl;this.colorChanged&&(n.uniform4fv(this.u_color,new Float32Array([this.color.red/255,this.color.green/255,this.color.blue/255,this.color.alpha])),this.colorChanged=!1);var r=null;if(i&&(!(r=new WRect(t.x-t.r-kWglAntiAliasingSize,t.y-t.r-kWglAntiAliasingSize,t.x+t.r+kWglAntiAliasingSize,t.y+t.r+kWglAntiAliasingSize).intersection(this.inkGLContext._clipRect))||r.width<=0||r.height<=0))return;n.uniform3fv(this.u_xyr,new Float32Array([t.x,t.y,t.r]));var o=Math.min(1024,Math.floor(2*this.scaleFactor*Math.PI*t.r/2)+1);return n.uniform1f(this.u_count,o),this.inkGLContext.drawArrays(n.TRIANGLE_FAN,0,o+2),e&&this.inkGLContext.drawArrays(n.TRIANGLE_STRIP,1026,2*(o+1)),r}}],[{key:"getVertexShader",value:function(){return"\n\t\t\t#define ANTI_ALIAS_SIZE 1.25\n\n\t\t\tprecision highp float;\n\n\t\t\tuniform mat4 u_concatenated_matrix;\n\t\t\tuniform vec2 u_scale_vector_abs;\n\t\t\tuniform lowp vec4 u_color;\n\n\t\t\t// TODO: rename to u_xyr and u_count\n\t\t\tuniform vec3 u_xyr;\n\t\t\tuniform float u_count;\n\n\t\t\tattribute highp vec2 a_t;\n\n\t\t\tvarying lowp vec4 v_color;\n\n\t\t\tvoid main() {\n\t\t\t\tfloat x;\n\t\t\t\tfloat y;\n\n\t\t\t\tfloat t = a_t.x / u_count;\n\t\t\t\tfloat alpha_mul = a_t.y;\n\n\t\t\t\t// vertex at the center, for the triangle fan\n\t\t\t\tif (t < 0.0) {\n\t\t\t\t\tx = u_xyr.x;\n\t\t\t\t\ty = u_xyr.y;\n\t\t\t\t\talpha_mul = 1.0;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tfloat correction = max(0.0, ANTI_ALIAS_SIZE - u_xyr.z) / ANTI_ALIAS_SIZE;\n\t\t\t\t\talpha_mul = alpha_mul * (1.0 - correction * correction);\n\n\t\t\t\t\tfloat r_X = max(0.0, u_xyr.z - (alpha_mul-0.5)*ANTI_ALIAS_SIZE / u_scale_vector_abs.x);\n\t\t\t\t\tfloat r_Y = max(0.0, u_xyr.z - (alpha_mul-0.5)*ANTI_ALIAS_SIZE / u_scale_vector_abs.y);\n\n\t\t\t\t\tfloat t_2pi = 6.28318530717959*t;\n\n\t\t\t\t\tx = u_xyr.x + sin(t_2pi) * r_X;\n\t\t\t\t\ty = u_xyr.y + cos(t_2pi) * r_Y;\n\t\t\t\t}\n\n\t\t\t\tv_color = u_color * alpha_mul;\n\t\t\t\tgl_Position = u_concatenated_matrix * vec4(x, y, alpha_mul, 1.0);\n\t\t\t}\n\t\t"}},{key:"getFragmentShader",value:function(){return"\n\t\t\tvarying lowp vec4 v_color;\n\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = v_color;\n\t\t\t}\n\t\t"}}]),e}(),kCatmullRomMatrix=new Float32Array([-.5,1.5,-1.5,.5,1,-2.5,2,-.5,-.5,0,.5,0,0,1,0,0]),kWglAntiAliasingSize$1=1.25,SplineProgram=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,GLProgram),_createClass(e,[{key:"init",value:function(){var t=this.inkGLContext.gl;this.a_t=t.getAttribLocation(this.program,"a_t"),this.a_tsf=t.getUniformLocation(this.program,"a_tsf"),this.u_concatenated_matrix=t.getUniformLocation(this.program,"u_concatenated_matrix"),this.u_color=t.getUniformLocation(this.program,"u_color"),this.u_scale_vector_abs=t.getUniformLocation(this.program,"u_scale_vector_abs"),this.u_spline_matrix=t.getUniformLocation(this.program,"u_spline_matrix"),this.a_ctrl_pts_x=t.getUniformLocation(this.program,"a_ctrl_pts_x"),this.a_ctrl_pts_y=t.getUniformLocation(this.program,"a_ctrl_pts_y"),this.a_ctrl_pts_r=t.getUniformLocation(this.program,"a_ctrl_pts_r"),this.u_count=t.getUniformLocation(this.program,"u_count")}},{key:"setColor",value:function(t){this.color=t,this.colorChanged=!0}},{key:"onActivate",value:function(){var t=this.inkGLContext,e=t.gl;this.colorChanged=!0,e.enableVertexAttribArray(this.a_t),this.scaleFactor=Math.max(t._scaleVectorAbs[0],t._scaleVectorAbs[1]),e.bindBuffer(e.ARRAY_BUFFER,this.inkGLContext.strokeSegmentBuffer),e.vertexAttribPointer(this.a_t,3,e.FLOAT,!1,0,0)}},{key:"onContextChange",value:function(){var t=this.inkGLContext,e=t.gl;e.uniformMatrix4fv(this.u_concatenated_matrix,!1,t._graphicsSpaceToFramebufferSpaceT.toFloat32Array()),e.uniform2fv(this.u_scale_vector_abs,t._scaleVectorAbs),this.scaleFactor=Math.max(t._scaleVectorAbs[0],t._scaleVectorAbs[1])}},{key:"drawSplineSegments2",value:function(t,e,i,n){this.activate();var r=this.inkGLContext.gl,o=e.length;this.colorChanged&&(r.uniform4fv(this.u_color,new Float32Array([this.color.red/255,this.color.green/255,this.color.blue/255,this.color.alpha])),this.colorChanged=!1),r.uniformMatrix4fv(this.u_spline_matrix,!1,kCatmullRomMatrix);for(var a=0;a<o;a++){r.uniform4fv(this.a_ctrl_pts_x,new Float32Array(t.slice(12*a,12*a+4))),r.uniform4fv(this.a_ctrl_pts_y,new Float32Array(t.slice(12*a+4,12*a+8))),r.uniform4fv(this.a_ctrl_pts_r,new Float32Array(t.slice(12*a+8,12*a+12)));r.uniform2fv(this.a_tsf,new Float32Array(i.slice(2*a,2*a+2)));var s=e[a],l=2*(s+1);r.uniform1f(this.u_count,s),this.inkGLContext.drawArrays(r.TRIANGLE_STRIP,0,l),n&&(this.inkGLContext.drawArrays(r.TRIANGLE_STRIP,2050,l),this.inkGLContext.drawArrays(r.TRIANGLE_STRIP,4100,l))}}},{key:"drawSplineSegments",value:function(t,e,i,n,r,o,a,s){this.activate();var l=this.inkGLContext.gl,u=Math.floor(t.length/e);this.colorChanged&&(l.uniform4fv(this.u_color,new Float32Array([this.color.red/255,this.color.green/255,this.color.blue/255,this.color.alpha])),this.colorChanged=!1);var h=null;l.uniformMatrix4fv(this.u_spline_matrix,!1,kCatmullRomMatrix);for(var c=0;c<u-3;c++){var v=PointUtil.getXYR(t,e,c,a),p=PointUtil.getXYR(t,e,c+1,a),f=PointUtil.getXYR(t,e,c+2,a),d=PointUtil.getXYR(t,e,c+3,a),_=[v.x,p.x,f.x,d.x],x=[v.y,p.y,f.y,d.y],b=[v.r,p.r,f.r,d.r];if(_[1]!=_[2]||x[1]!=x[2]){var $=.166666666666,y=_[1],g=-$*_[0]+_[1]+$*_[2],m=+$*_[1]+_[2]-$*_[3],E=_[2],P=x[1],w=-$*x[0]+x[1]+$*x[2],I=+$*x[1]+x[2]-$*x[3],S=x[2],A=b[1],k=-$*b[0]+b[1]+$*b[2],T=+$*b[1]+b[2]-$*b[3],C=b[2];if(s){var L=new WRect(y-A,P-A,y+A,P+A),O=new WRect(g-k,w-k,g+k,w+k),R=new WRect(m-T,I-T,m+T,I+T),D=new WRect(E-C,S-C,E+C,S+C),N=L.union(O).union(R).union(D),z=(N=new WRect(N.left-kWglAntiAliasingSize$1,N.bottom-kWglAntiAliasingSize$1,N.right+kWglAntiAliasingSize$1,N.top+kWglAntiAliasingSize$1)).intersection(o);if(!z)continue;h=z.union(h)}l.uniform4f(this.a_ctrl_pts_x,_[0],_[1],_[2],_[3]),l.uniform4f(this.a_ctrl_pts_y,x[0],x[1],x[2],x[3]),l.uniform4f(this.a_ctrl_pts_r,b[0],b[1],b[2],b[3]);var M=[0,1];0==c&&(M[0]=n),c==u-1-3&&(M[1]=r),l.uniform2fv(this.a_tsf,new Float32Array(M));var F=[g-y,w-P,k-A],B=[E-m,S-I,C-T],X=Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2]);F[0]=F[0]/X,F[1]=F[1]/X,F[2]=F[2]/X;var Y=Math.sqrt(B[0]*B[0]+B[1]*B[1]+B[2]*B[2]);B[0]=B[0]/Y,B[1]=B[1]/Y,B[2]=B[2]/Y;var j=1-(F[0]*B[0]+F[1]*B[1]+F[2]*B[2]);j=Math.min(2,j),j=Math.max(0,j);var U=Math.max(A,C),G=Math.sqrt((y-E)*(y-E)+(P-S)*(P-S)+(A-C)*(A-C)),K=void 0,q=.5*j,H=Math.pow(16*Math.PI*U,q*q)-3,W=G*q*16,V=Math.max(H,W);K=1+parseInt(Math.floor(V*this.scaleFactor)),K=Math.min(K,1024),isNaN(K)&&(K=4);var Z=2*(K+1);l.uniform1f(this.u_count,K),this.inkGLContext.drawArrays(l.TRIANGLE_STRIP,0,Z),i&&(this.inkGLContext.drawArrays(l.TRIANGLE_STRIP,2050,Z),this.inkGLContext.drawArrays(l.TRIANGLE_STRIP,4100,Z))}}return l.bindBuffer(l.ARRAY_BUFFER,null),h}}],[{key:"getVertexShader",value:function(){return"\n\t\t\t#define ANTI_ALIAS_SIZE 1.25\n\n\t\t\tprecision highp float;\n\n\t\t\tuniform mat4 u_concatenated_matrix;\n\t\t\tuniform vec2 u_scale_vector_abs; // needed for the anti-aliasing\n\t\t\tuniform lowp vec4 u_color;\n\n\t\t\tuniform mat4 u_spline_matrix;\n\n\t\t\tattribute highp vec3 a_t;\n\t\t\tuniform vec4 a_ctrl_pts_x;\n\t\t\tuniform vec4 a_ctrl_pts_y;\n\t\t\tuniform vec4 a_ctrl_pts_r;\n\n\t\t\tuniform vec2 a_tsf;// starting and final t\n\n\t\t\tvarying lowp vec4 v_color;\n\n\t\t\tuniform float u_count;\n\n\t\t\tconst vec3 kDerivator = vec3 (3.0, 2.0, 1.0);\n\n\t\t\tvoid main() {\n\t\t\t\tfloat t = a_t.x / u_count;\n\n\t\t\t\tt = clamp(t, a_tsf.x, a_tsf.y);\n\n\t\t\t\tfloat site_sign = a_t.y;\n\t\t\t\tfloat alpha_mul = a_t.z;\n\n\t\t\t\tfloat t_sq = t*t;\n\t\t\t\tfloat t_thrd = t_sq*t;\n\t\t\t\tvec4 tPowersVector = vec4(t_thrd, t_sq, t, 1.0);\n\n\t\t\t\tvec4 fu = a_ctrl_pts_x * u_spline_matrix;\n\t\t\t\tvec4 fv = a_ctrl_pts_y * u_spline_matrix;\n\t\t\t\tvec4 fr = a_ctrl_pts_r * u_spline_matrix;\n\n\t\t\t\tfloat u = dot(fu , tPowersVector);\n\t\t\t\tfloat v = dot(fv , tPowersVector);\n\t\t\t\tfloat r = dot(fr , tPowersVector);\n\n\t\t\t\tvec3 dfu = fu.xyz * kDerivator;\n\t\t\t\tvec3 dfv = fv.xyz * kDerivator;\n\t\t\t\tvec3 dfr = fr.xyz * kDerivator;\n\n\t\t\t\tfloat du = dot(dfu, tPowersVector.yzw);\n\t\t\t\tfloat dv = dot(dfv, tPowersVector.yzw);\n\t\t\t\tfloat dr = dot(dfr, tPowersVector.yzw);\n\n\t\t\t\tfloat correction = max(0.0, ANTI_ALIAS_SIZE - r) / ANTI_ALIAS_SIZE;\n\t\t\t\talpha_mul = alpha_mul * (1.0 - correction * correction);\n\n\t\t\t\tfloat r_X = max(0.0, r - (alpha_mul-0.5)*ANTI_ALIAS_SIZE / u_scale_vector_abs.x);\n\t\t\t\tfloat r_Y = max(0.0, r - (alpha_mul-0.5)*ANTI_ALIAS_SIZE / u_scale_vector_abs.y);\n\n\t\t\t\thighp float s = du*du + dv*dv;\n\t\t\t\thighp float d = s - dr*dr;\n\n\t\t\t\t/* Shady moment... */\n\t\t\t\tif (d < 0.0) {\n\t\t\t\t\tdr = sign(dr) * sqrt(s);\n\t\t\t\t\td = 0.0;\n\t\t\t\t}\n\n\t\t\t\tfloat denom = 1.0 / s;\n\t\t\t\tfloat d_sqrt = sqrt(d);\n\t\t\t\tfloat d_sqrt_denom = d_sqrt*denom;\n\t\t\t\tfloat dr_denom = dr*denom;\n\n\t\t\t\tfloat arg1 = u - du*dr_denom*r_X;\n\t\t\t\tfloat arg2 = dv*d_sqrt_denom*r_X;\n\n\t\t\t\tfloat arg3 = v - dv*dr_denom*r_Y;\n\t\t\t\tfloat arg4 = du*d_sqrt_denom*r_Y;\n\n\t\t\t\tfloat x = arg1 + site_sign*arg2;\n\t\t\t\tfloat y = arg3 - site_sign*arg4;\n\n\t\t\t\tgl_Position = u_concatenated_matrix * vec4(x, y, alpha_mul,  1.0);\n\t\t\t\tv_color = u_color * alpha_mul;\n\t\t\t}\n\t\t"}},{key:"getFragmentShader",value:function(){return"\n\t\t\tvarying lowp vec4 v_color;\n\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = v_color;\n\t\t\t}\n\t\t"}}]),e}(),TextureProgram=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,GLProgram),_createClass(e,[{key:"init",value:function(){this.a_position=this.gl.getAttribLocation(this.program,"a_position"),this.a_srcPosition=this.gl.getAttribLocation(this.program,"a_srcPosition"),this.u_texture=this.gl.getUniformLocation(this.program,"u_texture"),this.u_projectionMatrix=this.gl.getUniformLocation(this.program,"u_projectionMatrix"),this.u_textureMatrix=this.gl.getUniformLocation(this.program,"u_textureMatrix")}},{key:"onDeactivate",value:function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}},{key:"drawTexture",value:function(t,e,i,n,r){this.activate();var o=this.inkGLContext.gl;o.disable(o.DEPTH_TEST),o.disable(o.STENCIL_TEST),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,t),o.uniform1i(this.u_texture,0),o.bindBuffer(o.ARRAY_BUFFER,this.inkGLContext.destBuffer),o.bufferData(o.ARRAY_BUFFER,e.toFloat32Array(),o.DYNAMIC_DRAW),o.enableVertexAttribArray(this.a_position),o.vertexAttribPointer(this.a_position,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.inkGLContext.srcBuffer),o.bufferData(o.ARRAY_BUFFER,i.toFloat32Array(),o.DYNAMIC_DRAW),o.enableVertexAttribArray(this.a_srcPosition),o.vertexAttribPointer(this.a_srcPosition,2,o.FLOAT,!1,0,0),o.uniformMatrix4fv(this.u_projectionMatrix,0,n),o.uniformMatrix4fv(this.u_textureMatrix,0,r),this.inkGLContext.drawArrays(o.TRIANGLE_STRIP,0,4)}}],[{key:"getVertexShader",value:function(){return"\n\t\t\tprecision highp float;\n\n\t\t\tuniform mat4 u_projectionMatrix;\n\t\t\tuniform mat4 u_textureMatrix;\n\t\t\tattribute highp vec4 a_position;\n\t\t\tattribute highp vec4 a_srcPosition;\n\t\t\tvarying highp vec2 v_textureCoordinate;\n\n\t\t\tvoid main() {\n\t\t\t\tgl_Position = u_projectionMatrix * a_position;\n\t\t\t\tv_textureCoordinate = (u_textureMatrix * a_srcPosition).xy;\n\t\t\t}\n\t\t"}},{key:"getFragmentShader",value:function(){return"\n\t\t\tprecision highp float;\n\n\t\t\tvarying vec2 v_textureCoordinate;\n\t\t\tuniform lowp sampler2D u_texture;\n\n\t\t\tvoid main() {\n\t\t\t\tgl_FragColor = texture2D(u_texture, v_textureCoordinate);\n\t\t\t}\n\t\t"}}]),e}(),SpriteProgram=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,GLProgram),_createClass(e,[{key:"init",value:function(){var t=this.inkGLContext.gl;this.a_coordinates=t.getAttribLocation(this.program,"a_coordinates"),this.a_xys=t.getAttribLocation(this.program,"a_xys"),this.a_transformParams=t.getAttribLocation(this.program,"a_transformParams"),this.a_velocity=t.getAttribLocation(this.program,"a_velocity"),this.a_color=t.getAttribLocation(this.program,"a_color"),this.a_spriteRotation=t.getAttribLocation(this.program,"a_spriteRotation"),this.a_spriteScaleAndOffset=t.getAttribLocation(this.program,"a_spriteScaleAndOffset"),this.u_projectionMatrix=t.getUniformLocation(this.program,"u_projectionMatrix"),this.u_fillTextureSize=t.getUniformLocation(this.program,"u_fillTextureSize"),this.u_fillTextureOffset=t.getUniformLocation(this.program,"u_fillTextureOffset"),this.u_shapeTexture=t.getUniformLocation(this.program,"u_shapeTexture"),this.u_fillTexture=t.getUniformLocation(this.program,"u_fillTexture")}},{key:"setBrush",value:function(t){this.brush=t,this.brushChanged=!0}},{key:"onActivate",value:function(){this.brushChanged=!0;var t=this.inkGLContext,e=t.gl;e.bindBuffer(e.ARRAY_BUFFER,t.fullScreenQuad2dBuffer),e.vertexAttribPointer(this.a_coordinates,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.a_coordinates),e.disableVertexAttribArray(this.a_velocity),e.disableVertexAttribArray(this.a_transformParams),e.disableVertexAttribArray(this.a_spriteRotation),e.disableVertexAttribArray(this.a_spriteScaleAndOffset),e.disableVertexAttribArray(this.a_xys),e.disableVertexAttribArray(this.a_color)}},{key:"onContextChange",value:function(){var t=this.inkGLContext;t.gl.uniformMatrix4fv(this.u_projectionMatrix,!1,t._graphicsSpaceToFramebufferSpaceT.toFloat32Array())}},{key:"onDeactivate",value:function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}},{key:"drawSprite",value:function(t){this.activate();var e=this.inkGLContext.gl;this.brushChanged&&(e.uniform2fv(this.u_fillTextureSize,new Float32Array([this.brush.fillTextureSize.x,this.brush.fillTextureSize.y])),e.uniform2fv(this.u_fillTextureOffset,new Float32Array([this.brush.fillTextureOffset.x,this.brush.fillTextureOffset.y])),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.brush.shapeTexture),e.uniform1i(this.u_shapeTexture,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.brush.fillTexture),e.uniform1i(this.u_fillTexture,1),this.brushChanged=!1);var i=Math.min(1,Math.max(0,t.alpha)),n=t.red*i/255,r=t.green*i/255,o=t.blue*i/255;e.vertexAttrib4fv(this.a_color,new Float32Array([n,r,o,i])),0==t.dX&&0==t.dY&&(t.dX=2*this.inkGLContext.random()-1,t.dY=2*this.inkGLContext.random()-1),e.vertexAttrib2f(this.a_velocity,t.dX,t.dY);var a=this.brush.rotationMode==ParticleBrush.RotationMode.TRAJECTORY?1:0,s=this.brush.rotationMode==ParticleBrush.RotationMode.RANDOM?2*this.inkGLContext.random()*Math.PI:0,l=(2*this.inkGLContext.random()-1)*this.brush.scattering;e.vertexAttrib3f(this.a_transformParams,a,s,l),e.vertexAttrib1f(this.a_spriteRotation,t.rotation),e.vertexAttrib4f(this.a_spriteScaleAndOffset,t.scaleX,t.scaleY,t.offsetX,t.offsetY),e.vertexAttrib3fv(this.a_xys,new Float32Array([t.x,t.y,t.size])),this.inkGLContext.drawArrays(e.TRIANGLE_STRIP,0,4)}}],[{key:"getVertexShader",value:function(){return"\n\t\t\tprecision highp float;\n\n\t\t\tuniform mat4 u_projectionMatrix;\n\t\t\tuniform vec2 u_fillTextureSize;\n\t\t\tuniform vec2 u_fillTextureOffset;\n\n\t\t\tattribute lowp vec4 a_color;\n\t\t\t/* (x,y) is the center. z is the offset by x, w is the offset by y */\n\t\t\tattribute highp vec2 a_coordinates;\n\t\t\t/* the velocity at that point. It is the derivative of the function */\n\t\t\tattribute vec2 a_velocity;\n\t\t\t/* 1-shape trajectory rotation coficient, 2-shape randrom rotation angle, 3-scattering value */\n\t\t\tattribute vec3 a_transformParams;\n\n\t\t\t/* sprite rotation angle */\n\t\t\tattribute highp float a_spriteRotation;\n\t\t\t/* sprite's: 1-scaleX, 2-scaleY, 3-offsetX, 4-offsetY */\n\t\t\tattribute highp vec4 a_spriteScaleAndOffset;\n\n\t\t\tvarying lowp vec4 v_color;\n\t\t\tattribute vec3 a_xys;\n\t\t\tvarying highp vec2 v_shapeTexturePosition;\n\t\t\tvarying highp vec2 v_fillTexturePosition;\n\n\t\t\tmat2 trajectoryRotate(vec2 vNormal, float value) {\n\t\t\t\tvec2 base = vec2(1.0, 0.0);\n\n\t\t\t\tvec2 vNormalR = mix(base, vNormal, value);\n\t\t\t\tvNormalR = normalize(vNormalR);\n\n\t\t\t\tfloat cosfi = dot(vNormalR, base);\n\t\t\t\tfloat sinfi = vNormalR.x * base.y - vNormalR.y * base.x;\n\n\t\t\t\treturn mat2(\n\t\t\t\t\tcosfi, -sinfi,\n\t\t\t\t\tsinfi, cosfi\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tmat2 angleRotate2(float fi) {\n\t\t\t\tfloat sinfi = sin(fi);\n\t\t\t\tfloat cosfi = cos(fi);\n\n\t\t\t\treturn mat2(\n\t\t\t\t\tcosfi, -sinfi,\n\t\t\t\t\tsinfi, cosfi\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tmat2 scale2(float sx, float sy) {\n\t\t\t\treturn mat2(sx, 0.0, 0.0, sy);\n\t\t\t}\n\n\t\t\tmat3 rotate2h(float fi) {\n\t\t\t\tfloat sinfi = sin(fi);\n\t\t\t\tfloat cosfi = cos(fi);\n\n\t\t\t\treturn mat3(\n\t\t\t\t\tcosfi, -sinfi, 0.0,\n\t\t\t\t\tsinfi, cosfi, 0.0,\n\t\t\t\t\t0.0, 0.0, 1.0\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tmat3 scale2h(float sx, float sy) {\n\t\t\t\treturn mat3(\n\t\t\t\t\tsx, 0.0, 0.0,\n\t\t\t\t\t0.0, sy, 0.0,\n\t\t\t\t\t0.0, 0.0, 1.0\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tmat3 translate2h(float tx, float ty) {\n\t\t\t\treturn mat3(\n\t\t\t\t\t1.0, 0.0, 0.0,\n\t\t\t\t\t0.0, 1.0, 0.0,\n\t\t\t\t\ttx, ty, 1.0\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tvec2 orthoOffset(vec2 vNormal, float value) {\n\t\t\t\tvec2 vno = vec2(-vNormal.y*value, vNormal.x*value);\n\t\t\t\treturn vno;\n\t\t\t}\n\n\t\t\tvoid main() {\n\t\t\t\tfloat halfSize = a_xys.z / 2.0;\n\t\t\t\tvec2 vNormal = normalize(a_velocity);\n\n\t\t\t\t//Because this applied to the texture, the y reversed because the texture coordinate system y is increasing downwards.\n\t\t\t\tvNormal.y = -vNormal.y;\n\t\t\t\tfloat spriteRotation = -a_spriteRotation;\n\t\t\t\tvec4 spriteScaleAndOffset = a_spriteScaleAndOffset;\n\t\t\t\tspriteScaleAndOffset.y = -spriteScaleAndOffset.y;\n\t\t\t\tspriteScaleAndOffset.w = -spriteScaleAndOffset.w;\n\n\t\t\t\tvec2 scatterOffset = orthoOffset(vNormal, a_transformParams.z * halfSize);\n\n\t\t\t\t// For the shape\n\t\t\t\tmat2 mShapeTragetoryFollow = trajectoryRotate(vNormal, a_transformParams.x);\n\t\t\t\tmat2 mShapeRotate = angleRotate2(a_transformParams.y);\n\t\t\t\tvec2 transformedCoordinates = mShapeTragetoryFollow * mShapeRotate * a_coordinates;\n\n\t\t\t\tvec3 coordinatesH = vec3(transformedCoordinates.x, transformedCoordinates.y, 1.0);\n\t\t\t\tcoordinatesH = rotate2h(spriteRotation) * translate2h(spriteScaleAndOffset.z, spriteScaleAndOffset.w) * scale2h(spriteScaleAndOffset.x * halfSize, spriteScaleAndOffset.y * halfSize) * coordinatesH;\n\t\t\t\tvec2 coordinates = coordinatesH.xy;\n\n\t\t\t\tvec2 offset = coordinates + scatterOffset;\n\t\t\t\tvec4 position =  vec4(a_xys.x + offset.x, a_xys.y + offset.y, 0.0, 1.0);\n\t\t\t\tgl_Position = u_projectionMatrix * position;\n\n\t\t\t\tv_color = a_color;\n\t\t\t\tgl_Position = u_projectionMatrix * position;\n\t\t\t\tv_fillTexturePosition = position.xy / u_fillTextureSize + u_fillTextureOffset;\n\t\t\t\tv_shapeTexturePosition = (a_coordinates + 1.0) * 0.5; /* [-1;1] -> [0;1] */\n\t\t\t}\n\t\t"}},{key:"getFragmentShader",value:function(){return"\n\t\t\tuniform lowp sampler2D u_shapeTexture;\n\t\t\tuniform lowp sampler2D u_fillTexture;\n\n\t\t\t/* lowp seems to lead to an overflow on PowerVR SGX540, so use mediump instead :)*/\n\t\t\tvarying mediump vec4 v_color;\n\t\t\tvarying highp vec2 v_shapeTexturePosition;\n\t\t\tvarying highp vec2 v_fillTexturePosition;\n\n\t\t\tvoid main() {\n\t\t\t\tlowp vec4 c = v_color * texture2D(u_shapeTexture, v_shapeTexturePosition) * texture2D(u_fillTexture, v_fillTexturePosition);\n\n\t\t\t\tgl_FragColor = c;\n\t\t\t}\n\t\t"}}]),e}(),DirectBrush=function t(){_classCallCheck(this,t)},kWglAntiAliasingSize$2=1.25,InkContext=function(){function t(e,i){_classCallCheck(this,t);var n=e.getContext("webgl2",i)||e.getContext("webgl",i);this.inkGLContext=new InkGLContext(n),this.gl=this.inkGLContext.gl,this.simpleProgram=new SimpleProgram(this.inkGLContext),this.circleProgram=new CircleProgram(this.inkGLContext),this.splineProgram=new SplineProgram(this.inkGLContext),this.textureProgram=new TextureProgram(this.inkGLContext),this.spriteProgram=new SpriteProgram(this.inkGLContext),this.circleProgram.setColor(Color.BLACK),this.splineProgram.setColor(Color.BLACK),this.inkGLContext.programs=[this.simpleProgram,this.circleProgram,this.splineProgram,this.textureProgram,this.spriteProgram],this.currentTarget=null,this.inkGLContext.init(new WRect$1(0,0,0,0),new WRect$1(0,0,0,0))}return _createClass(t,[{key:"createLayer",value:function(t,e){return new InkLayer(this.inkGLContext,t,e)}},{key:"drawLayerWithTransform",value:function(t,e,i){if(this.currentTarget){var n=t.boundsQuad,r=e?n.transform(e):n;this.drawLayer(t,n,r,i)}}},{key:"drawLayer",value:function(t,e,i,n){if(this.currentTarget&&t.useTextureStorage){var r=this.currentTarget,o=r.flipY?WMat4.makeOrtho(0,r.width,r.height,0,1,-1):WMat4.makeOrtho(0,r.width,0,r.height,1,-1),a=t.flipY?WMat4.makeOrtho(-t.width,t.width,2*t.height,0,0,1):WMat4.makeOrtho(-t.width,t.width,-t.height,t.height,0,1);this.inkGLContext.blendMode(n),this.textureProgram.drawTexture(t.colorTexture,i,e,o.transpose().toFloat32Array(),a.transpose().toFloat32Array())}}},{key:"setTarget",value:function(t,e){var i=this.inkGLContext,n=i.gl;if(t&&!(t instanceof InkLayer))throw new TypeError("layer must be unset or instanceof InkLayer");if(e&&!(e instanceof WRect$1))throw new TypeError("clipRect must be unset or instanceof WRect");if(t){this.currentTarget=t;var r=new WRect$1(0,0,t.storageWidth,t.storageHeight),o=new WRect$1(0,0,t.width,t.height);i.resize(r,o),i.setUniforms(t.flipY),e?this.setTargetClipRect(e):this.disableTargetClipRect(),n.bindFramebuffer(n.FRAMEBUFFER,t.framebuffer)}}},{key:"clearColor",value:function(t){this.inkGLContext.clearColorbuffer(t)}},{key:"setTargetClipRect",value:function(t){var e=this.inkGLContext;t=t.floor().intersection(this.currentTarget.graphicsBounds),e._clipRect=t;var i=this.currentTarget.scaleFactor;t=this.currentTarget.flipY?WRect$1.makeWithSize(t.x,this.currentTarget.storageHeight-t.top,t.width,t.height):WRect$1.makeWithSize(t.x*i,t.y*i,t.width*i,t.height*i),e.scissors(t)}},{key:"disableTargetClipRect",value:function(){var t=this.inkGLContext;t.scissors(null),t._clipRect=t.graphicsBox}},{key:"drawStroke",value:function(t,e,i,n,r,o){if(!this.currentTarget)return null;var a=this.inkGLContext,s=e,l=e.layout.length,u=e.length/l;if(0==u)return null;var h=null,c=a._clipRect;if(a.blendMode(InkGLContext.BlendMode.NORMAL),t instanceof DirectBrush){var v=e.width,p=e.color,f=e.ts,d=e.tf;isNaN(p.red)&&(p.red=255),isNaN(p.green)&&(p.green=255),isNaN(p.blue)&&(p.blue=255),isNaN(p.alpha)&&(p.alpha=1),this.splineProgram.setColor(p);var _=this.splineProgram.drawSplineSegments(s,l,t.gradientAntialiasingEnabled,f,d,c,v,o);if(_&&(h=_.union(h)),(i||n)&&this.circleProgram.setColor(p),i){var x=this.drawCircleAtSplinePoint(t,s,l,v,0,f,o);x&&(h=x.union(h))}if(n){var b=this.drawCircleAtSplinePoint(t,s,l,v,u-1-3,d,o);b&&(h=b.union(h))}}else if(t instanceof ParticleBrush){var $;r&&($=a.scatterMethodRandomSeed,a.scatterMethodRandomSeed=r.randomSeed),this.spriteProgram.setBrush(t);for(var y=0;y<u;y++){var g=e.getPoint(y),m=WRect$1.calculateParticleBrushSegmentBounds(g,t.scattering).intersection(c);m&&(this.spriteProgram.drawSprite(g),h=m.union(h))}r&&(r.randomSeed=a.scatterMethodRandomSeed,a.scatterMethodRandomSeed=$)}return h?h.ceil():null}},{key:"readPixels",value:function(t){var e,i=this.currentTarget,n=this.inkGLContext.gl;if(t){if(!(t instanceof WRect$1))throw new TypeError("box must be instance of WRect")}else t=i.graphicsBounds;return i.flipY&&(t=WRect$1.makeWithSize(t.x,i.height-t.y-t.height,t.width,t.height)),this.setTarget(i),e=new Uint8Array(t.width*t.height*4),n.readPixels(parseInt(t.x*i.scaleFactor),parseInt(t.y*i.scaleFactor),parseInt(t.width*i.scaleFactor),parseInt(t.height*i.scaleFactor),n.RGBA,n.UNSIGNED_BYTE,e),e}},{key:"writePixels",value:function(t,e){if(t&&!(t instanceof WRect$1))throw new TypeError("rect must be instance of WRect");var i=this.currentTarget,n=this.inkGLContext.gl;if(t||(t=WRect$1.makeWithSize(0,0,i.width,i.height)),!i.useTextureStorage)throw new Error("writePixels layer without texture is not supported!");i.flipY&&(t=WRect$1.makeWithSize(t.x,i.height-t.y-t.height,t.width,t.height));var r=WRect$1.makeWithSize(t.x*i.scaleFactor,t.y*i.scaleFactor,t.width*i.scaleFactor,t.height*i.scaleFactor);n.finish(),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,i.colorTexture),n.texSubImage2D(n.TEXTURE_2D,0,parseInt(r.x),parseInt(r.y),parseInt(r.width),parseInt(r.height),n.RGBA,n.UNSIGNED_BYTE,e)}},{key:"fillPath",value:function(t,e,i,n){this.rasterizerHelper||(this.rasterizerHelper=new Module.RasterizerHelper);var r=Module.readFloats(this.rasterizerHelper.getFillPathTriangles(t,e));(i=Object.assign({},i)).red*=i.alpha/255,i.green*=i.alpha/255,i.blue*=i.alpha/255;for(var o=n?4:1,a=kWglAntiAliasingSize$2,s=o*o,l=1.01/s,u=a/o,h=new Float32Array(r.length*s),c=new Float32Array(2*r.length*s),v=0,p=0,f=0;f<o;f++)for(var d=0;d<o;d++)for(var _=l,x={x:f*u-(a-u)/2,y:d*u-(a-u)/2},b=0;b<r.length;b+=6)for(var $=[{x:r[b],y:r[b+1]},{x:r[b+2],y:r[b+3]},{x:r[b+4],y:r[b+5]}],y=0;y<3;y++)h[v++]=$[y%3].x+x.x,h[v++]=$[y%3].y+x.y,c[p++]=_*i.red,c[p++]=_*i.green,c[p++]=_*i.blue,c[p++]=_*i.alpha;this.inkGLContext.gl.bindFramebuffer(this.inkGLContext.gl.FRAMEBUFFER,this.currentTarget.framebuffer),this.inkGLContext.blendMode(n?InkGLContext.BlendMode.ADD:InkGLContext.BlendMode.NORMAL),this.simpleProgram.drawVertices(h,c)}}]),t}(),InkCanvas=function(t){function e(t){var i;if(_classCallCheck(this,e),i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t,{display:!0,width:t.inkGLContext.gl.canvas.width,height:t.inkGLContext.gl.canvas.height,flipY:ENVIRONMENT==EnvironmentType.WEB||ENVIRONMENT==EnvironmentType.WORKER})),Object.defineProperty(_assertThisInitialized(i),"surface",{value:t.inkGLContext.gl.canvas}),Object.defineProperty(_assertThisInitialized(i),"ctx",{value:t.inkGLContext.gl}),t.attributes.preserveDrawingBuffer)Object.defineProperty(_assertThisInitialized(i),"frameID",{value:NaN}),i.requestAnimationFrame=function(t){throw new Error("This usage is not applicable when preserve drawing buffer")};else if(config$1.ownBackbuffer)i.requestAnimationFrame=function(t){i.frameID=requestAnimationFrame(t)},i.frameID=-1;else{var n=i.createLayer(),r=new Array;Object.defineProperty(_assertThisInitialized(i),"backbuffer",{value:n}),i.requestAnimationFrame=function(t,e){return e&&(this.present=!0),r.add(t),this.frameID};var o=_get(_getPrototypeOf(e.prototype),"blend",_assertThisInitialized(i)).bind(_assertThisInitialized(i));i.frameID=requestAnimationFrame(function t(e){for(;r.length>0;)r.shift()(e);i.present&&(delete i.present,o(i.backbuffer,{mode:InkGLContext.BlendMode.NONE})),i.frameID=requestAnimationFrame(t)})}return i}return _inherits(e,OffscreenLayer),_createClass(e,[{key:"createLayer",value:function(t){return new OffscreenLayer(this.inkContext,t,{width:config$1.DEFAULT_LAYER_SIZE.width,height:config$1.DEFAULT_LAYER_SIZE.height,scaleFactor:config$1.DEFAULT_SCALE_FACTOR})}},{key:"clear",value:function(t,i){this.backbuffer?(this.backbuffer.clear(t,i),this.present=!0):_get(_getPrototypeOf(e.prototype),"clear",this).call(this,t,i)}},{key:"draw",value:function(t){this.backbuffer?(this.backbuffer.draw(t),this.present=!0):_get(_getPrototypeOf(e.prototype),"draw",this).call(this,t)}},{key:"drawStroke",value:function(t,i,n,r,o,a,s,l,u){if(this.backbuffer){var h=this.backbuffer.drawStroke(t,i,n,r,o,a,s,l,u);return this.present=!0,h}return _get(_getPrototypeOf(e.prototype),"drawStroke",this).call(this,t,i,n,r,o,a,s,l,u)}},{key:"fillPath",value:function(t,i,n){this.backbuffer?(this.backbuffer.fillPath(t,i,n),this.present=!0):_get(_getPrototypeOf(e.prototype),"fillPath",this).call(this,t,i,n)}},{key:"blend",value:function(t,i){this.backbuffer?(this.backbuffer.blend(t,i),this.present=!0):_get(_getPrototypeOf(e.prototype),"blend",this).call(this,t,i)}},{key:"readPixels",value:function(t){return this.backbuffer?this.backbuffer.readPixels(t):_get(_getPrototypeOf(e.prototype),"readPixels",this).call(this,t)}},{key:"writePixels",value:function(t,i){this.backbuffer?(this.backbuffer.writePixels(t,i),this.present=!0):_get(_getPrototypeOf(e.prototype),"writePixels",this).call(this,t,i)}},{key:"resize",value:function(t,i){_get(_getPrototypeOf(e.prototype),"resize",this).call(this,t,i),this.surface.width=t,this.surface.height=i}},{key:"delete",value:function(){ENVIRONMENT==EnvironmentType.WEB&&cancelAnimationFrame(this.frameID),_get(_getPrototypeOf(e.prototype),"delete",this).call(this),this.backbuffer&&this.backbuffer.delete()}},{key:"deleteLater",value:function(){return _get(_getPrototypeOf(e.prototype),"deleteLater",this).call(this),this.backbuffer&&this.backbuffer.deleteLater(),this}}],[{key:"createInstance",value:function(t,i,n,r){if(!t||"function"!=typeof t.getContext)throw new Error("WebGL context provider is required");if(!(i>0&&n>0))throw new Error("width and height are required and should be positive whole numbers");t.width=i,t.height=n,config$1.DEFAULT_LAYER_SIZE||("undefined"==typeof screen?config$1.setDefaultLayerSize(i,n):config$1.setDefaultLayerSize(Math.max(screen.width,screen.height))),config$1.DEFAULT_SCALE_FACTOR||config$1.setDefaultScaleFactor(1);var o=new InkContext(t,r);return o.attributes=r||{},new e(o)}}]),e}(),StrokeRenderer=function(){function t(e,i){_classCallCheck(this,t),this.canvas=e;var n=i instanceof OffscreenLayer?i:null,r=i&&!n?i:new Object;this.layer=n||e.createLayer(r),this.layerOptions=r,this.ownLayer=!n,this.restart=!0,this.brush=null,this.color=null,this.randomSeed=NaN,this.blendMode=null,this.preliminaryLayer=null,this.strokeBounds=null,this.updatedArea=null,this.streamUpdatedArea=null}return _createClass(t,[{key:"configure",value:function(t){this.blendMode||(this.blendMode=InkGLContext.BlendMode.NORMAL),t.brush&&(this.brush=t.brush),t.color&&(this.color=t.color),t.blendMode&&(this.blendMode=t.blendMode),this.brush instanceof ParticleBrush&&t.randomSeed&&!isNaN(t.randomSeed)&&(this.initialRandomSeed=t.randomSeed)}},{key:"draw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.layer.isDeleted())throw new Error("StrokeRenderer cannot draw, it is already deleted");if(this.restart&&this.reset(),t instanceof Stroke){var n=this.layer.draw(this.brush,t);this.strokeBounds=n,this.updatedArea=n,this.restart=!0}else{if(!this.validate(t))return;var r=this.brush instanceof ParticleBrush?this.strokeLastRendererdDrawContext:null,o=this.layer.drawStroke(this.brush,t,this.beginStroke,e||i,r);this.incompleteStrokeBounds=RectTools.union(this.incompleteStrokeBounds,o),this.strokeBounds=RectTools.union(this.strokeBounds,o),this.updatedArea=RectTools.union(this.incompleteStrokeBounds,this.preliminaryDirtyArea),this.blendWithPreliminaryLayer=!1,this.beginStroke&&o&&(this.beginStroke=!1),e&&(this.strokeBounds=RectTools.ceil(this.strokeBounds),this.restart=!0)}}},{key:"drawPreliminary",value:function(t){if(this.validate(t)){var e=null,i=null;this.brush instanceof ParticleBrush&&(this.strokeLastRendererdDrawContext.copyTo(this.strokePrelimLastRenderedDrawContext),e=this.strokePrelimLastRenderedDrawContext),this.ownLayer?(this.preliminaryLayer||(this.preliminaryLayer=this.canvas.createLayer(this.layerOptions),this.preliminaryLayer.clear()),i=this.preliminaryLayer):i=this.preliminaryLayer||this.canvas,this.updatedArea&&this.preliminaryLayer&&this.preliminaryLayer.blend(this.layer,{mode:InkGLContext.BlendMode.NONE,rect:this.updatedArea}),t.color||(t.color=this.color),this.preliminaryDirtyArea=i.drawStroke(this.brush,t,this.beginStroke,!0,e),this.updatedArea=RectTools.union(this.updatedArea,this.preliminaryDirtyArea),this.preliminaryLayer&&(this.blendWithPreliminaryLayer=!0)}}},{key:"abort",value:function(){this.restart=!0}},{key:"reset",value:function(){this.beginStroke=!0,this.incompleteStrokeBounds=null,this.strokeBounds=null,this.updatedArea=null,this.preliminaryDirtyArea=null,this.brush instanceof ParticleBrush?(this.strokeLastRendererdDrawContext=new StrokeDrawContext,this.strokePrelimLastRenderedDrawContext||(this.strokePrelimLastRenderedDrawContext=new StrokeDrawContext),this.initialRandomSeed&&(this.strokeLastRendererdDrawContext.randomSeed=this.initialRandomSeed,delete this.initialRandomSeed),this.randomSeed=this.strokeLastRendererdDrawContext.randomSeed):this.randomSeed=NaN,this.ownLayer&&(this.layer.clear(),this.preliminaryLayer&&this.preliminaryLayer.clear()),this.restart=!1}},{key:"validate",value:function(t){if(t.color||(t.color=this.color),!Stroke.validatePath(t))return!1;if(!this.brush)throw new Error("StrokeRenderer requires 'brush' to be configured");return!0}},{key:"blendUpdatedArea",value:function(t){if(this.updatedArea){var e=this.blendWithPreliminaryLayer?this.preliminaryLayer:this.layer,i=t||this.canvas,n=RectTools.intersect(this.updatedArea,i.bounds);n&&(n=RectTools.ceil(n),"function"==typeof this.streamUpdatedArea?this.stream(e,n,!1):i.blend(e,{mode:this.blendMode,rect:n})),this.incompleteStrokeBounds=null,this.updatedArea=null}}},{key:"blendStroke",value:function(t,e,i){if(this.strokeBounds){var n=this.layer,r=t||this.canvas;(i=RectTools.intersect(i||this.strokeBounds,r.bounds))&&(i=RectTools.ceil(i),"function"==typeof this.streamUpdatedArea?this.stream(n,i,!0):r.blend(n,{mode:e||this.blendMode,rect:i}))}}},{key:"stream",value:function(t,e,i){var n=new OffscreenCanvas(e.width,e.height).getContext("2d"),r=t.readPixels(e),o=n.createImageData(e.width,e.height);o.data.set(r),this.streamUpdatedArea(o,e,i)}},{key:"toStroke",value:function(t){var e=t.getPath(this.color),i=new Stroke(StrokeBrush.from(this.brush,this.randomSeed),e);return i.sensorDataContext=t.sensorDataContext,i}},{key:"delete",value:function(){this.ownLayer&&(this.layer.delete(),this.preliminaryLayer&&this.preliminaryLayer.delete())}}]),t}(),OffscreenLayer$1=function(){function t(e){_classCallCheck(this,t),Object.defineProperty(this,"surface",{value:e.canvas}),Object.defineProperty(this,"ctx",{value:e})}return _createClass(t,[{key:"width",get:function(){return this.surface.width}},{key:"height",get:function(){return this.surface.height}},{key:"bounds",get:function(){return RectTools.create(0,0,this.width,this.height)}}]),_createClass(t,[{key:"clear",value:function(t,e){if(e){if(Color.is(t))throw new Error("`clear` first argument should be DigitalInk.Rectangle")}else Color.is(t)&&(e=t,t=null);t||(t=this.bounds),this.ctx.clearRect(t.left,t.top,t.width,t.height),e&&(this.ctx.fillStyle="rgba(".concat(e.red,", ").concat(e.green,", ").concat(e.blue,", ").concat(e.alpha,")"),this.ctx.fillRect(t.left,t.top,t.width,t.height))}},{key:"draw",value:function(t){return this.drawStroke(t.path,t.color)}},{key:"drawStroke",value:function(t,e){var i=this;if(!Stroke.validatePath(t))return null;var n=RectTools.fromPath(t);return(n=RectTools.intersect(this.bounds,n))&&(this.ctx.save(),this.ctx.rect(n.left,n.top,n.width,n.height),this.ctx.clip(),this.ctx.beginPath(),t.forEach(function(t,e){if(i.ctx.moveTo(t[0],t[1]),0==e)for(var n=2;n<t.length;n+=2)i.ctx.lineTo(t[n],t[n+1]);else for(var r=t.length-2;r>=0;r-=2)i.ctx.lineTo(t[r],t[r+1]);i.ctx.closePath()}),this.ctx.fillStyle="rgba(".concat(e.red,", ").concat(e.green,", ").concat(e.blue,", ").concat(e.alpha,")"),this.ctx.fill(),this.ctx.restore()),n}},{key:"fillPath",value:function(t,e){this.drawStroke(t,e)}},{key:"blend",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.rect&&!e.transform&&(e.sourceRect=e.rect,e.destinationRect=e.rect),e.transform&&e.destinationRect)throw new Error("`destinationRect` is not applicable with `transform`");if(e.sourceRect&&!e.destinationRect)throw new Error("With `sourceRect`, `destinationRect` is required");if(e.destinationRect&&!e.sourceRect)throw new Error("With `destinationRect`, `sourceRect`is required");e.sourceRect&&e.destinationRect?this.ctx.drawImage(t.ctx.canvas,e.sourceRect.left,e.sourceRect.top,e.sourceRect.width,e.sourceRect.height,e.destinationRect.left,e.destinationRect.top,e.destinationRect.width,e.destinationRect.height):this.ctx.drawImage(t.ctx.canvas,0,0)}},{key:"createImageData",value:function(t,e){var i=this.ctx.createImageData(e.width,e.height);return i.data.set(t),i}},{key:"readPixels",value:function(t){return t||(t=this.bounds),this.ctx.getImageData(t.x,t.y,t.width,t.height).data}},{key:"writePixels",value:function(t,e){if(!t)throw new Error("OffscreenLayer$writePixels 'data' parameter is required");if(!(t instanceof ImageData))throw new Error("OffscreenLayer$writePixels 'bytes' parameter is not instance of ImageData");e||(e=this.bounds),this.ctx.putImageData(t,e.x,e.y)}},{key:"resize",value:function(t,e){this.surface.width=t,this.surface.height=e}}]),t}();OffscreenLayer$1.createEnum("CompositeOperation",["SOURCE_OVER","SOURCE_IN","SOURCE_OUT","SOURCE_ATOP","DESTINATION_OVER","DESTINATION_IN","DESTINATION_OUT","DESTINATION_ATOP","LIGHTER","COPY","XOR","MULTIPLY","SCREEN","OVERLAY","DARKEN","LIGHTEN","COLOR_DODGE","COLOR_BURN","HARD_LIGHT","SOFT_LIGHT","DIFFERENCE","EXCLUSION","HUE","SATURATION","COLOR","LUMINOSITY"]);var InkCanvas$1=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t))}return _inherits(e,OffscreenLayer$1),_createClass(e,[{key:"createLayer",value:function(t,e){t&&e||("undefined"==typeof screen?(t=this.surface.width,e=this.surface.height):e=t=Math.max(screen.width,screen.height));var i=new OffscreenCanvas(t,e);return new OffscreenLayer$1(i.getContext("2d"))}}],[{key:"createInstance",value:function(t,i,n){if(!t||"function"!=typeof t.getContext)throw new Error("CanvasRenderingContext2D context provider is required");if(!(i>0&&n>0))throw new Error("width and height are required and should be positive whole numbers");return t.width=i,t.height=n,new e(t.getContext("2d"))}}]),e}(),StrokeRenderer$1=function(){function t(e,i){_classCallCheck(this,t),this.canvas=e,this.layer=i||e.createLayer(),this.ownLayer=!i,this.restart=!0,this.brush=null,this.color=null,this.compositeOperation=null,this.preliminaryLayer=null,this.strokeBounds=null,this.updatedArea=null}return _createClass(t,[{key:"configure",value:function(t){this.compositeOperation||(this.compositeOperation=OffscreenLayer$1.CompositeOperation.SOURCE_OVER),t.brush&&(this.brush=t.brush),t.color&&(this.color=t.color),t.compositeOperation&&(this.compositeOperation=t.compositeOperation)}},{key:"draw",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.restart&&this.reset(),t instanceof Stroke){var i=this.layer.drawStroke(t.path,t.color.asRGB);this.strokeBounds=i,this.updatedArea=i,this.restart=!0}else{if(!this.color)throw new Error("StrokeRenderer requires 'color' to be configured");if(!this.validate(t))return;var n=this.layer.drawStroke(t,this.color.asRGB);this.incompleteStrokeBounds=RectTools.union(this.incompleteStrokeBounds,n),this.strokeBounds=RectTools.union(this.strokeBounds,n),this.updatedArea=RectTools.union(this.incompleteStrokeBounds,this.preliminaryDirtyArea),this.blendWithPreliminaryLayer=!1,this.beginStroke&&n&&(this.beginStroke=!1),e&&(this.strokeBounds=RectTools.ceil(this.strokeBounds),this.restart=!0)}}},{key:"drawPreliminary",value:function(t){if(this.validate(t)){var e=null;this.ownLayer?(this.preliminaryLayer||(this.preliminaryLayer=this.canvas.createLayer(),this.preliminaryLayer.clear()),e=this.preliminaryLayer):e=this.preliminaryLayer||this.canvas,this.updatedArea&&this.preliminaryLayer&&(this.preliminaryLayer.clear(this.updatedArea),this.preliminaryLayer.blend(this.layer,{mode:OffscreenLayer$1.CompositeOperation.SOURCE_OVER,rect:this.updatedArea})),this.preliminaryDirtyArea=e.drawStroke(t,this.color.asRGB),this.updatedArea=RectTools.union(this.updatedArea,this.preliminaryDirtyArea),this.preliminaryLayer&&(this.blendWithPreliminaryLayer=!0)}}},{key:"abort",value:function(){this.restart=!0}},{key:"reset",value:function(){this.beginStroke=!0,this.incompleteStrokeBounds=null,this.strokeBounds=null,this.updatedArea=null,this.preliminaryDirtyArea=null,this.ownLayer&&(this.layer.clear(),this.preliminaryLayer&&this.preliminaryLayer.clear()),this.color.alpha>0&&this.color.alpha<1&&(this.alphaLayer||(this.alphaLayer=this.canvas.createLayer())),this.restart=!1}},{key:"validate",value:function(t){return Stroke.validatePath(t)}},{key:"blendUpdatedArea",value:function(t){if(this.updatedArea){var e=t||this.canvas,i=this.blendWithPreliminaryLayer?this.preliminaryLayer:this.layer,n=RectTools.intersect(this.updatedArea,e.bounds);if(n){var r=this.color.alpha;r>0&&r<1?(this.alphaLayer.clear(),this.alphaLayer.ctx.globalAlpha=1,this.alphaLayer.blend(e,{rect:n}),this.alphaLayer.ctx.globalAlpha=r,this.alphaLayer.blend(i,{rect:n}),e.clear(n),e.blend(this.alphaLayer,{rect:n})):e.blend(i,{mode:this.compositeOperation,rect:RectTools.ceil(n)})}this.incompleteStrokeBounds=null,this.updatedArea=null}}},{key:"blendStroke",value:function(t,e,i){if(this.strokeBounds){var n=this.layer,r=t||this.canvas;if(i=RectTools.intersect(i||this.strokeBounds,r.bounds)){var o=this.color.alpha;o>0&&o<1?(this.alphaLayer.clear(),this.alphaLayer.ctx.globalAlpha=o,this.alphaLayer.blend(n,{rect:i}),r.blend(this.alphaLayer,{rect:i})):r.blend(n,{mode:e||this.compositeOperation,rect:RectTools.ceil(i)})}}}},{key:"toStroke",value:function(t){if(!this.brush)throw new Error("StrokeRenderer brush is not configured");var e=t.getPath(this.color),i=new Stroke(StrokeBrush.from(this.brush),e);return i.sensorDataContext=t.sensorDataContext,i}},{key:"delete",value:function(){console.warn("Not applicable with 2D API")}}]),t}(),format={nested:{WacomInkFormat3:{options:{optimize_for:"SPEED",java_multiple_files:!0,java_package:"com.wacom.ink"},nested:{Vector3:{fields:{x:{type:"float",id:1},y:{type:"float",id:2},z:{type:"float",id:3}}},Matrix3:{fields:{m00:{type:"float",id:1},m01:{type:"float",id:2},m02:{type:"float",id:3},m10:{type:"float",id:5},m11:{type:"float",id:6},m12:{type:"float",id:7},m20:{type:"float",id:9},m21:{type:"float",id:10},m22:{type:"float",id:11}}},Matrix4:{fields:{m00:{type:"float",id:1},m01:{type:"float",id:2},m02:{type:"float",id:3},m03:{type:"float",id:4},m10:{type:"float",id:5},m11:{type:"float",id:6},m12:{type:"float",id:7},m13:{type:"float",id:8},m20:{type:"float",id:9},m21:{type:"float",id:10},m22:{type:"float",id:11},m23:{type:"float",id:12},m30:{type:"float",id:13},m31:{type:"float",id:14},m32:{type:"float",id:15},m33:{type:"float",id:16}}},Rectangle:{fields:{x:{type:"float",id:1},y:{type:"float",id:2},width:{type:"float",id:3},height:{type:"float",id:4}}},InkState:{values:{PLANE:0,HOVERING:1,IN_VOLUME:2,VOLUME_HOVERING:3,START_TRACKING:4,STOP_TRACKING:5}},InkSensorType:{values:{CUSTOM:0,X:1,Y:2,Z:3,TIMESTAMP:4,PRESSURE:5,RADIUS_X:6,RADIUS_Y:7,AZIMUTH:8,ALTITUDE:9,ROTATION:10}},InkSensorMetricType:{values:{LENGTH:0,TIME:1,FORCE:2,ANGLE:3,NORMALIZED:4,LOGICAL_VALUE:5}},DataType:{values:{BOOLEAN:0,FLOAT32:1,FLOAT64:2,INT32:3,INT64:4,UINT32:5,UINT64:6}},EncodingMethod:{values:{DIRECT:0,DELTA:1}},InkDevice:{fields:{id:{type:"string",id:1},manufacturer:{type:"string",id:2},model:{type:"string",id:3},serialNumber:{type:"string",id:4},manufacturerID:{type:"string",id:5},channelGroups:{rule:"repeated",type:"InkSensorChannelGroup",id:6}}},InkSensorChannelGroup:{fields:{id:{type:"string",id:1},channels:{rule:"repeated",type:"InkSensorChannel",id:2},samplingRateHint:{type:"uint32",id:3},latency:{type:"uint32",id:4}}},InkSensorChannel:{fields:{id:{type:"string",id:1},type:{type:"InkSensorType",id:2},name:{type:"string",id:3},metric:{type:"InkSensorMetricType",id:4},resolution:{type:"float",id:5},min:{type:"float",id:6},max:{type:"float",id:7}}},DataList:{fields:{type:{type:"DataType",id:1},data:{type:"bytes",id:2},channelID:{type:"string",id:3},precision:{type:"uint32",id:4},encoding:{type:"EncodingMethod",id:5}}},SensorEvent:{fields:{id:{type:"string",id:1},timestamp:{type:"uint64",id:2},type:{type:"string",id:3},value:{type:"string",id:4},reference:{type:"string",id:5}}},InkDeviceContext:{fields:{id:{type:"string",id:1},inkDeviceID:{type:"string",id:2},offset:{type:"Vector3",id:3}}},SensorData:{fields:{id:{type:"string",id:1},inkDeviceContextID:{type:"string",id:2},state:{type:"InkState",id:3},timestamp:{type:"uint64",id:4},dataChannels:{rule:"repeated",type:"DataList",id:5}}},Path:{fields:{id:{type:"string",id:1},startParameter:{type:"float",id:2},endParameter:{type:"float",id:3},splineX:{rule:"repeated",type:"float",id:4},splineY:{rule:"repeated",type:"float",id:5},splineZ:{rule:"repeated",type:"float",id:6},red:{rule:"repeated",type:"bytes",id:7},green:{rule:"repeated",type:"bytes",id:8},blue:{rule:"repeated",type:"bytes",id:9},alpha:{rule:"repeated",type:"bytes",id:10},size:{rule:"repeated",type:"float",id:11},rotation:{rule:"repeated",type:"float",id:12},scaleX:{rule:"repeated",type:"float",id:13},scaleY:{rule:"repeated",type:"float",id:14},scaleZ:{rule:"repeated",type:"float",id:15},offsetX:{rule:"repeated",type:"float",id:16},offsetY:{rule:"repeated",type:"float",id:17},offsetZ:{rule:"repeated",type:"float",id:18},sensorDataMapping:{rule:"repeated",type:"uint32",id:19}}},RotationMode:{values:{NONE:0,RANDOM:1,TRAJECTORY:2}},VectorBrush:{fields:{id:{type:"string",id:1},pointX:{rule:"repeated",type:"float",id:2},pointY:{rule:"repeated",type:"float",id:3},pointZ:{rule:"repeated",type:"float",id:4},indices:{rule:"repeated",type:"uint32",id:5}}},RasterBrush:{fields:{id:{type:"string",id:1},shapeTexture:{rule:"repeated",type:"bytes",id:2},spacing:{type:"float",id:3},scattering:{type:"float",id:4},rotation:{type:"RotationMode",id:5},fillTexture:{rule:"repeated",type:"bytes",id:6},fillWidth:{type:"float",id:7},fillHeight:{type:"float",id:8},randomizeFill:{type:"bool",id:9}}},GroupElementType:{values:{GROUP:0,PATH:1,SENSOR_DATA:2,CHUNK:3,EXTERNAL:4}},ChunkType:{values:{PATH_CHUNK:0,SENSOR_DATA_CHUNK:1}},Group:{fields:{id:{type:"string",id:1},bounds:{type:"Rectangle",id:2},style:{type:"Style",id:3}}},Chunk:{fields:{id:{type:"string",id:1},pathID:{type:"string",id:2},type:{type:"ChunkType",id:3},fromPointIndex:{type:"uint32",id:4},toPointIndex:{type:"uint32",id:5}}},ExternalItem:{fields:{id:{type:"string",id:1}}},GroupItem:{fields:{id:{type:"string",id:1},parentID:{type:"string",id:2},previousID:{type:"string",id:3},type:{type:"GroupElementType",id:4}}},Groups:{fields:{data:{rule:"repeated",type:"Group",id:1},relations:{rule:"repeated",type:"GroupItem",id:2},chunks:{rule:"repeated",type:"Chunk",id:3},externalItems:{rule:"repeated",type:"ExternalItem",id:4}}},Style:{fields:{width:{type:"float",id:1},color:{type:"fixed32",id:2},brushID:{type:"string",id:3},particlesRandomSeed:{type:"uint32",id:4},renderMode:{type:"string",id:5}}},MetaDataType:{values:{DOCUMENT:0,AUTHOR:1,INK:2,ENVIRONMENT:3,DEVICE:4}},SemanticTriple:{fields:{subject:{type:"string",id:1},predicate:{type:"string",id:2},object:{type:"string",id:3}}},SemanticMetaData:{fields:{type:{type:"MetaDataType",id:1},statements:{rule:"repeated",type:"SemanticTriple",id:2}}},Devices:{fields:{data:{rule:"repeated",type:"InkDevice",id:1}}},DeviceData:{fields:{contexts:{rule:"repeated",type:"InkDeviceContext",id:1},events:{rule:"repeated",type:"SensorEvent",id:2}}},Semantics:{fields:{data:{rule:"repeated",type:"SemanticMetaData",id:1}}},Brushes:{fields:{vectored:{rule:"repeated",type:"VectorBrush",id:1},rastered:{rule:"repeated",type:"RasterBrush",id:2}}},PathRelation:{fields:{sensorDataOffset:{type:"uint32",id:1},sensorDataID:{type:"string",id:2},pathID:{type:"string",id:3},style:{type:"Style",id:4}}},InkData:{fields:{paths:{rule:"repeated",type:"Path",id:1},sensorData:{rule:"repeated",type:"SensorData",id:2},relations:{rule:"repeated",type:"PathRelation",id:3},groups:{type:"Groups",id:4}}},UniversalInkData:{fields:{deviceData:{type:"DeviceData",id:1},inkData:{type:"InkData",id:2},brushes:{type:"Brushes",id:3},semantics:{type:"Semantics",id:4},devices:{type:"Devices",id:5}}}}}}},Group=function(){function t(e,i){var n;_classCallCheck(this,t),this.bounds=e,this.style=i,Object.defineProperty(this,"id",{get:function(){return n||(n=utils.uuid()),n},set:function(t){n=t},enumerable:!0})}return _createClass(t,[{key:"setStyle",value:function(){}}]),t}(),Chunk=function t(e,i,n,r){var o;_classCallCheck(this,t),this.type=e,this.pathID=i,this.fromPointIndex=n,this.toPointIndex=r,Object.defineProperty(this,"id",{get:function(){return o||(o=utils.uuid()),o},set:function(t){o=t},enumerable:!0})};Chunk.createEnum("Type",["PATH","SENSOR_DATA"]);var GroupItem=function t(e,i,n,r){_classCallCheck(this,t),this.type=e,this.id=i,this.parentID=n,this.previousID=r};GroupItem.createEnum("Type",["GROUP","PATH","SENSOR_DATA","CHUNK","EXTERNAL"]);var ExternalItem=function t(e){_classCallCheck(this,t),this.id=e},DataModel=function(){function t(e){_classCallCheck(this,t),this.root=e||new Group,this.parent=this.root,this.groups=[],this.chunks=[],this.externalItems=[],this.strokes=[],this.sensorDataContexts=[],this.relations=[],this.groups.push(this.root),this.relations.push(new GroupItem(GroupItem.Type.GROUP,this.root.id))}return _createClass(t,[{key:"addGroup",value:function(t,e){this.groups.push(t),this.addRelation(GroupItem.Type.GROUP,t.id,e)}},{key:"addStroke",value:function(t,e){this.strokes.push(t),this.addRelation(GroupItem.Type.PATH,t.id,e)}},{key:"addSensorDataContext",value:function(t,e){this.sensorDataContexts.push(t),this.addRelation(GroupItem.Type.SENSOR_DATA,t.id,e)}},{key:"addChunk",value:function(t,e){this.chunks.push(t),this.addRelation(GroupItem.Type.CHUNK,t.id,e)}},{key:"addExternalItem",value:function(t,e){this.externalItems.push(t),this.addRelation(GroupItem.Type.EXTERNAL,t.id,e)}},{key:"addRelation",value:function(t,e,i){if(i){if(this.relations.filter(function(t){return t.id==i}).first.parentID!=this.parent.id)throw new Error("Current parent and previous item parent mismatch for item with id ".concat(e));var n=this.relations.filter(function(t){return t.previousID==i}).first;n&&(n.previousID=e)}else i=this.getPreviousID();this.relations.push(new GroupItem(t,e,this.parent.id,i))}},{key:"getPreviousID",value:function(){var t=this.getOrderedChilden(this.parent);return t.last?t.last.id:void 0}},{key:"getOrderedChilden",value:function(t){var e=[],i=this.relations.filter(function(e){return e.parentID==t.id}),n=Object.assign.apply(Object,[{}].concat(_toConsumableArray(i.map(function(t){return _defineProperty({},t.previousID,t)}))));if(i.length>0)for(var r;i.length>0;){var o=n[r];r=o.id,e.push(o),i.remove(o)}return e}},{key:"remove",value:function(t,e){var i=this.relations.filter(function(e){return e.id==t}).first;if(!i)throw new Error("Item with id ".concat(t,", not found"));switch(i.type){case GroupItem.Type.GROUP:this.delete(this.groups,t);break;case GroupItem.Type.PATH:this.delete(this.strokes,t);break;case GroupItem.Type.SENSOR_DATA:this.delete(this.sensorDataContexts,t);break;case GroupItem.Type.CHUNK:this.delete(this.chunks,t);break;case GroupItem.Type.EXTERNAL:this.delete(this.externalItems,t)}e||this.cleanRelations(i),this.delete(this.relations,t)}},{key:"delete",value:function(t,e){var i=t.filter(function(t){return t.id==e}).first;return t.remove(i)}},{key:"cleanRelations",value:function(t){var e=this,i=this.relations.filter(function(e){return e.parentID==t.parentID&&e.previousID==t.id}).first;(i&&(i.previousID=t.previousID),t.type==GroupItem.Type.GROUP)&&this.enlistChildren(t).forEach(function(t){return e.remove(t.id,!0)})}},{key:"enlistChildren",value:function(t){var e=this,i=this.relations.filter(function(e){return e.parentID==t.id});return i.filter(function(t){return t.type==GroupItem.Type.GROUP}).forEach(function(t){var n=e.enlistChildren(t);i=i.concat(n)}),i}},{key:"getHierarchy",value:function(){return this.getHierarchyLevel(this.root)}},{key:"getHierarchyLevel",value:function(t){var e=this,i=this.getOrderedChilden(t),n=i.filter(function(t){return t.type==GroupItem.Type.GROUP});return i.id=t.id,n.forEach(function(t){var n=e.getHierarchyLevel(t);i.replace(t,n,!0)}),i}}]),t}(),SemanticsData=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];_classCallCheck(this,t),this.type=e,this.statements=i}return _createClass(t,[{key:"add",value:function(t){this.statements.push(t)}}]),t}();SemanticsData.createEnum("Type",["DOCUMENT","AUTHOR","INK","ENVIRONMENT","DEVICE"]);var SemanticTripple=function t(e,i,n){_classCallCheck(this,t),this.subject=e,this.predicate=i,this.object=n};function encode(){return this.constructor.encode(this).finish()}var CODEC_DATA={inkData:void 0,semantics:void 0,brushes:void 0,devices:void 0,deviceData:void 0},InkCodec=function(){function t(){var e;if(_classCallCheck(this,t),"undefined"==typeof protobuf)throw new Error("Error loading module 'InkCodec'. Its dependency 'protobuf' was not found. Please, check whether 'protobuf' is loaded prior to 'InkCodec'.");e=protobuf.Root,t.format||(t.format=e.fromJSON(format).WacomInkFormat3),this.encodeData=Object.assign({},CODEC_DATA),this.decodeData=Object.assign({},CODEC_DATA)}return _createClass(t,[{key:"encode",value:function(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.DataType.INK_DOCUMENT;switch(i){case t.DataType.INK_DOCUMENT:var n=t.format.UniversalInkData.create(this.encodeData);e=t.format.UniversalInkData.encode(n).finish();break;case t.DataType.DEVICE_DATA:e=this.encodeData.deviceData.encode();break;case t.DataType.INK_DATA:e=this.encodeData.inkData.encode();break;case t.DataType.BRUSHES:e=this.encodeData.brushes.encode();break;case t.DataType.SEMANTICS:e=this.encodeData.semantics.encode();break;case t.DataType.DEVICES:e=this.encodeData.devices.encode();break;default:throw new Error("Invalid encode type provided: ".concat(i))}return this.encodeData=Object.assign({},CODEC_DATA),e}},{key:"decode",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.DataType.INK_DOCUMENT;switch(this.decodeData=Object.assign({},CODEC_DATA),i){case t.DataType.INK_DOCUMENT:var n=t.format.UniversalInkData.decode(e);this.decodeData.inkData=n.inkData,this.decodeData.brushes=n.brushes,this.decodeData.semantics=n.semantics,this.decodeData.devices=n.devices,this.decodeData.deviceData=n.deviceData;break;case t.DataType.DEVICE_DATA:this.decodeData.deviceData=t.format.DeviceData.decode(e);break;case t.DataType.INK_DATA:this.decodeData.inkData=t.format.InkData.decode(e);break;case t.DataType.BRUSHES:this.decodeData.brushes=t.format.Brushes.decode(e);break;case t.DataType.SEMANTICS:this.decodeData.semantics=t.format.Semantics.decode(e);break;case t.DataType.DEVICES:this.decodeData.devices=t.format.Devices.decode(e);break;default:throw new Error("Invalid decode type provided: ".concat(i))}var r=this.decodeDevices(),o=this.decodeDeviceData();o&&InkDeviceContextProvider.feed(o.contexts);var a,s,l=this.decodeSemantics(),u=this.decodeBrushes(),h=this.decodeInkData(u,r);return h instanceof DataModel?a=h:s=h,{brushes:u,strokes:s,dataModel:a,semantics:l,devices:r,deviceData:o}}},{key:"encodeInkData",value:function(e){var i,n,r,o=this;r=e instanceof DataModel?(n=(i=e).strokes).length>0?n.filter(function(t){return!!t.sensorDataContext}).map(function(t){return t.sensorDataContext}):i.sensorDataContext:(n=e).filter(function(t){return!!t.sensorDataContext}).map(function(t){return t.sensorDataContext});var a=t.format.InkData.create({paths:n.map(function(t){return o.encodeStroke(t)}),sensorData:r.map(function(t){return o.encodeSensorData(t)}),relations:n.map(function(t){return o.encodePathRelation(t)}),groups:this.encodeGroups(i)});a.encode=encode,this.encodeData.inkData=a}},{key:"decodeInkData",value:function(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=this.decodeData.inkData;if(r){var o=r.paths.map(function(t){return e.decodePath(t)}),a=r.sensorData.map(function(t){return e.decodeSensorData(t,n)}),s=r.relations.map(function(t){return e.decodePathRelation(t)}),l=[];return o.forEach(function(e){var n=s.filter(function(t){return t.pathID==e.id}).first,r=a.filter(function(t){return t.id==n.sensorDataID}).first,o=n.style;if(e.width=o.width,e.color=o.color,o.brushID){var u=i.filter(function(t){return t.id==o.brushID}).first;u||(u=t.getStrokeBrush(o.brushID));var h=new Stroke(StrokeBrush.from(u,o.randomSeed),e);h.sensorDataContext=r,h.sensorDataOffset=n.sensorDataOffset,h.sensorDataMapping=e.sensorDataMapping,l.push(h)}}),r.groups?this.decodeGroups(l,0==l.length?a:void 0):l}}},{key:"encodeStroke",value:function(e){for(var i=t.format.Path.create({id:e.id,startParameter:e.ts,endParameter:e.tf,sensorDataMapping:e.sensorDataMapping}),n=function(t){var n=e.pointAt(t);e.layout.forEach(function(t){switch(t){case PathPoint.Property.X:i.splineX.push(n.x);break;case PathPoint.Property.Y:i.splineY.push(n.y);break;case PathPoint.Property.Z:i.splineZ.push(n.z);break;case PathPoint.Property.RED:i.red=n.red;break;case PathPoint.Property.GREEN:i.green=n.green;break;case PathPoint.Property.BLUE:i.blue=n.blue;break;case PathPoint.Property.ALPHA:i.alpha=Math.round(255*n.alpha);break;case PathPoint.Property.SIZE:i.size.push(n.size);break;case PathPoint.Property.ROTATION:i.rotation.push(n.rotation);break;case PathPoint.Property.SCALE_X:i.scaleX.push(n.scaleX);break;case PathPoint.Property.SCALE_Y:i.scaleY.push(n.scaleY);break;case PathPoint.Property.SCALE_Z:i.scaleZ.push(n.scaleZ);break;case PathPoint.Property.OFFSET_X:i.offsetX.push(n.offsetX);break;case PathPoint.Property.OFFSET_Y:i.offsetY.push(n.offsetY);break;case PathPoint.Property.OFFSET_Z:i.offsetZ.push(n.offsetZ);break;default:throw new Error("Invalid layout property provided: ".concat(t))}})},r=0;r<e.length;r++)n(r);return i}},{key:"decodePath",value:function(t){if(0==t.splineX.length||0==t.splineY.length)throw new Error("Incomplete path definition");var e=[PathPoint.Property.X,PathPoint.Property.Y];t.splineZ.length>0&&e.push(PathPoint.Property.Z),t.red.length>0&&e.push(PathPoint.Property.RED),t.green.length>0&&e.push(PathPoint.Property.GREEN),t.blue.length>0&&e.push(PathPoint.Property.BLUE),t.alpha.length>0&&e.push(PathPoint.Property.ALPHA),t.size.length>0&&e.push(PathPoint.Property.SIZE),t.rotation.length>0&&e.push(PathPoint.Property.ROTATION),t.scaleX.length>0&&e.push(PathPoint.Property.SCALE_X),t.scaleY.length>0&&e.push(PathPoint.Property.SCALE_Y),t.scaleZ.length>0&&e.push(PathPoint.Property.SCALE_Z),t.offsetX.length>0&&e.push(PathPoint.Property.OFFSET_X),t.offsetY.length>0&&e.push(PathPoint.Property.OFFSET_Y),t.offsetZ.length>0&&e.push(PathPoint.Property.OFFSET_Z);for(var i=t.splineX.length,n=e.length,r=new Float32Array(i*n),o=function(i){e.forEach(function(e,o){var a;switch(e){case PathPoint.Property.X:a=t.splineX[i];break;case PathPoint.Property.Y:a=t.splineY[i];break;case PathPoint.Property.Z:a=t.splineZ[i];break;case PathPoint.Property.RED:a=t.red[i];break;case PathPoint.Property.GREEN:a=t.green[i];break;case PathPoint.Property.BLUE:a=t.blue[i];break;case PathPoint.Property.ALPHA:a=t.alpha[i]/255;break;case PathPoint.Property.SIZE:a=t.size[i];break;case PathPoint.Property.ROTATION:a=t.rotation[i];break;case PathPoint.Property.SCALE_X:a=t.scaleX[i];break;case PathPoint.Property.SCALE_Y:a=t.scaleY[i];break;case PathPoint.Property.SCALE_Z:a=t.scaleZ[i];break;case PathPoint.Property.OFFSET_X:a=t.offsetX[i];break;case PathPoint.Property.OFFSET_Y:a=t.offsetY[i];break;case PathPoint.Property.OFFSET_Z:a=t.offsetZ[i];break;default:throw new Error("Invalid layout property provided: ".concat(e.name))}r[i*n+o]=a})},a=0;a<i;a++)o(a);return{id:t.id,ts:t.startParameter,tf:t.endParameter,layout:e,points:r,sensorDataMapping:t.sensorDataMapping}}},{key:"encodePathRelation",value:function(e){var i=t.format.PathRelation.create({pathID:e.id,sensorDataOffset:e.sensorDataOffset});e.sensorDataContext&&(i.sensorDataID=e.sensorDataContext.id);var n=t.format.Style.create();return isNaN(e.width)||(n.width=e.width),e.color&&(n.color=t.encodeColor(e.color)),e.brush.randomSeed&&(n.particlesRandomSeed=e.brush.randomSeed),e.renderMode&&(n.renderMode=e.renderMode),e.brush.id?n.brushID=e.brush.id:console.warn("Possible lost of relation between stroke and brush. It is recommended to provide brush id for every stroke brush."),i.style=n,i}},{key:"decodePathRelation",value:function(e){var i=e.style;return{sensorDataOffset:e.sensorDataOffset,sensorDataID:e.sensorDataID&&""!=e.sensorDataID?e.sensorDataID:null,pathID:e.pathID,style:{width:i.width||NaN,color:i.color?t.decodeColor(i.color):null,brushID:i.brushID,randomSeed:i.particlesRandomSeed||null,renderMode:i.renderMode}}}},{key:"encodeSensorData",value:function(e){if(e){var i=t.format.SensorData.create({id:e.id,inkDeviceContextID:e.device.context.id,state:t.format.InkState[e.inkState.name]});return e.sensorDataByGroup.forEach(function(e){var n={};e.channels.forEach(function(t){return n[t.id]=[]});for(var r=function(t){var i=e.pointAt(t);e.channels.forEach(function(t){var e=t.type==InkSensorChannel.Type.CUSTOM?t.name:utils.getPropName(t.type.name);n[t.id].push(i[e])})},o=0;o<e.length;o++)r(o);e.channels.forEach(function(e){if(!e.dataType)throw new Error("Data type not found for channel with id: ".concat(e.id));var r,o=t.format.DataList.create({channelID:e.id,type:t.format.DataType[e.dataType.name]});switch(e.dataType){case InkSensorChannel.DataType.FLOAT32:r=n[e.id].toFloat32Array();break;case InkSensorChannel.DataType.FLOAT64:r=n[e.id].toFloat64Array();break;case InkSensorChannel.DataType.INT32:r=n[e.id].toInt32Array();break;case InkSensorChannel.DataType.UINT32:r=n[e.id].toUint32Array();break;case InkSensorChannel.DataType.INT64:case InkSensorChannel.DataType.UINT64:if("undefined"==typeof BigInt){var a,s=n[e.id].map(function(t){return utils.longToByteArray(t)});r=(a=[]).concat.apply(a,_toConsumableArray(s)).toUint8Array()}else{var l=n[e.id];"bigint"!=typeof l.first&&(l=l.map(function(t){return BigInt(t)})),r=e.dataType==InkSensorChannel.DataType.INT64?l.toBigInt64Array():l.toBigUint64Array()}break;case InkSensorChannel.DataType.BOOLEAN:r=new Uint8Array(n[e.id].map(function(t){return t?1:0}))}o.data=new Uint8Array(r.buffer),i.dataChannels.push(o)})}),i}}},{key:"decodeSensorData",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=InkDeviceContextProvider.all().filter(function(t){return t.id==e.inkDeviceContextID}).first;if(!n)throw new Error("Decoding of sensor data relies on device context. Context with id ".concat(e.inkDeviceContextID," is not found."));SensorDataContext.InkState[t.format.InkState[e.state]];var r=i.filter(function(t){return t.id==n.deviceID}).first;if(r||(r=t.getDevice(n.deviceID)),!r)throw new Error("Decoding of sensor data relies on device description. Please provide device via InkCodec.getDevice method");var o={},a={},s={};e.dataChannels.forEach(function(e){var i=r.getGroupByChannelID(e.channelID);if(!i)throw new Error("Not found corresponding channel group for data with channelID ".concat(e.channelID));o[i.id]||(o[i.id]=[]);var n,s=i.getChannel(e.channelID),l=InkSensorChannel.DataType[t.format.DataType[e.type]],u=new Uint8Array(e.data,e.data.byteOffset,e.data.length);switch(s.dataType=l,l){case InkSensorChannel.DataType.FLOAT32:n=new Float32Array(u.buffer);break;case InkSensorChannel.DataType.FLOAT64:n=new Float64Array(u.buffer);break;case InkSensorChannel.DataType.INT32:n=new Int32Array(u.buffer);break;case InkSensorChannel.DataType.UINT32:n=new Uint32Array(u.buffer);break;case InkSensorChannel.DataType.INT64:case InkSensorChannel.DataType.UINT64:if("undefined"==typeof BigInt){n=[];for(var h=0;h<u.length;h+=8){var c=u.subarray(h,h+8);n.push(utils.byteArrayToLong(c))}}else n=l==InkSensorChannel.DataType.INT64?new BigInt64Array(u.buffer):new BigUint64Array(u.buffer);break;case InkSensorChannel.DataType.BOOLEAN:n=[],u.forEach(function(t){return n.push(!!t)})}o[i.id].push(s),a[e.channelID]=n}),Object.keys(o).forEach(function(t){for(var e=r.getGroup(t),i=[],n=a[e.channels.first.id].length,o=function(t){e.channels.forEach(function(e){var n=a[e.id];i.push(n[t])})},l=0;l<n;l++)o(l);s[t]=i});var l=Object.values(o).map(function(t){return new SensorData(t,o[t],s[t])}),u=new SensorDataContext(r,l);return u.id=e.id,u.inkState=e.inkState,u}},{key:"encodeGroups",value:function(e){if(e){var i=t.format.Groups.create();return e.groups.forEach(function(e){i.data.push(t.format.Group.create({id:e.id}))}),e.chunks.forEach(function(e){i.chunks.push(t.format.Chunk.create({id:e.id,pathID:e.pathID,type:t.format.ChunkType[e.type.name+"_CHUNK"],fromPointIndex:e.fromPointIndex,toPointIndex:e.toPointIndex}))}),e.externalItems.forEach(function(e){i.externalItems.push(t.format.ExternalItem.create({id:e.id}))}),e.relations.forEach(function(e){i.relations.push(t.format.GroupItem.create({id:e.id,parentID:e.parentID,previousID:e.previousID,type:t.format.GroupElementType[e.type.name]}))}),i}}},{key:"decodeGroups",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this.decodeData.inkData.groups,r=n.relations.filter(function(e){return!e.parentID&&!e.previousID&&e.type==t.format.GroupElementType.GROUP}).first;if(!r)throw new Error("Invalid hieracrchy detected. Root group relation is not found. ");var o={};Object.keys(t.format.ChunkType).forEach(function(e){var i=e.substring(0,e.lastIndexOf("_")),n=t.format.ChunkType[e];o[i]=n,o[n]=i});var a=n.data.filter(function(t){return t.id==r.id}).first,s=new Group;s.id=a.id;var l=new DataModel(s);return l.strokes=e,l.sensorDataContexts=i,n.data.forEach(function(t){if(t.id!=s.id){var e=new Group;e.id=t.id,l.groups.push(e)}}),n.chunks.forEach(function(t){var e=new Chunk(Chunk.Type[o[t.type]],t.pathID,t.fromPointIndex,t.toPointIndex);e.id=t.id,l.chunks.push(e)}),n.externalItems.forEach(function(t){var e=new ExternalItem(t.id);l.externalItems.push(e)}),n.relations.forEach(function(e){if(e.id!=s.id){var i=new GroupItem(GroupItem.Type[t.format.GroupElementType[e.type]],e.id,e.parentID,e.previousID);l.relations.push(i)}}),l}},{key:"encodeBrush",value:function(e,i,n){if(!e.id)throw new Error("brush id is required");var r=this.encodeData.brushes;if(r||((r=t.format.Brushes.create()).encode=encode,this.encodeData.brushes=r),e instanceof PolygonBrush){for(var o=t.format.VectorBrush.create({id:e.id}),a=0;a<e.polygon.length;a+=2)o.pointX.push(e.polygon[a]),o.pointY.push(e.polygon[a+1]);r.vectored.push(o)}else{if(!(e instanceof ParticleBrush))throw new Error("brush should be instance of PolygonBrush or ParticleBrush");if(!i)throw new Error("shape definition is missing");if(!n)throw new Error("fill definition is missing");var s=t.format.RasterBrush.create({id:e.id,spacing:e.spacing,scattering:e.scattering,rotation:t.format.RotationMode[e.rotationMode.name],fillWidth:e.fillTextureSize.width,fillHeight:e.fillTextureSize.height,randomizeFill:e.randomizeFill});Array.isArray(i)?s.shapeTexture=i:s.shapeTexture.push(i),Array.isArray(n)?s.fillTexture=n:s.fillTexture.push(n),r.rastered.push(s)}}},{key:"decodeBrushes",value:function(){var t=this.decodeData.brushes;if(t){var e=[];return t.vectored.forEach(function(t){for(var i=new Float32Array(2*t.pointX.length),n=0;n<t.pointX.length;n++)i[2*n+0]=t.pointX[n],i[2*n+1]=t.pointY[n];e.push(new PolygonBrush(i,t.id))}),t.rastered.forEach(function(t){var i,n;i=1==t.shapeTexture.length?t.shapeTexture.first:t.shapeTexture,n=1==t.fillTexture.length?t.fillTexture.first:t.fillTexture;var r=new ParticleBrush(t.spacing,t.scattering,ParticleBrush.RotationMode[t.rotation],i,n,{width:t.fillWidth,height:t.fillHeight});r.id=t.id,e.push(r)}),e}}},{key:"encodeSemantics",value:function(){var e=this.encodeData.semantics;e||((e=t.format.Semantics.create()).encode=encode,this.encodeData.semantics=e)}},{key:"decodeSemantics",value:function(){var e=this.decodeData.semantics;if(e){var i=[];return e.data.forEach(function(e){i.push(new SemanticsData(SemanticsData.Type[t.format.MetaDataType[e.type]],e.statements.map(function(t){return new SemanticTripple(t.subject,t.predicate,t.object)})))}),i}}},{key:"encodeDevice",value:function(e){var i=this.encodeData.devices;i||((i=t.format.Devices.create()).encode=encode,this.encodeData.devices=i);var n=t.format.InkDevice.create({id:e.id,manufacturer:e.manufacturer,model:e.model,serialNumber:e.serialNumber,manufacturerID:e.manufacturerID});e.channelGroups.forEach(function(e){var i=t.format.InkSensorChannelGroup.create({id:e.id,samplingRateHint:e.samplingRate,latency:e.latency});e.channels.forEach(function(e){var n=t.format.InkSensorChannel.create({id:e.id,type:t.format.InkSensorType[e.type.name],name:e.name,metric:t.format.InkSensorMetricType[e.metric.name],resolution:e.resolution,min:e.min,max:e.max});i.channels.push(n)}),n.channelGroups.push(i)}),i.data.push(n)}},{key:"decodeDevices",value:function(){var e=this.decodeData.devices;if(e){var i=[];return e.data.forEach(function(e){var n=new InkDevice(e.id,e.manufacturer||void 0,e.model||void 0,e.serialNumber||void 0,e.manufacturerID||void 0);e.channelGroups.forEach(function(e){var i=new InkSensorChannelGroup(e.id,e.samplingRateHint,e.latency);e.channels.forEach(function(e){var n=new InkSensorChannel(e.id,InkSensorChannel.Type[t.format.InkSensorType[e.type]],InkSensorChannel.Metric[t.format.InkSensorMetricType[e.metric]],e.min,e.max,e.resolution);if(n.type==InkSensorChannel.Type.CUSTOM&&!e.name)throw new Error("Detected missing custom channel name identifier");n.name=e.name,i.add(n)}),n.addGroup(i)}),i.push(n)}),i}}},{key:"encodeDeviceData",value:function(){var e=this.encodeData.deviceData;e||((e=t.format.DeviceData.create()).encode=encode,this.encodeData.deviceData=e),InkDeviceContextProvider.all().forEach(function(i){e.contexts.push(t.format.InkDeviceContext.create({id:i.id,inkDeviceID:i.deviceID}))})}},{key:"decodeDeviceData",value:function(){var t=this.decodeData.deviceData;if(t){var e=[];return t.contexts.forEach(function(t){var i=new InkDeviceContext(t.inkDeviceID);i.id=t.id,e.push(i)}),{contexts:e}}}}],[{key:"encodeColor",value:function(t){return(255&t.red)<<24|(255&t.green)<<16|(255&t.blue)<<8|255*t.alpha&255}},{key:"decodeColor",value:function(t){var e=t>>24&255,i=t>>16&255,n=t>>8&255,r=(255&t)/255;return Color.from(e,i,n,r)}},{key:"getStrokeBrush",value:function(t){throw new Error("InkCodec.getStrokeBrush(brushID, [user]) should be implemented")}},{key:"getDevice",value:function(t){throw new Error("InkCodec.getDevice(deviceID) should be implemented")}}]),t}();InkCodec.createEnum("DataType",["INK_DOCUMENT","DEVICE_DATA","INK_DATA","BRUSHES","SEMANTICS","DEVICES"]),exports.Chunk=Chunk,exports.Color=Color,exports.DataModel=DataModel,exports.GLTools=GLTools,exports.Group=Group,exports.InkBuilder=InkBuilder$1,exports.InkCanvas2D=InkCanvas$1,exports.InkCanvasGL=InkCanvas,exports.InkCodec=InkCodec,exports.InkDevice=InkDevice,exports.InkSensorChannel=InkSensorChannel,exports.InterpolatedSpline=InterpolatedSpline$1,exports.ParticleBrush=ParticleBrush,exports.PathPoint=PathPoint,exports.PolygonBrush=PolygonBrush,exports.Rect=Rect,exports.RectTools=RectTools,exports.Scalar=Scalar$1,exports.SensorData=SensorData,exports.SensorDataContext=SensorDataContext,exports.Stroke=Stroke,exports.StrokeBrush=StrokeBrush,exports.StrokeRenderer2D=StrokeRenderer$1,exports.StrokeRendererGL=StrokeRenderer,Object.defineProperty(exports,"__esModule",{value:!0})});
